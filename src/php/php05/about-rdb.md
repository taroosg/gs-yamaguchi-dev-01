# RDBの構造

## RDB（Relational Database）とは

### 複雑なデータが必要なとき

- 一つのテーブルから取得できる情報は限られている．
- ECで購入したユーザの情報と商品の情報を両方取得したい場合は．．？？

### 複数のテーブル同士を連携（relation）させるッ！！

- テーブルの設計段階で連携させたいidのカラムをつくっておく！
- 両方のテーブルを関連付けるテーブルを「SQLで」作成する！
- 大事なのはデータの構造を見極めること！！

まずは下記2種類のデータ構造をマスターしよう！


## One to Many（カテゴリテーブルとユーザテーブル）

一つのカテゴリには複数のユーザが在籍するが，ユーザの所属は一つ．

### カテゴリテーブル

|category_id|name|
|-:|-|
|1|ファントムブラッド|
|2|戦闘潮流|
|3|スターダストクルセイダース|
|4|ダイヤモンドは砕けない|
|5|黄金の風|
|6|ストーンオーシャン|
|7|スティール・ボール・ラン|

### ユーザテーブル

|user_id|name|
|-:|-|
|1|ディオ|
|2|ツェペリ|
|3|リサリサ|
|4|カーズ|
|5|花京院|
|6|DIO|
|7|吉良吉影|
|8|早人|
|9|フーゴ|
|10|ディアボロ|
|11|エルメス|
|12|プッチ|
|13|ジャイロ|
|14|ヴァレンタイン|


「多」の側に対応するidを入れる構造にすればOK．

誰がどこに所属しているかがわかるようになる！


|user_id|name|category_id|
|-:|-|-:|
|1|ディオ|1|
|2|ツェペリ|1|
|3|リサリサ|2|
|4|カーズ|2|
|5|花京院|3|
|6|DIO|3|
|7|吉良吉影|4|
|8|早人|4|
|9|フーゴ|5|
|10|ディアボロ|5|
|11|エルメス|6|
|12|プッチ|6|
|13|ジャイロ|7|
|14|ヴァレンタイン|7|


## Many to Many（カテゴリテーブルと擬音語テーブル）

カテゴリは複数の擬音語が登場し，擬音語も複数のカテゴリで使われる．


### カテゴリテーブル

|category_id|name|
|-:|-|
|1|ファントムブラッド|
|2|戦闘潮流|
|3|スターダストクルセイダース|
|4|ダイヤモンドは砕けない|
|5|黄金の風|
|6|ストーンオーシャン|
|7|スティール・ボール・ラン|

### 擬音語テーブル

|sound_id|name|
|-:|-|
|1|ドドドドド|
|2|ゴゴゴゴゴ|
|3|ドォーン|
|4|バァーン|
|5|ドグシャア|
|6|ズキュウゥゥン|
|7|メメタァ|
|8|ガオン|
|9|ズアッ|

### 中間テーブル

この場合，「どのカテゴリに」「どの擬音語が登場するか」を表す別のテーブルを作成する．

このテーブルのことを「中間テーブル」と呼ぶ．

|category_id|sound_id|
|-:|-:|
|1|1|
|1|2|
|1|7|
|7|7|
|3|9|
|1|6|
|3|1|
|5|5|
|7|5|


## テーブルの設計

データ構造を考える際には，「どうすればうまくいくか」よりも「このパターンはマズイ」を押さえるとうまくいきやすい．

マズイパターンのことを「アンチパターン」と呼ぶが，まずは下記のパターンがないかどうか確認しよう．

### 💡 Key Point

>出やすいアンチパターン
>- ユーザの操作でテーブルが増える（減る）．
>- ユーザの操作でカラムが増える（減る）．
>- 一つのセル（でいいのかな？）に複数のデータ（数値など）が入る．
>- なにかのデータを更新したときに，別のテーブルのデータを更新する必要がある．

