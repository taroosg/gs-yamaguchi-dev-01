<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>G's-Yamaguchi-Dev01</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="note/index.html"><strong aria-hidden="true">1.</strong> 講義資料ノート</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="note/first-work.html"><strong aria-hidden="true">1.1.</strong> 初回課題の案内</a></li><li class="chapter-item expanded "><a href="note/about.html"><strong aria-hidden="true">1.2.</strong> 受講時の注意</a></li><li class="chapter-item expanded "><a href="note/with-code.html"><strong aria-hidden="true">1.3.</strong> コードへの向き合い方</a></li><li class="chapter-item expanded "><a href="note/for-work.html"><strong aria-hidden="true">1.4.</strong> 課題にチャレンジするコツ</a></li><li class="chapter-item expanded "><a href="note/work-post.html"><strong aria-hidden="true">1.5.</strong> 課題提出</a></li></ol></li><li class="chapter-item expanded "><a href="html-css/index.html"><strong aria-hidden="true">2.</strong> HTML &amp; CSS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="html-css/about-html-and-css.html"><strong aria-hidden="true">2.1.</strong> HTML と CSS の役割</a></li><li class="chapter-item expanded "><a href="html-css/get-started.html"><strong aria-hidden="true">2.2.</strong> ファイルの準備と動作確認</a></li><li class="chapter-item expanded "><a href="html-css/html.html"><strong aria-hidden="true">2.3.</strong> HTML</a></li><li class="chapter-item expanded "><a href="html-css/css.html"><strong aria-hidden="true">2.4.</strong> CSS / ページ設定，背景，文字の大きさ，色</a></li><li class="chapter-item expanded "><a href="html-css/inspect.html"><strong aria-hidden="true">2.5.</strong> 【tips】検証画面の活用</a></li><li class="chapter-item expanded "><a href="html-css/flex.html"><strong aria-hidden="true">2.6.</strong> CSS / レイアウト</a></li><li class="chapter-item expanded "><a href="html-css/work.html"><strong aria-hidden="true">2.7.</strong> 演習</a></li></ol></li><li class="chapter-item expanded "><a href="js/js01/index.html"><strong aria-hidden="true">3.</strong> JS_おみくじ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js01/about-js.html"><strong aria-hidden="true">3.1.</strong> JavaScript とは</a></li><li class="chapter-item expanded "><a href="js/js01/variable.html"><strong aria-hidden="true">3.2.</strong> 変数と計算</a></li><li class="chapter-item expanded "><a href="js/js01/random.html"><strong aria-hidden="true">3.3.</strong> ランダムな数（乱数）をつくる</a></li><li class="chapter-item expanded "><a href="js/js01/if.html"><strong aria-hidden="true">3.4.</strong> 条件分岐</a></li><li class="chapter-item expanded "><a href="js/js01/omikuji.html"><strong aria-hidden="true">3.5.</strong> おみくじの Web アプリ実装</a></li><li class="chapter-item expanded "><a href="js/js01/work.html"><strong aria-hidden="true">3.6.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="git/index.html"><strong aria-hidden="true">4.</strong> Git</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="git/cli.html"><strong aria-hidden="true">4.1.</strong> GUI と CLI</a></li><li class="chapter-item expanded "><a href="git/git.html"><strong aria-hidden="true">4.2.</strong> Git</a></li><li class="chapter-item expanded "><a href="git/github-about.html"><strong aria-hidden="true">4.3.</strong> GitHub 概要</a></li><li class="chapter-item expanded "><a href="git/github-setup/index.html"><strong aria-hidden="true">4.4.</strong> GitHub 設定</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="git/github-setup/setup-ssh-key.html"><strong aria-hidden="true">4.4.1.</strong> SSH 鍵の発行</a></li><li class="chapter-item expanded "><a href="git/github-setup/config.html"><strong aria-hidden="true">4.4.2.</strong> 設定ファイルの編集</a></li><li class="chapter-item expanded "><a href="git/github-setup/add-ssy-key-to-github.html"><strong aria-hidden="true">4.4.3.</strong> GitHub への SSH 鍵登録</a></li><li class="chapter-item expanded "><a href="git/github-setup/connect-to-github.html"><strong aria-hidden="true">4.4.4.</strong> GitHub との接続設定</a></li></ol></li><li class="chapter-item expanded "><a href="git/github-init.html"><strong aria-hidden="true">4.5.</strong> GitHub にプロダクトを push</a></li><li class="chapter-item expanded "><a href="git/github-push.html"><strong aria-hidden="true">4.6.</strong> GitHub に最新版を push</a></li></ol></li><li class="chapter-item expanded "><a href="js/js02/index.html"><strong aria-hidden="true">5.</strong> JS_メモパッド</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js02/array.html"><strong aria-hidden="true">5.1.</strong> 配列</a></li><li class="chapter-item expanded "><a href="js/js02/for.html"><strong aria-hidden="true">5.2.</strong> 繰り返し処理</a></li><li class="chapter-item expanded "><a href="js/js02/object.html"><strong aria-hidden="true">5.3.</strong> オブジェクト</a></li><li class="chapter-item expanded "><a href="js/js02/memopad01.html"><strong aria-hidden="true">5.4.</strong> LocalStorage（メモ帳初級）</a></li><li class="chapter-item expanded "><a href="js/js02/memopad02.html"><strong aria-hidden="true">5.5.</strong> JSON データ（メモ帳中級）</a></li><li class="chapter-item expanded "><a href="js/js02/work.html"><strong aria-hidden="true">5.6.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="js/js03/index.html"><strong aria-hidden="true">6.</strong> JS_配列と繰り返し</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js03/array-for.html"><strong aria-hidden="true">6.1.</strong> 配列と繰り返しの練習</a></li><li class="chapter-item expanded "><a href="js/js03/quiz01.html"><strong aria-hidden="true">6.2.</strong> クイズアプリ初級</a></li><li class="chapter-item expanded "><a href="js/js03/quiz02.html"><strong aria-hidden="true">6.3.</strong> クイズアプリ中級</a></li><li class="chapter-item expanded "><a href="js/js03/work.html"><strong aria-hidden="true">6.4.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="js/js04/index.html"><strong aria-hidden="true">7.</strong> JS_Firebase</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js04/function.html"><strong aria-hidden="true">7.1.</strong> 関数</a></li><li class="chapter-item expanded "><a href="js/js04/chat-app.html"><strong aria-hidden="true">7.2.</strong> リアルタイムチャットの実装</a></li><li class="chapter-item expanded "><a href="js/js04/firebase-project.html"><strong aria-hidden="true">7.3.</strong> Firebase の準備 1（プロジェクトの作成）</a></li><li class="chapter-item expanded "><a href="js/js04/firebase-js.html"><strong aria-hidden="true">7.4.</strong> Firebase の準備 2（ソースコードの準備）</a></li><li class="chapter-item expanded "><a href="js/js04/firebase-db.html"><strong aria-hidden="true">7.5.</strong> Firebase の準備 3（データベースの準備）</a></li><li class="chapter-item expanded "><a href="js/js04/chat-create.html"><strong aria-hidden="true">7.6.</strong> チャット画面の実装とデータの送信</a></li><li class="chapter-item expanded "><a href="js/js04/chat-read.html"><strong aria-hidden="true">7.7.</strong> データのリアルタイム取得と画面表示</a></li><li class="chapter-item expanded "><a href="js/js04/optimize.html"><strong aria-hidden="true">7.8.</strong> 機能追加</a></li><li class="chapter-item expanded "><a href="js/js04/work.html"><strong aria-hidden="true">7.9.</strong> 課題と提出時の注意点</a></li></ol></li><li class="chapter-item expanded "><a href="js/js05/index.html"><strong aria-hidden="true">8.</strong> JS_API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js05/about-api.html"><strong aria-hidden="true">8.1.</strong> API とは</a></li><li class="chapter-item expanded "><a href="js/js05/booksapi.html"><strong aria-hidden="true">8.2.</strong> GoogleBooks API</a></li><li class="chapter-item expanded "><a href="js/js05/geolocation.html"><strong aria-hidden="true">8.3.</strong> 位置情報の活用</a></li><li class="chapter-item expanded "><a href="js/js05/bingmapsapi-setup.html"><strong aria-hidden="true">8.4.</strong> BingMapsAPI/準備</a></li><li class="chapter-item expanded "><a href="js/js05/bingmapsapi-map.html"><strong aria-hidden="true">8.5.</strong> BingMapsAPI/実践</a></li><li class="chapter-item expanded "><a href="js/js05/bingmapsapi-pin.html"><strong aria-hidden="true">8.6.</strong> 【おまけ】BingMapsAPI/機能追加</a></li><li class="chapter-item expanded "><a href="js/js05/other-api.html"><strong aria-hidden="true">8.7.</strong> その他の API 紹介</a></li><li class="chapter-item expanded "><a href="js/js05/work.html"><strong aria-hidden="true">8.8.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="js/js06/index.html"><strong aria-hidden="true">9.</strong> JS 修練場</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js/js06/001-010.html"><strong aria-hidden="true">9.1.</strong> 001-010</a></li><li class="chapter-item expanded "><a href="js/js06/011-020.html"><strong aria-hidden="true">9.2.</strong> 011-020</a></li><li class="chapter-item expanded "><a href="js/js06/021-030.html"><strong aria-hidden="true">9.3.</strong> 021-030</a></li><li class="chapter-item expanded "><a href="js/js06/031-040.html"><strong aria-hidden="true">9.4.</strong> 031-040</a></li><li class="chapter-item expanded "><a href="js/js06/041-050.html"><strong aria-hidden="true">9.5.</strong> 041-050</a></li><li class="chapter-item expanded "><a href="js/js06/051-060.html"><strong aria-hidden="true">9.6.</strong> 051-060</a></li><li class="chapter-item expanded "><a href="js/js06/061-070.html"><strong aria-hidden="true">9.7.</strong> 061-070</a></li><li class="chapter-item expanded "><a href="js/js06/071-080.html"><strong aria-hidden="true">9.8.</strong> 071-080</a></li></ol></li><li class="chapter-item expanded "><a href="php/php_setup/index.html"><strong aria-hidden="true">10.</strong> PHP 事前準備</a></li><li class="chapter-item expanded "><a href="php/php01/index.html"><strong aria-hidden="true">11.</strong> PHP 基礎</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php01/about-php.html"><strong aria-hidden="true">11.1.</strong> PHP 概要</a></li><li class="chapter-item expanded "><a href="php/php01/get-started.html"><strong aria-hidden="true">11.2.</strong> 開発の手順</a></li><li class="chapter-item expanded "><a href="php/php01/php-start.html"><strong aria-hidden="true">11.3.</strong> PHP 基礎</a></li><li class="chapter-item expanded "><a href="php/php01/get-post.html"><strong aria-hidden="true">11.4.</strong> クライアント - サーバ間の通信</a></li><li class="chapter-item expanded "><a href="php/php01/write-file.html"><strong aria-hidden="true">11.5.</strong> ファイル操作（書き込み）</a></li><li class="chapter-item expanded "><a href="php/php01/read-file.html"><strong aria-hidden="true">11.6.</strong> ファイル操作（読み込み）</a></li><li class="chapter-item expanded "><a href="php/php01/work.html"><strong aria-hidden="true">11.7.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="php/php02/index.html"><strong aria-hidden="true">12.</strong> PHP_DB 連携_CRUD 処理前半</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php02/about-db.html"><strong aria-hidden="true">12.1.</strong> DB の基本</a></li><li class="chapter-item expanded "><a href="php/php02/start-db.html"><strong aria-hidden="true">12.2.</strong> DB / テーブルの作成</a></li><li class="chapter-item expanded "><a href="php/php02/db-sql.html"><strong aria-hidden="true">12.3.</strong> SQL による DB 操作</a></li><li class="chapter-item expanded "><a href="php/php02/sql-create.html"><strong aria-hidden="true">12.4.</strong> PHP と DB の連携 1（データ作成処理）</a></li><li class="chapter-item expanded "><a href="php/php02/sql-read.html"><strong aria-hidden="true">12.5.</strong> PHP と DB の連携 2（データ参照処理）</a></li><li class="chapter-item expanded "><a href="php/php02/work.html"><strong aria-hidden="true">12.6.</strong> 課題と提出時の注意点</a></li></ol></li><li class="chapter-item expanded "><a href="php/php03/index.html"><strong aria-hidden="true">13.</strong> PHP_DB 連携_CRUD 処理後半</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php03/function-db-connect.html"><strong aria-hidden="true">13.1.</strong> DB 接続関数の作成</a></li><li class="chapter-item expanded "><a href="php/php03/sql-edit.html"><strong aria-hidden="true">13.2.</strong> PHP と DB の連携 3（編集画面の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-update.html"><strong aria-hidden="true">13.3.</strong> PHP と DB の連携 4（データ更新処理の作成）</a></li><li class="chapter-item expanded "><a href="php/php03/sql-delete.html"><strong aria-hidden="true">13.4.</strong> PHP と DB の連携 5（データ削除処理）</a></li><li class="chapter-item expanded "><a href="php/php03/work.html"><strong aria-hidden="true">13.5.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="php/php04/index.html"><strong aria-hidden="true">14.</strong> PHP_セッション</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php04/about-session.html"><strong aria-hidden="true">14.1.</strong> セッションとは</a></li><li class="chapter-item expanded "><a href="php/php04/session-variables.html"><strong aria-hidden="true">14.2.</strong> セッション変数</a></li><li class="chapter-item expanded "><a href="php/php04/auth-01.html"><strong aria-hidden="true">14.3.</strong> 認証処理の実装 1（ログインとログアウト）</a></li><li class="chapter-item expanded "><a href="php/php04/auth-02.html"><strong aria-hidden="true">14.4.</strong> 認証処理の実装 2（認証状態の確認）</a></li><li class="chapter-item expanded "><a href="php/php04/work.html"><strong aria-hidden="true">14.5.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="php/php05/index.html"><strong aria-hidden="true">15.</strong> PHP_DB 応用_RDB</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php05/about-rdb.html"><strong aria-hidden="true">15.1.</strong> RDB の構造</a></li><li class="chapter-item expanded "><a href="php/php05/like-add.html"><strong aria-hidden="true">15.2.</strong> Like 機能の実装 1（データの追加 1）</a></li><li class="chapter-item expanded "><a href="php/php05/like-delete.html"><strong aria-hidden="true">15.3.</strong> Like 機能の実装 2（データの追加 2）</a></li><li class="chapter-item expanded "><a href="php/php05/like-groupby.html"><strong aria-hidden="true">15.4.</strong> Like 機能の実装 3（データの集計）</a></li><li class="chapter-item expanded "><a href="php/php05/like-join.html"><strong aria-hidden="true">15.5.</strong> Like 機能の実装 4（データの結合）</a></li><li class="chapter-item expanded "><a href="php/php05/work.html"><strong aria-hidden="true">15.6.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="php/php06/index.html"><strong aria-hidden="true">16.</strong> PHP_ファイル操作と Ajax</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="php/php06/about-upload.html"><strong aria-hidden="true">16.1.</strong> ファイルアップロードの流れ</a></li><li class="chapter-item expanded "><a href="php/php06/upload-file.html"><strong aria-hidden="true">16.2.</strong> ファイルアップロード実装</a></li><li class="chapter-item expanded "><a href="php/php06/upload-db.html"><strong aria-hidden="true">16.3.</strong> ファイルアップロードと DB 連携</a></li><li class="chapter-item expanded "><a href="php/php06/ajax.html"><strong aria-hidden="true">16.4.</strong> Ajax 実装</a></li><li class="chapter-item expanded "><a href="php/php06/work.html"><strong aria-hidden="true">16.5.</strong> 課題</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/index.html"><strong aria-hidden="true">17.</strong> Laravel 事前準備</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel_setup/setup-for-mac.html"><strong aria-hidden="true">17.1.</strong> 【Mac 編】環境構築</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/setup-for-windows.html"><strong aria-hidden="true">17.2.</strong> 【Windows 編】環境構築</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/create-project.html"><strong aria-hidden="true">17.3.</strong> Laravel プロジェクト作成</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/about-docker-and-docker-compose.html"><strong aria-hidden="true">17.4.</strong> 【補足】Docker と Docker Compose の解説</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel01/index.html"><strong aria-hidden="true">18.</strong> Laravel 01</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel01/about-laravel-and-mvc.html"><strong aria-hidden="true">18.1.</strong> Laravel と MVC フレームワーク</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/add-laravel-breeze.html"><strong aria-hidden="true">18.2.</strong> ライブラリ準備</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/setup-db.html"><strong aria-hidden="true">18.3.</strong> 【今回は不要】データベース準備</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/phpmyadmin.html"><strong aria-hidden="true">18.4.</strong> phpmyadmin の追加</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/migration.html"><strong aria-hidden="true">18.5.</strong> マイグレーションによるテーブル作成</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/route-and-controller.html"><strong aria-hidden="true">18.6.</strong> ルーティングとコントローラ</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/views.html"><strong aria-hidden="true">18.7.</strong> 必要な画面の作成と動作確認</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/create.html"><strong aria-hidden="true">18.8.</strong> tweet 作成処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/read.html"><strong aria-hidden="true">18.9.</strong> tweet 一覧画面の実装</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel02/index.html"><strong aria-hidden="true">19.</strong> Laravel 02</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel02/show.html"><strong aria-hidden="true">19.1.</strong> tweet 詳細画面の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/delete.html"><strong aria-hidden="true">19.2.</strong> tweet 削除処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/update.html"><strong aria-hidden="true">19.3.</strong> tweet 更新処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/auth.html"><strong aria-hidden="true">19.4.</strong> tweet とユーザ認証の連携</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel03/index.html"><strong aria-hidden="true">20.</strong> Laravel 03</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel03/mypage.html"><strong aria-hidden="true">20.1.</strong> マイページ機能の実装（1 対多のデータ）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/auther.html"><strong aria-hidden="true">20.2.</strong> 投稿者名の表示（多対 1 のデータ）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/favorite01.html"><strong aria-hidden="true">20.3.</strong> Favorite 機能 1（多対多のデータ・中間テーブル）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/favorite02.html"><strong aria-hidden="true">20.4.</strong> Favorite 機能 2（各処理の実装）</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/deploy/index.html"><strong aria-hidden="true">21.</strong> デプロイ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/deploy/docker-to-github.html"><strong aria-hidden="true">21.1.</strong> 実装したコードを GitHub へ push</a></li><li class="chapter-item expanded "><a href="laravel/deploy/setup-lolipop.html"><strong aria-hidden="true">21.2.</strong> ローカルからロリポップマネージドクラウドへのログイン</a></li><li class="chapter-item expanded "><a href="laravel/deploy/lolipop-to-github.html"><strong aria-hidden="true">21.3.</strong> ロリポップマネージドクラウドと GitHub の SSH 通信設定</a></li><li class="chapter-item expanded "><a href="laravel/deploy/github-to-lolipop.html"><strong aria-hidden="true">21.4.</strong> GitHub 上のコードをマネージドクラウドにデプロイ</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">G's-Yamaguchi-Dev01</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="講義資料ノート"><a class="header" href="#講義資料ノート">講義資料ノート</a></h1>
<p>全ての資料はこのドキュメントにまとまっています．</p>
<p>毎回の講義資料が都度追加されますので，本ページの URL をブックマークしておくと便利です！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="初回課題の案内"><a class="header" href="#初回課題の案内">初回課題の案内</a></h1>
<h2 id="web-サイトチーズアカデミーを制作ッ"><a class="header" href="#web-サイトチーズアカデミーを制作ッ">Web サイト「チーズアカデミー」を制作ッ！！</a></h2>
<ul>
<li>「チーズアカデミー」の web サイトを HTML と CSS を使って作成！</li>
<li>制作した web サイトをブラウザで開いたときにデザインと同様に．</li>
<li>細かい数値は厳密でなくて OK！</li>
</ul>
<p>↓ 画面イメージ（一部）</p>
<p><img src="note/./img/cheese_image.png" alt="画面イメージ" /></p>
<h2 id="必要なファイルや素材"><a class="header" href="#必要なファイルや素材">必要なファイルや素材</a></h2>
<p>まずは下記の URL からダウンロードしましょう．案内と材料が全て入っています！</p>
<p><a href="note/../samples/00_first_work.zip">download</a></p>
<h3 id="完成イメージ"><a class="header" href="#完成イメージ">完成イメージ</a></h3>
<ul>
<li><code>assets/cheese-academy-sizing.png</code> に入っています！</li>
</ul>
<h3 id="html"><a class="header" href="#html">HTML</a></h3>
<ul>
<li>HTML は <code>index.html</code> ファイルに記述！</li>
<li>必要な文章は <code>assets/text.txt</code> に書いてあるのでコピペして使おう！</li>
</ul>
<h3 id="css"><a class="header" href="#css">CSS</a></h3>
<ul>
<li>CSS は <code>css/style.css</code> ファイルに記述！</li>
</ul>
<h2 id="参考情報"><a class="header" href="#参考情報">参考情報</a></h2>
<p>制作に使用するエディタについて</p>
<ul>
<li><a href="https://arrown-blog.com/visual-studio-code/">https://arrown-blog.com/visual-studio-code/</a></li>
</ul>
<p>課題クリアに必須級「chrome 検証ツール」</p>
<ul>
<li><a href="https://arrown-blog.com/devtool-htmlcss/">https://arrown-blog.com/devtool-htmlcss/</a></li>
</ul>
<p>CSS が効かねええ(｀；ω；´)</p>
<ul>
<li><a href="https://arrown-blog.com/css-match-resolve/">https://arrown-blog.com/css-match-resolve/</a></li>
</ul>
<h2 id="締切"><a class="header" href="#締切">締切</a></h2>
<ul>
<li>JavaScript 1 回目講義開始時</li>
</ul>
<h2 id="提出方法"><a class="header" href="#提出方法">提出方法</a></h2>
<ul>
<li>上記講義につくったものを持参（自分の PC で見せられる状態になっていれば OK）</li>
</ul>
<h2 id="進め方"><a class="header" href="#進め方">進め方</a></h2>
<ul>
<li>仕様書の<strong>細かい数値にはこだわらなくて良い</strong>です（自分がいい感じになったと判断すれば OK）．</li>
<li><strong>【重要】だいたい仕様書通りにできたら，オリジナリティを表現（魔改造）しよう！！</strong></li>
</ul>
<h2 id="重要魔改造の例"><a class="header" href="#重要魔改造の例">【重要】魔改造の例</a></h2>
<ul>
<li>レスポンシブ対応した</li>
<li>コナミコマンドを入力すると怪しいサイトに変化するようにした</li>
<li>チーズを集める 3D ゲームをつくった</li>
<li>PHP でニュースを投稿できるようにした</li>
<li>iOS アプリケーションをつくった</li>
</ul>
<p><strong>ジーズは「普通」では生き残れない！</strong></p>
<p><strong>誰よりもヤバいものつくって目立て！！</strong></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="受講時の注意"><a class="header" href="#受講時の注意">受講時の注意</a></h1>
<p>時間もお金も投資しているのだからむしり取れるだけむしり取れッ！</p>
<h2 id="講義中に意識するポイント"><a class="header" href="#講義中に意識するポイント">講義中に意識するポイント</a></h2>
<p>ただ受けているだけだと資料の内容しかものにできずもったいない！</p>
<p>まず下記は絶対厳守！！！</p>
<ul>
<li>うまくいかないときに黙っている「サイレント詰み」は犯罪！</li>
<li>まずはわからなくても「動くもの」をつくれ！</li>
<li>食糧飲料燃料の補給は各自のペースで！（自分にとって最適な状況を用意！）</li>
</ul>
<h2 id="いつでもコードを書けるように"><a class="header" href="#いつでもコードを書けるように">いつでもコードを書けるように！</a></h2>
<ul>
<li>授業中は常にエディタを起動！</li>
<li>資料も常に開いておこう！</li>
</ul>
<h2 id="講義中はまず動くものをつくれ"><a class="header" href="#講義中はまず動くものをつくれ">講義中はまず動くものをつくれ！</a></h2>
<ul>
<li>講義では一緒に 1 つのアプリケーションをつくる．</li>
<li>わからなくてもとにかく「動かす」．</li>
<li>課題に挑戦すると大抵うまくいかない．そのときに「講義でつくった動くもの」と「自分でつくった動かないもの」を比較して何がマズイのか探る！</li>
</ul>
<h2 id="聴くときは聴き書くときは書く"><a class="header" href="#聴くときは聴き書くときは書く">聴くときは聴き，書くときは書く！</a></h2>
<ul>
<li>初めて挑戦することなので，わからなくなって当然．．！</li>
<li>まずはしっかり説明を聴こう！</li>
<li>聴くときは聴くこと，手を動かすときは手を動かすことに集中！！</li>
</ul>
<h2 id="クラスのメンバーでお互いに刺激し合おう"><a class="header" href="#クラスのメンバーでお互いに刺激し合おう">クラスのメンバーでお互いに刺激し合おう！</a></h2>
<ul>
<li>考えたことや感じたことは slack の「ガヤチャンネル」でガンガン発信！</li>
<li>くだらないことでも OK！！意見を言うやつは偉い！！</li>
<li>誰かのコメントに乗っかろう！</li>
</ul>
<h2 id="疑問を共有しよう"><a class="header" href="#疑問を共有しよう">疑問を共有しよう！</a></h2>
<ul>
<li>質問はまず slack へ！</li>
<li>慣れないうちは「詰んだ」の一言から．詰みを表明することが大切！</li>
<li>慣れたら「エラーのスクショ」や「書いたコード」を貼ろう！</li>
<li>他の人の質問にも目を通そう！（同じ質問があるかも）</li>
</ul>
<h2 id="進捗を共有しよう"><a class="header" href="#進捗を共有しよう">進捗を共有しよう！</a></h2>
<ul>
<li>演習時，できた人はスクショなど slack に貼ってアウトプット！</li>
<li>できたら「できた」コメント or スタンプ！</li>
<li>詰んだら「詰んだ」コメント or スタンプ！</li>
<li>みなさんのコメントを見ながら講義を進めていきます！</li>
</ul>
<h2 id="詰みを脱する-tips"><a class="header" href="#詰みを脱する-tips">詰みを脱する Tips</a></h2>
<ul>
<li>まずは打ち間違いを疑おう！
<ul>
<li><code>()</code> <code>[]</code> <code>{}</code> <code>'</code> <code>&quot;</code> <code>;</code> など</li>
</ul>
</li>
<li>書いたら保存しよう！（よく忘れる！）
<ul>
<li>Mac: <code>command + s</code></li>
<li>Windows: <code>ctrl + s</code></li>
</ul>
</li>
<li>他の人に見てもらおう！
<ul>
<li>自分の打ち間違いは 10 分探しても見つからないが，他人の打ち間違いは 2 秒で見つかる．</li>
<li>「隣の人」「slack + スクショ」「zoom のブレイクアウト」を活用するのだッ！</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="コードへの向き合い方"><a class="header" href="#コードへの向き合い方">コードへの向き合い方</a></h1>
<p>彼を知り己を知らば百戦危うからず．</p>
<h2 id="質問を制すものはコードを制す"><a class="header" href="#質問を制すものはコードを制す">質問を制すものはコードを制す！</a></h2>
<p>わからなかったり動かなかったりのときは遠慮なく質問せよ！</p>
<p>下記を記述するとお互いに幸せになれる確率が高まるッ！</p>
<ul>
<li>やりたいことは何か</li>
<li>どういう状態（動き）になればゴールなのか</li>
<li>どうやったか（考え方や書いたコードなど）</li>
<li>どうなったか（エラーメッセージやスクショなど）</li>
<li>調べたときのググりワード，参考にしたサイトの URL</li>
</ul>
<p>勿論最初から全部はできないので，まずは遠慮なく投稿するのが大事！</p>
<p>（足りない部分は講師チューターの方々が拾ってくれる）</p>
<h2 id="言語化が大事"><a class="header" href="#言語化が大事">言語化が大事！</a></h2>
<ul>
<li>「言語化」とは自分のやりたいことやうまくいかない現状を他の人に説明すること．</li>
<li>言語化は「できると良い」ではなく「できなければコードが書けない」のである．講師チューターは超能力者ではないので，みなさんが説明しなければ何をしたいのかわからないのだッ．．！</li>
<li>コードを書くにも「JavaScript で何を書けばよいのか」「どうなれば OK なのか」を自ら決めて明確にすることが第一歩．</li>
<li>「やりたいことや必要な処理を日本語で書き出す」→「コードに翻訳する」と考えるとやりやすい．</li>
<li>無理矢理にでも言葉にしたら誰かにぶつけよう．誰かと議論することでより解像度が高まる．最初は「ちょっと何いってるかわからない」と言われるが，やらないと言語化のスキルは高まらない．沈黙は死．</li>
</ul>
<h2 id="正解を求める思考を捨てよ"><a class="header" href="#正解を求める思考を捨てよ">正解を求める思考を捨てよ！</a></h2>
<ul>
<li>「唯一の正解は存在しない」</li>
<li>提示されたヒントでは動かないこともあるし，それとは異なる方法でうまくいくこともある．</li>
<li>一つのやり方に固執することは地獄への一本道を進むことに似たり．</li>
<li>「効率のよいやり方」など一旦動かしてから改めて考えれば良い．力技だろうがまずは動けば良かろうなのだァァッ！！</li>
</ul>
<h2 id="コードは量という勝ちパターン"><a class="header" href="#コードは量という勝ちパターン">「コードは量」という勝ちパターン！</a></h2>
<ul>
<li>一発でうまくいくことはほぼない．特にはじめの頃は経験値が少なく「運ゲー」度が高いので，何度もやり直してうまく行くパターンを引かなければならない．</li>
<li>運ゲーをものにするには試行回数が必要で，そのためには時間が必要になる．敵の行動パターンを集めながら会心の一撃が出るまで粘れ！</li>
<li>わからなければ講義内容を 10 周くらいすれば何か見えてくるはず．わからないと嘆く時間があるならコードを書こう．レベルが足りないなら経験値を稼ごう．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題にチャレンジするコツ"><a class="header" href="#課題にチャレンジするコツ">課題にチャレンジするコツ</a></h1>
<p>課題を制すものは全てを制す．</p>
<h2 id="自分でネタを決めよ"><a class="header" href="#自分でネタを決めよ">自分でネタを決めよ！</a></h2>
<ul>
<li>誰かに言われたものをつくっても面白くない．．．</li>
<li>自分で「何をつくりあげるのか」を決断してチャレンジすることが大切！</li>
<li>「自分で決めたことをやり遂げる」のが最高に Cool ッ！</li>
</ul>
<h2 id="つくりたいものをつくれ"><a class="header" href="#つくりたいものをつくれ">つくりたいものをつくれ！</a></h2>
<ul>
<li>「役に立つ」「ウケそう」ではない．．．</li>
<li>「自分がほしい物」「おもしろいと思うもの」にチャレンジすることで身が入る！</li>
<li>「誰かに褒められる感覚」よりも「全力でやりきった感覚」！</li>
</ul>
<h2 id="まず見た目より動きをつくれ"><a class="header" href="#まず見た目より動きをつくれ">まず見た目より動きをつくれ！</a></h2>
<ul>
<li>プロダクトには「機能」「見た目」どちらも大事！</li>
<li>見た目を作り込むことでより「完成度の高いプロダクト」になる．</li>
<li>しかしまずは「機能」や「動き」をつくる．「見た目」はその後！</li>
<li>見た目を先につくると，機能を変更したときに作り直しになる．．．</li>
</ul>
<h2 id="技術自体を楽しめ"><a class="header" href="#技術自体を楽しめ">技術自体を楽しめ！</a></h2>
<ul>
<li>技術は「アイデアを実現するためのツール」．</li>
<li>しかし技術をより深く知ることで「できることのイメージが広がる」！</li>
<li>「好きな技術」「やってて楽しい技術」を見つけよう！まずは技術にのめり込もう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題提出"><a class="header" href="#課題提出">課題提出</a></h1>
<h2 id="課題提出の流れ"><a class="header" href="#課題提出の流れ">課題提出の流れ</a></h2>
<ol>
<li>課題のプロダクトを各自実装する．</li>
<li>プロダクトのフォルダ内に readme ファイルを作成し，下記を記述する．
<ul>
<li>概要（どんなものか，どうやって使うか，など）</li>
<li>工夫した点，こだわった点</li>
<li>苦戦した点，もう少し実装したかった点</li>
<li>感想など（任意）</li>
<li>デプロイしていれば URL</li>
</ul>
</li>
<li>作成したプロダクトを GitHub に push する．</li>
<li>課題提出システムに URL を入力して送信！
<ul>
<li>GitHub の URL 以外は受け付けない点に注意．</li>
</ul>
</li>
</ol>
<p><a href="https://work-management-app.vercel.app/">提出システム：https://work-management-app.vercel.app/</a></p>
<h2 id="提出後の流れフィードバック"><a class="header" href="#提出後の流れフィードバック">提出後の流れ（フィードバック）</a></h2>
<ol>
<li>締切までに上記 URL から課題を提出すると，チューターのメンバーがフィードバックをくれる．</li>
<li>slack の「課題提出」チャンネルの自分の課題に対するフィードバックを確認し，チューターにコメントを返す．</li>
<li>slack の「feedback」チャンネルのコメントを見て他の人の気になる作品を確認し，適宜議論する．</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="html--css"><a class="header" href="#html--css">HTML &amp; CSS</a></h1>
<h2 id="サンプルコード"><a class="header" href="#サンプルコード">サンプルコード</a></h2>
<p><a href="html-css/../samples/00_html_css.zip">download</a></p>
<h2 id="本講義の内容とゴール"><a class="header" href="#本講義の内容とゴール">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容"><a class="header" href="#本講義の内容">本講義の内容</a></h3>
<ul>
<li>HTML を書いて動かす！</li>
<li>CSS を書いて動かす！</li>
<li>FlexBox を用いたレイアウトで練習用サイトを実装！</li>
</ul>
<h3 id="本講義のゴール"><a class="header" href="#本講義のゴール">本講義のゴール</a></h3>
<ul>
<li>HTML と CSS に慣れる！</li>
<li>FlexBox をマスターする！</li>
<li>チーズ完成のイメージを掴む！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="html-と-css-の役割"><a class="header" href="#html-と-css-の役割">HTML と CSS の役割</a></h1>
<h2 id="それぞれの役割"><a class="header" href="#それぞれの役割">それぞれの役割</a></h2>
<p>役割分担が大事！</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>HTML</td><td>コンテンツの指定<br>タイトル，文章，画像などの記述</td></tr>
<tr><td>CSS</td><td>コンテンツの装飾<br>色，大きさ，配置などの指定</td></tr>
</tbody></table>
<h3 id="例"><a class="header" href="#例">【例】</a></h3>
<p><a href="https://gsacademy.jp/">https://gsacademy.jp/</a></p>
<h3 id="参考"><a class="header" href="#参考">【参考】</a></h3>
<p><a href="https://fastcoding.jp/blog/all/jquery/html-css-javascript/">https://fastcoding.jp/blog/all/jquery/html-css-javascript/</a></p>
<h2 id="本日の成果物"><a class="header" href="#本日の成果物">本日の成果物</a></h2>
<p>ジーズアカデミーの紹介サイトを作成！</p>
<h3 id="html-1"><a class="header" href="#html-1">HTML</a></h3>
<p>ジーズアカデミーの紹介文や写真を記述しよう！</p>
<h3 id="css-1"><a class="header" href="#css-1">CSS</a></h3>
<p>文字の大きさや色，配置をいい感じに設定しよう！</p>
<h3 id="成果物イメージ"><a class="header" href="#成果物イメージ">成果物イメージ</a></h3>
<p><img src="html-css/./img/html_css_work_done.png" alt="練習用Webサイト" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイルの準備と動作確認"><a class="header" href="#ファイルの準備と動作確認">ファイルの準備と動作確認</a></h1>
<h2 id="必要なファイルの準備"><a class="header" href="#必要なファイルの準備">必要なファイルの準備</a></h2>
<ol>
<li>新しいフォルダをデスクトップに作成</li>
<li>vs code を開き「file」→「open」 -&gt; 上で作成したフォルダを選択</li>
<li>左側の「New File」をクリック -&gt; 「index.html」と入力</li>
<li>左側の「New File」をクリック -&gt; 「css」と入力</li>
<li>css フォルダを選択して「New File」をクリック -&gt; 「main.css」</li>
<li>サンプルの「img」フォルダを作成したフォルダの中に入れる</li>
</ol>
<p>↓ このような構成になっていれば OK！</p>
<pre><code class="language-txt">.
├── css
│   └── main.css
├── img
│   ├── content_img.jpg
│   └── main_bg.jpg
└── index.html

</code></pre>
<h2 id="html-の準備"><a class="header" href="#html-の準備">HTML の準備</a></h2>
<ol>
<li>web ページのフォーマットを入力</li>
<li>index.html を開く</li>
<li>「!」を入力（必ず半角）</li>
<li>「tab」を押す</li>
<li>下のようになれば OK！</li>
</ol>
<p>HTML の構造</p>
<pre><code class="language-html">&lt;!-- index.html --&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;!-- 文書自体の情報（文書名・読み込むファイルなど） --&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- 実際の文章の内容（文章や画像など）．ここにコンテンツを記述する． --&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="css-ファイルの読み込み"><a class="header" href="#css-ファイルの読み込み">CSS ファイルの読み込み</a></h2>
<p>html ファイルと css ファイルの関連付け</p>
<ol>
<li>index.html を開く</li>
<li>「<code>&lt;title&gt;</code>...」の 1 行下で「link」を入力して tab キー</li>
<li>タグができるので，「<code>href=</code>」の後を「<code>css/main.css</code>」に変更</li>
</ol>
<pre><code class="language-html">&lt;!-- index.html --&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;!-- 🔽 下記 1 行を追加 🔽 --&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/main.css&quot; /&gt;
  &lt;/head&gt;

  &lt;body&gt;&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="html-の動作確認"><a class="header" href="#html-の動作確認">HTML の動作確認</a></h2>
<p><code>&lt;body&gt;</code> タグ内にタグを作成して動作を確認する．</p>
<pre><code class="language-html">&lt;!-- index.html --&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;ここがページのタイトルなので好きな名前に変えても良き&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/main.css&quot; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- 🔽 下記 1 行を追加 🔽 --&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ブラウザ画面で「Hello World!」が表示されれば OK！</p>
<p><img src="html-css/./img/html_css_work_hello.png" alt="Hello World 確認" /></p>
<blockquote>
<p><strong>💡 【Point】開発の流れ</strong></p>
<ol>
<li>エディタでコードを書く</li>
<li>保存する（<code>command + s</code>, <code>ctrl + s</code>）</li>
<li>vs code でファイル名を右クリック →「<code>Copy Path</code>」</li>
<li>ブラウザのアドレスバーに貼り付けて Enter</li>
<li>意図したとおりになっているかどうか確認</li>
<li>1-5 の繰り返し</li>
</ol>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="html-2"><a class="header" href="#html-2">HTML</a></h1>
<h2 id="タグ"><a class="header" href="#タグ">タグ</a></h2>
<pre><code class="language-html">&lt;!-- htmlは「タグ」で挟む！ --&gt;
&lt;h1&gt;セカイを変えるGEEKになろう&lt;/h1&gt;
&lt;p&gt;最初は全くの初心者でOKです！！&lt;/p&gt;

&lt;!-- 挟まないものもある（単一のタグで成立） --&gt;
&lt;img src=&quot;hogehoge.png&quot; /&gt;
</code></pre>
<h2 id="タグの意味"><a class="header" href="#タグの意味">タグの意味</a></h2>
<p>プログラムがコンテンツの構造を理解できる．</p>
<ul>
<li>HTML を読むのは「プログラム」！！</li>
</ul>
<p>なにがいいの？？</p>
<ul>
<li>構造がしっかりしている web サイトはいい web サイトと判断される．</li>
<li>検索結果ではいい web サイトが上の方に表示される！</li>
</ul>
<h2 id="今回出てくるタグ"><a class="header" href="#今回出てくるタグ">今回出てくるタグ</a></h2>
<pre><code class="language-html">&lt;div&gt;この中に文章や画像を入れる「箱」のようなもの&lt;/div&gt;

&lt;h1&gt;見出し1（タイトル，文書中に1つしか存在してはならない）&lt;/h1&gt;

&lt;p&gt;段落（通常の文章はこれ）&lt;/p&gt;

&lt;h2&gt;見出し2&lt;/h2&gt;

&lt;h3&gt;見出し3&lt;/h3&gt;

&lt;img src=&quot;show-image.png&quot; /&gt;
</code></pre>
<blockquote>
<p><strong>💡 構造をつくるコツ</strong></p>
<p>全体をブロック（div 要素や section 要素）ごとに分ける！</p>
<p>入れ子構造（ツリー構造）を意識！</p>
<pre><code class="language-txt">body
├── div
│   ├── h1
│   └── p
├── div
│   ├── h2
│   ├── h3
│   ├── p
│   ├── h3
│   └── p
├── div
│   ├── h2
│   ├── p
│   └── p
└── div
    ├── h2
    ├── p
    └── p

</code></pre>
<p>どのように分けるかでわかりやすさや実装しやすさが変わる．．！</p>
</blockquote>
<h2 id="今回の-web-サイトの構造"><a class="header" href="#今回の-web-サイトの構造">今回の Web サイトの構造</a></h2>
<p><img src="html-css/./img/html_css_construct01.svg" alt="練習用Webサイト構造2" /></p>
<p><img src="html-css/./img/html_css_construct02.svg" alt="練習用Webサイト構造2" /></p>
<h2 id="練習"><a class="header" href="#練習">練習</a></h2>
<p>イメージを参考に HTML を書こう！</p>
<ul>
<li>画像部分は <code>content_img.jpg</code> を使用！</li>
</ul>
<p>↓ こんな感じになれば OK！</p>
<p><img src="html-css/./img/html_css_work_html.png" alt="HTML記述イメージ" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="css--ページ設定背景文字の大きさ色"><a class="header" href="#css--ページ設定背景文字の大きさ色">CSS / ページ設定，背景，文字の大きさ，色</a></h1>
<h2 id="css-の基本的な記述方法"><a class="header" href="#css-の基本的な記述方法">CSS の基本的な記述方法</a></h2>
<p>CSS は「css ファイル」に記述する．</p>
<p>CSS の命令の適用箇所は HTML 要素（タグやクラス名）を指定する．HTML 要素にクラス名をつけることで，細かく適用箇所を制御することができる．</p>
<pre><code class="language-css">body {
  /* タグに対して指定 */
  /* ここに文字の色やサイズなどを指定する命令を書く */
}

.hoge {
  /* `.` でクラス名で指定 */
}

.hoge,
.fuga {
  /* 複数のクラスに適用 */
}

.hoge .fuga {
  /* hoge クラス要素の下にある fuga クラスに適用 */
}
</code></pre>
<p>↓ HTML 要素にクラス名をつける例</p>
<pre><code class="language-html">&lt;div class=&quot;hoge&quot;&gt;
  &lt;h1 class=&quot;title&quot;&gt;セカイを変えるGEEKになろう&lt;/h1&gt;
  &lt;p class=&quot;fuga&quot;&gt;G's ACADEMY FUKUOKA&lt;/p&gt;
&lt;/div&gt;
</code></pre>
<h2 id="ページのサイズ指定"><a class="header" href="#ページのサイズ指定">ページのサイズ指定</a></h2>
<p>サイズは幅と高さを指定する．</p>
<pre><code class="language-css">/* 幅を指定 */
.box {
  width: 480px;
}

/* 幅と高さを指定 */
.box {
  width: 480px;
  height: 360px;
}
</code></pre>
<p>今回は<code>&lt;body&gt;</code>タグに対して指定し，ページ全体の幅を 960px に設定する．</p>
<pre><code class="language-css">body {
  /* body の幅を 960 px に設定する */
  width: 960px;
}
</code></pre>
<h2 id="背景の色写真の設定"><a class="header" href="#背景の色写真の設定">背景の色，写真の設定</a></h2>
<p>色や画像を設定する．</p>
<pre><code class="language-css">/* 背景を赤くする場合（#rrggbbの形式でも可） */
.box {
  background: red;
}

/* 背景に画像を設定する場合（画像ファイルの場所を指定する） */
.box {
  background: url(../img/main_bg.jpg);
}
</code></pre>
<p>画像の場合は大きさや位置を設定するとかっこいい感じになる．</p>
<pre><code class="language-css">/* 背景画像の大きさ */
.box {
  background-size: cover;
}

/* 背景画像の位置 */
.box {
  background-position: center;
}
</code></pre>
<h2 id="文字の色大きさの設定"><a class="header" href="#文字の色大きさの設定">文字の色，大きさの設定</a></h2>
<pre><code class="language-css">/* 文字の大きさ */
.title {
  font-size: 36px;
}

/* 文字の色（#rrggbbの形式でも可） */
.title {
  color: white;
}
</code></pre>
<h2 id="練習-1"><a class="header" href="#練習-1">練習</a></h2>
<p>練習用 Web サイトの以下の部分を実装しよう！</p>
<ul>
<li>ページのサイズ設定（全体の幅を 960px に）</li>
<li>タイトルの背景部分に写真（<code>main_bg.jpg</code>）を設定</li>
<li>タイトル文字の大きさと色を変更（見やすい感じになれば OK！）</li>
</ul>
<p>↓ ここまでのイメージ</p>
<p><img src="html-css/./img/html_css_work_css.png" alt="css前半の完成イメージ" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tips検証画面の活用"><a class="header" href="#tips検証画面の活用">【tips】検証画面の活用</a></h1>
<p>検証画面を使おう！</p>
<h2 id="検証画面とは"><a class="header" href="#検証画面とは">検証画面とは</a></h2>
<p>検証画面とは，ブラウザに表示されているアプリケーションに対して構造の確認や JavaScript の様子の確認などができるツールである．</p>
<p>検証ツールを使いこなすと，飛躍的に開発がしやすくなるッ．．！</p>
<h2 id="主な機能"><a class="header" href="#主な機能">主な機能</a></h2>
<ul>
<li>HTML の構造の把握．</li>
<li>適用されている CSS の確認，CSS を記述しての反映（保存はされない）．</li>
<li>JavaScript の実行結果の確認．</li>
<li>ブラウザに保存されているデータの確認．</li>
<li>ブラウザ - サーバ間通信の確認（接続サーバ，転送データなど）</li>
</ul>
<h2 id="使い方"><a class="header" href="#使い方">使い方</a></h2>
<p>まずは HTML 要素や適用されている CSS を確認してみよう！</p>
<p><img src="html-css/./img/html_css_inspect.svg" alt="検証画面解説" /></p>
<h2 id="注意点とコツ"><a class="header" href="#注意点とコツ">注意点とコツ</a></h2>
<p><strong>検証画面上で CSS を追加・編集しても保存はされないので注意！</strong></p>
<p>下記の流れがオススメ！</p>
<ul>
<li>適当に CSS を記述する．</li>
<li>検証画面で CSS を確認し，良さそうな値に調整する．</li>
<li>いい感じになったらエディタに戻ってコード追記 → 保存！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="css--レイアウト"><a class="header" href="#css--レイアウト">CSS / レイアウト</a></h1>
<h2 id="よくあるレイアウト"><a class="header" href="#よくあるレイアウト">よくあるレイアウト</a></h2>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>横並び</td><td>HTML は縦並びがデフォルト．</td></tr>
<tr><td>左右中央</td><td>HTML は左揃えがデフォルト．</td></tr>
<tr><td>上下中央</td><td>HTML は上揃えがデフォルト．</td></tr>
</tbody></table>
<h2 id="float"><a class="header" href="#float">float．．？</a></h2>
<p>float を使うと要素を横並びにできる．．．が．．．</p>
<p><img src="html-css/./img/html_css_float.png" alt="float例" /></p>
<p><a href="https://gray-code.com/html_css/release-float-by-clearfix/">参考：https://gray-code.com/html_css/release-float-by-clearfix/</a></p>
<p><strong>ものッ！すごくッ！！めんどくさいィィッッッ！！！！</strong></p>
<h2 id="flexbox-が全てを解決するッ"><a class="header" href="#flexbox-が全てを解決するッ">FlexBox が全てを解決するッ！！</a></h2>
<ul>
<li>横並び</li>
<li>左右中央揃え</li>
<li>上下中央揃え</li>
</ul>
<h3 id="html-のイメージ"><a class="header" href="#html-のイメージ">HTML のイメージ</a></h3>
<p>下記のような要素を想定する（主な部分のみ記述）．</p>
<pre><code class="language-html">&lt;div class=&quot;l_box&quot;&gt;
  &lt;div class=&quot;s_box sienna&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;s_box firebrick&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;s_box maroon&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;s_box darkmagenta&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;s_box indigo&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>↓ 画面上はこんな感じ</p>
<p><img src="html-css/./img/html_css_flex_unset.png" alt="初期状態" /></p>
<h3 id="横並び"><a class="header" href="#横並び">横並び</a></h3>
<p><code>display: flex;</code> を記述！</p>
<ul>
<li>HTML は縦並びがデフォルト．</li>
<li><code>display: flex;</code> を使用すると横並びにできる！</li>
</ul>
<blockquote>
<p><strong>💡 Point</strong></p>
<p><code>display: flex;</code> に関連する CSS は「レイアウトを制御したい要素の外側の要素」に記述する！</p>
</blockquote>
<pre><code class="language-css">.l_box {
  display: flex;
}
</code></pre>
<p><img src="html-css/./img/html_css_flex_flex.png" alt="横並び" /></p>
<h3 id="左右中央揃え"><a class="header" href="#左右中央揃え">左右中央揃え</a></h3>
<p><code>justify-content: center;</code> を記述！</p>
<ul>
<li>HTML は左揃えがデフォルト．</li>
<li><code>justify-content: center;</code> を使用すると左右中央揃えにできる！</li>
</ul>
<blockquote>
<p><strong>💡 Point</strong></p>
<p><code>display: flex;</code> は常に記述する必要あり！</p>
</blockquote>
<pre><code class="language-css">.l_box {
  display: flex;
  justify-content: center;
}
</code></pre>
<p><img src="html-css/./img/html_css_flex_justify_center.png" alt="左右中央" /></p>
<h3 id="上下左右中央揃え"><a class="header" href="#上下左右中央揃え">上下左右中央揃え</a></h3>
<p><code>align-items: center;</code> を記述！</p>
<ul>
<li>HTML は上揃えがデフォルト．</li>
<li><code>align-items: center;</code> を使用すると上下中央揃えにできる！</li>
</ul>
<pre><code class="language-css">.l_box {
  display: flex;
  justify-content: center;
  align-items: center;
}
</code></pre>
<p><img src="html-css/./img/html_css_flex_align_center.png" alt="上下左右中央" /></p>
<h3 id="縦並びが良い場合"><a class="header" href="#縦並びが良い場合">縦並びが良い場合</a></h3>
<p><code>flex-direction: column;</code> を記述！</p>
<ul>
<li>flex は横並びがデフォルト．</li>
<li><code>flex-direction: column;</code> を使用すると縦横の並び方を制御できる！</li>
</ul>
<pre><code class="language-css">.l_box {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
</code></pre>
<p><img src="html-css/./img/html_css_flex_column.png" alt="縦並び" /></p>
<h3 id="参考いい感じに並べたいとき"><a class="header" href="#参考いい感じに並べたいとき">【参考】いい感じに並べたいとき</a></h3>
<p>均等な感じにしたい場合にも設定できる．</p>
<p>↓ 端に寄せつつ均等に並べる <code>space-between</code></p>
<pre><code class="language-css">.l_box {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</code></pre>
<p><img src="html-css/./img/html_css_flex_justify_between.png" alt="between" /></p>
<p>↓ 均等に余白をつくって並べる <code>space-evenly</code></p>
<pre><code class="language-css">.l_box {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
}
</code></pre>
<p><img src="html-css/./img/html_css_flex_justify_evenly.png" alt="evenly" /></p>
<h2 id="練習-2"><a class="header" href="#練習-2">練習</a></h2>
<p><strong>FlexBox を駆使して横並び部分を実装しよう！</strong></p>
<p>ヒント！！</p>
<p>横並びの幅を均等にしたい！</p>
<ul>
<li>横に並んでいる div の width を「50%」にしよう！</li>
</ul>
<p>画像がはみ出す！</p>
<ul>
<li>画像の width を「100%」に設定すると箱の幅に合わせてくれる！</li>
<li>高さが足りないときは height も「100%」！</li>
<li>画像の比率がおかしいときは「object-fit」でググれ！</li>
</ul>
<p><img src="html-css/./img/html_css_work_flex.png" alt="flex実装後" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="演習"><a class="header" href="#演習">演習</a></h1>
<h2 id="残りの部分を実装"><a class="header" href="#残りの部分を実装">残りの部分を実装！！</a></h2>
<p>これまでに扱った内容を応用すれば全部できるッ！</p>
<h2 id="ヒント"><a class="header" href="#ヒント">ヒント！！</a></h2>
<p>タイトルを上下左右中央揃えにしよう！</p>
<ul>
<li>FlexBox を使え！！</li>
</ul>
<p>concept を左右中央揃えにしよう！</p>
<ul>
<li>FlexBox を使え！！</li>
<li>必要なら<code>&lt;div&gt;</code>を追加！</li>
<li>幅は「width」を「〇〇%」！</li>
</ul>
<p>ページ全体を中央に寄せよう！</p>
<ul>
<li><code>margin</code>をいい感じに使うとできる！</li>
</ul>
<h2 id="わからないとき"><a class="header" href="#わからないとき">わからないとき</a></h2>
<ul>
<li>「タグ名 やりたいこと」でググろう！</li>
<li>「css やりたいこと」でググろう！</li>
<li>とにかく「ググる」</li>
</ul>
<h2 id="完成するとこんな感じだッ"><a class="header" href="#完成するとこんな感じだッ">完成するとこんな感じだッ！</a></h2>
<ul>
<li>適当にアレンジを加えて OK！</li>
<li>できた人は課題のできそうな部分を実装！</li>
</ul>
<p><img src="html-css/./img/html_css_work_done.png" alt="練習用Webサイト" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_おみくじ"><a class="header" href="#js_おみくじ">JS_おみくじ</a></h1>
<h2 id="サンプルコード-1"><a class="header" href="#サンプルコード-1">サンプルコード</a></h2>
<p><a href="js/js01/../../samples/01_js_omikuji_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-1"><a class="header" href="#本講義の内容とゴール-1">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-1"><a class="header" href="#本講義の内容-1">本講義の内容</a></h3>
<ul>
<li>JavaScript を動かす！</li>
<li>変数と条件分岐の練習と実装．</li>
<li>おみくじアプリケーションの実装．</li>
</ul>
<h3 id="本講義のゴール-1"><a class="header" href="#本講義のゴール-1">本講義のゴール</a></h3>
<ul>
<li>プログラミングに慣れる！</li>
<li>「変数」「条件分岐」を扱う！</li>
<li>課題に取り組み始める！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="javascript"><a class="header" href="#javascript">JavaScript</a></h1>
<h2 id="javascript-の役割"><a class="header" href="#javascript-の役割">JavaScript の役割</a></h2>
<table><thead><tr><th>言語</th><th>役割</th></tr></thead><tbody>
<tr><td>HTML（マスター済み）</td><td>コンテンツの指定<br>タイトル，文章，画像などの記述</td></tr>
<tr><td>CSS（マスター済み）</td><td>コンテンツの装飾<br>色，大きさ，配置などの指定</td></tr>
<tr><td>JavaScript</td><td>ユーザー操作，イベント発生による動きを実現<br>（わりとなんでもできる）</td></tr>
</tbody></table>
<h2 id="javascript-とは"><a class="header" href="#javascript-とは">JavaScript とは</a></h2>
<p><strong>JavaScript ≠ JAVA</strong></p>
<p>JavaScript と JAVA の違い</p>
<table><thead><tr><th>JavaScript</th><th>JAVA</th></tr></thead><tbody>
<tr><td>フロントエンド言語</td><td>サーバサイド言語</td></tr>
<tr><td>カモミール</td><td>カモ</td></tr>
<tr><td>オーストラリア</td><td>オーストリア</td></tr>
<tr><td>ハムスター</td><td>ハム</td></tr>
<tr><td>メロンパン</td><td>メロン</td></tr>
</tbody></table>
<h2 id="web-アプリケーションに欠かせない-javascript"><a class="header" href="#web-アプリケーションに欠かせない-javascript">Web アプリケーションに欠かせない JavaScript</a></h2>
<p><img src="js/js01/./img/js_introduction_web_app.svg" alt="Webアプリケーションのしくみ" /></p>
<h3 id="言語別人気ランキング2020-年"><a class="header" href="#言語別人気ランキング2020-年">言語別人気ランキング（2020 年）</a></h3>
<table><thead><tr><th>言語</th><th>使用している開発者（%）</th></tr></thead><tbody>
<tr><td>JavaScript</td><td><code>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>69.7%</td></tr>
<tr><td>HTML/CSS</td><td><code>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>62.4%</td></tr>
<tr><td>SQL</td><td><code>|||||||||||||||||||||||||||||||||||||||||||||||||||||||||</code>56.9%</td></tr>
<tr><td>Python</td><td><code>||||||||||||||||||||||||||||||||||||||||||</code>41.6%</td></tr>
<tr><td>JAVA</td><td><code>||||||||||||||||||||||||||||||||||||||</code>38.4%</td></tr>
<tr><td>C#</td><td><code>||||||||||||||||||||||||||||||||</code>32.3%</td></tr>
<tr><td>TypeScript</td><td><code>||||||||||||||||||||||||||||</code>28.3%</td></tr>
<tr><td>PHP</td><td><code>||||||||||||||||||||||||||</code>25.8%</td></tr>
</tbody></table>
<p><a href="https://insights.stackoverflow.com/survey/2020/#technology-programming-scripting-and-markup-languages">ソース: https://insights.stackoverflow.com/survey/2020/#technology-programming-scripting-and-markup-languages</a></p>
<h2 id="javascript-周辺の技術"><a class="header" href="#javascript-周辺の技術">JavaScript 周辺の技術</a></h2>
<p><img src="js/js01/./img/js_introduction_around_js.svg" alt="JS周辺技術" /></p>
<h3 id="よく使われる技術"><a class="header" href="#よく使われる技術">よく使われる技術</a></h3>
<table><thead><tr><th>技術</th><th>特徴</th></tr></thead><tbody>
<tr><td><img src="js/js01/./img/1280px-JQuery-Logo.svg.png" width="200px"></td><td>- JavaScript のライブラリ．<br>- ユーザ操作イベントやアニメーションを実現<br>- ✅ 生 JS と比較して短くかける．<br>- ✅ web アプリケーションで広く普及している．<br>- ✅ 導入が簡単．<br>- ✅ 学習コストが低い．<br>- 🔼 難しいことをやろうとすると複雑になる．<br>- まずはここから！</td></tr>
<tr><td><img src="js/js01/./img/react-logo.png" width="200px"><br><img src="js/js01/./img/Vue-logo-001.svg" width="200px"><br></td><td>- JavaScript のライブラリ．<br>- ✅ モダンな web アプリケーション（SPA）を実現<br>- ✅ 高速！<br>- ✅ TypeScript での実装も可能<br>- ✅ スマホアプリも見据えた開発が可能．<br>- 🔼 学習コスト<br>- 🔼 環境構築がややハードル．<br>- （私は React が好き）</td></tr>
<tr><td><img src="js/js01/./img/nodejs-logo-vector.svg" width="200px"></td><td>- サーバサイドで JavaScript を動かす技術．<br>- ✅ フロントもサーバも JavaScript で書ける．．！<br>- ✅ サーバサイドの中では環境構築が容易<br>- 🔼 難しいことをやろうとすると複雑になる．</td></tr>
</tbody></table>
<h2 id="javascript-を書く"><a class="header" href="#javascript-を書く">JavaScript を書く</a></h2>
<h3 id="書き方"><a class="header" href="#書き方">書き方</a></h3>
<p><code>&lt;script&gt;&lt;/script&gt;</code>の間に処理を記述！</p>
<h3 id="書く場所"><a class="header" href="#書く場所">書く場所</a></h3>
<ul>
<li>html ファイルの<code>&lt;/body&gt;</code>のすぐ上に書こう！</li>
<li>ほかにもいくつか書ける場所があります．</li>
<li>別にファイルを作るやり方もあります．</li>
</ul>
<h3 id="まず動かす"><a class="header" href="#まず動かす">まず動かす！！</a></h3>
<ul>
<li><code>alert()</code></li>
<li><code>console.log()</code></li>
</ul>
<blockquote>
<p>文字列は「<code>'</code>」か「<code>&quot;</code>」で囲む．どちらでも OK！</p>
</blockquote>
<pre><code class="language-html">&lt;script&gt;
  alert(&quot;Hello world&quot;);

  console.log(&quot;Hello world&quot;);
&lt;/script&gt;
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="変数と計算"><a class="header" href="#変数と計算">変数と計算</a></h1>
<h3 id="変数とは"><a class="header" href="#変数とは">変数とは</a></h3>
<p>「変数」は文字列や数値に名前をつけて，後から使用できるようにするもの．</p>
<p>プログラミングでは，ある部分で計算などして導出した値を別の部分で使用することが多い．</p>
<p>その際，毎回同じ計算を行うと不便であるため，1 回計算した結果に名前をつけておき別の部分でそのまま使えるようにする．</p>
<h3 id="-key-point"><a class="header" href="#-key-point">💡 Key Point</a></h3>
<blockquote>
<p>変数には自分で名前をつけるが，「何の値なのか」がわかるように名前をつけることが極めて重要！！</p>
</blockquote>
<h3 id="変数のルール"><a class="header" href="#変数のルール">変数のルール</a></h3>
<p>プログラミングで使用する値には「数値」「文字列」などの型が存在する．</p>
<ul>
<li>「数値」は数学で扱う数と同様に計算できる．</li>
<li>「文字列」は開発者が決めたメッセージやキーワードなどである．英語でも日本語でも扱うことができ，<code>'</code>（シングルクォーテーション）か<code>&quot;</code>（ダブルクオーテーション）で囲む必要がある．</li>
<li>変数名の先頭が数字になるパターンは NG！</li>
</ul>
<pre><code class="language-js">const number1 = 100;
const number2 = 200;
const text1 = 'hello';
const text2 = 'world';
const 3text = 'JavaScript'; // NG

</code></pre>
<h3 id="-key-point-1"><a class="header" href="#-key-point-1">💡 Key Point</a></h3>
<blockquote>
<p>シングルクォーテーションとダブルクオーテーションはどちらでも良いが統一しよう！</p>
</blockquote>
<h2 id="数値の計算"><a class="header" href="#数値の計算">数値の計算</a></h2>
<p>数値は数学と同様に四則演算を行うことができる．</p>
<pre><code class="language-js">const number1 = 1 + 9; // 10
const number2 = 1 - 5; // -4
const number3 = 2 * 4; //  8
const number4 = 10 / 2; //  5
const number5 = 10 % 3; //  1
</code></pre>
<h2 id="文字列の結合"><a class="header" href="#文字列の結合">文字列の結合</a></h2>
<p>文字列は「<code>+</code>」の計算を行うことができる．この場合は数学と異なり，前後の文字列が連結される．</p>
<pre><code class="language-js">const number1 = 100;
const number2 = 200;
const text1 = &quot;hello&quot;;
const text2 = &quot;world&quot;;
const sum1 = number1 + number2; // 300
const sum2 = text1 + text2; // helloworld
</code></pre>
<h3 id="-key-point-2"><a class="header" href="#-key-point-2">💡 Key Point</a></h3>
<blockquote>
<p><code>1</code>と<code>'1'</code>は異なるッ！</p>
</blockquote>
<h2 id="ng-ワード"><a class="header" href="#ng-ワード">NG ワード</a></h2>
<p>変数名には使用できない単語が存在する</p>
<p>構文で使用するもの，将来的に使われるもの，など</p>
<ul>
<li>「<code>if</code>」「<code>for</code>」など</li>
</ul>
<p>このような単語は「予約語」と呼ばれる．</p>
<ul>
<li>「MDN javascript 予約語」で検索！！</li>
<li>引っかかる場合は少ないので今は気にしなくて OK！</li>
</ul>
<h2 id="練習-3"><a class="header" href="#練習-3">練習</a></h2>
<h3 id="以下の処理を-javascript-で実装しよう"><a class="header" href="#以下の処理を-javascript-で実装しよう">以下の処理を JavaScript で実装しよう！</a></h3>
<ul>
<li>「<code>100</code>」と「<code>200</code>」の数値をそれぞれ変数に入れ，加算した結果を<code>alert()</code>で表示．</li>
<li>「<code>G's</code>」と「<code>ACADEMY</code>」の文字列をそれぞれ変数に入れ，つなげて<code>alert()</code>で表示．</li>
<li><code>js_practice.html</code>に記述しよう！</li>
</ul>
<h3 id="動作確認"><a class="header" href="#動作確認">動作確認</a></h3>
<p>それぞれ「300」と「G'sACADEMY」が表示されれば OK！</p>
<h2 id="補足"><a class="header" href="#補足">補足</a></h2>
<blockquote>
<p>JavaScript における変数の定義には「<code>const</code>」「<code>let</code>」「<code>var</code>」の 3 種類が存在する．</p>
<p>基本的には<code>const</code>を使用し，どうしてもな場合に<code>let</code>を使用すれば良いだろう．</p>
<pre><code class="language-js">const hoge = 100;
const hoge = 200; // エラー（同じ名前で定義するのはNG）
hoge = 300; // エラー（異なる値を入れ直すのはNG）

// 後から上書きできる変数
let fuga = 1000;
let fuga = 2000; // エラー（同じ名前で定義するのはNG）
foo = 3000; // OK（予期せぬ値が入ってしまう場合があるので注意）

// むかしあったやつ（使わないほうが良い）
var piyo = 99999;
var piyo = 88888; // OK（あぶない）
piyo = 77777; // OK（あぶない）
</code></pre>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ランダムな数乱数をつくる"><a class="header" href="#ランダムな数乱数をつくる">ランダムな数（乱数）をつくる</a></h1>
<h2 id="乱数とは"><a class="header" href="#乱数とは">乱数とは</a></h2>
<p>毎回異なる値が出てくる数のこと（例：1 回目に実行したら 1，2 回目に実行したら 4，など）．</p>
<p>JavaScript には最初から乱数をつくれる処理が用意されている（<code>Math.random()</code>）のでこれを利用する．しかし，この処理は 0 から 1 の範囲で小数を発生させるため，<code>Math.floor()</code>を用いて整数に直す．</p>
<pre><code class="language-js">// 0から1の間でランダムな値（乱数）を表示．
const randomNumber1 = Math.random();
alert(randomNumber1);

// 0から4までのどれかが表示される！
const randomNumber2 = Math.floor(Math.random() * 5);
alert(randomNumber2);
</code></pre>
<h3 id="-key-point-3"><a class="header" href="#-key-point-3">💡 Key Point</a></h3>
<blockquote>
<p>乱数の処理は毎回これでいけるので，覚えるよりコピペ！</p>
</blockquote>
<h3 id="補足-1"><a class="header" href="#補足-1">補足</a></h3>
<p>JavaScript の<code>Math.~</code>には多くの種類があり，絶対値を求めたり四捨五入したりする処理も存在する．</p>
<h2 id="練習-4"><a class="header" href="#練習-4">練習</a></h2>
<p><code>math.html</code>で以下の数をランダムに発生させて<code>alert();</code>で表示させよう！</p>
<table><thead><tr><th></th><th align="right">最小値</th><th align="right">最大値</th></tr></thead><tbody>
<tr><td>問題 1</td><td align="right">0</td><td align="right">9</td></tr>
<tr><td>問題 2</td><td align="right">1</td><td align="right">9</td></tr>
<tr><td>問題 3</td><td align="right">5</td><td align="right">10</td></tr>
<tr><td>問題 4</td><td align="right">50</td><td align="right">99</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="条件分岐"><a class="header" href="#条件分岐">条件分岐</a></h1>
<h2 id="条件分岐-1"><a class="header" href="#条件分岐-1">条件分岐</a></h2>
<p>条件を満たすときと満たさないときで別々の処理を実行する！</p>
<pre><code class="language-js">if (`条件式`) {
  // 条件式を満たす場合の処理
} else {
  // 条件式を満たさない場合の処理
}
</code></pre>
<p>複数の条件で処理を分岐させることもできる！</p>
<pre><code class="language-js">if (`条件式1`) {
  // 条件式1を満たす場合の処理
} else if (`条件式2`) {
  // 条件式1と満たさなくて条件式2を満たす場合の処理
} else {
  // いずれの条件も満たさない場合の処理
}
</code></pre>
<h2 id="条件式"><a class="header" href="#条件式">条件式</a></h2>
<p>条件式は左辺と右辺の比較で行うことが多い（比較演算子）．</p>
<table><thead><tr><th>演算子</th><th>意味</th><th>補足</th></tr></thead><tbody>
<tr><td><code>==</code></td><td>左辺と右辺が等しい</td><td><code>1</code>と<code>'1'</code>は等しいと判定される．</td></tr>
<tr><td><code>===</code></td><td>左辺と右辺が等しい</td><td><code>1</code>と<code>'1'</code>は等しくないと判定される．</td></tr>
<tr><td><code>!=</code></td><td>左辺と右辺が等しくない</td><td><code>1</code>と<code>'1'</code>は等しいと判定される．</td></tr>
<tr><td><code>!==</code></td><td>左辺と右辺が等しくない</td><td><code>1</code>と<code>'1'</code>は等しくないと判定される．</td></tr>
<tr><td><code>&gt;</code></td><td>左辺が右辺より大きい</td><td></td></tr>
<tr><td><code>&lt;</code></td><td>左辺が右辺より小さい</td><td></td></tr>
<tr><td><code>&gt;=</code></td><td>左辺が右辺以上</td><td></td></tr>
<tr><td><code>&lt;=</code></td><td>左辺が右辺以下</td><td></td></tr>
</tbody></table>
<h3 id="-key-point-4"><a class="header" href="#-key-point-4">💡 Key Point</a></h3>
<blockquote>
<p>左辺と右辺が等しい場合に<code>a = b</code>のように記述してハマる．<code>a == b</code>が正解．</p>
</blockquote>
<h2 id="条件式の組み合わせ"><a class="header" href="#条件式の組み合わせ">条件式の組み合わせ</a></h2>
<p>条件式は複数組み合わせることができる．下記 2 種類がよく使われる．</p>
<ul>
<li>複数の条件式を全て満たす場合（AND 条件）は条件式を<code>&amp;&amp;</code>でつなぐ．</li>
<li>複数の条件式のいずれかを満たす場合（OR 条件）は条件式を<code>||</code>でつなぐ．</li>
</ul>
<pre><code class="language-js">if (`条件式1` &amp;&amp; `条件式2`) {
  // 条件式1と条件式2を両方満たす場合の処理
} else {
  // 片方しか満たさない，両方満たさない場合の処理
}

if (`条件式1` || `条件式2`) {
  // 条件式1か条件式2のどちらかを満たす場合の処理
} else {
  // 両方満たさない場合の処理
}
</code></pre>
<h3 id="-key-point-5"><a class="header" href="#-key-point-5">💡 Key Point</a></h3>
<blockquote>
<p>条件分岐を書くときははじめに構文（<code>if(){}else{}</code>）をつくってから条件や処理を書く！</p>
</blockquote>
<h2 id="練習-5"><a class="header" href="#練習-5">練習</a></h2>
<h3 id="乱数と条件分岐を組み合わせておみくじを実装"><a class="header" href="#乱数と条件分岐を組み合わせておみくじを実装">乱数と条件分岐を組み合わせておみくじを実装！</a></h3>
<p>ランダムに「大吉・中吉・小吉・凶・大凶」を<code>alert()</code>で表示！</p>
<p><code>omikuji01.html</code>に記述しよう！</p>
<h3 id="ヒント-1"><a class="header" href="#ヒント-1">ヒント！！</a></h3>
<ol>
<li><code>Math.rondom()</code>で 0 から 4 を発生させる．（&lt;- 前項でつくったものが使える．．！）</li>
<li>出た数値に応じて<code>if</code>文を使って条件分岐し，異なる内容を<code>alert()</code>で出力！</li>
</ol>
<p>毎回ランダムで「大吉・中吉・小吉・凶・大凶」のどれかが表示されれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="おみくじの-web-アプリ実装"><a class="header" href="#おみくじの-web-アプリ実装">おみくじの Web アプリ実装</a></h1>
<p>おみくじの処理自体はできたが，画面から操作できる Web アプリケーションにしたい！</p>
<h2 id="想定される挙動"><a class="header" href="#想定される挙動">想定される挙動</a></h2>
<ul>
<li>画面上の HTML 要素（DOM）をクリックして処理を実行！</li>
<li>要素を「指定」する！</li>
<li>class や id で DOM を特定する．</li>
<li>指定した DOM に対して JavaScript で操作を行う！</li>
</ul>
<h3 id="例-1"><a class="header" href="#例-1">例</a></h3>
<ul>
<li>「<code>id</code>が<code>button</code>」の要素を「クリック」したら．．．</li>
<li>「大吉-大凶のどれかをランダムに表示」！</li>
</ul>
<h3 id="参考dom"><a class="header" href="#参考dom">参考（DOM）</a></h3>
<blockquote>
<p>HTML に記述されている各要素のこと（document object model）</p>
</blockquote>
<h2 id="基本の-3-要素"><a class="header" href="#基本の-3-要素">基本の 3 要素</a></h2>
<ul>
<li>selector（どこを）</li>
<li>event（いつ）</li>
<li>method（どうする）</li>
</ul>
<p><img src="js/js01/./img/20210622123450.png" alt="dom3要素" /></p>
<p>なんだけど．．．</p>
<pre><code>＿人人人人人人人人人人人人人人＿
＞　JavaScriptはDOM操作が苦手　＜
￣Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^Y^￣
</code></pre>
<h2 id="jquery-ライブラリ"><a class="header" href="#jquery-ライブラリ">jQuery ライブラリ</a></h2>
<h3 id="jquery-とは"><a class="header" href="#jquery-とは">jQuery とは</a></h3>
<ul>
<li>セレクタを css と同じ要領で指定できる．</li>
<li>素の JavaScript よりも短く書ける！</li>
<li>アニメーションなど手軽に設定できる．</li>
<li>書き方（順序や考え方）は JavaScript と同様！</li>
<li>導入が簡単（フレームワークなどは環境構築で詰む）</li>
</ul>
<p><a href="https://webkikaku.co.jp/homepage/blog/hpseisaku/webdesign/jquery_start/">【参考】https://webkikaku.co.jp/homepage/blog/hpseisaku/webdesign/jquery_start/</a></p>
<h3 id="-key-point-6"><a class="header" href="#-key-point-6">💡 Key Point</a></h3>
<blockquote>
<p>jQuery は JavaScript の DOM 操作を短縮して書けるライブラリ</p>
</blockquote>
<h3 id="補足-2"><a class="header" href="#補足-2">補足</a></h3>
<blockquote>
<p>ライブラリは他の開発者がつくったコードを利用させてもらうイメージ．手間のかかる処理を一発で書けるように実装してくれている．</p>
</blockquote>
<h3 id="ライブラリ読み込み"><a class="header" href="#ライブラリ読み込み">ライブラリ読み込み</a></h3>
<p>（jQuery に限らず）ライブラリはソースコードの読み込みが必要！！</p>
<p>（読み込みのコードは毎回同じなのでコピペで OK！）</p>
<pre><code class="language-html">&lt;!-- 🔽 ここで読み込み 🔽 --&gt;
&lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
  // 自分で書いた処理
&lt;/script&gt;
</code></pre>
<h3 id="-key-point-7"><a class="header" href="#-key-point-7">💡 Key Point</a></h3>
<blockquote>
<p>ライブラリを使用する場合は「自分で書く JavaScript より上の行で」読み込むこと．ライブラリで決められた関数を実行しようとして，読み込みが終わっていない状態だとエラーになってしまう．</p>
</blockquote>
<h2 id="jquery-の書き方と動き方"><a class="header" href="#jquery-の書き方と動き方">jQuery の書き方と動き方</a></h2>
<p>基本の考え方は JavaScript と全く同じッ！</p>
<p><img src="js/js01/./img/20210622123450.png" alt="dom3要素" /></p>
<h3 id="コード例"><a class="header" href="#コード例">コード例</a></h3>
<ul>
<li><code>id</code>が<code>button</code>の要素を</li>
<li>クリックしたときに</li>
<li>アラートを出す</li>
</ul>
<pre><code class="language-js">$(&quot;#button&quot;).on(&quot;click&quot;, function () {
  alert(&quot;Hello World!&quot;);
});
</code></pre>
<p>コード内でそれぞれ以下の場所で指定している．</p>
<pre><code class="language-js">$(`セレクタ名`).on(`イベント名`, function () {
  `実行したい処理（メソッド）`;
});
</code></pre>
<p>今回は<code>id</code>で指定しているが，セレクタの指定方法はたくさんある．イベントもたくさんある．</p>
<ul>
<li>「<code>jQuery セレクタ</code>」でググる！</li>
<li>「<code>jQuery イベント</code>」でググる！</li>
</ul>
<h2 id="まずは形の入力に慣れよう"><a class="header" href="#まずは形の入力に慣れよう">まずは形の入力に慣れよう！</a></h2>
<p>いろいろな処理を書く前に，形の入力に慣れることが大事！！（慣れないとしょうもないスペルミスで時間溶かす）</p>
<pre><code class="language-js">$(&quot;#id&quot;).on(&quot;click&quot;, function () {
  // ...
});
</code></pre>
<h3 id="喋りながら書くと定着する本当"><a class="header" href="#喋りながら書くと定着する本当">喋りながら書くと定着する（本当）</a></h3>
<blockquote>
<p>だらーあいでぃーおんくりっくふぁんくしょんかっこかっこなみかっこえんたー...</p>
</blockquote>
<h2 id="練習-6"><a class="header" href="#練習-6">練習</a></h2>
<p>おみくじアプリケーションを完成させよう！</p>
<h3 id="仕様"><a class="header" href="#仕様">仕様</a></h3>
<ul>
<li>「おみくじを引くボタン」をクリックしたら以下のどれかを画面に表示！</li>
<li>「大吉・中吉・小吉・凶・大凶」</li>
</ul>
<h3 id="ヒント-2"><a class="header" href="#ヒント-2">ヒント</a></h3>
<p>下記の流れで考えよう！</p>
<ul>
<li>ボタンをクリックしたらなにかする．</li>
<li>ランダムな数値を発生させる．</li>
<li>条件分岐をつくって，対応する「大吉，中吉，...」を画面に表示させる．</li>
</ul>
<pre><code class="language-js">$(&quot;#button&quot;).on(&quot;click&quot;, function () {
  // 0から4でランダムな数を作成
  // 0だったら大吉，1だったら中吉．．．
  // 結果をidで指定した場所に表示
});
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題"><a class="header" href="#課題">課題</a></h1>
<p><strong>じゃんけんアプリを実装！！！！！</strong></p>
<h2 id="じゃんけんアプリの仕様"><a class="header" href="#じゃんけんアプリの仕様">じゃんけんアプリの仕様</a></h2>
<ol>
<li>「グー」「チョキ」「パー」のボタンを設置</li>
<li>どれかをクリックしたら「コンピュータの出した手は？」を変更
<ul>
<li>「コンピュータ：グー」「コンピュータ：チョキ」など</li>
</ul>
</li>
<li>「結果は？」の箇所に
<ul>
<li>「あなたの負け」「あなたの勝ち」「あいこ」のどれかを表示！</li>
</ul>
</li>
</ol>
<p>※上記を最低ラインとして製作</p>
<p>※これを土台にしてガンガン発展させよう！！</p>
<h2 id="課題に対する考え方"><a class="header" href="#課題に対する考え方">課題に対する考え方</a></h2>
<table><thead><tr><th>✅</th><th>❎</th></tr></thead><tbody>
<tr><td>オリジナリティを表現する</td><td>誰かに言われたものを作る</td></tr>
<tr><td>プロダクトを創る</td><td>プログラムを書く</td></tr>
<tr><td><strong>自分が好きなものをつくる</strong></td><td>受けが良さそうなものをつくる</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="git"><a class="header" href="#git">Git</a></h1>
<h2 id="事前準備"><a class="header" href="#事前準備">事前準備</a></h2>
<p>次回は大切なソースコードを管理&amp;開発を円滑に進めるためのツール「Git」「Github」を扱います！</p>
<p>まずは下記の準備をすすめていきましょう！</p>
<h2 id="準備-①-github-アカウントの取得全員必須"><a class="header" href="#準備-①-github-アカウントの取得全員必須">準備 ① Github アカウントの取得（全員必須）</a></h2>
<p>下記サイトを参考に Github のアカウントを作成してください！</p>
<p>（すでにアカウントをお持ちの方はそのままお使いいただけるので新たに取得する必要はありません）</p>
<p><a href="https://qiita.com/rshibasa/items/f62db870ed573ca4dced">参考： https://qiita.com/rshibasa/items/f62db870ed573ca4dced</a></p>
<h2 id="準備-②windows-ユーザのみ"><a class="header" href="#準備-②windows-ユーザのみ">準備 ②（windows ユーザのみ）</a></h2>
<p>windows ユーザーのみ，下記サイトを参考に「Git for windows」のインストールをお願いいたします！</p>
<p>下記サイトの「初期設定」の手前まで実施してください． 初期設定からは授業で解説しながら行います．</p>
<p><a href="https://eng-entrance.com/git-install">参考： https://eng-entrance.com/git-install</a></p>
<p>準備していないと完全に詰みます！！！</p>
<h2 id="準備-③mac-ユーザのみ"><a class="header" href="#準備-③mac-ユーザのみ">準備 ③（Mac ユーザのみ）</a></h2>
<p>Mac では git のコマンドを実行する場合，「<code>Command Line Tools for XCode</code>」が必要．</p>
<p>ターミナルで以下のコマンドを実行すればインストールできる．</p>
<pre><code class="language-bash">$ xcode-select --install
</code></pre>
<p>実行するとウインドウが出てきて「ダウンロードしますか」的なことを訊かれるのでそのままダウンロードしてインストールする．</p>
<blockquote>
<p>【補足 / 上記の手順でうまくいっている場合は不要】</p>
<p>上記コマンドを実行してもうまく行かない場合，下記の手順を実行する．</p>
<ul>
<li>
<p><a href="https://developer.apple.com/download/more/">https://developer.apple.com/download/more/</a>にアクセスする．自身の AppleID とパスワードを入力する．</p>
</li>
<li>
<p>検索窓に<code>command line tools</code>を入力し，<code>Command Line Tools for Xcode 11.5</code>を探し，ダウンロード → インストール．</p>
</li>
</ul>
</blockquote>
<p>準備していないと完全に詰みます！！！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="gui-と-cli"><a class="header" href="#gui-と-cli">GUI と CLI</a></h1>
<p>「GUI」と「CLI」とは，ユーザがコンピュータを操作するときの方式である．</p>
<h2 id="gui-とは"><a class="header" href="#gui-とは">GUI とは</a></h2>
<p>Graphical User Interface の略．</p>
<p>情報の提示に画像や図形を多用し，基礎的な操作の大半をマウスやタッチスクリーンなどによる画面上の位置の指示により行うことができるもの．</p>
<p>「いつも使用している画面上の操作」という認識で問題ない．</p>
<p><img src="git/./img/git_gui.png" alt="GUI画面の例" /></p>
<h2 id="cli-とは"><a class="header" href="#cli-とは">CLI とは</a></h2>
<p>Command Line Interface の略．</p>
<p>コンピュータを操作するすべてのやり取りを文字によって行う方式．予め定められた「コマンド」を入力して操作を行うことが多い．</p>
<p>GUI では，ユーザがマウスやタッチ操作を行うのに対し，CUI で使用するのはキーボードのみ．</p>
<p><img src="git/./img/git_cli.png" alt="CLI画面の例" /></p>
<h2 id="結局-cli-が必要"><a class="header" href="#結局-cli-が必要">結局 CLI が必要</a></h2>
<p>もともと PC は CLI しかなかった．</p>
<p>現代の PC は GUI（の表示されたディスプレイ）を見ながら操作する．</p>
<p>一方で，サーバなどを操作する場合には CUI（ターミナルなど）を使用する．自分の PC 内でも，操作によっては CLI が必須な場合がある．</p>
<p>例えば，以下の写真では自分の PC のターミナルからサーバマシンにアクセスしてコマンド操作している．</p>
<p><img src="git/./img/git_server.jpg" alt="CLIでサーバを操作する" /></p>
<p>このように，Web の開発では CLI を使用するタイミングが必ず出てくる．基本的な操作を行って慣れておくことが大切．</p>
<h2 id="cli-の操作"><a class="header" href="#cli-の操作">CLI の操作</a></h2>
<p>以下のアプリケーションを立ち上げよう！</p>
<p>これらのアプリケーションからコマンドを実行することができます！</p>
<table><thead><tr><th>OS</th><th>コマンドを実行するアプリケーション</th></tr></thead><tbody>
<tr><td>Mac</td><td>ターミナル（最初から入っている）</td></tr>
<tr><td>Windows</td><td>Git Bash（事前準備でインストール）</td></tr>
</tbody></table>
<p>※以降，どちらも呼び方はターミナルで統一します！</p>
<h2 id="作業フォルダという概念"><a class="header" href="#作業フォルダという概念">作業フォルダという概念</a></h2>
<p>ターミナルでコマンドを実行するときは必ず現在地（フォルダ）があります！</p>
<p>起動した直後の現在地を「ホームディレクトリ」と呼びます．</p>
<p>コマンドを実行するときは，適切なフォルダに移動する必要がある．</p>
<p>例：あるテキストファイルを編集するコマンドを実行したい場合，テキストファイルが入っているフォルダに移動しなければならない．</p>
<p>【重要】下記のコマンドで現在の作業フォルダを確認できる．</p>
<pre><code class="language-bash">$ pwd
</code></pre>
<h2 id="代表的な操作"><a class="header" href="#代表的な操作">代表的な操作</a></h2>
<p><code>$</code>マーク（<code>%</code>マークの場合もある）が出ているときはコマンド待機中（入力できる状態）</p>
<table><thead><tr><th>コマンド</th><th>実行例</th><th>意味</th></tr></thead><tbody>
<tr><td><code>cd</code></td><td><code>$ cd Desktop</code></td><td>最重要．<br>作業ディレクトリを変更する．<code>cd ..</code>で 1 階層上に移動．<br><code>cd </code>まで入力して，フォルダのドラッグ&amp;ドロップでも移動先を指定できる．</td></tr>
<tr><td><code>ls</code></td><td><code>$ ls -a</code></td><td>現在のディレクトリにあるファイルとフォルダを表示する．<br><code> -a</code>をつけることで隠しファイルやフォルダを表示する．</td></tr>
</tbody></table>
<h2 id="ファイルとフォルダの作成"><a class="header" href="#ファイルとフォルダの作成">ファイルとフォルダの作成</a></h2>
<table><thead><tr><th>コマンド</th><th>実行例</th><th>意味</th></tr></thead><tbody>
<tr><td><code>touch</code></td><td><code>$ touch memo.txt</code></td><td>新しいファイルを作成する．</td></tr>
<tr><td><code>mkdir</code></td><td><code>$ mkdir test</code></td><td>新しいフォルダを作成する．</td></tr>
<tr><td><code>cat</code></td><td><code>$ cat memo.txt</code></td><td>ファイルの内容を表示する．</td></tr>
</tbody></table>
<h2 id="ファイルを編集する"><a class="header" href="#ファイルを編集する">ファイルを編集する</a></h2>
<h3 id="cli-上で使えるエディタ"><a class="header" href="#cli-上で使えるエディタ">CLI 上で使えるエディタ</a></h3>
<p>CLI で使用できる<code>vi</code>というエディタが存在する．今後多用するため，操作を押さえておこう．</p>
<ul>
<li>CLI 上では<code>vi</code>と呼ばれるエディタを使用できる（他にもある）．</li>
<li><code>vi</code>コマンドでエディタを起動する．</li>
</ul>
<pre><code class="language-bash">$ vi 編集したいファイルの名前
</code></pre>
<h3 id="使い方の流れ"><a class="header" href="#使い方の流れ">使い方の流れ</a></h3>
<p>エディタには「コマンドモード」と「インサートモード」がある．</p>
<p>それぞれのモードでできることは以下のとおり．起動すると最初は必ずコマンドモードになる．</p>
<table><thead><tr><th>モード</th><th>できること</th><th>切り替え</th></tr></thead><tbody>
<tr><td>コマンドモード</td><td>ファイルの保存，閉じる，など</td><td><code>i</code>を入力するとインサートモードへ切り替わる</td></tr>
<tr><td>インサートモード</td><td>ファイルに対する追記や編集</td><td><code>Esc</code>キーでコマンドモードに切り替わる</td></tr>
</tbody></table>
<p>使い方は主に下記の流れとなる．</p>
<ul>
<li>vi を起動する．</li>
<li><code>i</code> を入力してインサートモードに変化する．<code>-INSERT-</code> などが表示される．</li>
<li>インサートモードで，ファイルに対して文字列の入力や編集が行う．</li>
<li><code>Esc</code> キーでコマンドモードに戻る．</li>
<li>コマンドモードで「ファイルを保存」「閉じる」などの操作を行う．</li>
</ul>
<h3 id="コマンドモードで使用する代表的なコマンド"><a class="header" href="#コマンドモードで使用する代表的なコマンド">コマンドモードで使用する代表的なコマンド</a></h3>
<table><thead><tr><th>コマンド</th><th>意味</th></tr></thead><tbody>
<tr><td><code>:w</code></td><td>現在開いているファイルを保存．</td></tr>
<tr><td><code>:q</code></td><td>現在開いているファイルを閉じる．</td></tr>
<tr><td><code>:wq</code></td><td>上記 2 つの組み合わせ．保存して閉じるの意味．</td></tr>
<tr><td><code>:!q</code></td><td>保存せずに閉じる．書いていて訳がわからなくなったらこれ．</td></tr>
</tbody></table>
<h2 id="練習-7"><a class="header" href="#練習-7">練習</a></h2>
<p>以下の処理をやってみよう！</p>
<p>CLI 操作に慣れるのが目的！</p>
<ul>
<li>ターミナルでデスクトップに移動する．</li>
<li><code>test</code> フォルダを作成する．</li>
<li><code>test</code> フォルダに移動する．</li>
<li><code>test</code> フォルダ内に <code>sample.txt</code> ファイルを作成する．</li>
<li>vi で <code>sample.txt</code> を開き，<code>Hello CLI!</code> と記述して保存して閉じる．</li>
<li>ターミナルで <code>sample.txt</code> の内容を表示する．（Hello CLI! が表示されれば OK）</li>
<li>GUI で上記ファイルが作成されていることを確認．</li>
</ul>
<h2 id="危険滅びの呪文"><a class="header" href="#危険滅びの呪文">【危険】滅びの呪文</a></h2>
<p>PC の全てが死ぬ．絶対に実行してはならない．</p>
<p>（実行すると講義の受講に著しく支障をきたします）</p>
<p><a href="https://news.mynavi.jp/article/dont_run_on_linux-11/">参考：https://news.mynavi.jp/article/dont_run_on_linux-11/</a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="git-1"><a class="header" href="#git-1">Git</a></h1>
<h2 id="クイズ"><a class="header" href="#クイズ">クイズ</a></h2>
<p>あるフォルダの中に以下のファイルがあります．</p>
<p>最新のファイルはどれか．</p>
<pre><code class="language-bah">議事録フォルダ
├── 20210701議事録.txt
├── 20210701議事録0702再修正.txt
├── 20210701議事録0702追記_確認依頼.txt
├── 20210701議事録0702追記.txt
├── 20210701議事録0702修正.txt
├── 20210701議事録0702修正2_チェック済.txt
├── 20210701議事録0702修正2.txt
├── 20210701議事録0702再修正.txt
├── 20210701議事録0702最終.txt
├── 20210701議事録0702追記.txt
└── 議事録.txt

</code></pre>
<p>このような悲劇を防ぐのが Git である．</p>
<h2 id="バージョン管理"><a class="header" href="#バージョン管理">「バージョン管理」</a></h2>
<p>ファイルを更新していく際，以前の状態も残しておきたいことは多い．</p>
<ul>
<li>修正点がわかるようにしたい．</li>
<li>不具合があった場合に，以前の状態に戻せるようにしたい．</li>
</ul>
<p>しかし，これらを実現しようとすると「いくつもの状態のファイル」を複数残しておく必要がでてくる．</p>
<p>Git は上記を実現するための「更新履歴を管理するツール」である．</p>
<h2 id="例-2"><a class="header" href="#例-2">例</a></h2>
<p>じゃんけんのアプリケーションをつくる際に Git を使ってバージョンを更新する流れ</p>
<table><thead><tr><th align="right">ファイルのバージョン</th><th>ファイルに対してやったこと</th><th>Git でやること</th></tr></thead><tbody>
<tr><td align="right">1</td><td>グーチョキパーのボタンをつくった</td><td>いまのバージョンを<code>iw83n5</code>とする</td></tr>
<tr><td align="right">2</td><td>グーボタンでコンピュータが手を出す機能を追加した</td><td>いまのバージョンを<code>21nvr7</code>とする</td></tr>
<tr><td align="right">3</td><td>チョキボタンとパーボタンでコンピュータが手を出す機能を追加した</td><td>いまのバージョンを<code>98nieh</code>とする</td></tr>
<tr><td align="right">4</td><td>勝数をカウントする機能を追加した</td><td>いまのバージョンを<code>mvre92</code>とする</td></tr>
</tbody></table>
<p>このように「Git を使って管理」しておくと，以下のことができる．</p>
<ul>
<li>ファイルは最新の状態のもの 1 つだけが残される．</li>
<li>変更の履歴（追加や削除した文字列など）が全て記録される．</li>
<li><code>iw83n5</code>などの文字列（ハッシュと呼ぶ）を指定することで，以前のバージョンに戻すことができる．</li>
<li>他にもいろいろあるが，今回は省略．</li>
</ul>
<p>このように，Git を使ってファイルを管理しておくと，「致命的なバグが発生したとき」「機能を追加しようとしてすでに動いている部分が動かなくなってしまったとき」などに「うまく動いていた状態」まで戻すことができる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-概要"><a class="header" href="#github-概要">GitHub 概要</a></h1>
<h2 id="gitとgithubは異なる"><a class="header" href="#gitとgithubは異なる">「Git」と「GitHub」は異なる！</a></h2>
<p>「Git のバージョン管理」をオンラインで共有できるのが GitHub</p>
<p><img src="git/./img/cli_git_github_01.svg" alt="GitHub解説1" /></p>
<h2 id="複数人でのバージョン管理がより簡単に"><a class="header" href="#複数人でのバージョン管理がより簡単に">複数人でのバージョン管理がより簡単に！</a></h2>
<p>オンライン上でソースコードを共有できるため，複数人で協力して開発を進めることが容易になる．</p>
<p><img src="git/./img/cli_git_github_02.svg" alt="GitHub解説2" /></p>
<h2 id="github-はエンジニア同士の-sns"><a class="header" href="#github-はエンジニア同士の-sns">Github はエンジニア同士の SNS</a></h2>
<p>GitHub は単にソースコードをオンラインで管理するだけが役割ではない．</p>
<p>その他にも，下記のようなことが実現できる「エンジニアの SNS」であるッ！</p>
<ul>
<li>開発者同士でのソースコード共有．</li>
<li>複数人のチームでのプロダクト開発．</li>
<li>有志による機能開発とプロダクトへの反映（pull request）</li>
<li>バグ報告などコードを使ったコミュニケーション（issue）</li>
</ul>
<h2 id="重要readme-ファイル"><a class="header" href="#重要readme-ファイル">【重要】readme ファイル</a></h2>
<p>ソースコードを GitHub に push するときは，コードの案内（どんなプロダクトなのか，など）が必要となる．</p>
<p>そのために「<code>readme</code>」ファイルというものが存在する．下記の手順で作成してみよう．</p>
<ol>
<li>エディタでプロダクトのフォルダを開き，<code>readme.md</code>を新規作成．</li>
<li>新規作成した readme ファイルに次の内容を記述しよう！
<ul>
<li><code>readme</code> ファイルは「マークダウン形式」で記述する．</li>
</ul>
</li>
</ol>
<pre><code class="language-md"># プロダクトのタイトル

## プロダクトの紹介

- 箇条書きにすると
- 読みやすい

## 工夫した点，こだわった点

- 特に見てほしい点，
- うまくできたと感じている点など．

## 苦戦した点，共有したいハマりポイントなど

- ハマった経験は資産．
- あとで自分で見返しても有用．
</code></pre>
<p><code>readme</code> ファイルはプロダクトのフォルダ内に保存しておき，他のソースコードと一緒に GitHub に push するとリポジトリの画面に表示される．</p>
<h2 id="重要ディレクトリ間違えた場合"><a class="header" href="#重要ディレクトリ間違えた場合">【重要】ディレクトリ間違えた場合</a></h2>
<p>コマンド <code>git init</code> を実行すると隠しフォルダ <code>.git</code> が作成される．</p>
<p>このフォルダの中に，バージョンの履歴などが保存されている．</p>
<p>誤ったフォルダで <code>git init</code> した場合は，<code>.git</code> フォルダを削除するとなかったことにできる．</p>
<p>→ 再度目的のディレクトリに移動して <code>git init</code> しよう！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-設定"><a class="header" href="#github-設定">GitHub 設定</a></h1>
<h2 id="この手順を実行するタイミング"><a class="header" href="#この手順を実行するタイミング">この手順を実行するタイミング</a></h2>
<ul>
<li>はじめて GitHub に登録をしたとき．</li>
<li>新しい PC で GitHub にアクセスするとき．</li>
</ul>
<p>ローカル PC と GitHub の通信には「SSH 通信」を使用する．</p>
<h2 id="ssh-通信の流れ"><a class="header" href="#ssh-通信の流れ">ssh 通信の流れ</a></h2>
<ol>
<li>「公開鍵」「秘密鍵」の 2 種類の鍵ファイルを作成する．この 2 つはペアになっている．</li>
<li>「公開鍵」の内容を GitHub 上に登録する．「秘密鍵」のファイルはローカル PC に保存する．</li>
<li>ローカル PC に通信用の設定を記述する．</li>
<li>両者で通信を行う際，「公開鍵」と「秘密鍵」の組み合わせが合っている場合のみ通信が成功する．</li>
</ol>
<p>本項では，この SSH 通信を行うための設定を行う．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ssh-鍵の発行"><a class="header" href="#ssh-鍵の発行">SSH 鍵の発行</a></h1>
<h2 id="作業ディレクトリの確認"><a class="header" href="#作業ディレクトリの確認">作業ディレクトリの確認</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>ターミナルを起動するとホームディレクトリにいるはずだが一応下記を実行．</p>
<pre><code class="language-bash">$ cd ~
</code></pre>
<h2 id="フォルダの準備"><a class="header" href="#フォルダの準備">フォルダの準備</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<ul>
<li>ssh-key は適切な場所に配置しないと動かない．</li>
<li>以下の手順でフォルダを準備する．</li>
</ul>
<p>下記コマンドでファイルとフォルダの一覧を表示する．</p>
<pre><code class="language-bash">$ ls -a
</code></pre>
<p>一覧が表示されるので，「<code>.ssh</code>」フォルダを探す．</p>
<p><strong><code>「.ssh」</code>が存在しない場合のみ</strong>下記コマンドでホームディレクトリに<code>.ssh</code>フォルダを作成する．</p>
<pre><code class="language-bash">$ mkdir -p ~/.ssh
</code></pre>
<p>エラーが出なければ OK．</p>
<h2 id="ssh-key-の発行"><a class="header" href="#ssh-key-の発行">ssh-key の発行</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<ul>
<li>GitHub にアクセスするには ssh-key が必要となる．</li>
<li>ssh-key は公開鍵と秘密鍵のペアになっており，「公開鍵を GitHub に登録」「秘密鍵を PC のローカルに保存」することで通信時に組み合わせがあっているかどうか判断する．</li>
<li>ターミナル(windows は GitBash)を開いて以下のコマンドを入力する．</li>
</ul>
<p>まずは以下のコマンドで作業ディレクトリを<code>.ssh</code>（前項で準備したフォルダ）に変更する．</p>
<pre><code class="language-bash">$ cd ~/.ssh
</code></pre>
<p>続いて，以下のコマンドで ssh キー（公開鍵と秘密鍵のペア）を発行する．</p>
<pre><code class="language-bash">$ ssh-keygen
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Generating public/private rsa key pair.
Enter file in which to save the key (/home/vagrant/.ssh/id_rsa):
</code></pre>
<p>そのまま何も入力せずに Enter．</p>
<pre><code class="language-bash">Enter passphrase (empty for no passphrase):
</code></pre>
<p>続き．何も入力せずに Enter．</p>
<pre><code class="language-bash">Enter same passphrase again:
</code></pre>
<p>続き．パスワード入力していないので何も入力せずに Enter．</p>
<pre><code class="language-bash">Your identification has been saved in id_rsa.
Your public key has been saved in id_rsa.pub.
The key fingerprint is:
6f:09:00:22:44:55:66:77:95:89:41:7d:a7:58:1b:92 vagrant@localhost.localdomain
The key's randomart image is:
+--[ RSA 2048]----+
|   .o. .         |
|     oEo+ .      |
|    . +=+=       |
|     o.+==       |
|    . . S .      |
|       - + .     |
|      .   +      |
|         .       |
|                 |
+-----------------+
</code></pre>
<p>これで ssh-key を発行できた．</p>
<blockquote>
<p><strong>【参考】</strong></p>
<p>以下のコマンドで発行した内容を確認できるので，うまくいかない場合は確認してみると良い．</p>
<p>下記のようになっていれば OK．（細かな文字列や数値は異なっていて OK）．</p>
<pre><code class="language-bash">$ ls -la | grep id_rsa

# 実行結果
-rw-------  1 taroosg taroosg 1856 Dec 28  2018 id_rsa
-rw-rw-r--  1 taroosg taroosg  403 Dec 28  2018 id_rsa.pub
</code></pre>
</blockquote>
<h2 id="ssh-キーの設定"><a class="header" href="#ssh-キーの設定">ssh キーの設定</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>以下 2 つのコマンドで ssh-key を動作するように設定する．</p>
<pre><code class="language-bash">$ eval $(ssh-agent)

# 実行結果（数値は毎回異なる）
Agent pid 9899

</code></pre>
<pre><code class="language-bash">$ ssh-add ~/.ssh/id_rsa

# 実行結果（ディレクトリは各自異なる）
Identity added: /home/taroosg/.ssh/id_rsa

</code></pre>
<p>以上で ssh-key の準備は完了だが，設定ファイルに変更を加える必要がある．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="設定ファイルの編集"><a class="header" href="#設定ファイルの編集">設定ファイルの編集</a></h1>
<h2 id="ターミナルで設定ファイルを開く"><a class="header" href="#ターミナルで設定ファイルを開く">ターミナルで設定ファイルを開く</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>ややこしいので 1 つずつ確認しながら進めること！</p>
<ul>
<li>下記のコマンドで設定ファイルに書き込む．</li>
<li>2 行目の「<code>vi ~...</code>」ではターミナル内でエディタを起動する．画面が変わりますがパニックにならないよう注意！</li>
</ul>
<p>ターミナルで以下を 1 行ずつ実行．1 行目がファイルの作成で，2 行目でエディタでファイルを開く．</p>
<pre><code class="language-bash">$ touch ~/.ssh/config
$ vi ~/.ssh/config
</code></pre>
<h2 id="設定ファイルに書き込み"><a class="header" href="#設定ファイルに書き込み">設定ファイルに書き込み</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<ul>
<li>このエディタにはインサートモードとコマンドモードの 2 つがあり，最初はコマンドモードで表示されるが，追記を行うにはインサートモードに変更する必要がある．</li>
<li>インサートモードにするには「<code>i</code>」キーを押す．画面のどこかに <code>—INSERT—</code> や <code>—挿入—</code> などの文字列が表示される．その状態で「<code>Host github</code>」からの 5 行を追記する．</li>
<li>追記が終わったら「esc（コマンドモードに戻る）」→「<code>:wq</code>（保存して終了のコマンド）」→「<code>enter</code>（実行）」で元の画面に戻る．</li>
<li>ミスったと感じたら「<code>esc</code>」→「<code>:q!</code>」→「<code>enter</code>」でエディタを終了できるので，もう一度「<code>vi ~...</code>」を入力してやり直しましょう．</li>
</ul>
<p><code>.ssh/config</code> ファイルを開くと空なので以下を追記する．</p>
<pre><code class="language-text">Host github.com
  HostName github.com
  Identityfile ~/.ssh/id_rsa
  Port 22
  User git
</code></pre>
<h2 id="権限の変更"><a class="header" href="#権限の変更">権限の変更</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>続いて，設定ファイルの権限を変更する．ターミナルで以下を実行．</p>
<pre><code class="language-bash">$ chmod 700 ~/.ssh/config
</code></pre>
<p>エラーが出なければ OK．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-への-ssh-鍵登録"><a class="header" href="#github-への-ssh-鍵登録">GitHub への SSH 鍵登録</a></h1>
<h2 id="作成した-ssh-キーの表示"><a class="header" href="#作成した-ssh-キーの表示">作成した ssh キーの表示</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>ターミナルで下記のコマンドを入力し，ssh-key を表示させる．</p>
<pre><code class="language-bash">$ cat ~/.ssh/id_rsa.pub
</code></pre>
<p>実行結果（先頭は <code>ssh-rsa</code> だが，残りは各自異なる文字列となる）</p>
<pre><code class="language-bash">ssh-rsa ...
...
...
...
...
... localhost@0-mac
</code></pre>
<h2 id="github-に-ssh-key-を登録"><a class="header" href="#github-に-ssh-key-を登録">GitHub に ssh-key を登録</a></h2>
<blockquote>
<p>🌏 ブラウザの操作</p>
</blockquote>
<p>GitHub のサイトにアクセスし，「設定」→「SSH keys」へ進む．「Add SSH key」をクリックして入力画面へ進む．</p>
<p>ターミナルに表示された文字列を「ssh-rsa」から全てコピーし，GitHub サイトの入力欄に貼り付ける．タイトルは PC 名など適当につけて OK．
入力したら「Add key」をクリックして終了．</p>
<p>※公開鍵は PC 毎にペアを作成するため，どの PC で発行した公開鍵なのか判別できるように名前をつけると良い．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-との接続設定"><a class="header" href="#github-との接続設定">GitHub との接続設定</a></h1>
<h2 id="github-の接続情報を登録"><a class="header" href="#github-の接続情報を登録">GitHub の接続情報を登録</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>「GitHub のユーザ名」と「GitHub で使用しているメールアドレス」をローカル PC に登録する．</p>
<p>ターミナルで下記コマンドを入力し，エンターを押す．</p>
<p><strong>！！！それぞれ自身のアカウントのものを入力すること！！！</strong></p>
<ul>
<li>1 行目はユーザ名を入力する．</li>
<li>2 行目はメールアドレスを入力する．</li>
</ul>
<pre><code class="language-bash">$ git config --global user.name &quot;hoge&quot;
$ git config --global user.email &quot;hoge@example.com&quot;
</code></pre>
<h2 id="内容確認"><a class="header" href="#内容確認">内容確認</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>以下のコマンドを入力して内容を確認する．</p>
<pre><code class="language-bash">$ git config -l

# 実行結果（下記以外にいくつか表示される場合もある．下記の内容が含まれていればOK）
user.name=hoge
user.email=hoge@example.com

</code></pre>
<p>上で入力した内容に間違いなければ OK．</p>
<h2 id="接続テスト"><a class="header" href="#接続テスト">接続テスト</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>ターミナルで下記を実行．途中でなにか訊かれたら「<code>yes</code>」と入力して進める．</p>
<pre><code class="language-bash">$ ssh -i ~/.ssh/id_rsa git@github.com

# 実行結果（`Hi` の後は自分のユーザ名が表示される）
Hi hoge! You've successfully authenticated, but GitHub does not provide shell access.
Connection to github.com closed.
</code></pre>
<p>上記のように表示されれば OK．</p>
<h2 id="デフォルトブランチの変更"><a class="header" href="#デフォルトブランチの変更">デフォルトブランチの変更</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>Git でソースコードを管理する際には「ブランチ」という考え方が存在する．</p>
<p>GitHub ではデフォルトのブランチが<code>main</code>という名前になっているが，ローカルの PC では<code>master</code>となっている場合がある（バージョンなどで異なる）．</p>
<p><code>main</code>に統一しておかないと後々面倒なので，下記のコマンドでローカル PC のデフォルトブランチを<code>main</code>に変更する．</p>
<pre><code class="language-bash">$ git config --global init.defaultBranch main
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-にプロダクトを-push"><a class="header" href="#github-にプロダクトを-push">GitHub にプロダクトを push</a></h1>
<h2 id="この手順を行うタイミング"><a class="header" href="#この手順を行うタイミング">この手順を行うタイミング</a></h2>
<ul>
<li>新しいプロダクトを作成し，初めて GitHub にソースコードを共有するとき．</li>
</ul>
<h2 id="リポジトリを作成する"><a class="header" href="#リポジトリを作成する">リポジトリを作成する</a></h2>
<blockquote>
<p>🌏 ブラウザの操作</p>
</blockquote>
<ul>
<li>ブラウザで GitHub にアクセスし，新しいリポジトリを作成する．</li>
<li>Repository name はプロダクト名にしておくとわかりやすくて良い．(janken, mamopad など)</li>
<li>【重要】下の方の<code>Initialize this repository with:</code>部分はチェックを入れないこと．</li>
<li>作成すると URL が表示されるのでそのままにしておく．「SSH のタブ」を選択しておく(後で URL を使用するため)</li>
</ul>
<h2 id="超重要ディレクトリを変更する"><a class="header" href="#超重要ディレクトリを変更する">【超重要】ディレクトリを変更する</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>まず，ターミナルの作業ディレクトリをプロダクトのディレクトリに移動する必要がある．</p>
<p><strong>移動しない場合，PC の中身全てを GitHub にプッシュする羽目になるので必ず行うこと！！</strong></p>
<p><strong>この手順を行わなかった場合，今後あらゆるコマンドでエラーが発生する，PC がクラッシュするなどの危険が伴う．</strong></p>
<p>ターミナルで下記コマンドを入力する．(enter は押さないこと)</p>
<p>【重要】<code>cd</code>のあとにスペースを入れること</p>
<pre><code class="language-bash">$ cd
</code></pre>
<p>入力したらプロダクトのフォルダをターミナルのウインドウ内にドラッグ&amp;ドロップする．</p>
<p>すると，「<code>cd</code>」の後にパスが表示されるので，間違いなければ「<code>enter</code>」を押す．</p>
<h2 id="初期化"><a class="header" href="#初期化">初期化</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>プロダクトのフォルダで Git による管理をできるようにする．</p>
<p>下記コマンドを入力する．</p>
<pre><code class="language-bash">$ git init
</code></pre>
<h2 id="リポジトリの登録"><a class="header" href="#リポジトリの登録">リポジトリの登録</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>コードをアップするリポジトリを連携させる．</p>
<p>先程ブラウザで作成したリポジトリの URL（<code>git@github.com/***</code>）を使用する．</p>
<p>ターミナルで以下を実行する．</p>
<pre><code class="language-bash">$ git remote add origin リポジトリのURL
</code></pre>
<p>登録されているかどうかは以下のコマンドで確認できる．</p>
<pre><code class="language-bash">$ git remote -v
</code></pre>
<p>確認結果</p>
<pre><code class="language-bash">origin	git@github.com:******/******.git (fetch)
origin	git@github.com:******/******.git (push)
</code></pre>
<p>間違っている場合は以下で登録し直す．</p>
<pre><code class="language-bash">$ git remote set-url origin 正しいURL
</code></pre>
<h2 id="ファイルを-add"><a class="header" href="#ファイルを-add">ファイルを add</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p>Git で管理するファイルを指定する．アップするには「<code>add</code>」「<code>commit</code>」「<code>push</code>」の 3 手順が必要．</p>
<p>ターミナルで以下を実行する．<code>.</code> は「フォルダ内の全てのファイル」の意味で，<code>add</code> の後にはスペースが入る点に注意！</p>
<pre><code class="language-bash">$ git add .
</code></pre>
<h2 id="ファイルを-commit"><a class="header" href="#ファイルを-commit">ファイルを commit</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p><code>commit</code> はファイルのバージョンを作成するイメージ．</p>
<p>コミットを重ねても，以前のコミットへ状態を戻すことでファイルの内容をもとに戻すことが可能．</p>
<p>以下のコマンドを入力する．</p>
<p><code>-m</code> のあとの「<code>&quot;&quot;</code>」内にコミットメッセージを追加する．(変更内容などが把握できるコメント)</p>
<pre><code class="language-bash">$ git commit -m &quot;コミットメッセージ&quot;
</code></pre>
<h2 id="ファイルを-push"><a class="header" href="#ファイルを-push">ファイルを push</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<p><code>push</code> は実際にファイルをアップロードするイメージ．この段階ではじめて GitHub にコードが追加される．</p>
<p>下記コマンドを入力する．</p>
<pre><code class="language-bash">$ git push origin main
</code></pre>
<p>実行結果（似たような感じになっていれば OK）</p>
<pre><code class="language-bash">Counting objects: 4, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 385 bytes | 385.00 KiB/s, done.
Total 4 (delta 3), reused 0 (delta 0)
remote: Resolving deltas: 100% (3/3), completed with 3 local objects.
To github.com:******/******.git
   9ae72be..eb700ec  main -&gt; main
</code></pre>
<p>ブラウザで GitHub のページを確認し，ファイルがアップされていれば成功！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-に最新版を-push"><a class="header" href="#github-に最新版を-push">GitHub に最新版を push</a></h1>
<h2 id="この手順を行うタイミング-1"><a class="header" href="#この手順を行うタイミング-1">この手順を行うタイミング</a></h2>
<ul>
<li>すでに GitHub リポジトリに登録してあるプロダクトに機能追加，更新などしたとき．</li>
</ul>
<h2 id="超重要ディレクトリを変更する-1"><a class="header" href="#超重要ディレクトリを変更する-1">【超重要】ディレクトリを変更する</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<ul>
<li>これを忘れると別のファイルを登録することになりものすごく面倒なので注意すること！！</li>
<li>ターミナルで下記コマンドを入力する．<code>cd</code>のあとには必ずスペース入れる．(enter は押さないこと)</li>
</ul>
<pre><code class="language-bash">$ cd
</code></pre>
<p>入力したらプロダクトのフォルダをドラッグ&amp;ドロップする．</p>
<p>すると，「<code>cd</code>」の後にパスが表示されるので，間違いなければ「<code>enter</code>」を押す．</p>
<p>以降は上記「<code>add</code>」「<code>commit</code>」「<code>push</code>」の流れ．</p>
<h2 id="ファイルを-add-1"><a class="header" href="#ファイルを-add-1">ファイルを add</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<pre><code class="language-bash">$ git add .
</code></pre>
<h2 id="ファイルを-commit-1"><a class="header" href="#ファイルを-commit-1">ファイルを commit</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<pre><code class="language-bash">$ git commit -m&quot;コミットメッセージ&quot;
</code></pre>
<h2 id="ファイルを-push-1"><a class="header" href="#ファイルを-push-1">ファイルを push</a></h2>
<blockquote>
<p>💻 ターミナルの操作</p>
</blockquote>
<pre><code class="language-bash">$ git push origin main
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Counting objects: 4, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 385 bytes | 385.00 KiB/s, done.
Total 4 (delta 3), reused 0 (delta 0)
remote: Resolving deltas: 100% (3/3), completed with 3 local objects.
To github.com:******/******.git
   9ae72be..eb700ec  main -&gt; main
</code></pre>
<p>ブラウザで GitHub のリポジトリを確認してコードが最新に更新されていれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_メモパッド"><a class="header" href="#js_メモパッド">JS_メモパッド</a></h1>
<h2 id="サンプルコード-2"><a class="header" href="#サンプルコード-2">サンプルコード</a></h2>
<p><a href="js/js02/../../samples/02_js_memopad_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-2"><a class="header" href="#本講義の内容とゴール-2">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-2"><a class="header" href="#本講義の内容-2">本講義の内容</a></h3>
<ul>
<li>配列や繰り返し処理に触れる．</li>
<li>ブラウザにデータを保存する．</li>
<li>複数件のデータをまとめる処理を実装する．</li>
</ul>
<h3 id="本講義のゴール-2"><a class="header" href="#本講義のゴール-2">本講義のゴール</a></h3>
<ul>
<li>いろいろなデータ形式を知る！</li>
<li>データの扱いになれる！</li>
<li>データを保存・読み出しをマスターする！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="配列"><a class="header" href="#配列">配列</a></h1>
<h2 id="配列arrayとは"><a class="header" href="#配列arrayとは">配列（array）とは</a></h2>
<ul>
<li>複数の値に順番をつけてまとめて扱う方法．奥が深い．超強い．</li>
<li>順番を「インデックス」と呼ぶ．「0」からスタート！
<ul>
<li>プログラミングでは「数字は 0 から始める」（稀に例外もあり）</li>
</ul>
</li>
</ul>
<pre><code class="language-js">const array = [&quot;大吉&quot;, &quot;中吉&quot;, &quot;小吉&quot;, &quot;凶&quot;, &quot;大凶&quot;];
alert(array[0]);
</code></pre>
<h2 id="配列の作り方"><a class="header" href="#配列の作り方">配列の作り方</a></h2>
<p>下記のどちらかで作成可能．どちらでも良い（1 が多い）．</p>
<ol>
<li><code>[]</code>で囲い，要素をカンマで区切る．</li>
<li><code>new Array()</code>の<code>()</code>内に要素をカンマ区切りで入れる．</li>
</ol>
<pre><code class="language-js">const list01 = ['月', '火', '水', '木', '金', '土', '日'];
const list02 = new Array('月', '火', '水', '木', '金', '土', '日&quot;);
console.log(list01);

</code></pre>
<h3 id="-key-point-8"><a class="header" href="#-key-point-8">💡 Key Point</a></h3>
<blockquote>
<p>配列はブラウザの検証画面に出力すると構造や内容が確認しやすい．</p>
</blockquote>
<h2 id="配列の長さ"><a class="header" href="#配列の長さ">配列の長さ</a></h2>
<p>配列の要素数を「長さ」と呼ぶ．長さは<code>配列名.length</code>で取得することができる．</p>
<p>繰り返し処理などで非常に有用である（後述）．</p>
<pre><code class="language-js">console.log(list01.length); // 7
</code></pre>
<h2 id="配列のいいぞ"><a class="header" href="#配列のいいぞ">配列のいいぞ．．．</a></h2>
<p>条件分岐なんていらんかったんや．．．</p>
<pre><code class="language-js">const hands = [&quot;グー&quot;, &quot;チョキ&quot;, &quot;パー&quot;];
const randomNumber = Math.floor(Math.random() * hands.length);
const computerHand = hands[randomNumber];

console.log(computerHand);
</code></pre>
<p>結果のテーブルをつくるのもありやな．．．</p>
<pre><code class="language-js">const resultTable = [
  [&quot;draw&quot;, &quot;win&quot;, &quot;lose&quot;],
  [&quot;lose&quot;, &quot;draw&quot;, &quot;win&quot;],
  [&quot;win&quot;, &quot;lose&quot;, &quot;draw&quot;],
];

const userHand = 0;
const computerHand = 1;

const result = resultTable[userHand][computerHand];

console.log(result);
</code></pre>
<h2 id="よくある配列の処理"><a class="header" href="#よくある配列の処理">よくある配列の処理</a></h2>
<p>配列には値を追加したり削除したりできる．</p>
<pre><code class="language-js">const list01 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

// 先頭に追加
list01.unshift(0); // [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

// 末尾に追加
list01.push(11); // [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]

// 先頭を削除
list01.shift(); // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]

// 末尾を削除
list01.pop(); // [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

// 反転
list01.reverse(); // [10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="繰り返し処理"><a class="header" href="#繰り返し処理">繰り返し処理</a></h1>
<h2 id="繰り返し処理とは"><a class="header" href="#繰り返し処理とは">繰り返し処理とは</a></h2>
<p>同じ処理を指定した回数実行するやり方</p>
<ul>
<li>同じ処理を 100 回実行したいときに 100 回書くのか．．？</li>
<li>配列と相性が良い！</li>
<li>超むずい（使っていてもきちんと説明できないことも．．．）</li>
</ul>
<h2 id="書き方-1"><a class="header" href="#書き方-1">書き方</a></h2>
<p>繰り返し処理では次の 3 つの条件を指定する．</p>
<ol>
<li>開始条件</li>
<li>繰り返しを続ける条件</li>
<li>回数のカウントの仕方</li>
</ol>
<pre><code class="language-js">for (`開始条件`; `繰り返しを続ける条件`; `回数のカウントの仕方`) {
  // 実際に繰り返したい処理
}
</code></pre>
<h3 id="-key-point-9"><a class="header" href="#-key-point-9">💡 Key Point</a></h3>
<blockquote>
<p>if 文と同じく，まず構文の形をつくってしまおう．</p>
</blockquote>
<h2 id="コード例-1"><a class="header" href="#コード例-1">コード例</a></h2>
<ul>
<li>「<code>i</code>」の値を使って繰り返しをコントロールする．</li>
<li>条件をセミコロン「<code>;</code>」で区切る点に注意！！</li>
<li><code>i++</code>は「<code>i</code>を 1 ずつ増やす」を意味する．</li>
<li>「<code>i=0</code>で<code>{}</code>内を実行」「<code>i=1</code>で<code>{}</code>内を実行」...の繰り返し．</li>
</ul>
<pre><code class="language-js">for (let i = 0; i &lt; 100; i++) {
  console.log(i);
}
</code></pre>
<p>上のコードは以下と同じ意味．「<code>i &lt; 100</code>」なので 99 まで実行したら終了．</p>
<pre><code class="language-js">console.log(0);
console.log(1);
console.log(2);
// ...
console.log(98);
console.log(99);
</code></pre>
<h2 id="繰り返しの使用例"><a class="header" href="#繰り返しの使用例">繰り返しの使用例</a></h2>
<p>1901 年から 2021 年を選択できる<code>&lt;select&gt;</code>を作成する．処理の流れは以下．</p>
<ol>
<li>開始年と終了年を定義しておく．</li>
<li>出力用の空文字を用意しておく．</li>
<li>繰り返し処理で「開始条件に開始年」「終了条件に終了年」を指定してタグを作成し，空文字に追加する．</li>
<li>繰り返し処理が終わったら指定した場所に出力する．</li>
</ol>
<pre><code class="language-js">// 1
const start = 1901;
const end = 2021;

// 2
let option = &quot;&quot;;

// 3
for (let i = start; i &lt;= end; i++) {
  option += &quot;&lt;option&gt;&quot; + i + &quot;&lt;/option&gt;&quot;;
}

// 4
$(&quot;#hoge&quot;).html(option);
</code></pre>
<h2 id="繰り返し処理との組み合わせ"><a class="header" href="#繰り返し処理との組み合わせ">繰り返し処理との組み合わせ</a></h2>
<p>繰り返し処理を用いると配列内の要素を順番に使うことができる．<code>length</code>を使用すると配列の長さに関わらず対応できる．</p>
<pre><code class="language-js">const list01 = [&quot;月&quot;, &quot;火&quot;, &quot;水&quot;, &quot;木&quot;, &quot;金&quot;, &quot;土&quot;, &quot;日&quot;];

for (let i = 0; i &lt; list01.length; i++) {
  console.log(list01[i]);
}
</code></pre>
<h2 id="配列と繰り返しでブラウザに要素を表示"><a class="header" href="#配列と繰り返しでブラウザに要素を表示">配列と繰り返しでブラウザに要素を表示</a></h2>
<p>よく出てくるパターン．データが入った配列からデータを取り出して画面に表示したい場面は多い．</p>
<p>流れは以下のとおり．</p>
<ol>
<li>空の出力用配列を用意しておく．</li>
<li>繰り返し処理を用いて，配列からデータを取り出し，タグに入れて 1 の配列に追加する．</li>
<li>繰り返し処理が終わったら出力用の配列を画面上の指定した部分に出力する．</li>
</ol>
<pre><code class="language-js">const list01 = [&quot;月&quot;, &quot;火&quot;, &quot;水&quot;, &quot;木&quot;, &quot;金&quot;, &quot;土&quot;, &quot;日&quot;];

// 1
const array = [];

// 2
for (let i = 0; i &lt; list01.length; i++) {
  array.push(&quot;&lt;p&gt;&quot; + list01[i] + &quot;&lt;/p&gt;&quot;);
}

// 3
$(&quot;#echo&quot;).html(array);
</code></pre>
<h2 id="繰り返し処理のバリエーション"><a class="header" href="#繰り返し処理のバリエーション">繰り返し処理のバリエーション</a></h2>
<p>似たような構文がいくつか存在する．とりあえず好きなものを使用すれば OK．</p>
<pre><code class="language-js">const list = [1, 2, 3, 4, 5];

for (let i = 0; i &lt; list.length; i++) {
  console.log(list[i]);
}

for (let x of list) {
  console.log(x);
}

list.forEach(function (x) {
  console.log(x);
});
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="オブジェクト"><a class="header" href="#オブジェクト">オブジェクト</a></h1>
<h2 id="オブジェクトとは"><a class="header" href="#オブジェクトとは">オブジェクトとは</a></h2>
<ul>
<li>配列と同様に複数の値を管理する方法</li>
<li>配列の「インデックス」に対して「キー」「バリュー」で管理．</li>
</ul>
<pre><code class="language-js">const jojo01 = {
  number: 1,
  title: &quot;ファントムブラッド&quot;,
  hero: &quot;ジョナサン・ジョースター&quot;,
  rival: &quot;ディオ・ブランドー&quot;,
  sound: &quot;メメタァ&quot;,
};
console.log(jojo01.sound);
console.log(jojo01[&quot;sound&quot;]);
</code></pre>
<h2 id="配列とオブジェクトの組み合わせ"><a class="header" href="#配列とオブジェクトの組み合わせ">配列とオブジェクトの組み合わせ</a></h2>
<p>この形は非常に多い．今後もたくさん出てくるので慣れておくことを推奨するッ！！</p>
<pre><code class="language-js">const jojo = [
  {
    number: 1,
    title: &quot;ファントムブラッド&quot;,
    hero: &quot;ジョナサン・ジョースター&quot;,
  },
  {
    number: 2,
    title: &quot;戦闘潮流&quot;,
    hero: &quot;ジョセフ・ジョースター&quot;,
  },
  {
    number: 3,
    title: &quot;スターダストクルセイダース&quot;,
    hero: &quot;空条承太郎&quot;,
  },
];

console.log(jojo[0].title); // ファントムブラッド
console.log(jojo[2].hero); // 空条承太郎
</code></pre>
<h2 id="練習-8"><a class="header" href="#練習-8">練習</a></h2>
<p>配列の練習</p>
<ul>
<li><code>list/array.html</code></li>
</ul>
<p>オブジェクトの練習</p>
<ul>
<li><code>list/object.html</code></li>
</ul>
<p>上記が楽勝な人</p>
<ul>
<li><code>list/challenge.html</code></li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="localstorageメモ帳初級"><a class="header" href="#localstorageメモ帳初級">LocalStorage（メモ帳初級）</a></h1>
<h2 id="localstorage-とは"><a class="header" href="#localstorage-とは">LocalStorage とは</a></h2>
<h3 id="変数やオブジェクトの問題"><a class="header" href="#変数やオブジェクトの問題">変数やオブジェクトの問題</a></h3>
<ul>
<li>ブラウザをリロードすると初期化される．</li>
<li>次回読み込んだときまで値を保存したいときにつらい！</li>
</ul>
<h3 id="localstorage-ができること"><a class="header" href="#localstorage-ができること">LocalStorage ができること</a></h3>
<ul>
<li>ブラウザにデータを保存できる！
<ul>
<li>テキスト形式のデータのみ．</li>
</ul>
</li>
<li>「オリジン単位」ごとに 5MB まで保存できる．</li>
<li>（自分で削除しないと永続的に保存される）</li>
</ul>
<blockquote>
<p>オリジン単位とは「http://www.example.com:80」のような「プロトコル://ドメイン名:ポート番号」のこと．</p>
<p><a href="https://gihyo.jp/dev/serial/01/javascript-security/0004?page=2">参考: https://gihyo.jp/dev/serial/01/javascript-security/0004?page=2</a></p>
</blockquote>
<h2 id="本日実装するアプリケーション"><a class="header" href="#本日実装するアプリケーション">本日実装するアプリケーション</a></h2>
<h3 id="メモ帳をつくろう"><a class="header" href="#メモ帳をつくろう">メモ帳をつくろう！</a></h3>
<ul>
<li>ブラウザ上のテキストエリアにメモを入力．</li>
<li>ブラウザに情報を保存．</li>
<li>リロードしても情報が保存されるようにする．</li>
</ul>
<h3 id="仕様-1"><a class="header" href="#仕様-1">仕様</a></h3>
<ul>
<li>save ボタンをクリックしたら情報を保存．</li>
<li>clear ボタンをクリックしたら情報を削除．</li>
<li>リロード時に情報が保存されていれば自動的に表示．</li>
</ul>
<h3 id="完成イメージ-1"><a class="header" href="#完成イメージ-1">完成イメージ</a></h3>
<p>LocalStorage の内容は検証画面から確認できる．</p>
<p>「Application」 -&gt; 「LocalStorage」の順にクリックすると確認できる（下図の赤枠部分）．</p>
<p><img src="js/js02/./img/20210620233121.png" alt="メモ帳初級画面" /></p>
<h2 id="localstorage-の使い方"><a class="header" href="#localstorage-の使い方">LocalStorage の使い方</a></h2>
<h3 id="しくみ"><a class="header" href="#しくみ">しくみ</a></h3>
<p>「key」と「value」の形式でデータを保存する．key 名を変えれば複数保存できるッ！</p>
<table><thead><tr><th>key</th><th>value</th></tr></thead><tbody>
<tr><td>memo01</td><td>コード！書かずにはいられないッ！</td></tr>
<tr><td>memo02</td><td>最終的に．．．動けばよかろうなのだァァァァッ！！</td></tr>
<tr><td>memo03</td><td>過程や！方法なぞ！どうでもよいのだァーッ</td></tr>
</tbody></table>
<h3 id="javascript-での扱い方"><a class="header" href="#javascript-での扱い方">JavaScript での扱い方</a></h3>
<p>今回はデータの登録（すでに同じ key が存在する場合は上書き）とデータの取得を扱う．</p>
<table><thead><tr><th>内容</th><th>JavaScript の書き方</th></tr></thead><tbody>
<tr><td>データ登録</td><td><code>localStorage.setItem(key, value);</code></td></tr>
<tr><td>データ取得</td><td><code>localStorage.getItem(key);</code></td></tr>
<tr><td>データ更新</td><td><code>localStorage.setItem(key, value);</code></td></tr>
<tr><td>データ削除</td><td><code>localStorage.removeItem(key);</code></td></tr>
<tr><td>データ全削除</td><td><code>localStorage.clear();</code></td></tr>
<tr><td>データの長さ</td><td><code>localStorage.length;</code></td></tr>
<tr><td>データの順番</td><td><code>localStorage.key(インデックス);</code></td></tr>
</tbody></table>
<h2 id="メモ帳に必要な処理"><a class="header" href="#メモ帳に必要な処理">メモ帳に必要な処理</a></h2>
<h3 id="1-データを保存するときの処理"><a class="header" href="#1-データを保存するときの処理">1. データを保存するときの処理</a></h3>
<ol>
<li>save ボタンのクリックでイベント発火．</li>
<li>テキストエリアの情報を取得．</li>
<li>LocalStorage に情報を保存．</li>
</ol>
<h3 id="2-データを削除するときの処理"><a class="header" href="#2-データを削除するときの処理">2. データを削除するときの処理</a></h3>
<ol>
<li>clear ボタンクリックでイベント発火．</li>
<li>LocalStorage の情報を消去．</li>
<li>画面上の入力欄をクリア．</li>
</ol>
<h3 id="3-データを取得するときの処理"><a class="header" href="#3-データを取得するときの処理">3. データを取得するときの処理</a></h3>
<ol>
<li>読み込み時に LocalStorage のデータ有無を確認．</li>
<li>保存されていれば情報を取得．</li>
<li>テキストエリアに情報を表示．</li>
</ol>
<h2 id="データを保存するときの処理"><a class="header" href="#データを保存するときの処理">データを保存するときの処理</a></h2>
<ol>
<li>save ボタンのクリックでイベント発火．</li>
<li><code>.val()</code>でテキストエリアの情報を取得．</li>
<li><code>localStorage.setItem()</code>で LocalStorage に情報を保存．</li>
</ol>
<pre><code class="language-js">// memo01.html

$(&quot;#save&quot;).on(&quot;click&quot;, function () {
  const text = $(&quot;#text_area&quot;).val();
  localStorage.setItem(&quot;memo&quot;, text);
});
</code></pre>
<h3 id="-key-point-10"><a class="header" href="#-key-point-10">💡 Key Point</a></h3>
<blockquote>
<p>「localStorage」は手打ちせず補完に頼る！！</p>
</blockquote>
<h2 id="データを削除するときの処理"><a class="header" href="#データを削除するときの処理">データを削除するときの処理</a></h2>
<ol>
<li>clear ボタンクリックでイベント発火．</li>
<li>key 名を指定して LocalStorage の情報を消去．</li>
<li>画面上の入力欄をクリア（空文字で上書きする）．</li>
</ol>
<pre><code class="language-js">// memo01.html

$(&quot;#clear&quot;).on(&quot;click&quot;, function () {
  localStorage.removeItem(&quot;memo&quot;);
  $(&quot;#text_area&quot;).val(&quot;&quot;);
});
</code></pre>
<blockquote>
<p>「<code>.val()</code>」は<code>()</code>内に何か入れると入れた値で上書きする！</p>
</blockquote>
<h2 id="データを取得するときの処理"><a class="header" href="#データを取得するときの処理">データを取得するときの処理</a></h2>
<ol>
<li>読み込み時に条件分岐を用いて LocalStorage のデータ有無を確認．</li>
<li>保存されていれば情報を取得．</li>
<li>テキストエリアに情報を表示．</li>
</ol>
<pre><code class="language-js">// memo01.html

if (localStorage.getItem(&quot;memo&quot;)) {
  const text = localStorage.getItem(&quot;memo&quot;);
  $(&quot;#text_area&quot;).val(text);
}
</code></pre>
<blockquote>
<p>データがないのに処理しようとするとエラーになってしまう．データがないときは何もしない．</p>
</blockquote>
<h2 id="練習-9"><a class="header" href="#練習-9">練習</a></h2>
<p><code>memo01.html</code>に以下の処理を順番に実装しよう．</p>
<ol>
<li>save ボタンクリック時にデータの保存</li>
<li>clear ボタンクリック時にデータの消去</li>
<li>読み込み時にデータの取得</li>
</ol>
<p>LocalStorage の中身は検証画面から確認しよう．それぞれ以下の状態になれば OK！</p>
<ul>
<li>保存時にデータが保存され，検証画面から確認できる．</li>
<li>消去時に保存してあるデータが消去される．</li>
<li>リロード時に保存しているデータがあれば画面に表示される．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="json-データメモ帳中級"><a class="header" href="#json-データメモ帳中級">JSON データ（メモ帳中級）</a></h1>
<h2 id="メモ帳初級の問題点"><a class="header" href="#メモ帳初級の問題点">メモ帳初級の問題点</a></h2>
<p>データが 1 件しか保存できない．複数のメモを個別に残しておきたいときに困る．</p>
<h2 id="複数件のデータを管理する"><a class="header" href="#複数件のデータを管理する">複数件のデータを管理する</a></h2>
<p>配列かオブジェクトを使えば複数件のデータをまとめることができる．これを用いればメモ欄が複数になっても管理できそうである．</p>
<h2 id="だめです"><a class="header" href="#だめです">だめです</a></h2>
<p>配列やオブジェクトは言語毎に形式が異なるため互換性がない（JavaScript の配列は JavaScript でしか扱えない）．</p>
<p>つまり，LocalStorage も配列やオブジェクトを保存することはできない．</p>
<p><img src="js/js02/./img/js_localstorage_json01.svg" alt="json解説01" /></p>
<h2 id="互換性のあるデータである-json-形式"><a class="header" href="#互換性のあるデータである-json-形式">互換性のあるデータである JSON 形式</a></h2>
<p>Web アプリケーションは複数の言語で構成されていることが多い．このような場合にお互いのデータをやり取りするため，互換性のある「JSON 形式」が準備されている．</p>
<p>各言語では「自前の配列やオブジェクト」と「JSON 形式のデータ」を相互に変換する処理が準備されている．</p>
<p><img src="js/js02/./img/js_localstorage_json02.svg" alt="json解説02" /></p>
<h2 id="メモ帳中級編のイメージ"><a class="header" href="#メモ帳中級編のイメージ">メモ帳中級編のイメージ</a></h2>
<p>タイトルと本文をまとめて保存できるようにする！</p>
<p><img src="js/js02/./img/20210620235722.png" alt="" /></p>
<h2 id="json-の扱い方"><a class="header" href="#json-の扱い方">JSON の扱い方</a></h2>
<p>JavaScript には（他の言語でも）「配列やオブジェクトを JSON に変換する処理」と「JSON を配列やオブジェクトに戻す処理」が用意されている．</p>
<h3 id="配列やオブジェクトを-json-に変換する処理"><a class="header" href="#配列やオブジェクトを-json-に変換する処理">配列やオブジェクトを JSON に変換する処理</a></h3>
<p><code>JSON.stringify()</code>で JSON 形式に変換できる．</p>
<pre><code class="language-js">const data = {
  title: &quot;波紋の使い方&quot;,
  text: &quot;メメタァ&quot;,
};

const jsonData = JSON.stringify(data);
localStorage.setItem(&quot;memo&quot;, jsonData);
</code></pre>
<h3 id="json-を配列やオブジェクトに戻す処理"><a class="header" href="#json-を配列やオブジェクトに戻す処理">JSON を配列やオブジェクトに戻す処理</a></h3>
<p><code>JSON.parse()</code>で JSON 形式から戻すことができる．</p>
<pre><code class="language-js">const jsonData = localStorage.getItem(&quot;memo&quot;);
const data = JSON.parse(jsonData);
console.log(data);
</code></pre>
<h2 id="練習-10"><a class="header" href="#練習-10">練習</a></h2>
<p>タイトルと本文の両方を保存できるメモ帳を実装しよう．</p>
<ul>
<li>動き方はメモ帳初級編と同様</li>
<li>save ボタンクリック時に
<ul>
<li>タイトルと本文の値を取得してまとめる．</li>
<li>まとめたデータを JSON 形式に変換する．</li>
<li>JSON 形式のデータを LocalStorage に保存．</li>
</ul>
</li>
<li>clear ボタンクリック時にデータを消去</li>
<li>読み込み時に
<ul>
<li>LocalStorage から JSON 形式のデータを取得する．</li>
<li>JSON 形式のデータをオブジェクトに戻す．</li>
<li>オブジェクトからデータを取り出して画面に表示する．</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-1"><a class="header" href="#課題-1">課題</a></h1>
<p><strong>LocalStorage を使った何かを作ろう</strong></p>
<ul>
<li>タブで複数記述できるメモ帳</li>
<li>じゃんけんのスコア保存</li>
<li>ゲームのセーブ&amp;ロード機能</li>
<li>保存したデータをグラフ表示</li>
</ul>
<blockquote>
<p>大事なのは「データを保存できる」「データを読み出せる」の 2 点！</p>
<p>これを用いて何ができるか考えるのだッ！！</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_配列と繰り返し"><a class="header" href="#js_配列と繰り返し">JS_配列と繰り返し</a></h1>
<h2 id="サンプルコード-3"><a class="header" href="#サンプルコード-3">サンプルコード</a></h2>
<p><a href="js/js03/../../samples/03_js_quiz_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-3"><a class="header" href="#本講義の内容とゴール-3">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-3"><a class="header" href="#本講義の内容-3">本講義の内容</a></h3>
<ul>
<li>繰り返しと条件分岐を組み合わせた処理の実装．</li>
<li>JavaScript のデータを HTML に反映させる実装．</li>
<li>配列とオブジェクトで適当なデータを作成して扱う．</li>
</ul>
<h3 id="本講義のゴール-3"><a class="header" href="#本講義のゴール-3">本講義のゴール</a></h3>
<ul>
<li>繰り返し処理と条件分岐をマスター！</li>
<li>配列とオブジェクトの組み合わせに慣れる！</li>
<li>配列の便利な処理をうまく使おう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="配列と繰り返しの練習"><a class="header" href="#配列と繰り返しの練習">配列と繰り返しの練習</a></h1>
<p>「FizzBuzz 問題」をやってみよう！！</p>
<h2 id="fizzbuzz-とは"><a class="header" href="#fizzbuzz-とは">FizzBuzz とは</a></h2>
<p>プレイヤーは円状に座る．最初のプレイヤーは「1」と数字を発言する．次のプレイヤーは直前のプレイヤーの次の数字に 1 を足した数字を発言していく．ただし，3 の倍数の場合は「Fizz」，5 の倍数の場合は「Buzz」，3 の倍数かつ 5 の倍数の場合（すなわち 15 の倍数の場合）は「Fizz Buzz」を数の代わりに発言しなければならない．発言を間違えた者や，ためらった者は脱落となる．</p>
<p>進行例</p>
<pre><code class="language-txt">1, 2, Fizz, 4, Buzz, Fizz, 7, 8, Fizz, Buzz, 11, Fizz, 13, 14, Fizz Buzz, 16, 17, Fizz, 19, Buzz, Fizz, 22, 23, Fizz, Buzz, 26, Fizz, 28, 29, Fizz Buzz, 31, 32, Fizz, 34, Buzz, Fizz, ...

</code></pre>
<h2 id="fizzbuzz-問題"><a class="header" href="#fizzbuzz-問題">FizzBuzz 問題</a></h2>
<p>このゲーム（上記の進行例の結果）をプログラミングで表現するのが「FizzBuzz 問題」である．通常は 1 から 100 までの数字で行われる．</p>
<h2 id="早速チャレンジ"><a class="header" href="#早速チャレンジ">早速チャレンジ！！</a></h2>
<p>ブラウザの画面上に処理結果を出力しよう．</p>
<p>下記のような表示になれば OK！</p>
<pre><code class="language-txt">1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16

...以下100まで

</code></pre>
<h2 id="ng-パターン"><a class="header" href="#ng-パターン">NG パターン</a></h2>
<p>これは流石に力技すぎるので NG！！</p>
<pre><code class="language-js">console.log(1);
console.log(2);
console.log(&quot;Fizz&quot;);
console.log(4);
console.log(&quot;Buzz&quot;);
console.log(&quot;Fizz&quot;);
console.log(7);
// ...以下100まで全部console.log()を書く
</code></pre>
<h2 id="ヒントやコツ"><a class="header" href="#ヒントやコツ">ヒントやコツ</a></h2>
<p>いきなりチャレンジしても良いが，難しそうな場合は下記のステップでやってみよう！</p>
<ol>
<li>「1 から 100 の数値」を console に出力する．</li>
<li>「3 の倍数の場合」に「Fizz」を出力する．</li>
<li>「5 の倍数の場合」に「Buzz」を出力する．</li>
<li>「3 の倍数かつ 5 の倍数の場合」に「FizzBuzz」を出力する．</li>
<li>処理結果を画面に表示する処理をつくる．</li>
</ol>
<p>「条件分岐と繰り返し」ができればいける！</p>
<p>いろいろな書き方があるが，どんな書き方でも正しい結果が得られれば OK！</p>
<p>できたらコードをシェアしよう！！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="クイズアプリ初級"><a class="header" href="#クイズアプリ初級">クイズアプリ初級</a></h1>
<h2 id="quiz-アプリ初級編の仕様"><a class="header" href="#quiz-アプリ初級編の仕様">Quiz アプリ初級編の仕様</a></h2>
<ul>
<li>ブラウザ上に問題と選択肢を表示．HTML には直接記述しない．</li>
<li>選択肢をクリックしたら正解かどうかを判定．</li>
<li><code>alert()</code>で正解不正解を表示．ブラウザ上にも正解不正解を表示．</li>
</ul>
<p>↓ 画面を開くと問題が表示される．</p>
<p><img src="js/js03/./img/js_array_quiz01_question.png" alt="Quiz初級編問題表示" /></p>
<p>↓ 適当なボタンをクリックすると正解不正解が表示される．</p>
<p><img src="js/js03/./img/js_array_quiz01_result.png" alt="Quiz初級編結果表示" /></p>
<h2 id="必要な処理"><a class="header" href="#必要な処理">必要な処理</a></h2>
<h3 id="読み込み時の処理"><a class="header" href="#読み込み時の処理">読み込み時の処理</a></h3>
<ul>
<li>指定した場所に問題文を表示する．</li>
<li>各ボタンに選択肢を表示する．</li>
<li>各ボタンの<code>value</code>に選択肢の値を設定する．</li>
</ul>
<h3 id="選択肢クリック時の処理"><a class="header" href="#選択肢クリック時の処理">選択肢クリック時の処理</a></h3>
<ul>
<li>button タグの<code>value</code>の値を受け取る．</li>
<li>正解の値と等しいかどうか判定する．</li>
<li>正解不正解を表示する．</li>
</ul>
<h2 id="読み込み時の処理-1"><a class="header" href="#読み込み時の処理-1">読み込み時の処理</a></h2>
<h3 id="html-要素"><a class="header" href="#html-要素">HTML 要素</a></h3>
<p>画面の HTML 要素は以下のようになっている．</p>
<pre><code class="language-html">&lt;h1&gt;Quiz初級編&lt;/h1&gt;

&lt;p id=&quot;question&quot;&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;button id=&quot;answer00&quot;&gt;0&lt;/button&gt;&lt;/li&gt;
  &lt;li&gt;&lt;button id=&quot;answer01&quot;&gt;1&lt;/button&gt;&lt;/li&gt;
  &lt;li&gt;&lt;button id=&quot;answer02&quot;&gt;2&lt;/button&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;結果&lt;/p&gt;
&lt;p id=&quot;result&quot;&gt;&lt;/p&gt;
</code></pre>
<h3 id="javascript-の処理-1読み込み時"><a class="header" href="#javascript-の処理-1読み込み時">JavaScript の処理 1（読み込み時）</a></h3>
<ol>
<li>指定した場所に問題文を表示する．
<ul>
<li>問題文と選択肢と正解がオブジェクトにまとまっているので，必要なものを取り出して表示する．</li>
</ul>
</li>
<li>各ボタンに選択肢を表示する．
<ul>
<li>選択肢は配列に入っているので，個別に取り出して表示する．</li>
</ul>
</li>
<li>各ボタンの<code>value</code>に選択肢の値を設定する．
<ul>
<li>正解不正解の判定のために， <code>0</code>, <code>1</code>, <code>2</code> の数値を button タグの <code>value</code> に設定する．</li>
</ul>
</li>
</ol>
<pre><code class="language-js">// quiz01.html

// ↓問題文（設定済み）
const quiz = {
  question: &quot;プログラミングにおいて次の3つの中で最も重要なものはなにか．&quot;,
  answers: [&quot;知性&quot;, &quot;コード量&quot;, &quot;体格&quot;],
  correct: 1,
};

// 1. 問題文の表示
$(&quot;#question&quot;).text(quiz.question);

// 2. 選択肢の表示
$(&quot;#answer00&quot;).text(quiz.answers[0]);
$(&quot;#answer01&quot;).text(quiz.answers[1]);
$(&quot;#answer02&quot;).text(quiz.answers[2]);

// 3. `value`の設定
$(&quot;#answer00&quot;).val(0);
$(&quot;#answer01&quot;).val(1);
$(&quot;#answer02&quot;).val(2);
</code></pre>
<h3 id="javascript-の処理-2正解不正解の判定と結果表示"><a class="header" href="#javascript-の処理-2正解不正解の判定と結果表示">JavaScript の処理 2（正解不正解の判定と結果表示）</a></h3>
<ol>
<li>button タグの<code>value</code>の値を受け取る．
<ul>
<li><code>e.target.value</code>で取得できる．</li>
<li>クリックイベント時に<code>e</code>を設定しておくと，イベント発生時の様々な情報を受け取ることができる．</li>
</ul>
</li>
<li>正解の値と等しいかどうか判定する．
<ul>
<li>条件分岐で問題のオブジェクトに設定されている正解の値と比較する．</li>
<li><code>e.target.value</code>で取得すると文字列形式なので<code>Number()</code>関数で数値になおす．</li>
</ul>
</li>
<li>正解不正解を表示する．
<ul>
<li>条件分岐の結果でどちらかを表示する．</li>
</ul>
</li>
</ol>
<pre><code class="language-js">$(&quot;button&quot;).on(&quot;click&quot;, function (e) {
  // 1, 2 `value`を受け取り，条件分岐
  if (Number(e.target.value) === quiz.correct) {
    // 正解の表示
    $(&quot;#result&quot;).text(&quot;正解！！！&quot;);
  } else {
    // 不正解の表示
    $(&quot;#result&quot;).text(&quot;不正解．．．&quot;);
  }
});
</code></pre>
<blockquote>
<p><strong>💡 tips</strong></p>
<p>今回は <code>value</code> の値を設定して用いているが，選択肢のテキストを取得して比較しても実装可能．<code>indexOf()</code> などを用いると正解の数値を比較できるだろう．</p>
</blockquote>
<h2 id="練習-11"><a class="header" href="#練習-11">練習</a></h2>
<p>クイズ初級編を実装しよう！</p>
<p>できた人は <code>value</code> を使わない方法にもチャレンジ！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="クイズアプリ中級"><a class="header" href="#クイズアプリ中級">クイズアプリ中級</a></h1>
<h2 id="quiz-アプリ中級編の仕様"><a class="header" href="#quiz-アプリ中級編の仕様">Quiz アプリ中級編の仕様</a></h2>
<ul>
<li>ブラウザ上に問題と選択肢を表示．HTML には直接記述しない．</li>
<li>選択肢をクリックしたら正解かどうかを判定．</li>
<li><code>alert()</code>で正解不正解を表示．ブラウザ上にも正解不正解を表示．</li>
<li>問題数を 3 問にし，回答したら次の問題を表示．</li>
</ul>
<p>↓ 画面を開くと問題が表示される．</p>
<p><img src="js/js03/./img/js_array_quiz02_question01.png" alt="Quiz中級編問題表示" /></p>
<p>↓ 適当なボタンをクリックすると正解不正解が表示される．問題文と選択肢が次のものに切り替わる．</p>
<p><img src="js/js03/./img/js_array_quiz02_question02.png" alt="Quiz中級編結果表示" /></p>
<h2 id="必要な処理-1"><a class="header" href="#必要な処理-1">必要な処理</a></h2>
<h3 id="読み込み時の処理-2"><a class="header" href="#読み込み時の処理-2">読み込み時の処理</a></h3>
<ul>
<li>結果を記録する配列を準備する．</li>
<li>指定した場所に問題文を表示する．</li>
<li>各ボタンに選択肢を表示する．</li>
<li>各ボタンの<code>value</code>に選択肢の値を設定する．</li>
</ul>
<h3 id="選択肢クリック時の処理-1"><a class="header" href="#選択肢クリック時の処理-1">選択肢クリック時の処理</a></h3>
<ul>
<li>button タグの<code>value</code>の値を受け取る．</li>
<li>正解の値と等しいかどうか判定する．</li>
<li>正解不正解を表示する．</li>
<li>正解不正解の結果を配列に追加する．</li>
<li>次の問題文と選択肢を表示する．</li>
</ul>
<h2 id="読み込み時の処理-3"><a class="header" href="#読み込み時の処理-3">読み込み時の処理</a></h2>
<h3 id="html-要素-1"><a class="header" href="#html-要素-1">HTML 要素</a></h3>
<p>画面の HTML 要素は以下のようになっている．</p>
<pre><code class="language-html">&lt;h1&gt;Quiz中級編&lt;/h1&gt;

&lt;p&gt;第 n 問&lt;/p&gt;

&lt;p id=&quot;question&quot;&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;button id=&quot;answer00&quot;&gt;0&lt;/button&gt;&lt;/li&gt;
  &lt;li&gt;&lt;button id=&quot;answer01&quot;&gt;1&lt;/button&gt;&lt;/li&gt;
  &lt;li&gt;&lt;button id=&quot;answer02&quot;&gt;2&lt;/button&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;結果&lt;/p&gt;
&lt;p id=&quot;result&quot;&gt;&lt;/p&gt;
</code></pre>
<h3 id="javascript-の処理-1読み込み時-1"><a class="header" href="#javascript-の処理-1読み込み時-1">JavaScript の処理 1（読み込み時）</a></h3>
<ol>
<li>結果を記録する配列を準備する．
<ul>
<li>空の配列を用意すれば OK．</li>
</ul>
</li>
<li>指定した場所に問題文を表示する．
<ul>
<li>処理自体は初級編と同様．</li>
<li>問題が複数あるため，配列形式となっている点に注意．</li>
<li>結果記録用配列の <code>length</code> を用いることで何問目なのかを指定することができる．</li>
</ul>
</li>
<li>各ボタンに選択肢を表示する．
<ul>
<li>こちらも初級編と同様．</li>
<li>何問目なのかの指定は問題文と同様．</li>
</ul>
</li>
<li>各ボタンの<code>value</code>に選択肢の値を設定する．
<ul>
<li>初級編と同様．</li>
</ul>
</li>
</ol>
<pre><code class="language-js">// quiz01.html

// ↓問題文（設定済み）
const quiz = [
  {
    question: &quot;プログラミングにおいて次の3つの中で最も重要なもの？？&quot;,
    answers: [&quot;知性&quot;, &quot;コード量&quot;, &quot;体格&quot;],
    correct: 1,
  },
  {
    question: &quot;課題をつくるときに大事なことは？？&quot;,
    answers: [&quot;斬新なアイデア&quot;, &quot;コミットする時間&quot;, &quot;洗練されたコード&quot;],
    correct: 1,
  },
  {
    question: &quot;コードを書くことに疲れたときはどうするのがよいか．&quot;,
    answers: [&quot;温泉に浸かる&quot;, &quot;ビールを飲む&quot;, &quot;更にコードを書く&quot;],
    correct: 2,
  },
];

// 1. 結果記録用の配列を用意
const result = [];

// 2. 問題文の表示
$(&quot;#question&quot;).text(quiz[result.length].question);

// 3. 選択肢の表示
$(&quot;#question&quot;).text(quiz[result.length].question);
$(&quot;#answer00&quot;).text(quiz[result.length].answers[0]);
$(&quot;#answer01&quot;).text(quiz[result.length].answers[1]);
$(&quot;#answer02&quot;).text(quiz[result.length].answers[2]);

// 4. `value`の設定
$(&quot;#answer00&quot;).val(0);
$(&quot;#answer01&quot;).val(1);
$(&quot;#answer02&quot;).val(2);
</code></pre>
<h3 id="javascript-の処理-2正解不正解の判定と結果表示-1"><a class="header" href="#javascript-の処理-2正解不正解の判定と結果表示-1">JavaScript の処理 2（正解不正解の判定と結果表示）</a></h3>
<ol>
<li>button タグの<code>value</code>の値を受け取る．
<ul>
<li>初級編と同様．</li>
</ul>
</li>
<li>正解の値と等しいかどうか判定する．
<ul>
<li>初級編と同様．</li>
</ul>
</li>
<li>正解不正解を表示する．
<ul>
<li>初級編と同様．</li>
</ul>
</li>
<li>正解不正解の結果を配列に追加する．
<ul>
<li><code>push()</code>で配列に値を追加することができる．</li>
</ul>
</li>
<li>次の問題文と選択肢を表示する．
<ul>
<li>結果記録用配列の <code>length</code> を使えッ！</li>
</ul>
</li>
</ol>
<pre><code class="language-js">$(&quot;button&quot;).on(&quot;click&quot;, function (e) {
  if (Number(e.target.value) === quiz[result.length].correct) {
    $(&quot;#result&quot;).text(&quot;正解！！！&quot;);
    // 結果を配列に追加
    result.push(&quot;ok&quot;);
  } else {
    $(&quot;#result&quot;).text(&quot;不正解．．．&quot;);
    // 結果を配列に追加
    result.push(&quot;ng&quot;);
  }
  // 問題文と選択肢を更新
  $(&quot;#question&quot;).text(quiz[result.length].question);
  $(&quot;#answer00&quot;).text(quiz[result.length].answers[0]);
  $(&quot;#answer01&quot;).text(quiz[result.length].answers[1]);
  $(&quot;#answer02&quot;).text(quiz[result.length].answers[2]);
});
</code></pre>
<h2 id="練習-12"><a class="header" href="#練習-12">練習</a></h2>
<p>クイズ中級編を実装しよう！</p>
<p>できた人は下記にもチャレンジ！</p>
<ul>
<li>画面上の「第 n 問」に何問目かの数値を表示する．</li>
<li>3 問目終了時に終了の判定を行う．</li>
<li>問題を 6 問まで追加する．</li>
<li>終了時に正解数を表示する．</li>
<li>終了時に正答率を表示する．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-2"><a class="header" href="#課題-2">課題</a></h1>
<p><strong>配列やオブジェクトを使った何かを作ろう</strong></p>
<h3 id="クイズネタ"><a class="header" href="#クイズネタ">クイズネタ</a></h3>
<ul>
<li>画像や映像を絡めたクイズ．</li>
<li>正解率をグラフで表示．</li>
<li>ランキング機能．</li>
<li>選択肢が問題によって変化する．</li>
<li>問題を自分で追加できる機能．</li>
</ul>
<h3 id="その他"><a class="header" href="#その他">その他</a></h3>
<ul>
<li>お買い物リスト．</li>
<li>性格診断．</li>
<li>連打ゲーム</li>
<li>タイピングゲーム．</li>
</ul>
<blockquote>
<p>データの構造を考えよう！</p>
<p>複数のデータを活用できるようになりたいッ！！</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_firebase"><a class="header" href="#js_firebase">JS_Firebase</a></h1>
<h2 id="サンプルコード-4"><a class="header" href="#サンプルコード-4">サンプルコード</a></h2>
<p><a href="js/js04/../../samples/04_js_chat_sample.zip">download</a></p>
<h2 id="事前準備-1"><a class="header" href="#事前準備-1">事前準備</a></h2>
<p>今回は Google のアカウントを使用します！</p>
<p>無料で取得できますので，事前に作成しておいてください！</p>
<ul>
<li>すでにお持ちの方は既存のアカウントで OK です！</li>
</ul>
<h2 id="本講義の内容とゴール-4"><a class="header" href="#本講義の内容とゴール-4">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-4"><a class="header" href="#本講義の内容-4">本講義の内容</a></h3>
<ul>
<li>関数を定義し，動かす一連の動作を実装する．</li>
<li>オンライン上のデータベースにデータを保存する．</li>
<li>オンライン上のデータを取得し，画面上にリアルタイムに表示する．</li>
</ul>
<h3 id="本講義のゴール-4"><a class="header" href="#本講義のゴール-4">本講義のゴール</a></h3>
<ul>
<li>関数を使って処理を実装できるようになる！</li>
<li>オンライン&amp;リアルタイムでデータ共有する！</li>
<li>複雑なデータを扱う場合にどう考えるかを把握する！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="関数"><a class="header" href="#関数">関数</a></h1>
<h2 id="関数functionとは"><a class="header" href="#関数functionとは">関数（function）とは</a></h2>
<ul>
<li>関数とは記述した処理をまとめて名前をつけて使い回せるようにしたもの．</li>
<li>一度処理を定義してしまえば，呼び出すだけで実行可能！</li>
</ul>
<h3 id="例-3"><a class="header" href="#例-3">例</a></h3>
<ul>
<li>関数には「定義」と「実行」が必要．</li>
<li>関数には必ず名前をつける．</li>
<li><code>{}</code>内に実行してほしい処理を記述する．</li>
<li>「実行」したいときは名前を呼び出す．</li>
</ul>
<pre><code class="language-js">// 関数の定義
function test(){
  console.log('関数は便利！');
}

// 関数の実行
test();

</code></pre>
<h2 id="引数と戻り値"><a class="header" href="#引数と戻り値">引数と戻り値</a></h2>
<p>関数は「なにかを入力して」「処理した結果を出力する」動きが基本となる．</p>
<h3 id="引数"><a class="header" href="#引数">引数</a></h3>
<p>引数とは「関数に入力する値」である．</p>
<ul>
<li>定義した関数に対して，処理に必要な値を入力する．</li>
<li>引数の数は一つでも複数でもOK！</li>
</ul>
<h3 id="戻り値"><a class="header" href="#戻り値">戻り値</a></h3>
<p>戻り値とは「関数から出力されてくる値」である．</p>
<ul>
<li>関数の中で計算などを実行した後，結果を返す処理．</li>
<li>関数内の変数，配列，オブジェクトなどで返せる．</li>
</ul>
<h3 id="例-4"><a class="header" href="#例-4">例</a></h3>
<p><code>a</code>と<code>b</code>の2つの数を入力し，「加算した結果」を出力する関数を考える．</p>
<p>この場合，<code>a</code>と<code>b</code>が「引数」で<code>total</code>が戻り値となる．</p>
<pre><code class="language-js">// 関数の定義
function add(a, b){
  const total = a + b;
  return total;
}

// 関数の実行
const sum = add(10, 20);
console.log(sum);   // 30

</code></pre>
<h2 id="数学の関数と同じ"><a class="header" href="#数学の関数と同じ">数学の関数と同じ</a></h2>
<p>プログラミングの関数は理解が難しいものの一つであるが，数学の関数と同じイメージを持つと理解しやすい．</p>
<h3 id="数学の関数"><a class="header" href="#数学の関数">数学の関数</a></h3>
<p>数学の関数は「何かの数値を入力」すると「決まった計算を実行した結果を出力」するものである．</p>
<p>例えば，<code>f(x) = x^2 + 2x + 1</code>と関数を定義すると．．．</p>
<ul>
<li><code>f(2) = 9</code>,</li>
<li><code>f(5) = 36</code>,</li>
<li><code>f(10) = 121</code></li>
</ul>
<p>となる．この場合，入力値・関数・出力値をまとめると以下のようになる．</p>
<table><thead><tr><th>入力値</th><th>関数</th><th>出力値</th></tr></thead><tbody>
<tr><td>2</td><td><code>f(x) = x^2 + 2x + 1</code></td><td>9</td></tr>
<tr><td>5</td><td><code>f(x) = x^2 + 2x + 1</code></td><td>36</td></tr>
<tr><td>10</td><td><code>f(x) = x^2 + 2x + 1</code></td><td>121</td></tr>
</tbody></table>
<h3 id="プログラミングの関数"><a class="header" href="#プログラミングの関数">プログラミングの関数</a></h3>
<p>上記の例をJavaScriptで書くと以下のようになる．</p>
<pre><code class="language-js">function calculate(x) {
  const result = x * x + 2 * x + 1;
  return result;
}

calculate(2);   // 9
calculate(5);   // 36
calculate(10);    // 121

</code></pre>
<p>この場合も「記述の仕方が異なるだけでやっていることは同じ」である．</p>
<table><thead><tr><th>入力値</th><th>関数</th><th>出力値</th></tr></thead><tbody>
<tr><td>2</td><td><code>calculate(x)</code></td><td>9</td></tr>
<tr><td>5</td><td><code>calculate(x)</code></td><td>36</td></tr>
<tr><td>10</td><td><code>calculate(x)</code></td><td>121</td></tr>
</tbody></table>
<h3 id="-key-point-11"><a class="header" href="#-key-point-11">💡 Key Point</a></h3>
<blockquote>
<p>引数と戻り値がない場合もある（ややこしいポイント）</p>
</blockquote>
<h2 id="言語にはじめから用意されている関数"><a class="header" href="#言語にはじめから用意されている関数">言語にはじめから用意されている関数</a></h2>
<p>これまでに使用した乱数関連も関数であるが，これらはJavaScriptがはじめから用意している関数である．</p>
<p>このような関数を「ビルドイン関数」と呼ぶ．</p>
<p>対して，開発者が自ら定義した関数を「ユーザ定義関数」と呼ぶ．</p>
<table><thead><tr><th align="right">引数</th><th>関数</th><th align="right">戻り値</th></tr></thead><tbody>
<tr><td align="right">なし</td><td><code>Math.random();</code></td><td align="right">0.534714863872</td></tr>
<tr><td align="right">3.1415926535</td><td><code>Math.floor(3.1415926535);</code></td><td align="right">3</td></tr>
</tbody></table>
<pre><code class="language-js">Math.random();    // 0.534714863872
  // 引数： なし
  // 戻り値： 0.534714863872

Math.floor(3.1415926535);   // 3
  // 引数： 3.1415926535
  // 戻り値： 3

</code></pre>
<h2 id="参考関数の記述方法"><a class="header" href="#参考関数の記述方法">【参考】関数の記述方法</a></h2>
<p>JavaScriptにおける関数の定義は以下の3種類を用いることができる．どの方法で記述しても実行方法は同じ．</p>
<p>（現段階では）どれでも同様と考えてOK．</p>
<pre><code class="language-js">function add1(a, b){
  return a + b;
}

const add2 = function(a, b){
  return a + b;
}

const add3 = (a, b) =&gt; {
  return a + b;
}

// 全部同じという理解でOK！
const result1 = add1(10, 20);
const result2 = add2(10, 20);
const result3 = add3(10, 20);

</code></pre>
<h2 id="関数の利用"><a class="header" href="#関数の利用">関数の利用</a></h2>
<h3 id="関数の利点"><a class="header" href="#関数の利点">関数の利点</a></h3>
<p>イベントごとに毎回同じ処理を書くのは面倒！</p>
<p>関数を定義しておけば，ボタン押したら実行するだけ！</p>
<h3 id="例-5"><a class="header" href="#例-5">例</a></h3>
<p>押したボタンに応じて，異なる範囲の乱数を発生させたい！</p>
<pre><code class="language-js">// 関数の定義
function generateRandomNumber(min, max){
  const rand = Math.floor(Math.random() * (max - min + 1) + min);
  return rand;
}

// 実行するときはこんな感じ
const result = generateRandomNumber(1, 9);
console.log(result);

</code></pre>
<h3 id="ボタンクリックイベントと組み合わせ"><a class="header" href="#ボタンクリックイベントと組み合わせ">ボタンクリックイベントと組み合わせ</a></h3>
<p>ボタンによって異なる範囲の乱数を発生させることもできる．</p>
<pre><code class="language-js">$('#btn01').on('click', function () {
 const result = generateRandomNumber(1, 10);
  $('#echo').text(result);
});

$('#btn02').on('click', function () {
 const result = generateRandomNumber(10, 20);
  $('#echo').text(result);
});

$('#btn03').on('click', function () {
 const result = generateRandomNumber(20, 100);
  $('#echo').text(result);
});

</code></pre>
<p>【参考】janken.htmlに関数を使用したじゃんけんの例もあります！</p>
<h2 id="練習-13"><a class="header" href="#練習-13">練習</a></h2>
<ul>
<li>最小値と最大値を入力してランダムな数を返す関数を定義しよう！</li>
<li>各ボタンのクリック時に関数を実行し，結果を<code>#echo</code>に出力しよう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="リアルタイムチャットの実装"><a class="header" href="#リアルタイムチャットの実装">リアルタイムチャットの実装</a></h1>
<h2 id="今回実装するアプリケーション"><a class="header" href="#今回実装するアプリケーション">今回実装するアプリケーション</a></h2>
<p>LocalStorage を利用したメモ帳アプリケーションでは，データを「ブラウザ」自体に保存する処理を実装した．</p>
<p>今回は更に発展させ，オンライン上にデータを保存する処理を実装し，リアルタイムに表示が更新されるチャットアプリケーションを実装する．</p>
<p><img src="js/js04/./img/js_firebase_about_chat_app.svg" alt="チャットアプリケーションのイメージ" /></p>
<p>このような動きを実装するために，Google が提供する「Firebase」を活用する．</p>
<h2 id="firebasecloud-firestoreとは"><a class="header" href="#firebasecloud-firestoreとは">Firebase（Cloud Firestore）とは</a></h2>
<p>Firebase は、クライアントからアクセス可能なデータベースとして Firebase Realtime Database( 以下 Realtime Database)と Cloud Firestore の 2 つを用意しています．</p>
<p>Realtime Database は，リアルタイムでクライアント全体の状態を同期させる必要があるモバイルアプリ向けの効率的で低レイテンシなものです．</p>
<p>Realtime Database はクラウド上でホスティングされる NoSQL のデータベースです．データはすべてのクライアントにわたってリアルタイムに同期され、アプリがオフラインになっても利用可能です．クロスプラットフォームアプリを構築した場合でも，すべてのクライアン トが 1 つの Realtime Database を共有して，最新のデータへの更新を自動的に行います．またクライアントからも直接アクセスが可能なため自前のサーバなしで使えるデータベースとしても活用できます．</p>
<p>Cloud Firestore は，直感的な新しいデータモデルで，Realtime Database の性能をさらに向上しており，Realtime Database よりも豊かで高速なクエリとスケールを備えています．Cloud Firestore は 2017 年の Google I/O で発表されたプロダクトであり，2018 年 5 月現在はベータ版リリースです．</p>
<p>引用：WEB+DB PRESS vol.105 第 4 章（※2019 年 2 月より正式版として運用されています．）</p>
<h2 id="つまり"><a class="header" href="#つまり">つまり．．？</a></h2>
<ul>
<li>サーバ上にデータを保存できる！</li>
<li>保存したデータをリアルタイムに同期できる！</li>
<li>異なるデバイスでもデータを共有可能！
<ul>
<li>PC とスマホでリアルタイムにデータを同期できる．</li>
</ul>
</li>
<li>JavaScript のみで実装可能！
<ul>
<li>Swift, Go, Python など他の言語でも使用可！</li>
</ul>
</li>
</ul>
<table><thead><tr><th></th><th>データの保存場所</th><th>データを使用できる範囲</th></tr></thead><tbody>
<tr><td>LocalStorage</td><td>ブラウザ</td><td>自分の PC（ブラウザ）</td></tr>
<tr><td>Firebase</td><td>オンライン上のサーバ</td><td>同じアプリケーションを動かしている端末全て</td></tr>
</tbody></table>
<p>Firebase を活用するにはアカウントやプロジェクトの準備が必要になるため，次項から進める．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="firebase-の準備-1プロジェクトの作成"><a class="header" href="#firebase-の準備-1プロジェクトの作成">Firebase の準備 1（プロジェクトの作成）</a></h1>
<p>まずは Firebase の「プロジェクト」を作成する．</p>
<p>Firebase では「プロジェクト」単位で管理を行う．</p>
<h2 id="管理画面へのアクセス"><a class="header" href="#管理画面へのアクセス">管理画面へのアクセス</a></h2>
<p>下記 URL にアクセスしよう．</p>
<p><a href="https://firebase.google.com/">https://firebase.google.com/</a></p>
<ul>
<li>アクセスしたら右上の「ログイン」からログインする．</li>
<li>すでにログイン済みの場合は「コンソールへ移動」をクリックする．</li>
</ul>
<h2 id="プロジェクトの作成"><a class="header" href="#プロジェクトの作成">プロジェクトの作成</a></h2>
<p>下記画面から「プロジェクトの作成」をクリックする．</p>
<p><img src="js/js04/./img/20210616120245.png" alt="Firebaseプロジェクト作成" /></p>
<p>プロジェクトの名前を入力する．何のアプリケーションなのかわかるように名前をつけると良い．</p>
<p>同意するに ✅ を入れて「続行」をクリックする．</p>
<p><img src="js/js04/./img/20210616120512.png" alt="Firebaseプロジェクト情報入力1" /></p>
<p>アナリティクスは使用しないので外す．外さないとエラーが出ることがあるので外すこと．</p>
<p><img src="js/js04/./img/20210616120730.png" alt="アナリティクス外す" /></p>
<p>「プロジェクトを作成」をクリックして少し待つとプロジェクトが作成される．「続行」をクリックすると画面が切り替わる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="firebase-の準備-2ソースコードの準備"><a class="header" href="#firebase-の準備-2ソースコードの準備">Firebase の準備 2（ソースコードの準備）</a></h1>
<h2 id="プロジェクトと-javascript-の連携"><a class="header" href="#プロジェクトと-javascript-の連携">プロジェクトと JavaScript の連携</a></h2>
<p>画面の下記部分をクリックする．</p>
<p><img src="js/js04/./img/20210616122043.png" alt="Webアプリ追加" /></p>
<p>ニックネームを入力するよう促されるので適当に入力する（プロジェクト名と同じが良い？）．</p>
<p>「Firebase Hosting」の ✅ は入れないこと．「アプリを登録」をクリックすると次の画面に切り替わる．</p>
<p><img src="js/js04/./img/20210616122207.png" alt="ニックネーム設定" /></p>
<p>コードが表示されるので全てコピーする．</p>
<p><img src="js/js04/./img/20210921105725.png" alt="コードコピー" /></p>
<p><code>chatapp.html</code>にコピーしたコードを貼り付ける．このコードが Firebase のプロジェクトとソースコードでやり取りをするために必要になる．</p>
<p>エディタ上で下記のような状態になっていれば OK（コメントは省略）！</p>
<pre><code class="language-html">&lt;!-- chatapp.html --&gt;

&lt;!-- ここにFirebaseのコードを貼り付けよう --&gt;
&lt;script type=&quot;module&quot;&gt;
  import { initializeApp } from &quot;https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js&quot;;

  const firebaseConfig = {
    apiKey: &quot;AIzaSyAfiXSG63mRJrfnWb2pSHH-tCUtPptP-Qw&quot;,
    authDomain: &quot;test-466a4.firebaseapp.com&quot;,
    projectId: &quot;test-466a4&quot;,
    storageBucket: &quot;test-466a4.appspot.com&quot;,
    messagingSenderId: &quot;1012034593201&quot;,
    appId: &quot;1:1012034593201:web:9d9dbbd31cf63275761d90&quot;,
  };

  const app = initializeApp(firebaseConfig);
&lt;/script&gt;
</code></pre>
<p>コードを貼り付けたらブラウザ画面の「コンソールに進む」ボタンをクリックする．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="firebase-の準備-3データベースの準備"><a class="header" href="#firebase-の準備-3データベースの準備">Firebase の準備 3（データベースの準備）</a></h1>
<h2 id="データベースの準備"><a class="header" href="#データベースの準備">データベースの準備</a></h2>
<p>データを実際に保存するためのデータベースを準備する．</p>
<p>コンソール画面から「構築」 -&gt; 「Firestore Database」 -&gt; 「データベースを作成」の順にクリック．</p>
<p><img src="js/js04/./img/20210616123536.png" alt="db準備" /></p>
<p>ルールは必ず「テストモードで開始」を選択して「次へ」をクリック．</p>
<p><img src="js/js04/./img/20210616123750.png" alt="dbルール設定" /></p>
<p>ロケーションは適当で OK．「有効にする」をクリックすると次の画面に移動する．</p>
<p><img src="js/js04/./img/20210616123858.png" alt="dbロケーション設定" /></p>
<h2 id="コレクションの作成"><a class="header" href="#コレクションの作成">コレクションの作成</a></h2>
<p>データを保存する際には「コレクション」と「ドキュメント」という単位で管理する．</p>
<p>これらは「フォルダ」と「ファイル」の関係によく似ている．</p>
<p><a href="https://firebase.google.com/docs/firestore/data-model?hl=ja">参考（ドキュメント）</a></p>
<table><thead><tr><th></th><th>データの容器</th><th>データの単位</th></tr></thead><tbody>
<tr><td>PC</td><td>フォルダ</td><td>ファイル</td></tr>
<tr><td>Firestore</td><td>コレクション</td><td>ドキュメント</td></tr>
</tbody></table>
<p>Firestore の機能を利用するには「コレクション」を作成してテストデータを入力しておく．下記画面の「コレクションを開始」をクリックする．</p>
<p><img src="js/js04/./img/20210616124349.png" alt="コレクション開始" /></p>
<p>コレクション ID に「<code>chat</code>」を入力し「次へ」をクリックする．</p>
<p><img src="js/js04/./img/20210616124917.png" alt="コレクション作成" /></p>
<p>テスト用のドキュメントを作成する．ドキュメントの構成はメッセージを送信したユーザ名の<code>name</code>，メッセージの本文である<code>text</code>，送信日時を表す<code>time</code>の 3 項目とする．</p>
<p>下記の手順でドキュメントを作成しよう．</p>
<ul>
<li>ドキュメント ID は「自動 ID」をクリック．</li>
<li>フィールドには「<code>name</code>」「<code>text</code>」「<code>time</code>」の 3 項目を設定．</li>
<li><code>name</code>と<code>text</code>には<code>String</code>，<code>time</code>には<code>timestamp</code>形式を選択する．</li>
<li>各フィールドには適当な値を入力しておく．</li>
</ul>
<p>設定したら「保存」をクリックする．</p>
<p><img src="js/js04/./img/20210616125231.png" alt="ドキュメント作成" /></p>
<p>下記のようにデータが保存されていればデータベースの準備は完了！</p>
<p><img src="js/js04/./img/20210616125644.png" alt="データ確認" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="チャット画面の実装とデータの送信"><a class="header" href="#チャット画面の実装とデータの送信">チャット画面の実装とデータの送信</a></h1>
<h2 id="チャット画面の実装"><a class="header" href="#チャット画面の実装">チャット画面の実装</a></h2>
<p>name と text の入力欄を作成する．</p>
<p>送信時に id を指定して入力した値を取得するため，<code>&lt;input&gt;</code>タグの 2 箇所と<code>&lt;button&gt;</code>に id を指定する．</p>
<pre><code class="language-html">&lt;!-- chatapp.html --&gt;

&lt;form&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;チャット入力画面&lt;/legend&gt;
    &lt;div&gt;name: &lt;input type=&quot;text&quot; id=&quot;name&quot; /&gt;&lt;/div&gt;
    &lt;div&gt;text: &lt;input type=&quot;text&quot; id=&quot;text&quot; /&gt;&lt;/div&gt;
    &lt;div&gt;
      &lt;button type=&quot;button&quot; id=&quot;send&quot;&gt;send&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;
</code></pre>
<p>下図のような画面となる．</p>
<p><img src="js/js04/./img/20210616144514.png" alt="チャット入力画面" /></p>
<h2 id="データ送信の処理"><a class="header" href="#データ送信の処理">データ送信の処理</a></h2>
<p>続いて，上記の入力画面で name と text を入力して送信ボタンをクリックしたタイミングで Firestore 上に新しいデータを作成する処理を実装する．</p>
<h3 id="リアルタイム通信の準備"><a class="header" href="#リアルタイム通信の準備">リアルタイム通信の準備</a></h3>
<p>前項で作成したコレクションとやり取りをするため，下記のコードを追記する．</p>
<h3 id="-key-point-12"><a class="header" href="#-key-point-12">💡 Key Point</a></h3>
<blockquote>
<p>このコードでは接続情報を<code>db</code>に保存する．この 1 行を書いておくことで<code>db</code>に対してデータの追加や取得ができるようになる．</p>
</blockquote>
<pre><code class="language-js">// chatapp.html

import { initializeApp } from &quot;https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js&quot;;

// 🔽 追加
import {
  getFirestore,
  collection,
  addDoc,
  serverTimestamp,
} from &quot;https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js&quot;;

const firebaseConfig = {
  // 省略
};

const app = initializeApp(firebaseConfig);

// 🔽 追加
const db = getFirestore(app);
</code></pre>
<h3 id="送信ボタンクリック時にデータを送信"><a class="header" href="#送信ボタンクリック時にデータを送信">送信ボタンクリック時にデータを送信</a></h3>
<p>続いて，送信ボタンクリック時にデータを送信する処理を実装する．</p>
<p>まずはボタンのクリックイベントを作成．</p>
<pre><code class="language-js">// chatapp.html

$(&quot;#send&quot;).on(&quot;click&quot;, function () {
  // 送信時に必要な処理
});
</code></pre>
<p>続いてクリックイベント内に「入力値を取得する処理」と「データを送信する処理」を記述する．</p>
<p>ポイントは，</p>
<ul>
<li>id 指定して<code>.val()</code>で入力値を取得する．</li>
<li>データを送信する際にはオブジェクト形式にする必要がある．</li>
<li><code>time</code>は Firestore の独自形式となるため，Firestore 側で用意されている関数を使用する．</li>
</ul>
<pre><code class="language-js">// chatapp.html

const data = {
  name: $(&quot;#name&quot;).val(),
  text: $(&quot;#text&quot;).val(),
  time: serverTimestamp(),
};
addDoc(data);
$(&quot;#text&quot;).val(&quot;&quot;);
</code></pre>
<h2 id="動作確認-1"><a class="header" href="#動作確認-1">動作確認</a></h2>
<p>コードを記述したらブラウザの画面から<code>name</code>と<code>text</code>を入力して．．．</p>
<p><img src="js/js04/./img/20210616145454.png" alt="動作確認（ブラウザ）" /></p>
<p>Firebase のコンソール画面でデータが保存されていれば OK！</p>
<p><img src="js/js04/./img/20210616145647.png" alt="動作確認（コンソール）" /></p>
<h2 id="練習-14"><a class="header" href="#練習-14">練習</a></h2>
<p>下記の処理を実装し，Firestore にデータを保存しよう！</p>
<ol>
<li>入力画面の作成</li>
<li>データの送信処理</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="データのリアルタイム取得と画面表示"><a class="header" href="#データのリアルタイム取得と画面表示">データのリアルタイム取得と画面表示</a></h1>
<h2 id="保存されているデータの扱い"><a class="header" href="#保存されているデータの扱い">保存されているデータの扱い</a></h2>
<p>Firestore ではデータの取得方法はいくつか用意されているが，最大の特徴は「データベースの変更を検知して自動的にデータを取得できる」ことである．</p>
<p>（本来はサーバ側の言語での実装が必要であり，難易度も高い．WebSocket などの実装が必要）</p>
<h2 id="処理の流れ"><a class="header" href="#処理の流れ">処理の流れ</a></h2>
<p>流れは送信と比較して複雑となる．理由は以下のとおり．</p>
<ul>
<li>動作のタイミングがつかみにくい．</li>
<li>取得したデータが非常に複雑な状態．</li>
<li>必要な 3 項目を取得するために Firestore 側で用意された関数を使用する必要がある．</li>
</ul>
<h2 id="データの取得"><a class="header" href="#データの取得">データの取得</a></h2>
<p>まずは Firestore 上に保存されているデータを取得して console に出力する．</p>
<ul>
<li>データに変更（追加，更新，削除など）が生じたタイミングで実行される<code>onSnapshot()</code>を使用する．</li>
<li><code>onSnapshot()</code>はデータベース上でデータの変更が発生したタイミングで<code>{}</code>内の処理を実行する．</li>
<li>Firestore 上に保存されているデータは<code>querySnapshot.docs</code>に入っている．</li>
</ul>
<pre><code class="language-js">// chatapp.html

// 🔽 `onSnapshot`を追記
import {
  getFirestore,
  collection,
  addDoc,
  serverTimestamp,
  onSnapshot,
} from &quot;https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js&quot;;

// 省略

// データ取得処理
onSnapshot(collection(db, &quot;chat&quot;), (querySnapshot) =&gt; {
  console.log(querySnapshot.docs);
});
</code></pre>
<h2 id="データの取り出し"><a class="header" href="#データの取り出し">データの取り出し</a></h2>
<p>上記<code>querySnapshot.docs</code>は非常に複雑な形となっており，このまま扱うことは難しい．</p>
<p>そのため，必要なデータのみ抽出した「オブジェクト形式の配列」に変換する．</p>
<ol>
<li>空の配列を準備．</li>
<li><code>querySnapshot.docs</code>に対して繰り返し処理を用いて各要素に対して，
<ul>
<li><code>.id</code>でドキュメント ID（名前）を取得する．</li>
<li><code>.data()</code>でドキュメント中身（3 項目）を取得する．</li>
</ul>
</li>
<li>上記のデータのみを 1 で用意した配列に追加．</li>
</ol>
<pre><code class="language-js">// chatapp.html
// 前項の`console.log()`下に記述

const dataArray = [];
querySnapshot.docs.forEach(function (doc) {
  const data = {
    id: doc.id,
    data: doc.data(),
  };
  dataArray.push(data);
});

console.log(dataArray);
</code></pre>
<h3 id="-key-point-13"><a class="header" href="#-key-point-13">💡 Key Point</a></h3>
<blockquote>
<p>難しい形式のデータは変換して「自分が慣れている形式」に変換すると扱いやすい．</p>
</blockquote>
<h2 id="画面表示するためのタグ生成"><a class="header" href="#画面表示するためのタグ生成">画面表示するためのタグ生成</a></h2>
<p>必要な情報のみを抽出した配列が作成できたため，この配列から画面表示用のタグを作成する．</p>
<p>前項で作成した<code>dataArray</code>を基にして，</p>
<ol>
<li>空の配列を準備する．</li>
<li><code>dataArray</code>に繰り返しを用い，各要素をタグの形にする．</li>
<li>繰り返し処理終了後に指定した id 部分に出力する．</li>
</ol>
<pre><code class="language-js">// chatapp.html
// 前項の`console.log()`下に記述

const tagArray = [];
dataArray.forEach(function (data) {
  tagArray.push(`
    &lt;li id=&quot;${data.id}&quot;&gt;
      &lt;p&gt;${data.data.name} at ${data.data.time}&lt;/p&gt;
      &lt;p&gt;${data.data.text}&lt;/p&gt;
    &lt;/li&gt;
  `);
});

$(&quot;#output&quot;).html(tagArray);
</code></pre>
<h2 id="動作確認-2"><a class="header" href="#動作確認-2">動作確認</a></h2>
<p>上記のコードを記述すると「Firestore 上でデータが変更されたタイミング」で<code>{}</code>内の処理が実行され，最新のデータが画面に反映される．</p>
<p><img src="js/js04/./img/20210616152526.png" alt="データ取得" /></p>
<p>また，「Firestore 上でデータが変更されたタイミング」で動作するため，複数タブで片方だけ操作した状態でもう片方の動作を確認することができる．</p>
<h2 id="練習-15"><a class="header" href="#練習-15">練習</a></h2>
<p>下記の順番でデータの表示を実装しよう．</p>
<ol>
<li>データ本体を取得．</li>
<li>データから必要なものだけを抽出．</li>
<li>抽出したデータからタグを作成．</li>
<li>タグを画面に表示．</li>
</ol>
<p>入力フォームからデータを送信し，一覧に追加されれば OK．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="機能追加"><a class="header" href="#機能追加">機能追加</a></h1>
<p>データの取得と表示（データ送信と同時に画面更新）は実装ができたが，下記の問題点がある．</p>
<ul>
<li>時刻がわかりにくい．</li>
<li>最新がどれなのかわかりにくい．</li>
</ul>
<p>これらを解決するために以下の処理を実装していく．</p>
<h2 id="時刻データの表示形式変更"><a class="header" href="#時刻データの表示形式変更">時刻データの表示形式変更</a></h2>
<p>JavaScript において時刻処理は非常に煩雑である．時刻関連の処理を実装するためにはライブラリを使用したほうが実装の負荷が少なくバグも少ない．</p>
<h3 id="時刻変換関数"><a class="header" href="#時刻変換関数">時刻変換関数</a></h3>
<p>今回はサンプルコード内に時刻の形式を変換する関数（下記）を記述しておいたため，これを利用する．解説は省略．</p>
<pre><code class="language-js">// chatapp.html内に記述してある関数

function convertTimestampToDatetime(timestamp) {
  const _d = timestamp ? new Date(timestamp * 1000) : new Date();
  const Y = _d.getFullYear();
  const m = (_d.getMonth() + 1).toString().padStart(2, &quot;0&quot;);
  const d = _d.getDate().toString().padStart(2, &quot;0&quot;);
  const H = _d.getHours().toString().padStart(2, &quot;0&quot;);
  const i = _d.getMinutes().toString().padStart(2, &quot;0&quot;);
  const s = _d.getSeconds().toString().padStart(2, &quot;0&quot;);
  return `${Y}/${m}/${d} ${H}:${i}:${s}`;
}
</code></pre>
<h3 id="関数を利用"><a class="header" href="#関数を利用">関数を利用</a></h3>
<p>本関数を利用して，タグ生成部分の処理で時刻形式を変換する．</p>
<pre><code class="language-js">// chatapp.html

const tagArray = [];
dataArray.forEach(function (data) {
  tagArray.push(`
    &lt;li id=&quot;${data.id}&quot;&gt;
      &lt;p&gt;${
        data.data.name
      } at ${convertTimestampToDatetime(data.data.time.seconds)}&lt;/p&gt;
      &lt;p&gt;${data.data.text}&lt;/p&gt;
    &lt;/li&gt;
  `);
});
</code></pre>
<h3 id="動作確認-3"><a class="header" href="#動作確認-3">動作確認</a></h3>
<p>下記のように人間が認識しやすい形式になって表示される．</p>
<p><img src="js/js04/./img/20210616154031.png" alt="時刻形式変換" /></p>
<h2 id="データの並び替え"><a class="header" href="#データの並び替え">データの並び替え</a></h2>
<p>本アプリケーションはチャット機能がメインであるため，送信日時が新しいメッセージが上部に表示されることが望ましい．</p>
<p>しかし，初期状態では Firestore 上の ID 名順でデータを取得しているため，<code>time</code>でソートされた状態でデータを取得できるようにしたい．</p>
<ul>
<li>データのソートには<code>orderBy()</code>を利用する．</li>
<li><code>orderBy()</code>には 2 つのデータを入力する．1 つ目は「どの項目で並び替えをするか」2 つ目は「昇順（<code>asc</code>）か降順（<code>desc</code>）」である．</li>
</ul>
<p>データ取得時の処理に追記する．</p>
<pre><code class="language-js">// chatapp.html

// 🔽 `query`と`orderBy`を追記
import {
  getFirestore,
  collection,
  addDoc,
  serverTimestamp,
  query,
  orderBy,
  onSnapshot,
} from &quot;https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js&quot;;

// 省略

// 🔽 データ取得条件の指定（今回は時間の新しい順に並び替えて取得）
const q = query(collection(db, &quot;chat&quot;), orderBy(&quot;time&quot;, &quot;desc&quot;));

onSnapshot(q, (querySnapshot) =&gt; {
  // 省略
});
</code></pre>
<p>ブラウザで並び順が変更されているか確認しよう．</p>
<h2 id="おまけenter-キーで送信"><a class="header" href="#おまけenter-キーで送信">【おまけ】Enter キーで送信</a></h2>
<p>ボタンクリックではなく，メッセージ入力時に Enter キーを押して送信することもできる．</p>
<p>この場合，イベント情報から「入力したキーを識別するキーコード」を抽出してキーを判別する．</p>
<ul>
<li><code>function (e)</code>の<code>e</code>にイベント情報（この場合<code>keydown</code>）で取得可能なデータが格納される．</li>
<li><code>e.keyCode</code>でどのキーを押したかが識別可能であるため，Enter のキーコードを調べておけば条件分岐でデータ送信を行える．</li>
</ul>
<pre><code class="language-js">// chatapp.html

$(&quot;#text&quot;).on(&quot;keydown&quot;, function (e) {
  if (e.keyCode === 13) {
    const data = {
      name: $(&quot;#name&quot;).val(),
      text: $(&quot;#text&quot;).val(),
      time: serverTimestamp(),
    };
    addDoc(data);
    $(&quot;#text&quot;).val(&quot;&quot;);
  }
});
</code></pre>
<p>このように，JavaScript ではイベントに関連した情報を取得することができる．これらを用いて画面の特定の部分をクリックしたときだけ発火させたり，決まった順にタイプしたときだけ発火させたりできる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題と提出時の注意点"><a class="header" href="#課題と提出時の注意点">課題と提出時の注意点</a></h1>
<p><strong>Firebase を使用したアプリを実装しよう！</strong></p>
<p>Firebase を用いることで複数の端末での双方向的なやり取りを実装することが可能となる．</p>
<p>今回はデータを追加していく方式で実装したが，データを削除したり上書きしたりすることも可能だ．</p>
<p>今回使用した Firestore 以外にも様々な機能がある．本気出せば Web アプリケーションを全て実装してデプロイできるだけの可能性を秘めた技術であるッ！</p>
<ul>
<li>認証（Authentication）</li>
<li>ファイル保存（Storage）</li>
<li>デプロイ（Hosting）</li>
<li>サーバサイドの実装（Functions）</li>
</ul>
<h2 id="実装例"><a class="header" href="#実装例">実装例</a></h2>
<ul>
<li>スタンプ送信機能</li>
<li>オンラインでじゃんけん</li>
<li>出席管理システム</li>
<li>オリジナル SNS</li>
<li>MMORPG を開発</li>
</ul>
<h2 id="-注意点"><a class="header" href="#-注意点">⚠️ 注意点</a></h2>
<h3 id="api-キーの扱い"><a class="header" href="#api-キーの扱い">API キーの扱い</a></h3>
<ul>
<li>Firebase には API キーが必要になります．</li>
<li>誰でも見られる Github にあげてしまうとあまりよろしくない．</li>
</ul>
<p>Github に push する前に．．．</p>
<ul>
<li><code>git add .</code>する前に API キー部分は一旦削除しておきましょう．</li>
<li>提出フォームのコメント欄に API キーを記述してください！</li>
</ul>
<pre><code class="language-html">&lt;script type=&quot;module&quot;&gt;
  import { initializeApp } from &quot;https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js&quot;;
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp,
    query,
    orderBy,
    onSnapshot,
  } from &quot;https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js&quot;;

  const firebaseConfig = {
    // 🔽この1行を`git add .`する前に一旦削除！削除したAPIキーは「提出フォームのAPIkey欄」に記述！
    apiKey: &quot;AIzaSyD7uBPYxKsUJQrJ94D8Ss5Ss5ETRpUzNbs&quot;,
    authDomain: &quot;chatapp-4cdef.firebaseapp.com&quot;,
    projectId: &quot;chatapp-4cdef&quot;,
    storageBucket: &quot;chatapp-4cdef.appspot.com&quot;,
    messagingSenderId: &quot;647489237948&quot;,
    appId: &quot;1:647489237948:web:1a75f2713344937854f1b9&quot;,
  };

  const app = initializeApp(firebaseConfig);

  // 以下，JavaScriptのコードたくさん
&lt;/script&gt;
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="js_api"><a class="header" href="#js_api">JS_API</a></h1>
<h2 id="サンプルコード-5"><a class="header" href="#サンプルコード-5">サンプルコード</a></h2>
<p><a href="js/js05/../../samples/05_js_api_sample.zip">download</a></p>
<h2 id="事前準備-2"><a class="header" href="#事前準備-2">事前準備</a></h2>
<p>今回はマイクロソフトのアカウントを使用します！</p>
<p>無料で取得できますので，事前に作成しておいてください！</p>
<ul>
<li>下記参考サイトの「既に持ってるメアドを使う場合」でアカウントを作りましょう．</li>
<li>すでにお持ちの方は既存のアカウントで OK です！</li>
<li>不明点あれば slack にコメントください！</li>
</ul>
<p><a href="https://kaoruya.org/blog/ms-account/#i-3">https://kaoruya.org/blog/ms-account/#i-3</a></p>
<h2 id="本講義の内容とゴール-5"><a class="header" href="#本講義の内容とゴール-5">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-5"><a class="header" href="#本講義の内容-5">本講義の内容</a></h3>
<ul>
<li>Google Books API を用いたリクエストとレスポンスを扱う．</li>
<li>Bing Maps API を用いて外部 API を用いた画面操作を行う．</li>
<li>自身のアイデアを元に API を探す．</li>
</ul>
<h3 id="本講義のゴール-5"><a class="header" href="#本講義のゴール-5">本講義のゴール</a></h3>
<ul>
<li>Web アプリケーションにおけるリクエストとレスポンスの概念を把握する．</li>
<li>JavaScript を用いた API 連携処理を実装することで，処理の基本的な流れを理解する．</li>
<li>自分のアイデアから関連する API を探し，実装にチャレンジできるようになる．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="api-とは"><a class="header" href="#api-とは">API とは</a></h1>
<h2 id="api-の意味合い"><a class="header" href="#api-の意味合い">API の意味合い</a></h2>
<p>Application Programming Interface の略．</p>
<p>あるアプリケーション（例えば Google Map や Twitter など）の一部を外部に向けて公開することにより，第三者が開発したソフトウェアに機能を組み込めるようにしたものである．</p>
<p>世の中に存在するサービスの機能の一部を使わせてもらえるイメージ！</p>
<blockquote>
<p>Interface</p>
<ul>
<li>Interface は「あるもの」と「あるもの」をつなぐもの，という意味合い．</li>
<li>今回は（すでに動いている）アプリケーションと（開発者が実装する）プログラムをつなぐ．</li>
</ul>
</blockquote>
<h2 id="api-の一例"><a class="header" href="#api-の一例">API の一例</a></h2>
<table><thead><tr><th>API 名</th><th>概要</th></tr></thead><tbody>
<tr><td>Bing Maps API</td><td>リクエストに応じてブラウザに地図を表示したり，ルート検索したりする．</td></tr>
<tr><td>Google Books API</td><td>Google Books が持っている書籍の情報から，キーワードなど指定してデータ- を返す．</td></tr>
<tr><td>Open Weather Map API</td><td>都市名や緯度経度を指定して，その日の天気や天気予報の情報を返す．</td></tr>
</tbody></table>
<h2 id="api-の利点"><a class="header" href="#api-の利点">API の利点</a></h2>
<ul>
<li>他社のデータを利用できる！</li>
<li>自分で作らなくて良いので開発速度がアップ！</li>
<li>いろいろな API を組み合わせてアプリケーションを実装できる！</li>
</ul>
<h2 id="動き方のイメージ"><a class="header" href="#動き方のイメージ">動き方のイメージ</a></h2>
<p>基本は「リクエスト」と「レスポンス」！</p>
<p>API（外部のサーバ）に JavaScript でリクエスト（要求）を送信し，API 側にデータを返してもらったり処理を実行してもらったりする．</p>
<p>Web アプリケーションのサーバ側の処理を API に行ってもらうイメージ！</p>
<p><img src="js/js05/./img/js_api_about_api.svg" alt="APIの動き方" /></p>
<h3 id="api-にリクエストを送信してデータをもらうタイプこちらが一般的"><a class="header" href="#api-にリクエストを送信してデータをもらうタイプこちらが一般的">API にリクエストを送信してデータをもらうタイプ（こちらが一般的）</a></h3>
<p>検索条件などを指定して，条件に合う情報を送ってもらう．</p>
<table><thead><tr><th>API</th><th>送信するデータ</th><th>受け取れるデータ</th></tr></thead><tbody>
<tr><td>Google Books API</td><td>本のタイトルに含まれるキーワード，著者，出版社，出版年，etc...</td><td>条件に該当する本のデータ</td></tr>
<tr><td>Open Weather Map API</td><td>都市名，緯度経度，etc</td><td>現在の気象情報，一週間分の天気予報，etc...</td></tr>
<tr><td>テキスト解析</td><td>テキストデータ</td><td>テキストの感情データ，要，約，etc...</td></tr>
<tr><td>画像認識</td><td>画像データ</td><td>画像に映っているもの名称，位置，etc...</td></tr>
<tr><td>音声認識</td><td>音声データ</td><td>音声を文字起こししたテキスト</td></tr>
</tbody></table>
<h3 id="api-に定められたコードを実行してブラウザを操作してもらうタイプ"><a class="header" href="#api-に定められたコードを実行してブラウザを操作してもらうタイプ">API に定められたコードを実行してブラウザを操作してもらうタイプ</a></h3>
<p>条件を指定して，実際にブラウザ表示などをやってもらう．</p>
<table><thead><tr><th>API</th><th>やってもらえること</th></tr></thead><tbody>
<tr><td>Bing Maps API</td><td>場所などを指定して地図を表示，ルート検索，住所を緯度経度に変換，etc...</td></tr>
<tr><td>Google Maps API</td><td>地図表示，ストリートビュー表示，etc...</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="googlebooksapi"><a class="header" href="#googlebooksapi">GoogleBooksAPI</a></h1>
<h2 id="google-books-api-とは"><a class="header" href="#google-books-api-とは">Google Books API とは</a></h2>
<p><a href="https://developers.google.com/books/docs/overview">ドキュメント</a></p>
<p>本 API に限らず，API には必ずドキュメント（仕様書）が存在する．</p>
<p>ドキュメントには下記のような重要な情報が記載されているため，必ず目を通そう．</p>
<ul>
<li>API にできること（得られるデータややってくれる処理など）．</li>
<li>API の使い方やサンプルコード．</li>
<li>料金（無料のものと有料のものが存在する）．</li>
</ul>
<h2 id="特徴"><a class="header" href="#特徴">特徴</a></h2>
<ul>
<li>Google Books に登録されている本の json データを取得できる！</li>
<li>タイトルや著者などで条件を指定できる！</li>
<li>（仕様をよく読みましょう！）</li>
<li>API key が不要！！！</li>
</ul>
<blockquote>
<p>API key とは</p>
<ul>
<li>API にリクエストを送るためにはユニークな文字列が必要．</li>
<li>設定を行ったアプリケーションのみ動作させるため．（無断で使用されないように．．！）</li>
<li>この文字列を API キーを呼び，API の種類問わず必須の場合が多い．</li>
</ul>
</blockquote>
<h2 id="処理の流れ-1"><a class="header" href="#処理の流れ-1">処理の流れ</a></h2>
<ul>
<li>API に定められた URL にリクエストを送信する．</li>
<li>送信の際には欲しいデータに必要な条件などを指定する．</li>
</ul>
<h2 id="http-通信の準備"><a class="header" href="#http-通信の準備">HTTP 通信の準備</a></h2>
<p>API へのリクエストには「HTTP 通信」という方式で送信する．</p>
<p>JavaScript で HTTP 通信を行うには下記のような複数の方法が存在する．下のものほどオススメ．</p>
<table><thead><tr><th>方法</th><th>特徴</th></tr></thead><tbody>
<tr><td>XMLHttpRequest</td><td>生 JS / 一番昔から存在する</td></tr>
<tr><td>$.ajax()</td><td>jQuery / これが出てきて流行った</td></tr>
<tr><td>fetch</td><td>生 JS / 慣れないと分かりづらい</td></tr>
<tr><td>axios</td><td>React とか Vue でも使われていて使い勝手が良い</td></tr>
</tbody></table>
<p>今回は<code>axios</code>ライブラリを使用する．ライブラリであるため，下記のコードで読み込みが必要となる．</p>
<p>最近のモダンなフレームワーク（React, Vue.js など）でも利用されているため，今の時点から慣れておくのも良き．</p>
<pre><code class="language-html">&lt;!-- booksapi.html --&gt;

&lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<h2 id="リクエストの送信とデータの受け取り"><a class="header" href="#リクエストの送信とデータの受け取り">リクエストの送信とデータの受け取り</a></h2>
<p>Google Books API で指定された下記の URL にリクエストする．</p>
<p><code>https://www.googleapis.com/books/v1/volumes</code></p>
<p>リクエストの際には，得たいデータの条件などを指定する．</p>
<ul>
<li>今回は「本のタイトルに<code>javascript</code>が含まれる」という条件を指定してみる．</li>
<li>本条件を指定する場合は，上記 URL の最後に「<code>?q=intitle:javascript</code>」を追加する．</li>
<li>条件の指定の仕方はドキュメントに記載されている．API によって指定方法が異なるため，必ずドキュメントを確認しよう．</li>
</ul>
<p>リクエストは<code>axios.get()</code>関数で実行する．</p>
<pre><code class="language-js">// booksapi.html

const requestUrl =
  &quot;https://www.googleapis.com/books/v1/volumes?q=intitle:javascript&quot;;

axios
  .get(requestUrl)
  .then(function (response) {
    // リクエスト成功時の処理（responseに結果が入っている）
    console.log(response);
  })
  .catch(function (error) {
    // リクエスト失敗時の処理（errorにエラー内容が入っている）
    console.log(error);
  })
  .finally(function () {
    // 成功失敗に関わらず必ず実行
    console.log(&quot;done!&quot;);
  });
</code></pre>
<h3 id="リクエストを送信するaxiosgetの動き方"><a class="header" href="#リクエストを送信するaxiosgetの動き方">リクエストを送信する<code>axios.get()</code>の動き方</a></h3>
<p><code>axios.get()</code>関数の<code>.then()</code>などは実行されるタイミングが下記のように決まっている．</p>
<table><thead><tr><th>記述</th><th>実行されるタイミング</th></tr></thead><tbody>
<tr><td><code>.then(function (response) {...})</code></td><td>情報の取得に成功した場合に<code>{}</code>内が実行される．<br>取得した情報は<code>response</code>に格納されている．</td></tr>
<tr><td><code>.catch(function (error) {...}</code></td><td>情報の取得に失敗した場合に<code>{}</code>内が実行される．<br>エラーの詳細が<code>error</code>に格納されている．</td></tr>
<tr><td><code>.finally(function () {...}</code></td><td>情報の取得成否にかかわらず<code>{}</code>内が実行される．</td></tr>
</tbody></table>
<h3 id="処理の順番"><a class="header" href="#処理の順番">処理の順番</a></h3>
<p>したがって，リクエストの成否によって下記のどちらかの順番で処理が実行されることとなる．</p>
<ul>
<li>リクエスト成功の場合
<ol>
<li><code>.then(function (response) {...})</code>の<code>{}</code>内に記述した処理．</li>
<li><code>.finally(function () {...}</code>の<code>{}</code>内に記述した処理．</li>
</ol>
</li>
<li>リクエスト失敗の場合
<ol>
<li><code>.catch(function (error) {...})</code>の<code>{}</code>内に記述した処理．</li>
<li><code>.finally(function () {...}</code>の<code>{}</code>内に記述した処理．</li>
</ol>
</li>
</ul>
<h3 id="-key-point-14"><a class="header" href="#-key-point-14">💡 Key Point</a></h3>
<blockquote>
<p>重要なのはリクエストに成功した場合の処理である．</p>
<p>API から取得したデータを使いたい場合は<code>.then(function (response) {...})</code>の<code>{}</code>内に処理を記述しよう．</p>
</blockquote>
<h2 id="実行結果"><a class="header" href="#実行結果">実行結果</a></h2>
<p>上記のコードを実行すると，コンソールには以下のようなデータが表示される．</p>
<p>データ全体はオブジェクトとなっており，<code>data.items</code>に本のデータが配列形式でまとまっている．ブラウザの検証画面をみてデータ構造や本のタイトルがどこに含まれているのかなど確認しよう．</p>
<pre><code class="language-js">// 検証画面に表示される内容

{data: {…}, status: 200, statusText: &quot;&quot;, headers: {…}, config: {…}, …}
  config: {url: &quot;https://www.googleapis.com/books/v1/volumes?q=intitle:javascript&quot;, method: &quot;get&quot;, headers: {…}, transformRequest: Array(1), transformResponse: Array(1), …}
  data:
    items: Array(10)
      0: {kind: &quot;books#volume&quot;, id: &quot;yg0fBAAAQBAJ&quot;, etag: &quot;lfbwNFyvkDg&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/yg0fBAAAQBAJ&quot;, volumeInfo: {…}, …}
      1: {kind: &quot;books#volume&quot;, id: &quot;sREfBAAAQBAJ&quot;, etag: &quot;Bbo+KCTb+os&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/sREfBAAAQBAJ&quot;, volumeInfo: {…}, …}
      2: {kind: &quot;books#volume&quot;, id: &quot;EgEfBAAAQBAJ&quot;, etag: &quot;1Sqd8Kh1nDE&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/EgEfBAAAQBAJ&quot;, volumeInfo: {…}, …}
      3: {kind: &quot;books#volume&quot;, id: &quot;oeFeDwAAQBAJ&quot;, etag: &quot;VpC+UDGt4ak&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/oeFeDwAAQBAJ&quot;, volumeInfo: {…}, …}
      4: {kind: &quot;books#volume&quot;, id: &quot;EQ0fBAAAQBAJ&quot;, etag: &quot;IUx31Y7bo5w&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/EQ0fBAAAQBAJ&quot;, volumeInfo: {…}, …}
      5: {kind: &quot;books#volume&quot;, id: &quot;sLiKBgAAQBAJ&quot;, etag: &quot;W8AX5pJDoTw&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/sLiKBgAAQBAJ&quot;, volumeInfo: {…}, …}
      6: {kind: &quot;books#volume&quot;, id: &quot;MMGlDwAAQBAJ&quot;, etag: &quot;uasA3kSjFmg&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/MMGlDwAAQBAJ&quot;, volumeInfo: {…}, …}
      7: {kind: &quot;books#volume&quot;, id: &quot;OH-ynAEACAAJ&quot;, etag: &quot;BGSumK/B93U&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/OH-ynAEACAAJ&quot;, volumeInfo: {…}, …}
      8: {kind: &quot;books#volume&quot;, id: &quot;0pfxN9xhwMIC&quot;, etag: &quot;0m0saY33NmY&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/0pfxN9xhwMIC&quot;, volumeInfo: {…}, …}
      9: {kind: &quot;books#volume&quot;, id: &quot;VI-EoAEACAAJ&quot;, etag: &quot;SvupF5US57Q&quot;, selfLink: &quot;https://www.googleapis.com/books/v1/volumes/VI-EoAEACAAJ&quot;, volumeInfo: {…}, …}
      length: 10
    kind: &quot;books#volumes&quot;
    totalItems: 200
  headers: {cache-control: &quot;private&quot;, content-encoding: &quot;gzip&quot;, content-length: &quot;7804&quot;, content-type: &quot;application/json; charset=UTF-8&quot;, date: &quot;Sun, 06 Jun 2021 07:45:18 GMT&quot;, …}
  request: XMLHttpRequest {readyState: 4, timeout: 0, withCredentials: false, upload: XMLHttpRequestUpload, onreadystatechange: ƒ, …}
  status: 200
  statusText: &quot;&quot;

</code></pre>
<h2 id="練習-16"><a class="header" href="#練習-16">練習</a></h2>
<p>Google Books API を使って下記を実行しよう！</p>
<ol>
<li>検索の条件を自由に設定して URL を作成しよう！</li>
<li>本の情報を console.log()で出力しよう！</li>
<li>本のタイトルをブラウザ上に一覧表示してみよう！</li>
<li>（タイトルにリンクを張る，本の画像を表示，などもチャレンジ）</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="位置情報の活用"><a class="header" href="#位置情報の活用">位置情報の活用</a></h1>
<h2 id="位置情報とその使われ方"><a class="header" href="#位置情報とその使われ方">位置情報とその使われ方</a></h2>
<p>近年位置情報の活用幅や重要性は増しており，サービスの 8 割程度で利用されているとも言われている．</p>
<p><a href="https://japan.cnet.com/article/20417587/">参考 1</a></p>
<p><a href="https://forbesjapan.com/articles/detail/38376">参考 2</a></p>
<h3 id="gps-などを用いた位置情報"><a class="header" href="#gps-などを用いた位置情報">GPS などを用いた位置情報</a></h3>
<ul>
<li>位置情報とマップの組み合わせ</li>
<li>今まではユーザの現在地がわからなかった．</li>
<li>ユーザの現在位置を視覚的に表示できるため，どこに行けばよいかがわかる．</li>
<li>地図上に店舗データなどを表示できる．</li>
<li>道を間違っても自動的に現在地からのルートが分かる</li>
</ul>
<h3 id="wifi-を用いた位置情報"><a class="header" href="#wifi-を用いた位置情報">Wifi を用いた位置情報</a></h3>
<ul>
<li>店舗のマーケティングリサーチ</li>
<li>電波強度で顧客を分類する．
<ul>
<li>強ければ店内，弱ければ店外．</li>
</ul>
</li>
<li>接続時間で顧客を分類する．
<ul>
<li>時間が長ければ店内，短ければ店外．</li>
<li>営業時間内なら顧客，時間外は通行人．</li>
</ul>
</li>
</ul>
<h3 id="ビーコンを用いた位置情報"><a class="header" href="#ビーコンを用いた位置情報">ビーコンを用いた位置情報</a></h3>
<ul>
<li>店内の販促ツール．
<ul>
<li>棚の近くにビーコンを設置．</li>
<li>ユーザが近づくと LINE にクーポンを配信．</li>
</ul>
</li>
<li>ユーザにアプリ等のツールが必要ない．</li>
<li>購入レシートを送信するとポイントが当たる．</li>
<li>再度の来店を促す．</li>
</ul>
<h2 id="javscript-での位置情報取得"><a class="header" href="#javscript-での位置情報取得">JavScript での位置情報取得</a></h2>
<p>JavaScript には標準で位置情報を取得する関数が組み込まれている．</p>
<h3 id="種類"><a class="header" href="#種類">種類</a></h3>
<p>下記 2 種類の方法で位置情報を取得することができる．</p>
<table><thead><tr><th>方法</th><th>概要</th></tr></thead><tbody>
<tr><td>getCurrentPosition</td><td>処理を実行したタイミングで一度だけ位置情報を取得する．</td></tr>
<tr><td>watchPosition</td><td>処理を実行すると，位置情報を常に取得し続ける．<br>バッテリー消費に注意！</td></tr>
</tbody></table>
<h3 id="オプション"><a class="header" href="#オプション">オプション</a></h3>
<p>また，上記の処理を実行する際には 3 種類のオプションを設定することができる．</p>
<p>オプションはオブジェクト形式で設定し，上記処理を実行する際に読み込むことで適用される．</p>
<table><thead><tr><th>オプション名</th><th>内容や設定のしかた</th></tr></thead><tbody>
<tr><td>enableHighAccuracy</td><td>対応端末で GPS を使用するかどうかの設定．<br><code>true</code>または<code>false</code>で指定．</td></tr>
<tr><td>maximumAge</td><td>指定時間以内であれば前回取得した位置情報の値を用いる．<br>ミリ秒で指定．</td></tr>
<tr><td>timeout</td><td>タイムアウト時間を設定する．<br>ミリ秒で指定．</td></tr>
</tbody></table>
<h2 id="処理の流れとコード"><a class="header" href="#処理の流れとコード">処理の流れとコード</a></h2>
<p>位置情報を取得する処理を記述する場合には，下記の 3 項目が必要となるため，予め用意しておく必要がある．</p>
<ol>
<li>位置情報の取得に成功した場合に実行される関数（サンプルでは<code>showPosition</code>）．</li>
<li>位置情報の取得に失敗した場合に実行される関数（サンプルでは<code>showError</code>）．</li>
<li>位置情報の取得に必要なオプション（前項で紹介したもの，サンプルでは<code>option</code>）．</li>
</ol>
<p>⚠️ 上記 3 項目は下記コード（位置情報取得の処理）よりも上に書いておく必要がある．</p>
<h3 id="位置情報取得の処理"><a class="header" href="#位置情報取得の処理">位置情報取得の処理</a></h3>
<pre><code class="language-js">// geolocation.html

navigator.geolocation.getCurrentPosition(showPosition, showError, option);
</code></pre>
<h3 id="位置情報の取得に成功した場合に実行される関数"><a class="header" href="#位置情報の取得に成功した場合に実行される関数">位置情報の取得に成功した場合に実行される関数</a></h3>
<p>位置情報の取得に成功すると，自動的に関数の引数（下記では<code>position</code>）に位置情報が入ってくる．</p>
<p>まずは console に出力して内容を確認しよう．</p>
<pre><code class="language-js">// geolocation.html

function showPosition(position) {
  console.log(position);
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  console.log(lat, lng);
}
</code></pre>
<h3 id="位置情報の取得に失敗した場合に実行される関数"><a class="header" href="#位置情報の取得に失敗した場合に実行される関数">位置情報の取得に失敗した場合に実行される関数</a></h3>
<p>位置情報の取得に失敗した場合は決まったエラーが返される．</p>
<p>エラーには番号（<code>1</code>, <code>2</code>, <code>3</code>）が振ってあり意味が決まっているため，それぞれに対応したメッセージを表示するように記述してある．</p>
<pre><code class="language-js">// geolocation.html

function showError(error) {
  const errorMessages = [
    &quot;位置情報が許可されてません&quot;,
    &quot;現在位置を特定できません&quot;,
    &quot;位置情報を取得する前にタイムアウトになりました&quot;,
  ];
  alert(`error:${errorMessages[error.code - 1]}`);
}
</code></pre>
<h3 id="位置情報の取得に必要なオプション"><a class="header" href="#位置情報の取得に必要なオプション">位置情報の取得に必要なオプション</a></h3>
<p>オブジェクトの形式で 3 項目を指定する．</p>
<pre><code class="language-js">// geolocation.html

const option = {
  enableHighAccuracy: true,
  maximumAge: 20000,
  timeout: 1000000,
};
</code></pre>
<h2 id="動作確認-4"><a class="header" href="#動作確認-4">動作確認</a></h2>
<p>コードが実行されると「位置情報の取得を許可するかどうか」のダイアログが表示されるため，許可する．</p>
<p>位置情報が取得できると，コンソール画面には以下のような情報が表示される．</p>
<p>位置情報は緯度経度で表現され，それぞれ<code>latitude</code>と<code>longitude</code>の値が対応する．</p>
<pre><code class="language-js">GeolocationPosition {coords: GeolocationCoordinates, timestamp: 1622956582259}
  coords: GeolocationCoordinates
    accuracy: 200
    altitude: null
    altitudeAccuracy: null
    heading: null
    latitude: 35.69
    longitude: 139.69
    speed: null
timestamp: 1622956582259
</code></pre>
<h2 id="練習-17"><a class="header" href="#練習-17">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ol>
<li>読み込み時に位置情報を取得して console.log()に表示しよう！</li>
<li>できる人は取得した緯度と経度をブラウザに表示しよう！</li>
</ol>
<p>（位置情報の取得までに時間がかかることもあるので気長に待つ！）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="bingmapsapi準備"><a class="header" href="#bingmapsapi準備">BingMapsAPI/準備</a></h1>
<h2 id="bing-maps-api-とは"><a class="header" href="#bing-maps-api-とは">Bing Maps API とは</a></h2>
<p>Microsoft が提供する地図 API である．位置情報との連携を中心に様々な機能を提供する．</p>
<p>今回は前項で取得した位置情報を利用し，現在地付近の地図をブラウザ上に表示するアプリケーションを実装する．</p>
<h3 id="特徴-1"><a class="header" href="#特徴-1">特徴</a></h3>
<ul>
<li>JavaScript のみで実装可能．</li>
<li>機能を実現するために必要なコードは Microsoft が定めている．決められたコードを記述するだけで様々な機能を実装可能．</li>
<li>支払い情報など登録する必要なく無料で使用可能．</li>
</ul>
<h3 id="機能例"><a class="header" href="#機能例">機能例</a></h3>
<ul>
<li>任意の地点・縮尺で地図の表示．</li>
<li>出発地，到着地を指定したルート検索．</li>
<li>地図上の任意の地点にピン，Infobox（吹き出し），などを設置．</li>
<li>住所から緯度経度を取得．</li>
<li>緯度経度から住所を取得．</li>
</ul>
<h2 id="準備"><a class="header" href="#準備">準備</a></h2>
<p>Bing Maps API を使用するためにはいくつかの準備が必要となる．主な手順は以下のとおり．</p>
<ol>
<li>Microsoft アカウントが必要（事前準備済）．</li>
<li>Bing Maps API 開発者アカウントの準備．</li>
<li>API key の発行．</li>
<li>（実際にコードを記述する）</li>
</ol>
<h3 id="開発者アカウントの準備"><a class="header" href="#開発者アカウントの準備">開発者アカウントの準備</a></h3>
<p>まずは下記の URL にアクセス！</p>
<p><a href="https://www.bingmapsportal.com">https://www.bingmapsportal.com</a></p>
<p>下記の画面から「Sign In」ボタンをクリック．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup01.svg" alt="bingmapsAPI準備1" /></p>
<p>Microsoft アカウントでログインする．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup02.svg" alt="bingmapsAPI準備2" /></p>
<p>画面が切り替わるので「Yes, let's create a new account」をクリックし，アカウント情報を入力する．</p>
<p>メールアドレスは Microsoft アカウントと同じものを使用すると管理しやすいだろう．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup03.svg" alt="bingmapsAPI準備3" /></p>
<h3 id="api-key-の発行"><a class="header" href="#api-key-の発行">API key の発行</a></h3>
<p>アカウントが作成できたら，画面上部のタブの「My account」 -&gt; 「My Keys」をクリックする．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup04.svg" alt="bingmapsAPI準備4" /></p>
<p>アプリケーション名を入力し，API key を作成する．アプリケーション名以外は初期状態のままで構わない．</p>
<p>アプリケーション名は「何のアプリケーションなのか」がわかる名前にしよう．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup05.svg" alt="bingmapsAPI準備5" /></p>
<p>作成が正常に完了すると自動的に画面が切り替わる．下図の「Show key」部分をクリックすると API key が表示される．</p>
<p>API key は後ほどコード内に記述する必要があるため，この画面は開いたままにしておくとスムーズである．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_setup06.svg" alt="bingmapsAPI準備6" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="bingmapsapi実践"><a class="header" href="#bingmapsapi実践">BingMapsAPI/実践</a></h1>
<p>API key の準備が完了したら，実際に JavaScript を書いて Map を表示してみよう．</p>
<h2 id="処理の流れ-2"><a class="header" href="#処理の流れ-2">処理の流れ</a></h2>
<p>位置情報の取得と API 処理を組み合わせるため，実行される順番がやや複雑になる．コメントなどで順番がわかるようにしておくと自力で実装する際の助けとなるだろう．</p>
<ol>
<li>API を使用するためのコード読み込み．</li>
<li>位置情報取得に成功した場合の関数，失敗した場合の関数，オプションを記述．</li>
<li>位置情報の取得（前項での処理と同様）</li>
<li>位置情報が取得できた場合は，id 指定した HTML 要素に現在地を中心としたマップを表示する（位置情報の取得に成功した場合に実行される関数内に記述する）．</li>
</ol>
<h2 id="コードの読み込み"><a class="header" href="#コードの読み込み">コードの読み込み</a></h2>
<p>Microsoft が提供するコードを読み込む．ここに自分の API key を入力しておく．</p>
<pre><code class="language-html">&lt;!-- geo_and_map.html --&gt;

&lt;script src=&quot;https://www.bing.com/api/maps/mapcontrol?mkt=ja-jp&amp;key=API_KEY&quot;&gt;&lt;/script&gt;

&lt;script&gt;
  // JSの処理
&lt;/script&gt;
</code></pre>
<h2 id="位置情報取得に成功した場合の関数失敗した場合の関数オプションを記述"><a class="header" href="#位置情報取得に成功した場合の関数失敗した場合の関数オプションを記述">位置情報取得に成功した場合の関数，失敗した場合の関数，オプションを記述．</a></h2>
<p>この 3 項目自体は前項の位置情報取得で使用したものと同様の記述をすれば OK．</p>
<p>今回はそれぞれ以下のような内容．</p>
<ul>
<li>位置情報の取得に成功した場合に実行される関数（本項では<code>mapsInit</code>）．</li>
<li>位置情報の取得に失敗した場合に実行される関数（前項と全く同じ）．</li>
<li>位置情報の取得に必要なオプション（前項と全く同じ）．</li>
</ul>
<p>その他，マップの情報を格納するための変数（<code>map</code>）を定義しておく（これがないと動かないので注意！）．</p>
<h3 id="必要な関数を準備"><a class="header" href="#必要な関数を準備">必要な関数を準備</a></h3>
<pre><code class="language-js">// geo_and_map.html

// マップ情報格納用の変数
let map;

// 省略
const option = {...};

// 省略
function showError(error) {...};

// この後マップ表示の処理を書き込む
function mapsInit() {...};

</code></pre>
<h2 id="マップ表示処理の追加"><a class="header" href="#マップ表示処理の追加">マップ表示処理の追加</a></h2>
<p>マップの表示処理は Microsoft 側で決められているため，ドキュメントに従ってコードを記述すれば OK．</p>
<p>流れとしては下記のとおり．</p>
<ol>
<li>位置情報から緯度経度を抽出する．</li>
<li>1 で取得した緯度経度を中心にしてマップを表示する．</li>
</ol>
<p>マップを表示する際には下記の情報が必要となる．</p>
<ul>
<li>マップを表示したい要素の id 名（<code>#map</code>）．</li>
<li>表示するマップの中心座標（緯度経度，<code>center</code>のオブジェクト）．</li>
<li>表示するマップの縮尺（<code>1</code>から<code>20</code>で指定）．</li>
</ul>
<pre><code class="language-js">// geo_and_map.html

function mapsInit(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  map = new Microsoft.Maps.Map(&quot;#map&quot;, {
    center: {
      latitude: lat,
      longitude: lng,
    },
    zoom: 15,
  });
}
</code></pre>
<h2 id="位置情報取得処理"><a class="header" href="#位置情報取得処理">位置情報取得処理</a></h2>
<p>最後に，実際に位置情報を取得する処理を記述する．</p>
<p>コード自体は前項と同様だが，実行のタイミングに注意する必要がある．理由は以下．</p>
<ul>
<li>マップ表示のためには Microsoft が提供したコードを読み込む必要がある．</li>
<li>読み込みが完了する前にマップ表示の処理を実行しようとするとエラーになる．</li>
<li>そのため，読み込みが完了した後に「位置情報取得 -&gt; マップ表示」の処理が実行されるように記述しなければならない．</li>
</ul>
<p>この場合，<code>window.onload = function () {...}</code>を用いることで，全てのスクリプトが読み込ま出てから<code>{}</code>内が実行されるように記述できる．</p>
<pre><code class="language-js">// geo_and_map.html

window.onload = function () {
  navigator.geolocation.getCurrentPosition(mapsInit, showError, option);
};
</code></pre>
<h3 id="-key-point-15"><a class="header" href="#-key-point-15">💡 Key Point</a></h3>
<blockquote>
<p>API（特に外部のコードを読み込む場合）は読み込み -&gt; 実行の順番が重要になる場合が多い．</p>
</blockquote>
<h2 id="実行結果-1"><a class="header" href="#実行結果-1">実行結果</a></h2>
<p>正常に位置情報が取得でき，マップ表示処理が実行されると，以下のようにブラウザ上にマップが表示される．</p>
<p>実行場所やネットワーク環境によって場所は変化するため，実際の場所とあっていなくても気にしなくて OK．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_result01.png" alt="マップ表示結果" /></p>
<h2 id="練習-18"><a class="header" href="#練習-18">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ul>
<li>位置情報の取得に成功したときに関数を定義し，map 表示の処理を記述．</li>
<li>位置情報を取得する処理を記述し，画面にマップが表示されることを確認！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="おまけbingmapsapi機能追加"><a class="header" href="#おまけbingmapsapi機能追加">【おまけ】BingMapsAPI/機能追加</a></h1>
<p>マップが表示されたら，マップ上にピンなどのオブジェクトを配置してみよう．</p>
<h2 id="ピンの生成"><a class="header" href="#ピンの生成">ピンの生成</a></h2>
<p>現在地をわかりやすくするピンを設定できる．</p>
<h3 id="処理の流れ-3"><a class="header" href="#処理の流れ-3">処理の流れ</a></h3>
<ol>
<li>「ピンを立てる関数」を定義する．
<ul>
<li>ピンの色などのオプションを指定する．</li>
<li>表示したいマップを指定する．</li>
</ul>
</li>
<li>前項で実装したマップ表示後に「ピンを立てる関数」を実行する．</li>
</ol>
<h3 id="ピンを立てる関数の定義"><a class="header" href="#ピンを立てる関数の定義">ピンを立てる関数の定義</a></h3>
<p>マップ表示と同様に Microsoft が処理を用意しているため，ドキュメントに従って記述すれば OK．</p>
<p>本関数の中身は以下の流れ．</p>
<ul>
<li>「ピンを表示したい位置の緯度」「経度」「表示したいマップ」の 3 つを入力する．</li>
<li>入力された緯度経度を Microsoft のフォーマットに変換する．</li>
<li>ピンの位置と色・表示設定を指定する．</li>
<li>入力されたマップ上にピンを配置する．</li>
</ul>
<pre><code class="language-js">// geo_and_map.html

function pushPin(lat, lng, map) {
  const location = new Microsoft.Maps.Location(lat, lng);
  const pin = new Microsoft.Maps.Pushpin(location, {
    color: &quot;navy&quot;,
    visible: true,
  });
  map.entities.push(pin);
}
</code></pre>
<h3 id="ピンを立てる関数の実行"><a class="header" href="#ピンを立てる関数の実行">ピンを立てる関数の実行</a></h3>
<p>マップ表示後に関数を実行する．</p>
<pre><code class="language-js">// geo_and_map.html

function mapsInit(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  map = new Microsoft.Maps.Map(&quot;#map&quot;, {
    center: {
      latitude: lat,
      longitude: lng,
    },
    zoom: 15,
  });
  pushPin(lat, lng, map);
}
</code></pre>
<h2 id="infobox-の生成"><a class="header" href="#infobox-の生成">infobox の生成</a></h2>
<p>infobox（吹き出し）を生成する関数を定義する．吹き出し内には任意のテキストや画像を表示することができる．</p>
<h3 id="処理の流れ-4"><a class="header" href="#処理の流れ-4">処理の流れ</a></h3>
<ol>
<li>「Infobox を立てる関数」を定義する．
<ul>
<li>Infobox の表示内容などのオプションを指定する．</li>
<li>表示したいマップを指定する．</li>
</ul>
</li>
<li>前項で実装したマップ表示後に「Infobox を立てる関数」を実行する．</li>
</ol>
<h3 id="infobox-を生成する関数の定義"><a class="header" href="#infobox-を生成する関数の定義">Infobox を生成する関数の定義</a></h3>
<p>これまでと同様に Microsoft が処理を用意しているため，ドキュメントに従って記述すれば OK．</p>
<p>本関数の中身は以下の流れ．</p>
<ul>
<li>「Infobox を表示したい位置の緯度」「経度」「表示したいマップ」の 3 つを入力する．</li>
<li>入力された緯度経度を Microsoft のフォーマットに変換する．</li>
<li>Infobox の位置と表示内容を指定する．</li>
<li>入力されたマップ上に Infobox を配置する．</li>
</ul>
<pre><code class="language-js">// geo_and_map.html

function generateInfobox(lat, lng, map) {
  const location = new Microsoft.Maps.Location(lat, lng);
  const infobox = new Microsoft.Maps.Infobox(location, {
    title: `G's ACADEMY`,
    description: &quot;JavaScript!!!&quot;,
  });
  infobox.setMap(map);
}
</code></pre>
<h3 id="infobox-を生成する関数の実行"><a class="header" href="#infobox-を生成する関数の実行">Infobox を生成する関数の実行</a></h3>
<p>マップ表示後に関数を実行する．</p>
<pre><code class="language-js">// geo_and_map.html

function mapsInit(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  map = new Microsoft.Maps.Map(&quot;#map&quot;, {
    center: {
      latitude: lat,
      longitude: lng,
    },
    zoom: 15,
  });
  pushPin(lat, lng, map);
  generateInfobox(lat, lng, map);
}
</code></pre>
<h2 id="実行結果-2"><a class="header" href="#実行結果-2">実行結果</a></h2>
<p>マップ上にピンと Infobox が表示される．</p>
<p><img src="js/js05/./img/js_api_bingmapsapi_result02.png" alt="ピン表示結果" /></p>
<h2 id="その他の機能"><a class="header" href="#その他の機能">その他の機能</a></h2>
<p>ここまで紹介した機能はほんの一部！！</p>
<h3 id="ドキュメントも読んでみよう"><a class="header" href="#ドキュメントも読んでみよう">ドキュメントも読んでみよう！</a></h3>
<p><a href="https://bingmapsv8samples.azurewebsites.net">https://bingmapsv8samples.azurewebsites.net</a></p>
<h3 id="山崎先生が作ったサンプル集かなり参考になる"><a class="header" href="#山崎先生が作ったサンプル集かなり参考になる">山崎先生が作ったサンプル集！！（かなり参考になる！！）</a></h3>
<p><a href="https://mapapi.org">https://mapapi.org</a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="その他の-api-紹介"><a class="header" href="#その他の-api-紹介">その他の API 紹介</a></h1>
<p>今回扱った内容以外にも様々な API が存在する．</p>
<p>API を扱う場合は下記がポイントとなる．</p>
<ul>
<li>自分が実現しようとしていることに対して活用できそうな API はないか．</li>
<li>複数の API を連携させることで，新しい価値を生み出せないか．</li>
</ul>
<p>まずはどんな API が存在するのか，探すことから始めよう！</p>
<h2 id="例-6"><a class="header" href="#例-6">例</a></h2>
<table><thead><tr><th>機能</th><th>概要</th><th>API 例</th></tr></thead><tbody>
<tr><td>画像認識</td><td>画像に含まれる物体の名前，表示位置などの推定値を返す</td><td>Google Cloud Vision API など．</td></tr>
<tr><td>翻訳</td><td>翻訳したいテキストと翻訳先の言語名を送信すると翻訳されたテキストを返す．</td><td>Microsoft Translator Text API など．</td></tr>
<tr><td>テキスト解析</td><td>テキストの感情などを分析してスコアを返す．</td><td>Natural Language API など．</td></tr>
<tr><td>EC サイトの情報</td><td>キーワードやカテゴリなどの条件で扱っている商品のリストを返す．</td><td>楽天商品検索 API など．</td></tr>
<tr><td>天気情報</td><td>任意の地点（都市名や緯度経度）から気象情報や天気予報を返す．</td><td>Open Weather Map API など．</td></tr>
</tbody></table>
<h2 id="まずは探せ"><a class="header" href="#まずは探せ">まずは探せ！！</a></h2>
<p><a href="https://www.apibank.jp">https://www.apibank.jp</a></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-3"><a class="header" href="#課題-3">課題</a></h1>
<p><strong>「API」を使用したアプリケーションを実装！！</strong></p>
<h2 id="考え方"><a class="header" href="#考え方">考え方</a></h2>
<ul>
<li>API を組み合わせる！</li>
<li>Firebase や LocalStorage を組み込んでも OK！</li>
<li>API 自体を作ってもいいぞ．．！</li>
</ul>
<h2 id="アレンジの例"><a class="header" href="#アレンジの例">アレンジの例</a></h2>
<ul>
<li>ゾンビと対戦するマップ</li>
<li>ワンタップで周辺のレストランを検索</li>
<li>その日の天気や気温で近くの飲食店をレコメンド</li>
<li>政府の統計情報からマーケット分析</li>
<li>twitter bot, LINE bot, etc...</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="javascript-100-本ノック"><a class="header" href="#javascript-100-本ノック">JavaScript 100 本ノック</a></h1>
<h2 id="目的"><a class="header" href="#目的">目的</a></h2>
<ul>
<li>JavaScript の初歩的な処理をひたすら繰り返すことで定着を狙う．</li>
<li>初歩的な処理を組み合わせ，やや複雑な処理を自身で組み立てられるようにする．</li>
</ul>
<h2 id="進め方-1"><a class="header" href="#進め方-1">進め方</a></h2>
<ul>
<li>1 から順番に挑戦しよう．</li>
</ul>
<h2 id="注意点"><a class="header" href="#注意点">注意点</a></h2>
<ul>
<li>いろいろなところのコードを参考にしているため，転載は控えましょう．</li>
</ul>
<h2 id="例題長方形の面積"><a class="header" href="#例題長方形の面積">【例題】長方形の面積</a></h2>
<h3 id="問題"><a class="header" href="#問題">問題</a></h3>
<p>長方形の長辺<code>a</code>(mm，自然数)と短辺<code>b</code>(mm，自然数)が入力されると面積(mm2，自然数)を出力する関数<code>calculateArea()</code>関数を作成してください．</p>
<p>入力される値（a, b）は必ず自然数であるものとし，自然数以外の値が入力される場合を考慮する必要はない（以降の問題でも同様）．</p>
<pre><code class="language-js">function calculateArea(a, b) {
  // ここに処理を記述！
}

console.log(calculateArea(2, 5)); // 10
console.log(calculateArea(10, 10)); // 100
</code></pre>
<h3 id="回答例"><a class="header" href="#回答例">回答例</a></h3>
<p>下記のように記述して動作確認を行い，想定している値が出力されていれば OK！</p>
<pre><code class="language-js">function calculateArea(a, b) {
  return a * b;
}

console.log(calculateArea(2, 5)); // 10
console.log(calculateArea(10, 10)); // 100
</code></pre>
<p>上記の要領で関数を作成しよう( ` ･ω･)b</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="数の比較"><a class="header" href="#数の比較">数の比較</a></h2>
<p>整数の入力値<code>a</code>と<code>b</code>を比較し大きい方の値を出力する<code>compareNumbers()</code>関数を作成してください．a と b が等しい場合は<code>eq</code>と出力して下さい．</p>
<pre><code class="language-js">function compareNumbers(a, b) {}

console.log(compareNumbers(2, 5)); // 5
console.log(compareNumbers(10, 9)); // 10
console.log(compareNumbers(2, 2)); // eq
</code></pre>
<h2 id="単位の計算"><a class="header" href="#単位の計算">単位の計算</a></h2>
<p>距離<code>n</code>とその単位<code>s</code>が入力されるので，すべての距離を<code>mm</code>に換算し数値で出力する<code>convertToMm()</code>関数を作成してください．</p>
<p>入力される距離の単位は km, m, cm の 3 種類で，それぞれ以下のように換算出来ます．</p>
<ul>
<li>1km = 1000 m</li>
<li>1m = 100 cm</li>
<li>1cm = 10 mm</li>
</ul>
<pre><code class="language-js">function convertToMm(n，s) {

}

console.log(convertToMm(1, 'km'));    // 1000000
console.log(convertToMm(54, 'km'));   // 54000000
console.log(convertToMm(2, 'cm'));    // 20
</code></pre>
<h2 id="奇数か偶数か"><a class="header" href="#奇数か偶数か">奇数か偶数か</a></h2>
<p>正の整数<code>n</code>が入力されるので，<code>n</code>奇数ならば<code>odd</code>偶数ならば<code>even</code>と出力する<code>oddOrEven()</code>関数を作成してください．</p>
<pre><code class="language-js">function oddOrEven(n) {}

console.log(oddOrEven(4)); // even
console.log(oddOrEven(5)); // odd
console.log(oddOrEven(2)); // even
</code></pre>
<h2 id="西暦の計算"><a class="header" href="#西暦の計算">西暦の計算</a></h2>
<p>2 つの西暦<code>a</code>と<code>b</code>を入力し，<code>a</code>から<code>b</code>が何年間あるか出力する<code>calculateYears()</code>関数を作成してください（<code>a &lt; b</code>とする）．</p>
<pre><code class="language-js">function calculateYears(a, b) {}

console.log(calculateYears(1990, 2014)); // 24
console.log(calculateYears(1999, 2000)); // 1
console.log(calculateYears(794, 1192)); // 398
</code></pre>
<h2 id="何番目"><a class="header" href="#何番目">何番目？</a></h2>
<p>以下のような A〜Z (半角英字大文字) の中から 1 文字入力されます．</p>
<p>ABCDEFGHIJKLMNOPQRSTUVWXYZ
A を 1 番目としてアルファベット順で何番目かを出力する<code>judgeTh()</code>関数を作成してください．</p>
<p>例えば<code>C</code>を入力した場合は<code>3</code>と出力して下さい．</p>
<pre><code class="language-js">function judgeTh(c) {}

console.log(judgeTh(&quot;C&quot;)); // 3
console.log(judgeTh(&quot;X&quot;)); // 24
</code></pre>
<h2 id="絶対値"><a class="header" href="#絶対値">絶対値</a></h2>
<p><code>-100</code>から<code>100</code>までの整数<code>n</code>が与えられるので，絶対値を出力する<code>getAbs()</code>関数を作成してください．</p>
<pre><code class="language-js">function getAbs(n) {}

console.log(getAbs(-10)); // 10
console.log(getAbs(15)); // 15
console.log(getAbs(0)); // 0
</code></pre>
<h2 id="割り算"><a class="header" href="#割り算">割り算</a></h2>
<p>整数<code>m</code>と<code>n</code>を入力し，<code>m</code>を<code>n</code>で割り算した商と余りを半角スペース区切りの文字列で出力する<code>getQuotientAndSurplus()</code>関数を作成してください．</p>
<pre><code class="language-js">function getQuotientAndSurplus(m, n) {}

console.log(getQuotientAndSurplus(10, 3)); // 3 1
console.log(getQuotientAndSurplus(12, 14)); // 0 12
</code></pre>
<h2 id="小文字を大文字に"><a class="header" href="#小文字を大文字に">小文字を大文字に</a></h2>
<p>半角アルファベットの小文字で構成された長さ<code>n</code>の文字列<code>s</code>が与えられます．</p>
<p>文字列<code>s</code>を大文字に変換して出力する<code>convertToUppercase()</code>関数を作成してください．</p>
<pre><code class="language-js">function convertToUppercase(s) {}

console.log(convertToUppercase(&quot;gsacademy&quot;)); // GSACADEMY
console.log(convertToUppercase(&quot;abcdefghijklmnopqrstuvwxyz&quot;)); // ABCDEFGHIJKLMNOPQRSTUVWXYZ
</code></pre>
<h2 id="掛け算のリスト"><a class="header" href="#掛け算のリスト">掛け算のリスト</a></h2>
<p>正の整数 1 から 9 に整数 n をそれぞれを掛けた数を半角スペース区切りで出力する関数<code>createList()</code>関数を作成してください．</p>
<p>例えば n=2 の場合は</p>
<p><code>2 4 6 8 10 12 14 16 18</code></p>
<p>となります．</p>
<pre><code class="language-js">function createList(n) {}

console.log(createList(2)); // 2 4 6 8 10 12 14 16 18
console.log(createList(3)); // 3 6 9 12 15 18 21 24 27
console.log(createList(5)); // 5 10 15 20 25 30 35 40 45
</code></pre>
<h2 id="等差数列"><a class="header" href="#等差数列">等差数列</a></h2>
<p>以下のような数列を考えます．</p>
<p><code>5 8 11 14 17 20 23 26 29 32</code></p>
<p>最初の数字が 5 で，3 ずつ増加していく事がわかります．
一般的にこれを初項 5，公差 3 の等差数列といいます．</p>
<p>このような数列を出力するプログラムを作りましょう．</p>
<p>初項<code>m</code>と公差<code>n</code>が入力し，10 番目までの数字をスペース区切りで出力する<code>createSequence()</code>関数を作成してください．</p>
<pre><code class="language-js">function createSequence(m, n) {}

console.log(createSequence(3, 3)); // 3 6 9 12 15 18 21 24 27 30
console.log(createSequence(5, 10)); // 5 15 25 35 45 55 65 75 85 95
console.log(createSequence(1, 3)); // 1 4 7 10 13 16 19 22 25 28
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="カウントダウン"><a class="header" href="#カウントダウン">カウントダウン</a></h2>
<p>正整数<code>n</code>が入力されるので，<code>n</code>から 1 まで 1 ずつカウントダウンする<code>countDown()</code>関数を作成してください．</p>
<p>例えば</p>
<p><code>3</code></p>
<p>と入力された場合</p>
<p><code>3 2 1</code></p>
<p>と出力してください．</p>
<pre><code class="language-js">function countDown(n) {}

console.log(countDown(3)); // 3 2 1
console.log(countDown(10)); // 10 9 8 7 6 5 4 3 2 1
</code></pre>
<h2 id="n-文字目まで出力"><a class="header" href="#n-文字目まで出力">N 文字目まで出力</a></h2>
<p>半角アルファベットで構成された文字列<code>s</code>と正の整数<code>n</code>入力されます．</p>
<p>1 文字目から<code>n</code>文字目までを出力する<code>getOneToN()</code>関数を作成してください．</p>
<p>例えば</p>
<p><code>abcdefg</code>と<code>4</code></p>
<p>と入力された場合</p>
<p><code>abcd</code></p>
<p>と出力して下さい．</p>
<pre><code class="language-js">function getOneToN(s, n) {}

console.log(getOneToN(&quot;aabbccdd&quot;, 5)); // aabbc
console.log(getOneToN(&quot;gsacademyfukuoka&quot;, 9)); // gsacademy
</code></pre>
<h2 id="最大と最小"><a class="header" href="#最大と最小">最大と最小</a></h2>
<p>5 個の数字 <code>n_1</code>, <code>n_2</code>, <code>n_3</code>, <code>n_4</code>, <code>n_5</code> が半角スペース区切りで与えられます．</p>
<p>それらの数字の最大の数字，最小の数字を半角スペース区切りで出力する<code>getMaxAndMin()</code>関数を作成してください．</p>
<p>例えば</p>
<p><code>9 12 3 6 10</code></p>
<p>と入力された場合</p>
<p><code>12 3</code></p>
<p>と出力してください．</p>
<pre><code class="language-js">function getMaxAndMin(s) {}

console.log(getMaxAndMin(&quot;9 12 3 6 10&quot;)); // 12 3
console.log(getMaxAndMin(&quot;1 1 2 2 3&quot;)); // 3 1
console.log(getMaxAndMin(&quot;5 9 -1 10 2&quot;)); // 10 -1
</code></pre>
<h2 id="文字列から-n-番目"><a class="header" href="#文字列から-n-番目">文字列から N 番目</a></h2>
<p>半角アルファベット文字列<code>s</code>と整数<code>n</code>が入力されます．</p>
<p>文字列<code>s</code>の 1 番左の文字を 1 文字目とし<code>n</code>文字目のアルファベットを出力する<code>getNthChar()</code>関数を定義してください．</p>
<p>例えば</p>
<p><code>gsacademy</code>と<code>3</code></p>
<p>と入力された場合</p>
<p><code>a</code></p>
<p>と出力して下さい．</p>
<pre><code class="language-js">function getNthChar(s, n) {}

console.log(getNthChar(&quot;gsacademy&quot;, 3)); // a
console.log(getNthChar(&quot;abcdefg&quot;, 5)); // e
console.log(getNthChar(&quot;qwertyu&quot;, 1)); // q
</code></pre>
<h2 id="文字列の一致"><a class="header" href="#文字列の一致">文字列の一致</a></h2>
<p>文字列<code>s</code>と文字列<code>t</code>が半角スペース区切りで入力されます．</p>
<p><code>s</code>と<code>t</code>が完全一致していれば「Yes」，それ以外は「No」と出力する<code>isEqual()</code>関数を作成してください．</p>
<pre><code class="language-js">function isEqual(s, t) {}

console.log(isEqual(&quot;gsacademy&quot;, &quot;gsacademy&quot;)); // Yes
console.log(isEqual(&quot;JavaScript&quot;, &quot;ジャバスク&quot;)); // No
console.log(isEqual(&quot;aaaaa&quot;, &quot;aaaaaa&quot;)); // No
</code></pre>
<h2 id="a-の個数"><a class="header" href="#a-の個数">A の個数</a></h2>
<p>半角アルファベットで構成された文字列<code>s</code>が与えられます．</p>
<p><code>s</code>に含まれる半角アルファベット「A」の数を出力する<code>getNumberOfA()</code>関数を作成してください．</p>
<pre><code class="language-js">function getNumberOfA(s) {}

console.log(getNumberOfA(&quot;GSACADEMY&quot;)); // 2
console.log(getNumberOfA(&quot;aAaAaA&quot;)); // 3
console.log(getNumberOfA(&quot;JavaScript&quot;)); // 0
</code></pre>
<h2 id="表面積の計算"><a class="header" href="#表面積の計算">表面積の計算</a></h2>
<p>立方体の体積を求めましょう．</p>
<p>一辺の長さ<code>a</code>が入力されるので，立方体の表面積を出力する<code>getSurfaceArea()</code>関数を作成してください．</p>
<pre><code class="language-js">function getSurfaceArea(a) {}

console.log(getSurfaceArea(4)); // 96
console.log(getSurfaceArea(1)); // 6
</code></pre>
<h2 id="三角形の内角の和"><a class="header" href="#三角形の内角の和">三角形の内角の和</a></h2>
<p>平面上の三角形の 2 つの角の角度<code>a</code>, <code>b</code>を入力し，残りの 1 つの角の角度を出力する<code>getAngle()</code>関数を作成してください．</p>
<pre><code class="language-js">function getAngle(a, b) {}

console.log(getAngle(30, 90)); // 60
console.log(getAngle(45, 45)); // 90
</code></pre>
<h2 id="数字の出力"><a class="header" href="#数字の出力">数字の出力</a></h2>
<p>ある正の整数<code>n</code>（最大 2 桁）が入力されます．</p>
<p><code>n</code>を 0 埋め 3 桁で出力する<code>zeroPadding3()</code>関数を作成してください．</p>
<p>例えば以下のような入力の場合</p>
<p><code>98</code></p>
<p>以下のように出力して下さい</p>
<p><code>098</code></p>
<pre><code class="language-js">function zeroPadding3(n) {}

console.log(zeroPadding3(98)); // 098
console.log(zeroPadding3(2)); // 002
</code></pre>
<h2 id="一週間の予定"><a class="header" href="#一週間の予定">一週間の予定</a></h2>
<p>あなたは 1 週間を全て休みにするために有給を申請することにしました．もともと決まっている休みもあります．</p>
<p>半角スペース区切りで 7 日間の休みが，休みならば「yes」，休みでなければ「no」と入力されます．</p>
<p>有給申請しなくては行けない日数を出力する<code>getPaidHolidays()</code>関数を作成してください．</p>
<pre><code class="language-js">function getPaidHolidays(s) {}

console.log(getPaidHolidays(&quot;yes yes yes yes no no yes&quot;)); // 2
console.log(getPaidHolidays(&quot;yes no no no no no yes&quot;)); // 5
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="n-までの和"><a class="header" href="#n-までの和">n までの和</a></h2>
<p>ある 2 以上の整数<code>n</code>が与えられます．</p>
<p>1 から<code>n</code>までの和を出力する<code>getSum()</code>関数を作成してください．</p>
<pre><code class="language-js">function getSum(n) {}

console.log(getSum(10)); // 55
console.log(getSum(99)); // 4950
</code></pre>
<h2 id="数字の桁数"><a class="header" href="#数字の桁数">数字の桁数</a></h2>
<p>ある 10 進数の正の整数<code>n</code>が与えられます．</p>
<p><code>n</code>が何桁かを数字で出力する<code>getNumberOfDigits()</code>関数を作成してください．</p>
<pre><code class="language-js">function getNumberOfDigits(n) {}

console.log(getNumberOfDigits(100)); // 3
console.log(getNumberOfDigits(114514)); // 6
</code></pre>
<h2 id="サイコロの裏面"><a class="header" href="#サイコロの裏面">サイコロの裏面</a></h2>
<p>一般的な 6 面サイコロの目を表す整数<code>n</code>に対し，その裏側にある目を出力する<code>getBackSide()</code>関数を作成してください．</p>
<pre><code class="language-js">function getBackSide(n) {}

console.log(getBackSide(1)); // 6
console.log(getBackSide(3)); // 4
</code></pre>
<h2 id="単位の変換"><a class="header" href="#単位の変換">単位の変換</a></h2>
<p>ある正の整数<code>n</code>が入力されます．</p>
<p><code>n</code>分から秒へ変換する<code>convertToSeconds()</code>関数を作成してください．</p>
<pre><code class="language-js">function convertToSeconds(n) {}

console.log(convertToSeconds(16)); // 960
console.log(convertToSeconds(3)); // 180
</code></pre>
<h2 id="充電時間"><a class="header" href="#充電時間">充電時間</a></h2>
<p>1 分間で 1%の充電が可能なスマートフォンの充電器があります．</p>
<p>現在のスマートフォンのバッテリーの残量<code>n</code>%からこの充電器で 100%まで充電するのに何分かかるかを求める<code>getTimeUntilFull()</code>関数を作成してください．</p>
<pre><code class="language-js">function getTimeUntilFull(n) {}

console.log(getTimeUntilFull(70)); // 30
console.log(getTimeUntilFull(25)); // 75
</code></pre>
<h2 id="頭文字"><a class="header" href="#頭文字">頭文字</a></h2>
<p>あなたは半角アルファベットの苗字と名前からそれぞれ 1 文字目を取りイニシャルを作ることにしました．</p>
<p>半角スペース区切りで苗字と名前が入力されるので，1 文字目を取り &quot;.&quot; (半角ドット)で区切った文字列を出力する<code>getInitialFromName()</code>関数を作成してください．</p>
<pre><code class="language-js">function getInitialFromName(s) {}

console.log(getInitialFromName(&quot;Dio Brando&quot;)); // D.B
console.log(getInitialFromName(&quot;Pannacotta Fugo&quot;)); // P.F
console.log(getInitialFromName(&quot;Gyro Zeppeli&quot;)); // G.Z
</code></pre>
<h2 id="どれにしようかな"><a class="header" href="#どれにしようかな">どれにしようかな</a></h2>
<p>あなたはレストランで何を注文しようか迷っています．しかしあまり時間がないので「どれにしようかな天の神様の言うとおり」で决めてしまいましょう．</p>
<p>メニューの数<code>n</code>を入力し，選ばれた 1 から<code>n</code>までの数の一つを出力する<code>choiceOfGod()</code>関数を作成してください．</p>
<p>選ばれるメニューはこの文字数 21 を迷っているメニューの数で割れば求められます．ただし余りが 0 となるときはそのメニューの中で最後のものが選ばれることに注意しましょう．</p>
<pre><code class="language-js">function choiceOfGod(n) {}

console.log(choiceOfGod(4)); // 1
console.log(choiceOfGod(3)); // 3
</code></pre>
<h2 id="日付のデータ"><a class="header" href="#日付のデータ">日付のデータ</a></h2>
<p>スペース区切りで西暦<code>y</code>，月<code>m</code>，日<code>d</code>が入力されます．</p>
<p><code>/</code>区切りで文字列として出力する<code>formatYMD()</code>関数を作成してください．</p>
<p>ただし，西暦は 4 桁，月と日は 2 桁で出力しましょう．</p>
<pre><code class="language-js">function formatYMD(s) {}

console.log(formatYMD(&quot;2021 1 1&quot;)); // 2021/01/01
console.log(formatYMD(&quot;2020 10 10&quot;)); // 2020/10/10
console.log(formatYMD(&quot;794 11 29&quot;)); // 0794/11/29
</code></pre>
<h2 id="アットマーク"><a class="header" href="#アットマーク">アットマーク</a></h2>
<p>半角小文字アルファベットで構成された文字列<code>s</code>が入力されます．</p>
<p>文字列<code>s</code>の中に含まれる<code>at</code>という文字列を全て<code>@</code>(アットマークに)置換して出力する<code>convertAtToAtMark()</code>関数を作成してください．</p>
<pre><code class="language-js">function convertAtToAtMark(s) {}

console.log(convertAtToAtMark(&quot;gsatcodeatquantity&quot;)); // gs@code@quantity
console.log(convertAtToAtMark(&quot;atatatjojoatatat&quot;)); // @@@jojo@@@
</code></pre>
<h2 id="花粉症でつらい"><a class="header" href="#花粉症でつらい">花粉症でつらい</a></h2>
<p>あなたは花粉症でティッシュを毎日使っては買いに行くのを繰り返していましたが，必要なティッシュ箱の数を計算し一気に注文しようと考えました．</p>
<p>ティッシュ 1 箱が空になるまでの期間を<code>m</code>日，残りの花粉症の季節を<code>n</code>日が入力されるので，花粉症の季節が終わるまでに必要なティッシュ箱の数を求める<code>getNeedBox()</code>関数を作成してください．</p>
<pre><code class="language-js">function getNeedBox(m, n) {}

console.log(getNeedBox(7, 30)); // 5
console.log(getNeedBox(3, 100)); // 34
console.log(getNeedBox(7, 5)); // 1
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="本棚選び"><a class="header" href="#本棚選び">本棚選び</a></h2>
<p>あなたは新しい本棚を買おうと検討しています．そこで，既に持っている本の幅などから収まるか概算することにしました．</p>
<p>持っている本の幅を合計したもの<code>n</code>(cm)，検討している本棚の段数<code>d</code>，本が収まる幅<code>e</code>(cm)がそれぞれ半角スペース区切りで入力し，本が収まるかどうかを<code>OK</code>または<code>NG</code>で出力する<code>canStoreBooks()</code>関数を作成してください．</p>
<p>概算なので本それぞれの違い 1 段に収まるかは考えないことにします．</p>
<p>例えば，本の幅を合計したものが 400(cm)，検討している本棚の段数が 5，本が収まる幅が 85 (cm)の場合は以下の様な入力になり，</p>
<p><code>400 5 85</code></p>
<p>各段の幅を合計したものは 85 かける 5 で 425(cm)となり，400(cm)の本は収まるので以下のように出力して下さい．</p>
<p><code>OK</code></p>
<p>収まらない場合は<code>NG</code>を出力してくだだい．</p>
<pre><code class="language-js">function canStoreBooks(s) {}

console.log(canStoreBooks(&quot;400 5 85&quot;)); // OK
console.log(canStoreBooks(&quot;500 4 70&quot;)); // NG
</code></pre>
<h2 id="試合の回数"><a class="header" href="#試合の回数">試合の回数</a></h2>
<p>あなたは 1 対 1 で戦う競技の大会を開くことにしました．</p>
<p><code>n</code>人の選手で総当り対戦を行う場合，対戦の回数を出力する<code>calculateNumberOfGames()</code>関数を作成してください．</p>
<p>総当り戦では<code>n</code>人がそれぞれ自分自身以外と対戦します．</p>
<pre><code class="language-js">function calculateNumberOfGames(n) {}

console.log(calculateNumberOfGames(4)); // 6
console.log(calculateNumberOfGames(10)); // 45
</code></pre>
<h2 id="連休の天気"><a class="header" href="#連休の天気">連休の天気</a></h2>
<p>あなたは 7 日間の連休をもらいましたが，降水確率が 30%以下ならば外に出掛ける事に決めました．</p>
<p>7 日間の降水確率(%)が半角スペース区切りで入力されるので，出掛ける日数の合計を出力する<code>daysOfGoOut()</code>関数を作成してください．</p>
<pre><code class="language-js">function daysOfGoOut(s) {}

console.log(daysOfGoOut(&quot;13 0 15 30 89 100 30&quot;)); // 5
console.log(daysOfGoOut(&quot;0 14 18 22 0 2 4&quot;)); // 7
console.log(daysOfGoOut(&quot;99 99 99 99 99 99 99&quot;)); // 0
</code></pre>
<h2 id="正三角形かどうか"><a class="header" href="#正三角形かどうか">正三角形かどうか</a></h2>
<p>あなたは，3 つの辺の長さが分かっている三角形が正三角形なのかを判別しようとしています．</p>
<p>3 つの辺の長さ a, b, c が半角スペース区切りで与えられるので正三角形なら<code>YES</code>, 正三角形でなければ<code>NO</code>と出力する<code>isEquilateralTriangle()</code>関数を作成してください．</p>
<pre><code class="language-js">function isEquilateralTriangle(s) {}

console.log(isEquilateralTriangle(&quot;10 10 10&quot;)); // yes
console.log(isEquilateralTriangle(&quot;3 4 5&quot;)); // No
</code></pre>
<h2 id="天気の表示"><a class="header" href="#天気の表示">天気の表示</a></h2>
<p>あなたは 0% 〜 100%の降水確率を得て，その数値から天気を文字列で表示をしようと考えました．</p>
<p>表示のルールは以下のよう定めました．</p>
<ul>
<li>降水確率が 0 % 以上 30 % 以下ならば<code>sunny</code></li>
<li>降水確率が 31 % 以上 70 % 以下ならば<code>cloudy</code></li>
<li>降水確率が 71 % 以上ならば<code>rainy</code></li>
</ul>
<p>降水確率<code>n</code>(%)が与えられるので上のルールに従って文字列を出力する<code>showWeather()</code>関数を作成してください．</p>
<pre><code class="language-js">function showWeather(n) {}

console.log(showWeather(31)); // cloudy
console.log(showWeather(2)); // sunny
console.log(showWeather(71)); // rainy
</code></pre>
<h2 id="はじめまして"><a class="header" href="#はじめまして">はじめまして</a></h2>
<p>はじめましてのあいさつをしましょう．</p>
<p>名前が文字列<code>s1</code>で，性別が文字列<code>s2</code>(男性は<code>M</code>, 女性は<code>F</code>) で与えられます．
これに対し，男性なら<code>Hi, Mr.〇〇(名前)</code>と，女性なら<code>Hi, Ms.〇〇(名前)</code>と出力する<code>greet()</code>関数を作成してください．</p>
<pre><code class="language-js">function greet(s1, s2) {}

console.log(greet(&quot;Stroheim&quot;, &quot;M&quot;)); // Hi, Mr.Stroheim
console.log(greet(&quot;Trish&quot;, &quot;F&quot;)); // Hi, Ms.Trish
</code></pre>
<h2 id="通知票"><a class="header" href="#通知票">通知票</a></h2>
<p>ジーズ中学校ではこれまで 5~1 の数字で成績をつけていましたが，英語教育に力を入れるため今年度から A~E のアルファベットで成績をつけることにしました．</p>
<p>すでに成績を数字でつけてしまったあなたはあわててアルファベットに変換することにしました．</p>
<p>【変換ルール】</p>
<ul>
<li>5 -&gt; A</li>
<li>4 -&gt; B</li>
<li>3 -&gt; C</li>
<li>2 -&gt; D</li>
<li>1 -&gt; E</li>
</ul>
<p>5 教科について数字の評価が入力されるので，アルファベットの評価を出力する<code>convertNumberToAlphabet()</code>関数を作成してください．</p>
<pre><code class="language-js">function convertNumberToAlphabet(s) {}

console.log(convertNumberToAlphabet(&quot;53342&quot;)); // ACCBD
console.log(convertNumberToAlphabet(&quot;22222&quot;)); // DDDDD
console.log(convertNumberToAlphabet(&quot;51111&quot;)); // AEEEE
</code></pre>
<h2 id="不思議なタマゴ"><a class="header" href="#不思議なタマゴ">不思議なタマゴ</a></h2>
<p>持ったまま一定の距離を歩くと孵化する不思議なタマゴ（1km, 2km, 5km）があります．</p>
<p>あなたはこのタマゴをなるべくいっぺんに孵化させようと思い，3 つをまとめて持っていくことにしました．</p>
<p>これらをすべて孵化させるのに最低限必要な歩行距離を求める<code>getNumberOfSteps()</code>関数を作成してください．</p>
<pre><code class="language-js">function getNumberOfSteps(s) {}

console.log(getNumberOfSteps(&quot;1 2 5&quot;)); // 5
console.log(getNumberOfSteps(&quot;2 5 5&quot;)); // 5
console.log(getNumberOfSteps(&quot;1 2 1&quot;)); // 2
</code></pre>
<h2 id="台風の間隔"><a class="header" href="#台風の間隔">台風の間隔</a></h2>
<p>あなたは気象庁のデータ分析の担当者で，8 月の台風の上陸の間隔についてのデータを作るよう求められました．</p>
<p>サンプルとなる 5 個の台風について上陸した日が与えられるので，それぞれ (2 個目以降) について直前の上陸日との間隔日数を出力する<code>getInterval()</code>関数を作成してください．</p>
<pre><code class="language-js">function getInterval(s) {}

console.log(getInterval(&quot;5 8 19 25 31&quot;)); // 3 11 6 6
console.log(getInterval(&quot;2 3 7 9 28&quot;)); // 1 4 2 19
</code></pre>
<h2 id="-の秋"><a class="header" href="#-の秋">◯◯ の秋</a></h2>
<p>あなたは，「わたしの秋は ◯◯ の秋」というアンケートの集計を任されました．</p>
<p>アンケートの回答はまちまちで，「◯◯ の秋」と書く人もいれば「◯◯」の部分だけ書く人もいます．これでは不便なのでまず「◯◯」の部分だけを取り出す<code>getAutumn()</code>関数を作成してください．</p>
<pre><code class="language-js">function getAutumn(s) {}

console.log(getAutumn(&quot;codenoaki&quot;)); // code
console.log(getAutumn(&quot;dokusyo&quot;)); // dokusyo
console.log(getAutumn(&quot;javascriptnoaki&quot;)); // javascript
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="お月見だんご"><a class="header" href="#お月見だんご">お月見だんご</a></h2>
<p>あなたはお月見の準備をしています．子供 2 人にいくつお月見だんごがほしいかをたずねますが，やんちゃな子は明らかに食べきれない数のだんごを要求してきます．</p>
<p>付き合いきれないのであなたは 5 より大きい数字を要求された場合には 5 個しか与えないことにしました．もちろん 5 以下の場合にはその数のだんごを与えます．</p>
<p>必要なだんごの数を求める<code>getNumberOfDango()</code>関数を作成してください．</p>
<pre><code class="language-js">function getNumberOfDango(s) {}

console.log(getNumberOfDango(&quot;3 50&quot;)); // 8
console.log(getNumberOfDango(&quot;100 500&quot;)); // 10
console.log(getNumberOfDango(&quot;2 4&quot;)); // 6
</code></pre>
<h2 id="衣替え"><a class="header" href="#衣替え">衣替え</a></h2>
<p>そろそろ衣替えのシーズンです．冬服をしまって夏服を出しましょう．</p>
<p>10 着の服に関してそれが夏物か冬物かの情報が与えられるので，その半分 (5 着) 以上が夏物になっているかどうか (なっていれば<code>OK</code>，なっていなければ<code>NG</code>) を判定する<code>isReadyForSummer()</code>関数を作成してください．</p>
<pre><code class="language-js">function isReadyForSummer(s) {}

console.log(isReadyForSummer(&quot;W W W W W S S S S S&quot;)); // OK
console.log(isReadyForSummer(&quot;S S W W S W W W W W&quot;)); // NG
console.log(isReadyForSummer(&quot;W S S S S S S S S W&quot;)); // OK
</code></pre>
<h2 id="ピラミッドの作り方"><a class="header" href="#ピラミッドの作り方">ピラミッドの作り方</a></h2>
<p>あなたのクラスでは，運動会の出し物で人間ピラミッドをやることになりました．段数<code>n</code>のピラミッドを組むのに必要な人数を求める<code>getNumberOfHuman()</code>関数を作成してください．</p>
<p>【例】</p>
<p>ピラミッドの段数: 5 段</p>
<p>1 + 2 + 3 + 4 + 5 = 15</p>
<p>→ 必要な人数: 15 人</p>
<pre><code class="language-js">function getNumberOfHuman(n) {}

console.log(getNumberOfHuman(4)); // 10
console.log(getNumberOfHuman(10)); // 55
console.log(getNumberOfHuman(50)); // 1275
</code></pre>
<h2 id="トリックオアトリート"><a class="header" href="#トリックオアトリート">トリック・オア・トリート</a></h2>
<p>Trick or Treat! ハロウィーンのシーズンです．あなたの子供はわがままなのでお菓子といってもキャンディかチョコレートでないと満足してくれません．</p>
<p>文字列が与えられるので，これが<code>candy</code>か<code>chocolate</code>であれば<code>Thanks!</code>，その他の場合は <code>No!</code>という子供のリアクションを出力する<code>candyOrChocolate()</code>関数を作成してください．</p>
<pre><code class="language-js">function candyOrChocolate(s) {}

console.log(candyOrChocolate(&quot;chocolate&quot;)); // Thanks!
console.log(candyOrChocolate(&quot;candy&quot;)); // Thanks!
console.log(candyOrChocolate(&quot;pannacotta&quot;)); // No!
</code></pre>
<h2 id="1111"><a class="header" href="#1111">11/11</a></h2>
<p>今日はみんなで棒状のチョコレートお菓子を持ち寄るパーティーをします．このお菓子が合計で 11 本以上あればパーティーが開催できます．</p>
<p>このお菓子の 1 本は数字の<code>1</code>で表され，本数分だけ<code>1</code>が連続する文字列が与えられるので，パーティーが開催できれば<code>OK</code>，できなければ必要な本数を出力する<code>canParty()</code>関数を作成してください．</p>
<p>【例】</p>
<ul>
<li>
<p>111111111111 → 12 ≧ 11 本なので OK</p>
</li>
<li>
<p>1111111 → 7 &lt; 11 本なので NG，あと 11 - 7 = 4 本必要</p>
</li>
</ul>
<pre><code class="language-js">function canParty(s) {}

console.log(canParty(&quot;11111111111&quot;)); // OK
console.log(canParty(&quot;1111&quot;)); // 7
console.log(canParty(&quot;1111111111111111&quot;)); // OK
</code></pre>
<h2 id="ワインのキャッチコピー"><a class="header" href="#ワインのキャッチコピー">ワインのキャッチコピー</a></h2>
<p>あなたはあるワインの銘柄のマーケティングを担当しています．良いキャッチコピーを考えるため，とりあえず「〜の中で最高」というフレーズを色々作ってみることにしました．</p>
<p>2 つの文字列が与えられるので，&quot;Best in&quot; とそれらの文字列をすべて半角スペース区切りで結合して出力する<code>bestCopy()</code>関数を作成してください．</p>
<p>【例】</p>
<ul>
<li>hundred years → Best in hundred years</li>
<li>the universe → Best in the universe</li>
</ul>
<pre><code class="language-js">function bestCopy(s) {}

console.log(bestCopy(&quot;a decade&quot;)); // Best in a decade
console.log(bestCopy(&quot;the world&quot;)); // Best in the world
console.log(bestCopy(&quot;history ever&quot;)); // Best in history ever
</code></pre>
<h2 id="ガチャ期待値計算"><a class="header" href="#ガチャ期待値計算">ガチャ期待値計算</a></h2>
<p>あなたがプレイしているゲームで推しキャラが実装されたので，予算と相談して引ける確率を算出したいと思いました．</p>
<p>推しキャラの当選確率<code>n</code>（%）と試行回数<code>t</code>（数値）を入力し，1 回以上推しを引ける確率（%）を出力する<code>probabilityGetSSR()</code>関数を作成してください．</p>
<p>なお，出力する確率の小数点以下は四捨五入してください．</p>
<pre><code class="language-js">function probabilityGetSSR(n, t) {}

console.log(probabilityGetSSR(1, 100)); // 63
console.log(probabilityGetSSR(1.5, 70)); // 65
console.log(probabilityGetSSR(1, 200)); // 87
</code></pre>
<h2 id="調理計画"><a class="header" href="#調理計画">調理計画</a></h2>
<p>今日は夕食当番です．コードをギリギリまで書かなければならないので，夕食の準備を開始する時間を決めたいと考えました．</p>
<p>夕食の時間<code>s</code>（hh:mm）と調理に要する時間<code>t</code>（分）を入力し，調理開始時間を出力する<code>getStartTimeForCook()</code>関数を作成してください．</p>
<pre><code class="language-js">function getStartTimeForCook(s, t) {}

console.log(getStartTimeForCook(&quot;19:00&quot;, 90)); // 17:30
console.log(getStartTimeForCook(&quot;20:00&quot;, 20)); // 19:40
console.log(getStartTimeForCook(&quot;20:30&quot;, 80)); // 19:10
</code></pre>
<h2 id="しかたないから全角にしてやるか"><a class="header" href="#しかたないから全角にしてやるか">しかたないから全角にしてやるか</a></h2>
<p>システム改修中，全角数字しか入らないデータベースを発見しました．</p>
<p>ユーザから送信された 7 桁の郵便番号を全て全角に変換して出力する<code>convertToUppercase()</code>関数を作成してください．</p>
<pre><code class="language-js">function convertToUppercase(s) {}

console.log(convertToUppercase(&quot;1234567&quot;)); // １２３４５６７
console.log(convertToUppercase(&quot;1111111&quot;)); // １１１１１１１
console.log(convertToUppercase(&quot;1145140&quot;)); // １１４５１４０
</code></pre>
<h2 id="リストラ計画"><a class="header" href="#リストラ計画">リストラ計画</a></h2>
<p>チューターを解雇することになりました．現在のチューターのリストと解雇したいチューターのリストが入力されるので，残存するチューターを半角スペース区切りで出力する<code>fireEmployees()</code>関数を作成してください．</p>
<pre><code class="language-js">function fireEmployees(employees, fireEmployees) {}

console.log(
  fireEmployees(
    &quot;Jotaro Joseph Avdol Polnareff Tenmei Iggy&quot;,
    &quot;Avdol Tenmei Iggy&quot;
  )
); // Jotaro Joseph Polnareff
console.log(
  fireEmployees(
    &quot;Giorno Bucciarati Abbacchio Mista Narancia Fugo Trish&quot;,
    &quot;Bucciarati Abbacchio Narancia&quot;
  )
); // Giorno Mista Fugo Trish
console.log(
  fireEmployees(
    &quot;Jolyne Ermes Emporio F・F Weather Anasui&quot;,
    &quot;Jolyne Ermes F・F Weather Anasui&quot;
  )
); // Emporio
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="プロフィールの表示"><a class="header" href="#プロフィールの表示">プロフィールの表示</a></h2>
<p>人事局長のあなたは，毎年行われる新入社員の自己紹介が面倒なので自動化するシステムをつくることにしました．</p>
<p>名前<code>name</code>，年齢<code>age</code>，性別<code>gender</code>が記載されたオブジェクトを入力すると，プロフィールを出力する<code>outputProfile()</code>関数を作成してください．</p>
<p>プロフィールの形式は「彼/彼女の名前は<code>name</code>で<code>age</code>歳です」とします．彼/彼女は gender によって区別されるものとします．</p>
<p>3 項目揃っていない場合は「情報がありません」と出力してください．</p>
<pre><code class="language-js">function outputProfile(obj) {}
const taro = {
  name: &quot;Taro&quot;,
  age: 25,
  gender: &quot;male&quot;,
};

console.log(outputProfile(taro)); //彼の名前はTaroで25歳です

const hanako = {
  name: &quot;Hanako&quot;,
  age: 30,
  gender: &quot;female&quot;,
};

console.log(outputProfile(hanako)); // 彼女の名前はHanakoで30歳です

const hatena = {
  name: &quot;hatena&quot;,
  age: 20,
};

console.log(outputProfile(hatena)); //  情報がありません
</code></pre>
<h2 id="お買い物リスト"><a class="header" href="#お買い物リスト">お買い物リスト</a></h2>
<p>配列でつくられた買い物リストがあります．</p>
<p>買い物に出かけようとしたタイミングで新たにリストに追加しましたが，バグで別の配列に入ってしまいました．</p>
<p>二つの配列を合わせた新しい配列を出力する<code>combineArray()</code>関数を作成してください．</p>
<pre><code class="language-js">function combineArray(a, b) {}

const abc = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];
const def = [&quot;d&quot;, &quot;e&quot;, &quot;f&quot;];

console.log(combineArray(abc, def)); //[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;]

const gen = [&quot;米&quot;, &quot;トイレットペーパー&quot;, &quot;ちゅーる&quot;, &quot;酒&quot;];
const yui = [&quot;洗剤&quot;, &quot;肉&quot;, &quot;ブロッコリー&quot;];

console.log(combineArray(gen, yui)); // [&quot;米&quot;, &quot;トイレットペーパー&quot;, &quot;ちゅーる&quot;, &quot;酒&quot;, &quot;洗剤&quot;, &quot;肉&quot;, &quot;ブロッコリー&quot;]
</code></pre>
<h2 id="成績を晒す"><a class="header" href="#成績を晒す">成績を晒す</a></h2>
<p>あなたが勤務する学校で小テストを行いました．成績の悪い生徒を晒したく，テストのスコアが悪い順に出力するプログラムを作成しましょう．</p>
<p>テストの点数は半角スペース区切りで入力されるため，点数が低い順に半角スペース区切りで出力する<code>createBadScoreArray()</code>関数を作成してください．</p>
<pre><code class="language-js">function createBadScoreArray(a) {}

console.log(createBadScoreArray(&quot;15 8 9 100 26 1&quot;)); // 1 8 9 15 26 100

console.log(createBadScoreArray(&quot;50 15 89 5 61 2 44&quot;)); // 2 5 15 44 50 61 89
</code></pre>
<h2 id="特定の文字列を含むか"><a class="header" href="#特定の文字列を含むか">特定の文字列を含むか</a></h2>
<p>文字列の中に，特定の文字列が含まれているかの判定を出力する<code>containStrings()</code>関数を作成してください．</p>
<p>含まれている場合は「<code>true</code>」含まれていない場合は「<code>false</code>」と出力することとします．</p>
<pre><code class="language-js">function containStrings(str1, str2) {}

const a = &quot;あけましておめでとうございます&quot;;
const b = &quot;おめでとう&quot;;

console.log(containStrings(a, b)); // true

const c = &quot;Love the life you live. Live the life you love.&quot;;
const d = &quot;best&quot;;

console.log(containStrings(c, d)); // false
</code></pre>
<h2 id="アンケートデータの作成"><a class="header" href="#アンケートデータの作成">アンケートデータの作成</a></h2>
<p>名前と年齢を入力するアンケートを作成しました．回答データを扱いやすくするため，一つのオブジェクトにまとめたデータを作成したいと考えました．</p>
<p>入力データ（名前と年齢）からこれら 2 つ（<code>name</code>, <code>age</code>）をキーとしたオブジェクトを出力する<code>createObject()</code>関数を作成してください．</p>
<pre><code class="language-js">function createObject(a, b) {}

console.log(createObject(&quot;ichiro&quot;, 20)); // { name: &quot;ichiro&quot;, age: 20, }
console.log(createObject(&quot;momoko&quot;, 22)); // { name: &quot;momoko&quot;, age: 22, }
</code></pre>
<h2 id="ランダムに挨拶"><a class="header" href="#ランダムに挨拶">ランダムに挨拶</a></h2>
<p>プロジェクトのチャットツールで挨拶をすることになりました．</p>
<p>いろいろな国や地域から参加者がいるため，時差などを考慮した挨拶を考えるのが面倒なのでランダムに出力してお茶を濁すことにしました．</p>
<p>予め決めた挨拶を入力すると，ランダムに一つの挨拶を出力する<code>randomGreet()</code>関数を作成してください．</p>
<pre><code class="language-js">function randomGreet(a, b, c) {}
console.log(randomGreet(&quot;おはよう&quot;, &quot;こんにちは&quot;, &quot;こんばんは&quot;)); // おはようorこんにちはorこんばんは
console.log(randomGreet(&quot;Hi!&quot;, &quot;Hello!&quot;, &quot;Bye!&quot;)); // Hi! or Hello! or Bye!
</code></pre>
<h2 id="オブジェクトの並び替え"><a class="header" href="#オブジェクトの並び替え">オブジェクトの並び替え</a></h2>
<p>膨大な顧客データの中から，条件に当てはまる顧客のリストをつくっています．</p>
<p>リストは並び順が適当なので，管理番号が若い順に並び替えたリストに直しましょう．</p>
<p>管理番号<code>id</code>，名前<code>name</code>，年齢<code>age</code>を定義するオブジェクト obj を入力すると，<code>id</code>の順番で並び替えたメンバーの一覧を出力する<code>sortObject()</code>関数を作成してください．一人のデータは<code>id:name(age)</code>形式となるようにし，<code>,</code>で区切った文字列にすること．</p>
<pre><code class="language-js">function sortObject(obj) {}

const objectArray1 = [
  {
    id: 8,
    name: &quot;Emily&quot;,
    age: 29,
  },
  {
    id: 1,
    name: &quot;John&quot;,
    age: 22,
  },
  {
    id: 4,
    name: &quot;Bob&quot;,
    age: 30,
  },
];

console.log(sortObject(objectArray1)); // 1:John(22),4:Bob(30),8:Emily(29)

const objectArray2 = [
  {
    id: 10,
    name: &quot;taro&quot;,
    age: 29,
  },
  {
    id: 112,
    name: &quot;hanako&quot;,
    age: 22,
  },
  {
    id: 40,
    name: &quot;pochi&quot;,
    age: 3,
  },
];

console.log(sortObject(objectArray2)); // 10:taro(29),40:pochi(3),112:hanako(22)
</code></pre>
<h2 id="名前しかいらん"><a class="header" href="#名前しかいらん">名前しかいらん</a></h2>
<p>顧客リストを作成する仕事を任されました．完成させて上司に提出したところ，「名前しかいらん」と言われました．</p>
<p>これまでに作成した顧客リストを活用したいので，これらのデータから名前だけを抽出しましょう．</p>
<p>管理番号<code>id</code>，名前<code>name</code>，年齢<code>age</code>，を定義するオブジェクトを入力して，名前のみの配列を出力する<code>createNameArray()</code>関数を作成してください．</p>
<pre><code class="language-js">function createNameArray(array) {}

const objectArray3 = [
  {
    id: 8,
    name: &quot;Emily&quot;,
    age: 29,
  },
  {
    id: 1,
    name: &quot;John&quot;,
    age: 22,
  },
  {
    id: 4,
    name: &quot;Bob&quot;,
    age: 30,
  },
];

console.log(createNameArray(objectArray3)); // [&quot;John&quot;, &quot;Emily&quot;, &quot;Bob&quot;]

const objectArray4 = [
  {
    id: 10,
    name: &quot;taro&quot;,
    age: 29,
  },
  {
    id: 112,
    name: &quot;hanako&quot;,
    age: 22,
  },
  {
    id: 40,
    name: &quot;pochi&quot;,
    age: 3,
  },
];
console.log(createNameArray(objectArray4)); // [&quot;pochi&quot;, &quot;hanako&quot;, &quot;taro&quot;]
</code></pre>
<h2 id="メール一斉送信"><a class="header" href="#メール一斉送信">メール一斉送信</a></h2>
<p>顧客リストの中から，25 歳以下のメンバーにメールの一斉送信を行う仕事を任されました．</p>
<p>管理番号<code>id</code>，名前<code>name</code>，年齢<code>age</code>を定義するオブジェクトを引数として，25 歳未満のメンバーの<code>id</code>が入った配列を出力する<code>filterUnder25Array()</code>関数を作成してください．</p>
<pre><code class="language-js">function filterUnder25Array(array) {}

const objectArray5 = [
  {
    id: 8,
    name: &quot;Emily&quot;,
    age: 29,
  },
  {
    id: 1,
    name: &quot;John&quot;,
    age: 22,
  },
  {
    id: 4,
    name: &quot;Bob&quot;,
    age: 30,
  },
];

console.log(filterUnder25Array(objectArray5)); // [1]

const objectArray6 = [
  {
    id: 10,
    name: &quot;taro&quot;,
    age: 29,
  },
  {
    id: 112,
    name: &quot;hanako&quot;,
    age: 22,
  },
  {
    id: 40,
    name: &quot;pochi&quot;,
    age: 3,
  },
];

console.log(filterUnder25Array(objectArray6)); // [112, 40]
</code></pre>
<h2 id="予算オーバー"><a class="header" href="#予算オーバー">予算オーバー</a></h2>
<p>EC サイトで買い物をした商品がカートに入っています．このサイトはバグを抱えており，合計金額がユーザに表示されません．</p>
<p>カートの中身から合計金額を算出し，今回の予算<code>¥114514</code>に収まるかどうかを判断しましょう．</p>
<p>カート内の情報を入力すると商品の価格<code>price</code>合計が予算に収まるかどうかを<code>true</code>または<code>false</code>で出力する<code>canTakeThis()</code>関数を作成してください．</p>
<p>カートには商品が複数入る場合（<code>count</code>の値）がある点に注意しましょう．</p>
<pre><code class="language-js">function canTakeThis(arr) {}
const tarosCart = [
  {
    id: 8,
    name: &quot;Yoich&quot;,
    price: 5800,
    count: 2,
  },
  {
    id: 1,
    name: &quot;Yamasaki30&quot;,
    price: 3000000,
    count: 1,
  },
  {
    id: 4,
    name: &quot;Chita&quot;,
    price: 3600,
    count: 1,
  },
];

console.log(canTakeThis(tarosCart)); // false

const hanakosCart = [
  {
    id: 10,
    name: &quot;ひまわり&quot;,
    price: 280,
    count: 3,
  },
  {
    id: 112,
    name: &quot;かすみ草&quot;,
    price: 220,
    count: 2,
  },
  {
    id: 40,
    name: &quot;ガーベラ&quot;,
    price: 110,
    count: 5,
  },
];
console.log(canTakeThis(hanakosCart)); // true
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="トランプ占い"><a class="header" href="#トランプ占い">トランプ占い</a></h2>
<p>著名な占い師であるあなたはとある国の大統領から占いを依頼されました．正しい占いをしたいところですが，この大統領は気難しいのであまり悪い結果を伝えるのはためらわれます．</p>
<p>占いの結果はトランプカード&quot;J&quot;, &quot;Q&quot;, &quot;K&quot;の 2 枚 1 組で表れます．</p>
<p>もし結果が「最悪」を表す&quot;J&quot;2 枚になってしまったときには片方（2 枚目） を&quot;Q&quot;に変更する<code>divinationCheat()</code>関数を作成してください．</p>
<pre><code class="language-js">function divinationCheat(s) {}

console.log(divinationCheat(&quot;K Q&quot;)); // K Q
console.log(divinationCheat(&quot;J Q&quot;)); // J Q
console.log(divinationCheat(&quot;J J&quot;)); // J Q
</code></pre>
<h2 id="a-ボタンと-b-ボタン"><a class="header" href="#a-ボタンと-b-ボタン">A ボタンと B ボタン</a></h2>
<p>あなたは A のボタン， B のボタンの 2 つのボタンを使うゲームを作っています．</p>
<p>このゲームではキャラクターを動かして遊びます．キャラクターははじめ座標 0 の位置にいて，A のボタンを押すとキャラクターが 1 マス右に進み（座標が 1 増える）， B のボタンを押すとキャラクターが 1 マス左に進み （座標が 1 減る） ます．</p>
<p>A, B のボタンそれぞれ何回押したが入力されるので，ボタンが全て押された後のキャラクターの位置の座標を出力する<code>placeCount()</code>関数を作成してください．</p>
<pre><code class="language-js">function placeCount(s) {}

console.log(placeCount(&quot;3 4&quot;)); // -1
console.log(placeCount(&quot;80 44&quot;)); // 36
</code></pre>
<h2 id="3-倍返し"><a class="header" href="#3-倍返し">3 倍返し？</a></h2>
<p>バレンタインデーも終わり，あなたはホワイトデーにいくつチョコレートを用意すればよいかを計算するプログラムを作ることにしました．</p>
<p>もらったチョコレートが 1 つ以上であればその 3 倍の数を， 0 個であれば自分用に 1 つだけ用意することにしましょう...</p>
<p>もらった個数<code>n</code>が入力されるので，お返しの数を出力する<code>deathWhiteDay()</code>関数を作成してください．</p>
<pre><code class="language-js">function deathWhiteDay(n) {}

console.log(deathWhiteDay(1)); // 3
console.log(deathWhiteDay(99)); // 297
console.log(deathWhiteDay(0)); // 1
</code></pre>
<h2 id="leet-文字列"><a class="header" href="#leet-文字列">Leet 文字列</a></h2>
<p>Leet と呼ばれるインターネットスラングがあります．</p>
<p>Leet ではいくつかのアルファベットをよく似た形の他の文字に置き換えて表記します．
Leet の置き換え規則はたくさんありますが，ここでは次の置き換え規則のみを考えましょう．</p>
<table><thead><tr><th align="center">置き換え前</th><th align="center">置き換え後</th></tr></thead><tbody>
<tr><td align="center">A</td><td align="center">4</td></tr>
<tr><td align="center">E</td><td align="center">3</td></tr>
<tr><td align="center">G</td><td align="center">6</td></tr>
<tr><td align="center">I</td><td align="center">1</td></tr>
<tr><td align="center">O</td><td align="center">0</td></tr>
<tr><td align="center">S</td><td align="center">5</td></tr>
<tr><td align="center">Z</td><td align="center">2</td></tr>
</tbody></table>
<p>文字列が入力されるので，これを Leet に変換して出力する<code>convertLeet()</code>関数を作成してください．</p>
<pre><code class="language-js">function convertLeet(s) {}

console.log(convertLeet(&quot;ALANTURING&quot;)); // 4L4NTUR1N6
console.log(convertLeet(&quot;GSACADEMY&quot;)); // 654C4D3MY
</code></pre>
<h2 id="完全数とほぼ完全数"><a class="header" href="#完全数とほぼ完全数">完全数とほぼ完全数</a></h2>
<p>N を 2 以上の整数とし，N の約数のうち N 自身を除いたものの和を S とします． このとき</p>
<ul>
<li>N = S となるような N を完全数</li>
<li>|N-S| = 1 となるような N をほぼ完全数</li>
</ul>
<p>と言うことにしましょう．ここで，|N-S| は N-S の絶対値を意味します．</p>
<p>たとえば，N = 28 のとき，28 の約数は 1, 2, 4, 7, 14, 28 なので，S = 1+2+4+7+14 = 28 となります．従って，28 は完全数です．</p>
<p>また，N = 16 のときには S = 1+2+4+8 = 15 となるので，16 はほぼ完全数です．</p>
<p>入力された整数が完全数かほぼ完全数かそのいずれでもないかを判定する<code>isPerfectNumber()</code>関数を作成してください．</p>
<p>判定は以下のとおりとします．</p>
<table><thead><tr><th align="center">完全数</th><th align="center">ほぼ完全数</th><th align="center">それ以外</th></tr></thead><tbody>
<tr><td align="center">perfect</td><td align="center">nearly</td><td align="center">neither</td></tr>
</tbody></table>
<pre><code class="language-js">function isPerfectNumber(s) {}

console.log(isPerfectNumber(&quot;28 16 777&quot;)); // perfect nearly neither
console.log(isPerfectNumber(&quot;3 4 5 6&quot;)); // neither nearly neither perfect
</code></pre>
<h2 id="単語テストの採点"><a class="header" href="#単語テストの採点">単語テストの採点</a></h2>
<p>英単語のテストの採点ではどこまでをスペルミスとみなしてどこまでを別の単語とみなすかが悩みどころです．</p>
<p>そこでジーズ予備校では以下の様な採点基準を導入してこれに従って厳密に採点することにしています．</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>正解の単語と完全一致</td><td>◯ 2 点</td></tr>
<tr><td>正解の単語と長さ（文字数）が異なる</td><td>× 0 点</td></tr>
<tr><td>正解の単語と長さは同じだが 1 文字だけ異なる</td><td>△ 1 点</td></tr>
<tr><td>正解の単語と長さは同じだが 2 文字以上異なる</td><td>× 0 点</td></tr>
</tbody></table>
<p>ここで「文字が異なる」とは，同じ位置にある文字が異なるということを意味しています．</p>
<p>【例】</p>
<table><thead><tr><th>正解</th><th>回答</th><th>点数</th></tr></thead><tbody>
<tr><td>apple</td><td>aple</td><td>0 点 (長さが異なる)</td></tr>
<tr><td>orange</td><td>olange</td><td>1 点 (長さは同じだが 1 文字だけ異なる)</td></tr>
<tr><td>grape</td><td>glepe</td><td>0 点 (長さは同じだが 2 文字異なる)</td></tr>
<tr><td>lemon</td><td>lemon</td><td>2 点 (完全一致)</td></tr>
</tbody></table>
<p>合計得点 → 3 点</p>
<p>問題数と各問題の正解の単語および生徒の解答が与えられるので，このような形でジーズ予備校の採点基準に従いこの生徒の合計得点を算出する関数を<code>calculatePoint()</code>作成してください．</p>
<p>正解と回答を半角スペースで区切ったものを 1 セットとし，各セットがカンマ区切りで入力されます．</p>
<pre><code class="language-js">function calculatePoint() {}

console.log(calculatePoint(&quot;apple aple,orange olange,grape glepe,lemon lemon&quot;)); // 3
console.log(
  calculatePoint(
    &quot;january januarry,february febrary,march march,april aplil,may may,june june,july jury,august ougust,september septenber,october october,november novembar,december dicembar&quot;
  )
); // 13
</code></pre>
<h2 id="先生の宿題"><a class="header" href="#先生の宿題">先生の宿題</a></h2>
<p>あなたは小学校一年生の先生です．今週の授業で，足し算と引き算を教えます．</p>
<p>あなたは，足し算と引き算を用いた宿題を作る必要があり，そのためのプログラムを書くことにしました．</p>
<p>以下の手順で問題をランダム生成するプログラムはもうできているのですが，その答えを求めるプログラムはまだできていません．</p>
<p>【問題生成の手順】</p>
<ol>
<li>正しい式 a + b = c, あるいは a - b = c (a, b, c, は整数) を生成する</li>
<li>a, b, c のうちいずれか 1 つを空欄にする</li>
</ol>
<p>この空欄に入れるべき整数が「答え」となります．</p>
<p>式を入力したら式中の x で表した答えを出力する<code>getAnswer()</code>関数を作成してください．</p>
<pre><code class="language-js">function getAnswer() {}

console.log(getAnswer(&quot;1 + 3 = x&quot;)); // 4
console.log(getAnswer(&quot;6 - x = 3&quot;)); // 3
console.log(getAnswer(&quot;x - 1 = 5&quot;)); // 6
</code></pre>
<h2 id="アニメの日時"><a class="header" href="#アニメの日時">アニメの日時</a></h2>
<p>深夜アニメの放送開始時刻は，しばしば &quot;時&quot; を表す部分の数字が 24 以上になることを許容し次のように表記することがあります．</p>
<p><code>01/27 24:30</code></p>
<p>この日付を &quot;時&quot; の部分が 0 以上 23 以下になるような表記で，</p>
<p><code>01/28 00:30</code></p>
<p>と表すことができます．</p>
<p>前者の表記方法は時として便利ではありますが，実際に放送される &quot;日&quot; が知りたい場合は後者のほうが便利です．</p>
<p>そこで，日時が与えられるので，&quot;時&quot; の部分が 0 以上 23 以下になるように修正した日時を出力する<code>formatHour()</code>関数を作成してください．</p>
<p>ただし，&quot;時&quot; を修正した結果，日がその月に存在しない日になった場合でも月を調整することなくそのまま出力してください．もしかすると，この関数が使われる世界ではそのような日付が存在するかもしれないからです．</p>
<pre><code class="language-js">function formatHour() {}

console.log(formatHour(&quot;01/27 24:30&quot;)); // 01/28 00:30
console.log(formatHour(&quot;02/31 73:59&quot;)); // 02/34 01:59
console.log(formatHour(&quot;12/31 00:00&quot;)); // 12/31 00:00
console.log(formatHour(&quot;12/31 25:01&quot;)); // 12/32 01:01
</code></pre>
<h2 id="コーヒー割引キャンペーン"><a class="header" href="#コーヒー割引キャンペーン">コーヒー割引キャンペーン</a></h2>
<p>あなたがよく利用しているコーヒーショップは本日限定であるサービスを行っています．</p>
<ul>
<li><code>x</code>円のコーヒーをお買い上げした際に，次のお買い上げの値段を更に<code>p</code>% off!</li>
<li>毎回の値下げにおいて小数点以下切り捨て</li>
</ul>
<p>あなたは値下げが累積する事に目をつけました．</p>
<p>コーヒーを何回も飲んでいれば，タダでコーヒーを飲めるようになるのです．</p>
<p>タダで頼みたいあなたは，何円払えば以後タダで注文できるのか計算したくなりました．</p>
<p>コーヒーの価格<code>x</code>と割引率<code>p</code>を入力して無料になるまでの支払い総額を出力する<code>getCostForFreeCoffee()</code>関数を作成してください．</p>
<p><code>x</code>と<code>p</code>はこの順番に半角スペース区切りで入力されます．</p>
<pre><code class="language-js">function getCostForFreeCoffee() {}

console.log(getCostForFreeCoffee(&quot;300 50&quot;)); // 596
console.log(getCostForFreeCoffee(&quot;1000 99&quot;)); // 1010
</code></pre>
<h2 id="エレベーター"><a class="header" href="#エレベーター">エレベーター</a></h2>
<p>あなたはジーズアカデミーの用務員として，校舎に備え付けのエレベーターを管理しています．</p>
<p>エレベーターが一定の距離を動くと，定期点検をしなければなりません．</p>
<p>エレベーターの動きのログをもとに、エレベーターが何階分の距離を動いたか計算する<code>getElevatorMove()</code>関数を作成してください．</p>
<p>ただし，エレベーターは最初は必ず 1 階にいるものとします．</p>
<pre><code class="language-js">function getElevatorMove() {}

console.log(getElevatorMove(&quot;3 1 4&quot;)); // 7
console.log(getElevatorMove(&quot;17 28 11 62 64 4 7 17&quot;)); // 170
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h2 id="ゾロ目の日付"><a class="header" href="#ゾロ目の日付">ゾロ目の日付</a></h2>
<p>11 月 11 日が迫るある日，あなたはゾロ目の日付を判定するプログラムを作成することにしました．</p>
<p>ゾロ目の日とはある日付に対して月と日に含まれる全ての桁の数字が同じものを指します．
スペース区切りで月と日が与えられるのでゾロ目の日であれば<code>Yes</code>そうでなければ<code>No</code>と出力する<code>isSingleNumber()</code>関数を作成してください．</p>
<p>例えば入力例 1 では 11 月 1 日が以下のように与えられます．</p>
<p><code>11 1</code></p>
<p>この場合，月と日ともに 1 のゾロ目なので</p>
<p><code>Yes</code></p>
<p>と出力して下さい．</p>
<pre><code class="language-js">function isSingleNumber(s) {}

console.log(isSingleNumber(&quot;11 1&quot;)); // Yes
console.log(isSingleNumber(&quot;11 11&quot;)); // Yes
console.log(isSingleNumber(&quot;12 11&quot;)); //  No
</code></pre>
<h2 id="花見の準備"><a class="header" href="#花見の準備">花見の準備</a></h2>
<p>あなたはお花見の準備のためにレジャーシートを買うことにしました．</p>
<p>レジャーシートの質に興味のないあなたは最も面積あたりの価格の安いレジャーシートを探すため，プログラムを書くことにしました．</p>
<p>2 つのレジャーシートの横の長さ<code>x</code>, 縦の長さ<code>y</code>, 価格<code>p</code> がスペース区切りで与えられます．1 つ目のレジャーシートのデータと 2 つ目のレジャーシートのデータはカンマ区切りとなります．</p>
<p>最も面積あたりの価格の安いレジャーシートの<code>x</code>, <code>y</code>, <code>p</code>をスペース区切りで出力する<code>judgeCheapSheet()</code>関数を作成してください．
ただし，面積あたりの価格が同じ場合は<code>DRAW</code>と出力してください．</p>
<pre><code class="language-js">function judgeCheapSheet(s) {}

console.log(judgeCheapSheet(&quot;5 18 1000,12 21 3000&quot;)); // 5 18 1000
console.log(judgeCheapSheet(&quot;5 5 1800,5 10 3600&quot;)); // DRAW
</code></pre>
<h2 id="下一桁はいくつ"><a class="header" href="#下一桁はいくつ">下一桁はいくつ</a></h2>
<p>あなたは 5 つの数字を足し算するプログラムを作成しています．しかし，出力したい数字は下一桁のみです．</p>
<p>5 つの数字がスペース区切りで入力されるので，全てを足した結果の下一桁を出力する<code>getLastNumber()</code>関数を作成してください．</p>
<p>例えば以下のような入力の場合</p>
<p><code>1 9 8 9 12</code></p>
<p>足すと 39 となりますが<code>9</code>と下一桁のみ出力します．</p>
<pre><code class="language-js">function getLastNumber(s) {}

console.log(getLastNumber(&quot;1 9 8 9 12&quot;)); // 9
console.log(getLastNumber(&quot;1 1 1 1 6&quot;)); // 0
</code></pre>
<h2 id="門松の作成"><a class="header" href="#門松の作成">門松の作成</a></h2>
<p>あなたはお正月に向けて門松を作ることにしました．門松は 3 本の竹からなり，それぞれ竹の長さは<code>3:5:7</code>の比率で作る習わしとなっています．</p>
<p>最も短い竹の長さが与えられるので， 3 本の竹に切断し門松を作るために必要な竹の長さを出力する<code>getAllLength()</code>関数を作成してください．この時切断面は竹に対して垂直に切られるものとします．</p>
<pre><code class="language-js">function getAllLength(n) {}

console.log(getAllLength(60)); // 300
console.log(getAllLength(9)); // 45
</code></pre>
<h2 id="禁止ワード"><a class="header" href="#禁止ワード">禁止ワード</a></h2>
<p>あなたは禁止ワードが含まれるかどうかを判定するプログラムを作成しています．</p>
<p>禁止ワード<code>w</code>と判定する文字列<code>s</code>が改行区切りで順に与えられるので<code>s</code>に<code>w</code>が含まれている時は<code>NG</code>それ以外の場合は文字列<code>s</code>をそのまま出力する<code>hasNgWord()</code>関数を作成してください．</p>
<pre><code class="language-js">function hasNgWord(s) {}

console.log(hasNgWord(&quot;ngword thisisngword&quot;)); // NG
console.log(hasNgWord(&quot;ngword gsprogramming&quot;)); // gsprogramming
</code></pre>
<h2 id="洗濯物と砂ぼこり"><a class="header" href="#洗濯物と砂ぼこり">洗濯物と砂ぼこり</a></h2>
<p>あなたは洗濯物を干すかどうか，その日の気温と湿度で決めることにしました．</p>
<p>暖かくて乾燥してる日を選んで干したいところですが，家の向には公園があり，そういった日は砂ぼこりが舞ってしまいます．</p>
<p>そこであなたは干すためのルールを決めました．</p>
<p>気温が 25℃ 以上の日，もしくは湿度が 40%以下の日は干します．それ以外の日は干しません．
ただし，上記の干す条件を満たす日のうち，気温が 25℃ 以上かつ，湿度 40%以下の日は砂ぼこりが舞うので干しません．</p>
<p>その日の気温と湿度が与えられるので，干すかどうか判断（<code>Yes</code>か<code>No</code>を出力）する<code>canDry()</code>関数を作成してください．</p>
<pre><code class="language-js">function canDry(s) {}

console.log(canDry(&quot;25 50&quot;)); // Yes
console.log(canDry(&quot;10 20&quot;)); // Yes
console.log(canDry(&quot;20 50&quot;)); // No
</code></pre>
<h2 id="カード並べ"><a class="header" href="#カード並べ">カード並べ</a></h2>
<p>フライト中に退屈してしまったあなたは，持っているトランプを使用した簡単な遊びを考えました．</p>
<p>この遊びでは 1 から 9 までの数字のカードのみを 4 枚使用します．
ただし，この 4 枚の中で同じ数値のカードが重複する事もあります．</p>
<p>ルールは以下の通りです．</p>
<p>4 枚のカードを横に並べます．
左から 2 枚のカード，右から 2 枚のカードをそれぞれ 2 ケタの整数とみなし，和を計算します．
あらゆる並べ方を試し，和の最大値（最大スコア）を求めます．</p>
<p>カード 4 枚に書かれた数が与えられるので，最大スコアを出力する<code>getBestScore()</code>関数を作成してください．
入力例 1 の 2, 9, 3, 8 の 4 枚を使う場合，最大値 175 が最大スコアとなります．</p>
<pre><code class="language-js">function getBestScore(s) {}

console.log(getBestScore(&quot;2 9 3 8&quot;)); // 175
console.log(getBestScore(&quot;7 8 7 7&quot;)); // 164
</code></pre>
<h2 id="ログのフィルター"><a class="header" href="#ログのフィルター">ログのフィルター</a></h2>
<p>あなたはサーバ管理者です． 日々洪水のように流れるログを追っています．</p>
<p>とうとう自分の目と頭では処理しきれない量になってしまったため，プログラムを作って，重要な文字列を含むログだけ抽出する事にしました．</p>
<p>重要な文字列とログ（半角スペース区切り文字列）がカンマ区切りで入力されるので，重要な文字列が入ったログのみを半角スペース区切りで出力する<code>filterLogByKeyword()</code>関数を作成してください．</p>
<p>ログ内に重要な文字列が含まれるデータがない場合な<code>None</code>と出力しましょう．</p>
<pre><code class="language-js">function filterLogByKeyword() {}

console.log(
  filterLogByKeyword(&quot;gs,gsacademytokyo javascript gsacademyfukuoka gsbase&quot;)
); // gsacademytokyo gsacademyfukuoka gsbase
console.log(
  filterLogByKeyword(&quot;script,javascript typescript googleappscript java&quot;)
); // javascript typescript googleappscript
console.log(
  filterLogByKeyword(
    &quot;dio,Giorno Bucciarati Abbacchio Mista Narancia Fugo Trish&quot;
  )
); // None
</code></pre>
<h2 id="メールアドレス認証"><a class="header" href="#メールアドレス認証">メールアドレス認証</a></h2>
<p>ある開発者はベータテストユーザーを，メールアドレス登録によって受け付けることにしました．その際，ユーザーのメールアドレスが有効なものなのかをチェックするプログラムが必要になります．</p>
<p>あるメールアドレスを受け取るので，それが正しいものであれば<code>true</code>を，そうでなければ<code>false</code>を返す<code>isValidEmail()</code>関数を作成してください．ここでの正しいアドレスというのは以下の 4 つの条件を満たすものを指します．</p>
<ul>
<li>「@」から始まらないこと</li>
<li>スペースがないこと</li>
<li>「@」を 1 つのみ含んでいること</li>
<li>「@」の後に「.」があること</li>
</ul>
<pre><code class="language-js">function isValidEmail() {}

console.log(isValidEmail(&quot;ccc@aaa.com&quot;)); // true
console.log(isValidEmail(&quot;c@cc@aaa.com&quot;)); // false
console.log(isValidEmail(&quot;cc c@aaa.com&quot;)); // false
console.log(isValidEmail(&quot;cc.c@aaacom&quot;)); // false
console.log(isValidEmail(&quot;cc.c@aaa.com&quot;)); // true
console.log(isValidEmail(&quot;@aaa.com&quot;)); // false
</code></pre>
<h2 id="フィボナッチ数列"><a class="header" href="#フィボナッチ数列">フィボナッチ数列</a></h2>
<p>自然界に多くみられる数列として，フィボナッチ数列という数列があります．フィボナッチ数列は以下の公式で表されます．</p>
<p>【フィボナッチ数列とは】</p>
<ul>
<li>f(0) = 0</li>
<li>f(1) = 1</li>
<li>f(n) = f(n-2) + f(n-1) (ただし，n &gt;= 2 であることが条件)</li>
</ul>
<p>【具体例】</p>
<ul>
<li>f(2) = 0 + 1 = 1</li>
<li>f(3) = 1 + 1 = 2</li>
<li>f(4) = 1 + 2 = 3</li>
<li>f(5) = 2 + 3 = 5</li>
</ul>
<p>ある青年は，手動で 50 番目まで計算したところで，この計算を手動で無限に続けるのは無理だと思い，これを 100 番目でも 10000 番目でも瞬時に計算できるプログラムを作りたいと考えました．</p>
<p>青年を助けるための<code>getFibonacciNth()</code>関数を作成してください．</p>
<p>数が大きくなると計算に時間を要するので，実装を工夫することをオススメします．</p>
<pre><code class="language-js">function getFibonacciNth() {}

console.log(getFibonacciNth(1)); // 1
console.log(getFibonacciNth(5)); // 5
console.log(getFibonacciNth(10)); // 55
console.log(getFibonacciNth(90)); // 2880067194370816120
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-事前準備"><a class="header" href="#php-事前準備">PHP 事前準備</a></h1>
<h2 id="サーバとクライアント"><a class="header" href="#サーバとクライアント">サーバとクライアント</a></h2>
<p>サーバで動作する言語（サーバサイド）</p>
<ul>
<li>web サーバ上でプログラムが実行される．</li>
<li>PHP, Ruby, Python, JAVA, (node.js), etc…</li>
</ul>
<p>クライアント（web ブラウザ）で動作する言語（クライアントサイド）</p>
<ul>
<li>web ブラウザでプログラムが実行される．</li>
<li>html, css, JavaScript</li>
</ul>
<p>=&gt;サーバサイド言語の開発にはサーバ上で動作させるアプリケーション（xampp など）が必要！</p>
<p>（自分の PC 上でサーバを動かすイメージ）</p>
<h2 id="サーバのしくみと-xampp-の役割"><a class="header" href="#サーバのしくみと-xampp-の役割">サーバのしくみと XAMPP の役割</a></h2>
<h3 id="サーバの役割及び構成"><a class="header" href="#サーバの役割及び構成">サーバの役割及び構成</a></h3>
<p>Web アプリケーションはクライアントとサーバの組み合わせで構成されている．</p>
<p>サーバには「アプリケーションサーバ」と「DB サーバ」が存在し，相互に連携することでアプリケーションを構築している．</p>
<p>（詳しい仕組みの理解は後からで OK．）</p>
<p><img src="php/php_setup/./img/php_file_about_server.svg" alt="サーバのしくみ" /></p>
<h3 id="サーバサイド言語での開発と-xampp-の役割"><a class="header" href="#サーバサイド言語での開発と-xampp-の役割">サーバサイド言語での開発と XAMPP の役割</a></h3>
<p>上記のとおり，PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身の PC で開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身の PC 内で擬似的なサーバを用意して PHP を動作させることができるのが「xampp」である．</p>
<p>xampp は以下の役割を提供する．</p>
<ul>
<li>PHP を動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php_setup/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="xampp-環境構築"><a class="header" href="#xampp-環境構築">XAMPP 環境構築</a></h2>
<h3 id="ダウンロード"><a class="header" href="#ダウンロード">ダウンロード</a></h3>
<p>下記 URL にアクセスする．</p>
<p><a href="https://www.apachefriends.org/jp/download.html">https://www.apachefriends.org/jp/download.html</a></p>
<blockquote>
<p><strong>！！注意！！</strong></p>
<p>資料作成時時点では<code>7.3.6 / PHP 7.3.6</code>となっているが，現時点（2021/09/12）では<code>8.0.9 / PHP 8.0.9</code>が最新なのでこちらを用いること！！</p>
<p>上記バージョンより新しいものが表示される場合は最新版をインストールしてください！</p>
</blockquote>
<p>↓ アクセス画面
<img src="php/php_setup/./img/php_setup_xampp_download_01.svg" alt="xamppダウンロード画面" /></p>
<p>Mac の人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_02.svg" alt="xamppダウンロード画面" /></p>
<p>Windows の人は下記からダウンロード．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_03.svg" alt="xamppダウンロード画面" /></p>
<h3 id="インストール"><a class="header" href="#インストール">インストール</a></h3>
<p>ダウンロードしたらインストールを進める．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_04.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認サーバ起動"><a class="header" href="#動作確認サーバ起動">動作確認（サーバ起動）</a></h3>
<p>インストールが済んだらアプリケーションを立ち上げる．</p>
<p>Mac の人は以下のようにサーバを起動させる．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_05.svg" alt="xamppダウンロード画面" /></p>
<p>Windows の人は以下の画面．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_download_06.svg" alt="xamppダウンロード画面" /></p>
<h3 id="動作確認画面表示"><a class="header" href="#動作確認画面表示">動作確認（画面表示）</a></h3>
<h4 id="アプリケーションサーバ動作確認"><a class="header" href="#アプリケーションサーバ動作確認">アプリケーションサーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/">https://localhost/</a>にアクセスして下記画面が表示されれば OK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_01.svg" alt="アプリケーションサーバ動作確認" /></p>
<h4 id="db-サーバ動作確認"><a class="header" href="#db-サーバ動作確認">DB サーバ動作確認</a></h4>
<p>ブラウザで<a href="https://localhost/phpmyadmin">https://localhost/phpmyadmin</a>にアクセスして下記画面が表示されれば OK．</p>
<p><img src="php/php_setup/./img/php_setup_xampp_confirm_02.svg" alt="DBサーバ動作確認" /></p>
<h2 id="まとめ"><a class="header" href="#まとめ">まとめ</a></h2>
<p>下記 3 点が実施できていることを確認しよう！</p>
<ul>
<li>XAMPP の起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-基礎"><a class="header" href="#php-基礎">PHP 基礎</a></h1>
<h2 id="サンプルコード-6"><a class="header" href="#サンプルコード-6">サンプルコード</a></h2>
<p><a href="php/php01/../../samples/06_php01_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-6"><a class="header" href="#本講義の内容とゴール-6">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-6"><a class="header" href="#本講義の内容-6">本講義の内容</a></h3>
<ul>
<li>Web アプリケーションの仕組み．</li>
<li>PHP の基本的な開発手順．</li>
<li>PHP を用いた簡単な処理の実装．</li>
</ul>
<h3 id="本講義のゴール-6"><a class="header" href="#本講義のゴール-6">本講義のゴール</a></h3>
<ul>
<li>Web アプリケーションの仕組みをと動きを把握する（大事）！</li>
<li>PHP（の開発手順）に慣れる！</li>
<li>PHP を用いたデータの送受信を通して，アプリケーションの動きをイメージする．</li>
</ul>
<h2 id="準備-1"><a class="header" href="#準備-1">準備</a></h2>
<p>以下 3 点ができているか確認しよう！</p>
<ul>
<li>XAMPP の起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-概要"><a class="header" href="#php-概要">PHP 概要</a></h1>
<h2 id="web-アプリケーションの仕組み動き方"><a class="header" href="#web-アプリケーションの仕組み動き方">Web アプリケーションの仕組み（動き方）</a></h2>
<p>Web アプリケーション（のソースコード）は世界のどこかにある「サーバ」に置かれている．</p>
<p><img src="php/php01/./img/php_file_web01.svg" alt="webの仕組み" /></p>
<p>Web アプリケーションを使用するときは，Web ブラウザに「URL」を指定する．</p>
<ul>
<li>Web ブラウザから「http」方式で URL に「リクエスト」を送る．</li>
<li>URL は Web 上にたくさんあるファイルを必ず 1 つ指定できるようになっている（ユニークな文字列）．</li>
</ul>
<p>URL の構造は下記のようになっている．</p>
<pre><code class="language-txt">https://www.emperor-crimson.com/data/status.php
  ^       ^                      ^      ^
  |       |                      |      |
scheme hostname（サーバ名）    directory filename
</code></pre>
<h2 id="サーバ---クライアント型のアプリケーション"><a class="header" href="#サーバ---クライアント型のアプリケーション">サーバ - クライアント型のアプリケーション</a></h2>
<h3 id="サーバで動作する言語サーバサイド"><a class="header" href="#サーバで動作する言語サーバサイド">サーバで動作する言語（サーバサイド）</a></h3>
<p>サーバ上でプログラムが実行される．</p>
<p><img src="php/php01/./img/php_web_server.svg" alt="サーバサイド言語の動き方" /></p>
<ul>
<li>PHP</li>
<li>Ruby</li>
<li>Python</li>
<li>JAVA</li>
<li>Node.js</li>
<li>etc...</li>
</ul>
<h3 id="クライアントweb-ブラウザで動作する言語クライアントサイド"><a class="header" href="#クライアントweb-ブラウザで動作する言語クライアントサイド">クライアント（web ブラウザ）で動作する言語（クライアントサイド）</a></h3>
<p><img src="php/php01/./img/php_web_client.svg" alt="クライアントサイド言語の動き方" /></p>
<p>web ブラウザがプログラムを実行する．</p>
<ul>
<li>HTML</li>
<li>CSS</li>
<li>JavaScript</li>
</ul>
<h2 id="サーバサイドの役割"><a class="header" href="#サーバサイドの役割">サーバサイドの役割</a></h2>
<p>様々な Web アプリケーションが存在するが，基本のサーバサイド処理は同様である．</p>
<p>基本の機能は何らかのデータを扱うことである．</p>
<h3 id="例-7"><a class="header" href="#例-7">例</a></h3>
<ul>
<li>twitter =&gt; ツイート，検索，タイムラインの表示，etc</li>
<li>facebook =&gt; 投稿，検索，記事の更新，コメント，etc</li>
<li>wordpress =&gt; ブログ記事の投稿，編集，削除，etc</li>
</ul>
<p>※：アプリケーションは必ずしも PHP で作られているわけではない！！</p>
<h3 id="-key-point-16"><a class="header" href="#-key-point-16">💡 Key Point</a></h3>
<blockquote>
<p>上記の処理は以下の 4 つに集約される．</p>
<ul>
<li>📝 データの「作成」（Create）</li>
<li>📖 データの「参照」（Read）</li>
<li>🔄 データの「更新」（Update）</li>
<li>🗑 データの「削除」（Delete）</li>
</ul>
</blockquote>
<p>これら 4 種類の処理の頭文字をとって「CRUD」と呼ぶ．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-基礎-1"><a class="header" href="#php-基礎-1">PHP 基礎</a></h1>
<h2 id="サーバサイド言語での開発"><a class="header" href="#サーバサイド言語での開発">サーバサイド言語での開発</a></h2>
<p>PHP（及び他のサーバサイド言語）を動作させるには「サーバ」が必要となる．</p>
<p>しかし，自身の PC で開発を行う場合に都度サーバを用意することは効率的ではない．</p>
<p>このような場合に自身の PC 内で擬似的なサーバを用意して PHP を動作させることができるのが「xampp」である．</p>
<p>xampp は以下の役割を提供する．</p>
<ul>
<li>PHP を動作させるアプリケーションサーバ（<code>Apatch web server</code>）を用意する．</li>
<li>データを保存するためのデータベース（<code>MySQL Database</code>）を用意する．</li>
<li>その他いろいろ（今回の開発では使用しない）．</li>
</ul>
<p><img src="php/php01/./img/php_file_about_xampp.svg" alt="xampp概要" /></p>
<h2 id="開発の手順"><a class="header" href="#開発の手順">開発の手順</a></h2>
<p>xampp は PC 内に<code>localhost</code>というサーバを用意してくれる．</p>
<p>このサーバ内に PHP ファイルを配置することで PHP のコードを動かすことができる．</p>
<p>PC 内では予め指定されたディレクトリ（<code>htdocs</code>）がサーバの役割をするよう決められているため，まず PHP ファイルを指定のディレクトリに配置する作業が必要となる．</p>
<p>サンプルフォルダを下記のディレクトリへ移動すると PHP を動かせる！</p>
<ul>
<li>windows : <code>C\xampp\htdocs\</code></li>
<li>mac : <code>/Applications/xampp/xamppfiles/htdocs/</code></li>
</ul>
<h2 id="便利な設定"><a class="header" href="#便利な設定">便利な設定</a></h2>
<ul>
<li><code>htdocs</code>はよく使うのでショートカットを用意しておくと便利！！</li>
<li><code>htdocs</code>内に講義用のフォルダを用意しておくと管理しやすい！</li>
<li><code>htdocs</code>内の<code>index.php</code>の名前を<code>index.php.old</code>に変更しておくとブラウザ画面から<code>htdocs</code>内のファイルが確認できて便利！！</li>
</ul>
<h3 id="-key-point-17"><a class="header" href="#-key-point-17">💡 Key Point</a></h3>
<blockquote>
<p><strong>【重要】開発の手順は以下の流れとなる．</strong></p>
<ol>
<li>xampp を起動する</li>
<li>php ファイルが入ったフォルダを htdocs に配置</li>
<li>vs code で htdocs の上記フォルダを開く</li>
<li>php のコードを書く</li>
<li>ブラウザで localhost にアクセスして動作確認</li>
</ol>
<p>以降，3-5 の繰り返し！</p>
<p>※一通り終わったら xampp を終了させることを推奨（次回起動でコケる）</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-基礎-2"><a class="header" href="#php-基礎-2">PHP 基礎</a></h1>
<h2 id="php-の記述"><a class="header" href="#php-の記述">PHP の記述</a></h2>
<p>PHP は「PHP ファイル」に記述する．</p>
<h3 id="php-ファイルの作成"><a class="header" href="#php-ファイルの作成">PHP ファイルの作成</a></h3>
<ul>
<li>拡張子を「<code>.php</code>」にする．</li>
<li>例：「<code>index.php</code>」「<code>create.php</code>」など．</li>
</ul>
<h3 id="開始タグと終了タグ"><a class="header" href="#開始タグと終了タグ">開始タグと終了タグ</a></h3>
<ul>
<li>「<code>&lt;?php</code>」で始まり「<code>?&gt;</code>」で終了（php しか書かない場合，終了タグは省略可）．</li>
<li>開始タグと終了タグの間に書かれた処理がサーバ上で実行される！</li>
<li>タグ以外の部分（HTML など記述した場合）はサーバでは実行されない（そのままソースコードがブラウザに送信される）．</li>
</ul>
<pre><code class="language-php">&lt;?php
// ここにPHPの処理を書く
// ...
?&gt;

// ここから下に書いたコードはサーバで実行されない
// （HTMLなどを書く）
</code></pre>
<h2 id="変数と文字列"><a class="header" href="#変数と文字列">変数と文字列</a></h2>
<p>変数の扱いは JavaScript と大きく変わらないが，以下の点に注意する．</p>
<ul>
<li>変数名は必ず「<code>$****</code>」←$で始めるルール！</li>
<li>文字列はシングルクォーテーションかダブルクォーテーションで囲む．</li>
<li><code>$</code>の次に数字は NG（JavaScript と同様）．</li>
<li><code>_</code>などの記号は OK．</li>
</ul>
<pre><code class="language-php">// 数値
$number = 100;

// 文字列
$name = 'engineer';

// 数値スタートはNG
$1lang = 'php';

// 後の数字はOK
$lang2 = 'javascript';

// 記号もOK
$_lang = 'Rust';
</code></pre>
<p>変数と文字列は「<code>.</code>」でつなげる．</p>
<p>ダブルクォーテーションを用いる場合は<code>{}</code>で変数を埋め込むことができる（JavaScript の<code>``</code>と<code>${}</code>に相当）．</p>
<pre><code class="language-php">$str1 = 'ジーズで' . $lang2 . 'を勉強中！';

// こっちのほうが楽かな．．！
$str2 = &quot;ジーズで{$lang2}を勉強中！&quot;;
</code></pre>
<h2 id="配列と連想配列"><a class="header" href="#配列と連想配列">配列と連想配列</a></h2>
<h3 id="配列-1"><a class="header" href="#配列-1">配列</a></h3>
<p>JavaScript と同様の形式．</p>
<p>データを確認する際には<code>echo</code>または<code>var_dump()</code>を用いる．</p>
<ul>
<li><code>echo</code>で値自体を出力する．</li>
<li><code>var_dump()</code>では配列などの構造も見られる．</li>
<li>デバッグの基本は<code>var_dump()</code>（JavaScript の<code>console.log()</code>的な）！！！</li>
</ul>
<pre><code class="language-php">// 配列
$array = ['JavaScript', 'PHP', 'Rust', 'COBOL'];

// `echo`で画面上にデータを表示できる．
echo $array[2]; // Rust

// 変数や配列の中身や構造を表示
var_dump($array);

</code></pre>
<h3 id="連想配列"><a class="header" href="#連想配列">連想配列</a></h3>
<p>連想配列は JavaScript における「オブジェクト」に相当する．</p>
<ul>
<li>「キー」「バリュー」のセット．</li>
<li>キー名を指定して値を取り出すことができる．</li>
</ul>
<pre><code class="language-php">// 連想配列
$array2 = [
  &quot;フロント&quot; =&gt; &quot;JavaScript&quot;,
  &quot;サーバ&quot; =&gt; &quot;PHP&quot;,
  &quot;iOS&quot; =&gt; &quot;Swift&quot;,
  &quot;関数型&quot; =&gt; &quot;Haskell&quot;
];

// キー名を指定して値を取り出す
echo $array2['サーバ'];
</code></pre>
<h2 id="条件分岐-2"><a class="header" href="#条件分岐-2">条件分岐</a></h2>
<p>条件分岐の構文は JavaScript と同様．</p>
<pre><code class="language-php">// 0から1のランダムな数を発生させる
$number = rand(0, 1);

// 1かそれ以外で条件分岐
if ($number == 1) {
  echo '値は1です';
} else {
  echo '値は1以外です';
}

</code></pre>
<p>条件分岐を使用したおみくじの例</p>
<pre><code class="language-php">// 1から5の乱数を作成
$random_number = rand(1, 5);

// 乱数の値で条件分岐
if ($random_number == 1) {
  $result =  '大吉';
} elseif ($random_number == ...) {
  $result = ...
} elseif (...) {
  // ...
}
echo $result;

</code></pre>
<h2 id="php-と-html-の組み合わせ"><a class="header" href="#php-と-html-の組み合わせ">PHP と HTML の組み合わせ</a></h2>
<p><code>echo</code>で処理結果を出力できるが，ブラウザに値が表示されるだけで気が利いていない．</p>
<p>そこで，PHP と HTML を組み合わせて画面を作成する機能を利用してみる．</p>
<ul>
<li>html 内に<code>&lt;?=変数名?&gt;</code>と記述することで PHP の変数を埋め込める．</li>
<li>PHP で処理した結果から HTML をつくるイメージ．</li>
</ul>
<pre><code class="language-php">&lt;?php
// いろいろな処理
$result = '大吉';
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;今日の運勢は&lt;?=$result?&gt;です！&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="-key-point-18"><a class="header" href="#-key-point-18">💡 Key Point</a></h3>
<blockquote>
<p>PHP と HTML が動く順序を把握しよう！</p>
<ol>
<li>PHP の処理が実行される．</li>
<li>処理の結果作成された値が HTML に埋め込まれ，HTML が完成する．</li>
<li>HTML のデータがブラウザに送信される．</li>
<li>ブラウザが HTML の内容を画面に表示する．</li>
</ol>
</blockquote>
<h2 id="php-の練習"><a class="header" href="#php-の練習">PHP の練習</a></h2>
<p><code>omikuji.php</code>におみくじの処理を作成し，HTML と組み合わせて画面に結果を表示しよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="クライアント---サーバ間の通信"><a class="header" href="#クライアント---サーバ間の通信">クライアント - サーバ間の通信</a></h1>
<h2 id="サーバへデータを送るとは"><a class="header" href="#サーバへデータを送るとは">サーバへデータを送る，とは？？</a></h2>
<p>html ファイルや php ファイルから別の php ファイルへデータを送る．
データを受け取った php ファイルが DB への保存などの処理を実行．</p>
<p>データ送信には以下の 2 種類が存在する．</p>
<ul>
<li>GET</li>
<li>POST</li>
</ul>
<p>どちらの場合も手順は同様．</p>
<h3 id="-key-point-19"><a class="header" href="#-key-point-19">💡 Key Point</a></h3>
<blockquote>
<p>必ず送信側ファイルと受信側ファイルの 2 つでやり取りを行う．</p>
</blockquote>
<h2 id="getでのデータ送受信"><a class="header" href="#getでのデータ送受信"><code>GET</code>でのデータ送受信</a></h2>
<h3 id="get方式でデータをやり取りする場合の流れ"><a class="header" href="#get方式でデータをやり取りする場合の流れ"><code>GET</code>方式でデータをやり取りする場合の流れ．</a></h3>
<h4 id="送信側の処理"><a class="header" href="#送信側の処理">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の 3 項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;data_get_confirm.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;GET&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理"><a class="header" href="#受信側の処理">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_GET</code>変数に値が格納される．</li>
<li><code>$_GET</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード"><a class="header" href="#送信側のコード">送信側のコード</a></h3>
<pre><code class="language-php">// data_get.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;data_get_confirm.php&quot; method=&quot;GET&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード"><a class="header" href="#受信側のコード">受信側のコード</a></h3>
<ul>
<li>GET で送信された情報は<code>$_GET</code>に入って送られる．</li>
<li>まず「情報が受け取れているかどうか」をチェックすることが大事！！</li>
<li>（情報が受け取れないと以降どうしようもない）</li>
<li><code>exit()</code>は以降の処理を中止する．</li>
</ul>
<pre><code class="language-php">// data_get_confirm.php

&lt;?php

// 必ず最初にチェック！！内容を確認したらコメントアウトすること．
var_dump($_GET);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_GET['todo'];
$deadline = $_GET['deadline'];

?&gt;

</code></pre>
<h3 id="get方式の特徴"><a class="header" href="#get方式の特徴"><code>GET</code>方式の特徴</a></h3>
<ul>
<li>サーバから情報を取得する． URL に情報を追加して送信できる．</li>
<li>データの特定（自分の名前で検索）など，少量のデータ送信に向く（URL にデータが含まれている）．</li>
<li>URL にデータが含まれるため，URL をシェアするだけでデータを共有できる．</li>
</ul>
<h2 id="postでのデータ送受信"><a class="header" href="#postでのデータ送受信"><code>POST</code>でのデータ送受信</a></h2>
<h3 id="post方式でデータをやり取りする場合の流れほとんどgetと同様"><a class="header" href="#post方式でデータをやり取りする場合の流れほとんどgetと同様"><code>POST</code>方式でデータをやり取りする場合の流れ（ほとんど<code>GET</code>と同様）．</a></h3>
<h4 id="送信側の処理-1"><a class="header" href="#送信側の処理-1">送信側の処理</a></h4>
<p><code>&lt;form&gt;&lt;/form&gt;</code>を用いてデータを送信する．必ず以下の 3 項目を設定する．</p>
<ul>
<li>データの送信宛先（<code>action=&quot;data_post_confirm.php&quot;</code>）．</li>
<li>データの送信方法（<code>method=&quot;POST&quot;</code>）．</li>
<li>データの項目名（<code>name=&quot;hoge&quot;</code>）．</li>
</ul>
<h4 id="受信側の処理-1"><a class="header" href="#受信側の処理-1">受信側の処理</a></h4>
<ul>
<li>送信されたデータは<code>$_POST</code>変数に値が格納される．</li>
<li><code>$_POST</code>は連想配列形式となっており，送信側の<code>name</code>で設定した値がキーとなる．</li>
<li>個別の値を取り出して変数に格納すれば，後は通常の変数として処理可能．</li>
</ul>
<h3 id="送信側のコード-1"><a class="header" href="#送信側のコード-1">送信側のコード</a></h3>
<pre><code class="language-php">// data_post.php

// formタグに`action`と`method`を記述
// 個々の項目（inputタグ）に`name`を指定する
&lt;form action=&quot;data_post_confirm.php&quot; method=&quot;POST&quot;&gt;
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
&lt;/form&gt;

</code></pre>
<h3 id="受信側のコード-1"><a class="header" href="#受信側のコード-1">受信側のコード</a></h3>
<ul>
<li>POST で送信された情報は<code>$_POST</code>に入って送られる．</li>
<li>以降の流れは<code>GET</code>の場合と同様．</li>
</ul>
<pre><code class="language-php">// data_post_confirm.php

&lt;?php

// POSTの場合も必ず最初にチェック！！
var_dump($_POST);
exit();

// キー名に送信元ファイルのname属性を指定する．
$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

?&gt;

</code></pre>
<h3 id="post方式の特徴"><a class="header" href="#post方式の特徴"><code>POST</code>方式の特徴</a></h3>
<ul>
<li>サーバにデータを送信するときに使用．情報を見えないように送信する方法</li>
<li>個人情報など．（送れるデータ量が GET と比較して多い）</li>
<li>ファイルを送信する場合にも使用</li>
</ul>
<h2 id="参考xss--クロスサイトスクリプティング"><a class="header" href="#参考xss--クロスサイトスクリプティング">【参考】XSS : クロスサイトスクリプティング</a></h2>
<p>form に悪意ある JavaScript を埋め込まれて実行される場合がある．</p>
<p>HTML にデータを埋め込む際に対策できる．</p>
<pre><code class="language-php">&lt;?php
$hoge = $_POST['hoge'];
?&gt;

// ここからhtmlの記述
&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;JavaScriptが送信されると実行されてしまいます&lt;?=$hoge?&gt;&lt;/p&gt;
    &lt;p&gt;ただの文字列として処理されます&lt;?=htmlspecialchars($hoge, ENT_QUOTES);?&gt;&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre>
<!-- 次の項では，データ送信機能を用いて検索処理を実装してみよう． -->
<h2 id="練習-19"><a class="header" href="#練習-19">練習</a></h2>
<ol>
<li><code>todo_get.php</code> と <code>todo_get_confirm.php</code> で GET 方式のデータ送受信を実装しよう．</li>
<li><code>todo_post.php</code> と <code>todo_post_confirm.php</code> で POST 方式のデータ送受信を実装しよう．</li>
</ol>
<p>双方とも，データを受け取ったら HTML 部分に受信内容を表示しよう．入力画面で入力した内容が受信側ファイルの画面に表示されていれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイル操作書き込み"><a class="header" href="#ファイル操作書き込み">ファイル操作（書き込み）</a></h1>
<h2 id="実装するアプリケーションtodo-リストの概要"><a class="header" href="#実装するアプリケーションtodo-リストの概要">実装するアプリケーション（todo リスト）の概要</a></h2>
<p>サーバではマシン内のファイルを直接操作することができる（ブラウザ=クライアントサイドからは操作できない）．</p>
<p>この特徴を活かし，ユーザが入力して送信したデータをファイルに保存する todo リストのアプリケーションを実装する．</p>
<p>まずは送信したデータを txt ファイルに書き込んで保存する</p>
<h3 id="やりたいこと"><a class="header" href="#やりたいこと">やりたいこと</a></h3>
<ol>
<li>フォームにデータを入力し，サーバに送信する．</li>
<li>サーバで受け取ったデータを txt ファイルに書き込んで保存する．</li>
<li>保存してあるデータを読み込んで HTML を作成し，画面に表示する．</li>
</ol>
<h3 id="必要なファイル"><a class="header" href="#必要なファイル">必要なファイル</a></h3>
<ul>
<li>保存用の txt ファイル「<code>data</code>」ディレクトリの「<code>todo.txt</code>」（自動で作成されるので準備する必要はない）．</li>
<li>データを入力して送信するファイル（<code>todo_txt_input.php</code>）</li>
<li>データを受け取ってファイルに書き込むファイル（<code>todo_txt_create.php</code>）</li>
</ul>
<h2 id="ファイル書き込み処理の実装"><a class="header" href="#ファイル書き込み処理の実装">ファイル書き込み処理の実装</a></h2>
<h3 id="データ送信側ファイルの処理"><a class="header" href="#データ送信側ファイルの処理">データ送信側ファイルの処理</a></h3>
<ol>
<li>送信先のファイルを指定する（今回は<code>todo_txt_create.php</code>）．</li>
<li>送信方式を指定する（GET or POST）← 今回は POST で実装．</li>
<li>input タグに name 属性を指定する．</li>
</ol>
<pre><code class="language-php">// todo_txt_input.php

// `action`, `method`, `name`の3つを指定する．
&lt;form action=&quot;todo_txt_create.php&quot; method=&quot;POST&quot;&gt;
  // ...
  &lt;div&gt;
    todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;button&gt;submit&lt;/button&gt;
  &lt;/div&gt;
  // ...
&lt;/form&gt;

</code></pre>
<h3 id="データ受信側ファイルの処理"><a class="header" href="#データ受信側ファイルの処理">データ受信側ファイルの処理</a></h3>
<ol>
<li>データを受け取る</li>
<li>書き込み先のファイルを開く（なければ新たにファイルを作成）</li>
<li>他の人が書き込まないようロックする</li>
<li>データを書き込む</li>
<li>ロックを解除する</li>
<li>ファイルを閉じる</li>
<li>入力画面に移動</li>
</ol>
<pre><code class="language-php">// todo_txt_create.php

// まずは`var_dump($_POST);`で値を確認すること！！

// データの受け取り
$todo = $_POST[&quot;todo&quot;];
$deadline = $_POST[&quot;deadline&quot;];

// データ1件を1行にまとめる（最後に改行を入れる）
$write_data = &quot;{$deadline} {$todo}\n&quot;;

// ファイルを開く．引数が`a`である部分に注目！
$file = fopen('data/todo.txt', 'a');
// ファイルをロックする
flock($file, LOCK_EX);

// 指定したファイルに指定したデータを書き込む
fwrite($file, $write_data);

// ファイルのロックを解除する
flock($file, LOCK_UN);
// ファイルを閉じる
fclose($file);

// データ入力画面に移動する
header(&quot;Location:todo_txt_input.php&quot;);

</code></pre>
<h3 id="参考ファイル操作時の主なオプション"><a class="header" href="#参考ファイル操作時の主なオプション">【参考】ファイル操作時の主なオプション</a></h3>
<table><thead><tr><th>引数</th><th>意味合い</th></tr></thead><tbody>
<tr><td><strong><code>r</code></strong></td><td>読み込みのみで開く</td></tr>
<tr><td><code>r+</code></td><td>読み込み/書き込み用に開く</td></tr>
<tr><td><code>w</code></td><td>書き込みで開く&amp;内容を削除 → ファイルがなければ作成</td></tr>
<tr><td><code>w+</code></td><td>読み込み/書き込みで開く&amp;内容を削除 → ファイルがなければ作成</td></tr>
<tr><td><strong><code>a</code></strong></td><td>追加書き込みのみで開く → ファイルがなければ作成</td></tr>
<tr><td><code>a+</code></td><td>読み込み/追加書き込みで開く → ファイルがなければ作成</td></tr>
</tbody></table>
<p><a href="https://www.php.net/manual/ja/function.fopen.php">参考リンク</a></p>
<h2 id="練習-20"><a class="header" href="#練習-20">練習</a></h2>
<ol>
<li><code>todo_txt_input.php</code>の form 欄の設定を記述しよう！</li>
<li><code>todo_txt_create.php</code>でデータを受け取り，ファイルに書き込もう！</li>
<li>書き込み処理の結果を<code>todo.txt</code>で確認しよう！
<ul>
<li>エディタから txt ファイルを開いて書き込まれていれば OK．</li>
</ul>
</li>
</ol>
<h2 id="-macos-の場合は権限の設定が必要"><a class="header" href="#-macos-の場合は権限の設定が必要">⚠️ MacOS の場合は権限の設定が必要</a></h2>
<p>（WindowsOS の場合は設定不要）</p>
<ul>
<li>初期状態では PHP からファイルを操作する権限が付与されていない．</li>
<li>以下の手順で権限を設定する．</li>
</ul>
<ol>
<li>「htdocs に入れた講義フォルダ」で</li>
<li>メニュー表示 =&gt; 情報を見る =&gt; 共有とアクセス権</li>
<li>全て「読み/書き」に変更 =&gt; 歯車ボタン =&gt; 内包している項目に適用</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイル操作読み込み"><a class="header" href="#ファイル操作読み込み">ファイル操作（読み込み）</a></h1>
<h2 id="ファイル読み込み処理画面表示の概要"><a class="header" href="#ファイル読み込み処理画面表示の概要">ファイル読み込み処理（&amp;画面表示）の概要</a></h2>
<h3 id="やりたいこと-1"><a class="header" href="#やりたいこと-1">やりたいこと</a></h3>
<ul>
<li>保存用ファイルから内容を読み出す．</li>
<li>読み出したデータをまとめ，HTML に埋め込む．</li>
</ul>
<h3 id="必要なファイル-1"><a class="header" href="#必要なファイル-1">必要なファイル</a></h3>
<ul>
<li>ファイルのデータを読み込んで表示するファイル（<code>todo_txt_read.php</code>）</li>
</ul>
<h2 id="ファイル読み込み処理の実装"><a class="header" href="#ファイル読み込み処理の実装">ファイル読み込み処理の実装</a></h2>
<h3 id="処理の流れ-5"><a class="header" href="#処理の流れ-5">処理の流れ</a></h3>
<ol>
<li>出力用の変数を用意する．</li>
<li>txt ファイルを開く（読み取り専用）．</li>
<li>ファイルをロックする．</li>
<li>txt ファイルのデータを読み込み，繰り返し処理を用いて出力用の変数に入れる．</li>
<li>ロックを解除する．</li>
<li>ファイルを閉じる．</li>
<li>（HTML 上で表示）</li>
</ol>
<pre><code class="language-php">// todo_txt_read.php

// データまとめ用の空文字変数
$str = '';

// ファイルを開く（読み取り専用）
$file = fopen('data/todo.txt', 'r');
// ファイルをロック
flock($file, LOCK_EX);

// fgets()で1行ずつ取得→$lineに格納
if ($file) {
  while ($line = fgets($file)) {
    // 取得したデータを`$str`に追加する
    $str .=&quot;&lt;tr&gt;&lt;td&gt;{$line}&lt;/td&gt;&lt;/tr&gt;&quot;;
  }
}

// ロックを解除する
flock($file, LOCK_UN);
// ファイルを閉じる
fclose($file);

// `$str`に全てのデータ（タグに入った状態）がまとまるので，HTML内の任意の場所に表示する．

</code></pre>
<h2 id="練習-21"><a class="header" href="#練習-21">練習</a></h2>
<ol>
<li><code>todo_txt_read.php</code>で<code>todo.txt</code>の内容を読み込もう（まずは<code>var_dump()</code>で確認）！</li>
<li>読み込んだデータをブラウザで表示しよう！</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-4"><a class="header" href="#課題-4">課題</a></h1>
<p><strong>csv ファイルを用いたアンケートシステムをつくろう！</strong></p>
<h2 id="構成例"><a class="header" href="#構成例">構成（例）</a></h2>
<ul>
<li>入力画面（index.php）</li>
<li>書き込みファイル（create.php）</li>
<li>読み込みファイル（read.php）</li>
</ul>
<p>最低限ここまで！</p>
<h2 id="アンケート内容例"><a class="header" href="#アンケート内容例">アンケート内容（例）</a></h2>
<ul>
<li>名前，email，任意の質問を入力</li>
<li>入力内容を csv 形式で「data/data.csv」に保存</li>
<li>読み込みファイルで csv ファイルの内容を表示</li>
</ul>
<p>※例によってアンケート項目とか適当で OK！</p>
<h2 id="アップグレード"><a class="header" href="#アップグレード">アップグレード</a></h2>
<ul>
<li>同じ画面で送信と表示を実行</li>
<li>csv ファイルの内容の集計結果をグラフ表示，デザインをかっこよく</li>
<li>結果に応じた評価機能とか統計解析とか</li>
<li>卒制のアイデアでつくってみる！！</li>
</ul>
<h2 id="php-と-js-を組み合わせろ"><a class="header" href="#php-と-js-を組み合わせろ">PHP と JS を組み合わせろ！！</a></h2>
<ul>
<li>PHP は JavaScript と比較して自由度が低い．．！</li>
<li>PHP は狙ったデータを確実に取得できるように！！</li>
<li>凝った画面表示や動きは JS を使おう！！</li>
</ul>
<p><img src="php/php01/./img/php_file_php_js_flow.svg" alt="PHPとJSの処理の流れ" /></p>
<p>PHP のデータを JS に渡す例</p>
<pre><code class="language-php">&lt;?php
// これはPHPの配列
$hoge_array = ['PHP', 'JS', 'Rust', 'COBOL'];
?&gt;

&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;

    &lt;p&gt;ここでJSONが活躍するのじゃ．．！&lt;/p&gt;

    &lt;script&gt;
      // JSではPHPの配列を扱えないため，サーバ上でJSON形式に変換する
      const hogeArray = &lt;?=json_encode($hoge_array)?&gt;;
      console.log(hogeArray);

      // あとはわかるな．．？？
    &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db-連携_crud-処理前半"><a class="header" href="#php_db-連携_crud-処理前半">PHP_DB 連携_CRUD 処理前半</a></h1>
<h2 id="サンプルコード-7"><a class="header" href="#サンプルコード-7">サンプルコード</a></h2>
<p><a href="php/php02/../../samples/07_php02_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-7"><a class="header" href="#本講義の内容とゴール-7">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-7"><a class="header" href="#本講義の内容-7">本講義の内容</a></h3>
<ul>
<li>DB の基本的な扱い．</li>
<li>SQL を用いた DB 操作（データ作成，データ参照）．</li>
<li>PHP 上での SQL 実行と todo リスト（Web アプリケーション）の連携を実装．</li>
</ul>
<h3 id="本講義のゴール-7"><a class="header" href="#本講義のゴール-7">本講義のゴール</a></h3>
<ul>
<li>DB の構成や動き方を理解する！</li>
<li>SQL で DB を操作する基本を理解する！</li>
<li>PHP で DB を操作できるようになる！</li>
</ul>
<p><strong>今回の内容を実装できるようになると，Web アプリケーションのかなりの部分が実現できる！！</strong></p>
<h2 id="準備-2"><a class="header" href="#準備-2">準備</a></h2>
<p>以下 4 点ができているか確認しよう！</p>
<ul>
<li>XAMPP の起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる（前回と同じ要領）</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db-の基本"><a class="header" href="#db-の基本">DB の基本</a></h1>
<h2 id="db-とは"><a class="header" href="#db-とは">DB とは</a></h2>
<ul>
<li>web 上にデータを保存するためのもの．</li>
<li>構造はエクセルなどと対比するとイメージしやすい！</li>
<li>データを操作するには SQL（言語）を用いる．</li>
</ul>
<h2 id="使い所"><a class="header" href="#使い所">使い所</a></h2>
<ul>
<li>web アプリケーションでデータを保存する場合のほとんど．</li>
</ul>
<h3 id="利用シーンの例"><a class="header" href="#利用シーンの例">利用シーンの例</a></h3>
<ul>
<li>EC サイトの商品データ（商品名，画像，説明文）</li>
<li>サービスに登録しているユーザの情報（ユーザ名，アドレス，etc）</li>
<li>ブログの投稿内容（投稿日時，タイトル，画像，本文，etc）</li>
</ul>
<h2 id="db-のデータ構造と概念"><a class="header" href="#db-のデータ構造と概念">DB のデータ構造と概念</a></h2>
<p>エクセルと同様のデータ構造となっている．実際にデータが格納されるのは「テーブル」であり，テーブルをどう設計するかがアプリケーションの根幹となる．</p>
<table><thead><tr><th>DB の概念</th><th>エクセルの概念</th></tr></thead><tbody>
<tr><td>データベース</td><td>エクセルファイル</td></tr>
<tr><td>テーブル</td><td>シート</td></tr>
<tr><td>レコード</td><td>行</td></tr>
<tr><td>カラム</td><td>列</td></tr>
</tbody></table>
<h3 id="-key-point-20"><a class="header" href="#-key-point-20">💡 Key Point</a></h3>
<blockquote>
<p>テーブル設計を行う際には，エクセルやスプレッドシートに書き出しながら作業すると視覚的に確認できるのでオススメ．</p>
</blockquote>
<h3 id="データ構造の例"><a class="header" href="#データ構造の例">データ構造の例</a></h3>
<p>EC サイトの商品データをイメージしたテーブルを下記に示す．</p>
<p>（下記のデーブル構造はまだ改善点があるが，後の講義で解説する．）</p>
<table><thead><tr><th align="right">id</th><th>product_name</th><th align="right">price</th><th>category</th><th>image_url</th></tr></thead><tbody>
<tr><td align="right">1</td><td>Laphroaig</td><td align="right">40</td><td>whisky</td><td>./images/laphroaig.png</td></tr>
<tr><td align="right">2</td><td>Ardbeg</td><td align="right">45</td><td>whisky</td><td>./images/ardbeg.png</td></tr>
<tr><td align="right">3</td><td>Caolila</td><td align="right">50</td><td>whisky</td><td>./images/caolila.png</td></tr>
<tr><td align="right">4</td><td>Kilchoman</td><td align="right">50</td><td>whisky</td><td>./images/kilchoman.png</td></tr>
<tr><td align="right">5</td><td>Bowmore</td><td align="right">45</td><td>whisky</td><td>./images/bowmore.png</td></tr>
<tr><td align="right">6</td><td>PortCharlotte</td><td align="right">55</td><td>whisky</td><td>./images/portcharlotte.png</td></tr>
<tr><td align="right">...</td><td>...</td><td align="right">..</td><td>...</td><td>...</td></tr>
</tbody></table>
<h3 id="db-の動き方のイメージ"><a class="header" href="#db-の動き方のイメージ">DB の動き方のイメージ</a></h3>
<p>「サーバ」には 3 種類存在し，相互に連携しながら Web アプリケーションを動作させている．ただし，Web サーバとアプリケーションサーバは区別の概念が難しいため，一旦「DB サーバとそれ以外」という理解で進めてしまって OK．</p>
<ul>
<li>「Web サーバ」：ブラウザにデータを返す．</li>
<li>「アプリケーションサーバ」：PHP などのサーバサイド言語を動かす．</li>
<li>「DB サーバ」：データを提供する．</li>
</ul>
<p>ブラウザ，PHP，DB が連携するイメージを以下に示す．</p>
<p><img src="php/php02/./img/php_crud01_about-db.svg" alt="DBの動き方イメージ" /></p>
<h3 id="-key-point-21"><a class="header" href="#-key-point-21">💡 Key Point</a></h3>
<blockquote>
<p>処理の流れを把握しよう！</p>
<p>例えば，PHP と DB を連携させ，保存されているデータを画面に表示する流れは以下のとおりとなる．</p>
<ol>
<li>PHP から DB サーバに接続する．</li>
<li>DB を操作する SQL を実行し，必要なデータを取得する．</li>
<li>取得したデータを HTML 上に反映させ，画面に表示する．</li>
</ol>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db--テーブルの作成"><a class="header" href="#db--テーブルの作成">DB / テーブルの作成</a></h1>
<h2 id="db-の作成"><a class="header" href="#db-の作成">DB の作成</a></h2>
<p>まずは基本単位となる DB を作成する．</p>
<p>1 つのアプリケーションに対して 1 つの DB，というイメージで OK．</p>
<ul>
<li><a href="http://localhost/phpmyadmin/">http://localhost/phpmyadmin/</a>にアクセス</li>
<li>「<code>Databases</code>」タブをクリック</li>
<li>「<code>Database name</code>」に「<code>dec_todo</code>」を入力（DB 名）</li>
<li>「<code>utf8mb4_unicode_ci</code>」を選択 →「作成」をクリック</li>
</ul>
<p>正常に作成されると，画面左側に作成した DB 名が表示される．</p>
<h2 id="テーブルとカラムの作成"><a class="header" href="#テーブルとカラムの作成">テーブルとカラムの作成</a></h2>
<p>今回実装する todo リストのデータ用テーブルを準備する．</p>
<p>テーブルは 1 つの DB 内に複数作成し，相互に連携して Web アプリケーションのデータを構築する．</p>
<h3 id="テーブルの作成"><a class="header" href="#テーブルの作成">テーブルの作成</a></h3>
<p>以下の手順でテーブルを作成しよう．</p>
<ol>
<li>左側の DB 一覧から前項で作成した DB を選択する．</li>
<li>名前欄に「<code>todo_table</code>」を入力（テーブル名）．</li>
<li>カラム数を「5」に設定する．</li>
<li>「Go」ボタンをクリック．</li>
</ol>
<h3 id="カラムの設定"><a class="header" href="#カラムの設定">カラムの設定</a></h3>
<p>テーブルに格納されるデータは定められた形式（文字列，数値，日付など）で保存しなければならない．</p>
<p>カラム設定時，各カラムに「名前」と「データ型」を設定する必要がある．下記の表に従ってカラム名とデータ型を設定しよう．</p>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>todo</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>deadline</code></td><td>DATE</td><td>-</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<ul>
<li>id は単一のデータを取得するためのもので，インデックスを「PRIMARY」に設定する必要がある．</li>
<li>また，id は自動的に数値を 1 から順に振るため，「A_I（Auto Increment）」にチェックしておく</li>
</ul>
<p>全て入力したら右下の「保存する」をクリック！！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="sql-による-db-操作"><a class="header" href="#sql-による-db-操作">SQL による DB 操作</a></h1>
<h2 id="sql-とは"><a class="header" href="#sql-とは">SQL とは</a></h2>
<p>DB の操作には「SQL（言語）」を使用する．</p>
<p>PHP で DB を操作するときは，コード内で SQL 文を実行する．</p>
<p>フレームワークなどではコード内では実行しない場合もある．ただし，フレームワークが関数の実行結果として SQL を生成して実行するため，DB 操作は必ず SQL で行われる．</p>
<h2 id="基本の-sql4-種"><a class="header" href="#基本の-sql4-種">基本の SQL4 種</a></h2>
<p>まずはデータ操作の基本となる 4 種類を押さえましょう！</p>
<ul>
<li><code>INSERT</code>：データの「作成」</li>
<li><code>SELECT</code>：データの「参照」</li>
<li><code>UPDATE</code>：データの「更新」</li>
<li><code>DELETE</code>：データの「削除」</li>
</ul>
<p>※SQL 文は大文字で記載していますが，小文字でも動作する．他の言語（本講座では PHP）と組み合わせる際に区別しやすいよう大文字で記載している．他の言語でも大文字で扱うことが多い．</p>
<h2 id="insertデータの作成"><a class="header" href="#insertデータの作成">INSERT（データの作成）</a></h2>
<p>指定したテーブルに対して新規データの作成を行う．</p>
<p>ポイントは以下！</p>
<ul>
<li>「カラム名の数と順序」と「値の数と順序」を一致させる必要がある．</li>
<li><code>id</code>カラムは DB 側で Auto increment の設定をしているため<code>NULL</code>を送信する．</li>
<li>作成日時や更新日時は<code>now()</code>を使用して実行時の日付時刻が入力されるようにする．</li>
</ul>
<pre><code class="language-sql">
-- INSERT文の基本構造
INSERT INTO テーブル名 (カラム1, カラム2, ...) VALUES (値1, 値2, ...);

-- 例
INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES(NULL, 'SQL練習', '2021-12-31', now(), now());

</code></pre>
<h2 id="selectデータの参照"><a class="header" href="#selectデータの参照">SELECT（データの参照）</a></h2>
<p>SELECT 文はデータの参照に使用されるが，フィルタリングやソートなど多様なオプションが用意されている．</p>
<h3 id="select-文の基本"><a class="header" href="#select-文の基本">SELECT 文の基本</a></h3>
<pre><code class="language-sql">-- SELECT文の基本構造
SELECT 表示するカラム名 FROM テーブル名;

-- 例

-- 「*」で全て指定
SELECT * FROM todo_table;

-- 1つのカラムを指定
SELECT todo FROM todo_table;

-- 複数カラム指定
SELECT todo, deadline FROM todo_table;

</code></pre>
<h3 id="フィルタリング"><a class="header" href="#フィルタリング">フィルタリング</a></h3>
<p>データの条件を設定してフィルタリングをおこなうことができる．フィルタリングには<code>WHERE</code>を使用する．</p>
<pre><code class="language-sql">-- 「WHERE」を使用して値の条件を指定できる
SELECT * FROM todo_table WHERE deadline='2021-12-31';

-- 演算子の使用
SELECT * FROM todo_table WHERE deadline &lt;= '2021-12-31';
SELECT * FROM todo_table WHERE deadline &gt;= '2021-12-01' AND deadline &lt;= '2021-12-31';

-- あいまい検索
SELECT * FROM todo_table WHERE todo LIKE 'PHP%';
SELECT * FROM todo_table WHERE todo LIKE '%提出';
SELECT * FROM todo_table WHERE todo LIKE '%課題%';

</code></pre>
<h3 id="ソート"><a class="header" href="#ソート">ソート</a></h3>
<p>並び替えには<code>ORDER BY</code>を使用する．</p>
<ul>
<li>基準となるカラム名を指定し，</li>
<li>昇順（<code>ASC</code>）か降順（<code>DESC</code>）を指定する．</li>
</ul>
<pre><code class="language-sql">-- ORDER BYを使用した並び替え
-- `deadline`カラムの値で降順に並び替え
SELECT * FROM todo_table ORDER BY deadline DESC;
-- `todo`カラムの値で昇順に並び替え
SELECT * FROM todo_table ORDER BY todo ASC;

</code></pre>
<h3 id="取得するデータ件数の制限"><a class="header" href="#取得するデータ件数の制限">取得するデータ件数の制限</a></h3>
<p><code>LIMIT</code>を用いてデータ件数の制限を行うことができる．最新 10 件，などの使い方がメジャー．</p>
<pre><code class="language-sql">-- LIMITで表示件数の制限
SELECT * FROM todo_table LIMIT 5;

-- 並び替えとの組み合わせ
SELECT * FROM todo_table ORDER BY deadline DESC LIMIT 5;

</code></pre>
<h2 id="updateデータの更新"><a class="header" href="#updateデータの更新">UPDATE（データの更新）</a></h2>
<p>UPDATE は次回の講義で扱う．</p>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="deleteデータの削除"><a class="header" href="#deleteデータの削除">DELETE（データの削除）</a></h2>
<p>DELETE は次回の講義で扱う．</p>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="参考sql-の練習"><a class="header" href="#参考sql-の練習">【参考】SQL の練習</a></h2>
<p><a href="https://sqlzoo.net/">https://sqlzoo.net/</a></p>
<p>初歩から応用まで SQL 問題が出題．当面は最初の方の基本的なデータ取得ができれば OK．</p>
<h2 id="練習-22"><a class="header" href="#練習-22">練習</a></h2>
<p>SQL は phpmyadmin の「SQL タブ」から記述&amp;実行できる．</p>
<ol>
<li>INSERT 文を用いて<code>todo_table</code>にデータを 10 件程度作成しよう．</li>
<li>SELECT 文を用いて作成したデータを取り出そう．
<ul>
<li>WHERE, ORDER BY, LIMIT を試して，想定どおりのデータを取得できるかどうか確認！</li>
</ul>
</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-と-db-の連携データ作成処理"><a class="header" href="#php-と-db-の連携データ作成処理">PHP と DB の連携（データ作成処理）</a></h1>
<h2 id="必要なファイル-2"><a class="header" href="#必要なファイル-2">必要なファイル</a></h2>
<ul>
<li><code>todo_input.php</code>：データ入力画面．</li>
<li><code>todo_create.php</code>：DB 接続，データ作成処理を実行．</li>
</ul>
<h2 id="処理の流れ-6"><a class="header" href="#処理の流れ-6">処理の流れ</a></h2>
<ol>
<li><code>todo_input.php</code>で入力されたデータを<code>todo_create.php</code>へ送信（post）．</li>
<li><code>todo_create.php</code>でデータを受け取り，DB への新規データ作成．</li>
<li>作成完了後，<code>todo_input.php</code>（入力画面）へ移動．（<code>todo_create.php</code>では画面表示なし）</li>
</ol>
<h2 id="送信側の処理-2"><a class="header" href="#送信側の処理-2">送信側の処理</a></h2>
<p>フォームからデータを送信する．以下 3 点の漏れやスペルミスがないよう確認しよう．</p>
<ul>
<li>action</li>
<li>method</li>
<li>name</li>
</ul>
<pre><code class="language-php">// todo_input.php

&lt;form action=&quot;todo_create.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<h2 id="受信側の処理-2"><a class="header" href="#受信側の処理-2">受信側の処理</a></h2>
<p>データ受け取り側では以下の処理を実装する．</p>
<ul>
<li>必須項目の入力チェック</li>
<li>データの受け取り</li>
<li>DB 接続</li>
<li>SQL 作成&amp;実行</li>
<li>SQL 実行後の処理</li>
</ul>
<h3 id="入力チェック"><a class="header" href="#入力チェック">入力チェック</a></h3>
<p>DB にデータを格納する場合，基本的にデータの欠損は許されない（データなしを許可する設定もある）．</p>
<p>そのため，以下の条件に合致する場合は以降の処理を中止してエラー画面を表示する．</p>
<ul>
<li>必須項目（todo と deadline）のデータが送信されていない．</li>
<li>必須項目（todo と deadline）が空で送信されている．</li>
</ul>
<pre><code class="language-php">// todo_create.php

if (
  !isset($_POST['todo']) || $_POST['todo']=='' ||
  !isset($_POST['deadline']) || $_POST['deadline']==''
) {
  exit('ParamError');
}

</code></pre>
<h3 id="参考エラーメッセージを出力する意味"><a class="header" href="#参考エラーメッセージを出力する意味">【参考】エラーメッセージを出力する意味</a></h3>
<p>どこで失敗したのかをわかるようにする！</p>
<ul>
<li>PHP ではエラーを見つけづらい．．．</li>
<li>データを扱うので，異常なデータなどが作成されるとまずい．</li>
<li>どこでエラーが出ているのかわからないと詰む．</li>
<li>エラーにも種類がある！
<ul>
<li>どこでうまくいっていないのかを把握できるようにエラーの処理を記述！</li>
</ul>
</li>
</ul>
<h3 id="データ受け取り"><a class="header" href="#データ受け取り">データ受け取り</a></h3>
<p>前回講義の場合と同様．今回は POST で送信しているため<code>$_POST</code>で受け取る．</p>
<pre><code class="language-php">// todo_create.php

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];

</code></pre>
<h3 id="db-接続"><a class="header" href="#db-接続">DB 接続</a></h3>
<p>DB に接続するコードは決まった形式（<code>PDO</code>）．</p>
<p>接続の際には以下の情報が必要になる．今回は<code>dbname</code>のみ設定が必要．</p>
<ul>
<li><code>mysql</code>：DB の種類（他に<code>PostgreSQL</code>，<code>Oracle Database</code>，などが存在する）</li>
<li><code>dbname</code>：DB の名前（今回はここを<code>dec_todo</code>に設定する！）</li>
<li><code>port</code>：接続ポート</li>
<li><code>host</code>：DB のホスト名</li>
<li><code>username</code>：DB 接続時のユーザ名</li>
<li><code>password</code>：DB 接続時のパスワード</li>
</ul>
<pre><code class="language-php">// todo_create.php

// 各種項目設定
$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

// DB接続
try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

// 「dbError:...」が表示されたらdb接続でエラーが発生していることがわかる．

</code></pre>
<h3 id="sql-作成実行"><a class="header" href="#sql-作成実行">SQL 作成&amp;実行</a></h3>
<p>SQL（今回は INSERT 文）を実行する場合も手順が決まっている．</p>
<ol>
<li>SQL 文の記述．</li>
<li>バインド変数の設定．</li>
<li>SQL 実行．</li>
</ol>
<pre><code class="language-php">// todo_create.php

// SQL作成&amp;実行
$sql = 'INSERT INTO todo_table (id, todo, deadline, created_at, updated_at) VALUES (NULL, :todo, :deadline, now(), now())';

$stmt = $pdo-&gt;prepare($sql);

// バインド変数を設定
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);

// SQL実行（実行に失敗すると$statusにfalseが返ってくる）
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="補足バインド変数と-sql-インジェクション"><a class="header" href="#補足バインド変数と-sql-インジェクション">【補足】バインド変数と SQL インジェクション</a></h3>
<p>SQL インジェクションと呼ばれるハッキング手法が存在する．</p>
<p>例えば，下記のようにコードを記述されている場合．．．</p>
<pre><code class="language-php">$query = &quot;SELECT * FROM user WHERE id = '$user_id'&quot;;
</code></pre>
<p><code>$user_id</code>に「<code>' or 'A' = 'A</code>」を入れると，下記と同じ意味になってしまう！</p>
<pre><code class="language-sql">SELECT * FROM user;
</code></pre>
<p>-&gt; 不正にユーザのデータを取得できてしまう！！！</p>
<p>バインド変数を用いることで，SQL 文として実行されないようにできる！</p>
<p>ユーザが入力した値を SQL 文内で使用する場合には必ずバインド変数を使用すること．</p>
<h3 id="sql-実行時の処理"><a class="header" href="#sql-実行時の処理">SQL 実行時の処理</a></h3>
<p>実行に失敗すると<code>$status</code>に<code>false</code>が返ってくるため，条件分岐して失敗を検出する．</p>
<p><code>$stmt-&gt;errorInfo()</code>と記述することでエラー内容（配列形式）を取得することができ，2 番めのデータにエラーメッセージが格納されている．</p>
<p>SQL が正常に実行された場合は，データ入力画面に移動することとする．</p>
<pre><code class="language-php">// todo_create.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  header('Location:todo_input.php');
  exit();
}

</code></pre>
<h2 id="練習-23"><a class="header" href="#練習-23">練習</a></h2>
<p>DB にデータを追加する処理を実装しよう！</p>
<ol>
<li><code>todo_input.php</code>にフォームを作成</li>
<li><code>todo_create.php</code>で
<ul>
<li>データを受け取る</li>
<li>DB に接続</li>
<li>SQL 文を書いて実行</li>
</ul>
</li>
</ol>
<p>phpmyadmin でテーブルを確認し，データが作成されていれば OK！</p>
<ul>
<li>phpmyadmin の「表示」タブをクリックすると最新のデータを読み込める．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-と-db-の連携データ参照処理"><a class="header" href="#php-と-db-の連携データ参照処理">PHP と DB の連携（データ参照処理）</a></h1>
<h2 id="必要なファイル-3"><a class="header" href="#必要なファイル-3">必要なファイル</a></h2>
<ul>
<li><code>todo_read.php</code>：DB からデータを取得してデータの一覧画面を作成する．</li>
</ul>
<h2 id="処理の流れ-7"><a class="header" href="#処理の流れ-7">処理の流れ</a></h2>
<ol>
<li>表示ファイル（<code>todo_read.php</code>）へアクセス時，DB 接続する．</li>
<li>データ参照用 SQL 作成 → 実行．</li>
<li>取得したデータを HTML に埋め込んで画面を表示．</li>
</ol>
<p>※必要に応じて，並び替えやフィルタリングを実施してみよう．</p>
<h2 id="db-データ作成処理の実装"><a class="header" href="#db-データ作成処理の実装">DB データ作成処理の実装</a></h2>
<h3 id="db-接続-1"><a class="header" href="#db-接続-1">DB 接続</a></h3>
<p>新規データ作成の場合と同様の処理（DB 名の設定を忘れずに！）．</p>
<pre><code class="language-php">// todo_read.php

$dbn ='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
$user = 'root';
$pwd = '';

try {
  $pdo = new PDO($dbn, $user, $pwd);
} catch (PDOException $e) {
  echo json_encode([&quot;db error&quot; =&gt; &quot;{$e-&gt;getMessage()}&quot;]);
  exit();
}

</code></pre>
<h3 id="sql-作成実行-1"><a class="header" href="#sql-作成実行-1">SQL 作成&amp;実行</a></h3>
<p>データ作成処理と同様に SQL を記述して実行する．今回は「ユーザが入力したデータ」を使用しないのでバインド変数は不要．</p>
<p>また，<code>$status</code>には実行結果が入るが，この時点ではまだデータ自体の取得はできていない点に注意．</p>
<pre><code class="language-php">// todo_read.php

$sql = 'SELECT * FROM todo_table';
$stmt = $pdo-&gt;prepare($sql);
$status = $stmt-&gt;execute();

</code></pre>
<h3 id="sql-実行後の処理"><a class="header" href="#sql-実行後の処理">SQL 実行後の処理</a></h3>
<p>SQL の実行に失敗した場合はエラーを表示して処理を中止する．</p>
<p>SQL が正常に実行された場合は以下の流れで処理が実行される．</p>
<ul>
<li><code>fetchAll()</code>関数でデータ自体を取得する．</li>
<li>繰り返し処理を用いて，取得したデータから HTML タグを生成する．</li>
<li>（HTML 内の任意の位置に作成したタグを設置</li>
</ul>
<pre><code class="language-php">// todo_read.php

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
  $output = &quot;&quot;;
  foreach ($result as $record) {
    $output .= &quot;
      &lt;tr&gt;
        &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
        &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;/tr&gt;
    &quot;;
  }
}

</code></pre>
<h3 id="html-にタグを埋め込み"><a class="header" href="#html-にタグを埋め込み">HTML にタグを埋め込み</a></h3>
<pre><code class="language-php">// todo_read.php

// html部分にデータを追加
&lt;tbody&gt;
  &lt;!-- 🔽 に&lt;tr&gt;&lt;td&gt;deadline&lt;/td&gt;&lt;td&gt;todo&lt;/td&gt;&lt;tr&gt;の形でデータが入る --&gt;
  &lt;?= $output ?&gt;
&lt;/tbody&gt;

</code></pre>
<h3 id="参考js-を用いたタグ生成"><a class="header" href="#参考js-を用いたタグ生成">【参考】JS を用いたタグ生成</a></h3>
<p>上記では「PHP 内でタグを生成 → HTML 内に埋め込み」という実装を行っているが，タグ生成部分を JS で行うこともできる．</p>
<p>どちらが正解というものではないので，自身のイメージしやすいパターンで実装すれば問題ない．</p>
<pre><code class="language-php">&lt;?php

// DB接続，SQL実行など

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  exit('sqlError:'.$error[2]);
} else {
  // PHPではデータを取得するところまで実施
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
}

?&gt;

&lt;!DOCTYPE html&gt;
  &lt;head&gt;
    // 省略
  &lt;/head&gt;
  &lt;body&gt;
    &lt;table&gt;
      &lt;tbody id=&quot;output&quot;&gt;&lt;/tbody&gt;
    &lt;table&gt;

    &lt;script&gt;
      // PHPのデータをJSに渡す
      const resultArray = &lt;?=json_encode($result) ?&gt;;
      // 配列からタグ生成し，#outputに表示する
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;


</code></pre>
<h2 id="練習-24"><a class="header" href="#練習-24">練習</a></h2>
<p>DB のデータを読み出して表示する処理を実装しよう！</p>
<p><code>todo_read.php</code>で</p>
<ul>
<li>DB に接続</li>
<li>SQL 文を書いて実行</li>
<li>取得したデータを HTML に埋め込み</li>
</ul>
<p>テーブルのデータが画面に一覧で表示されれば OK！</p>
<p>できた人は SQL 文を編集してフィルタリングやソートなどを実装してみよう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題と提出時の注意点-1"><a class="header" href="#課題と提出時の注意点-1">課題と提出時の注意点</a></h1>
<p><strong>DB を使用したアプリを実装しよう！</strong></p>
<p>DB を扱うことで Web アプリケーションの基本的な機能を実装できる．日頃使っている Web アプリケーションの中で，DB や SQL がどのように使われているのかイメージしてみると，活用方法のイメージが湧くだろう．</p>
<h2 id="db-やテーブル"><a class="header" href="#db-やテーブル">DB やテーブル</a></h2>
<ul>
<li>DB 名：今回作成したものを使用</li>
<li>テーブル構成：自由に！（講義で使用した<code>todo_table</code>の構成は変更しないこと！）</li>
</ul>
<h2 id="構成"><a class="header" href="#構成">構成</a></h2>
<p>基本は下記ファイル（処理）を作成！（ファイル構成や名前は変更して OK！）</p>
<ul>
<li>input.php （作成画面）</li>
<li>create.php （作成処理）</li>
<li>select.php （参照&amp;表示処理）</li>
</ul>
<p>卒制のプロトタイプ的な作品とか，SNS 的なものとか！</p>
<h2 id="-注意点-1"><a class="header" href="#-注意点-1">⚠️ 注意点</a></h2>
<ul>
<li>DB 使用時には DB に保存されたデータも必要．</li>
<li>DB のデータ（テーブルなど）もまとめて提出！</li>
<li>「DB」は必ず授業でつくったものを使用すること！</li>
</ul>
<p><img src="php/php02/./img/php_crud01_sql_export_01.svg" alt="sqlファイルエクスポート1" />
<img src="php/php02/./img/php_crud01_sql_export_02.svg" alt="sqlファイルエクスポート2" />
<img src="php/php02/./img/php_crud01_sql_export_03.svg" alt="sqlファイルエクスポート3" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db-連携_crud-処理後半"><a class="header" href="#php_db-連携_crud-処理後半">PHP_DB 連携_CRUD 処理後半</a></h1>
<h2 id="サンプルコード-8"><a class="header" href="#サンプルコード-8">サンプルコード</a></h2>
<p><a href="php/php03/../../samples/08_php03_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-8"><a class="header" href="#本講義の内容とゴール-8">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-8"><a class="header" href="#本講義の内容-8">本講義の内容</a></h3>
<ul>
<li>DB 内のデータを更新する処理，削除する処理を実装する．</li>
<li>関数専用のファイルを作成し，読み込みを実行を行う．</li>
<li>todo リストの基本的な機能について実装を完了する．</li>
</ul>
<h3 id="本講義のゴール-8"><a class="header" href="#本講義のゴール-8">本講義のゴール</a></h3>
<ul>
<li>基本的な CRUD 処理を実装し，処理の流れを理解する．</li>
<li>複数のファイルで使用する共通のコードの管理手法を学ぶ．</li>
<li>オリジナル Web サービスの構想から CRUD 処理の設計につなげる．</li>
</ul>
<h3 id="todo-アプリケーションの全体像"><a class="header" href="#todo-アプリケーションの全体像">todo アプリケーションの全体像</a></h3>
<p><img src="php/php03/./img/php_crud02_app_construct.svg" alt="todoアプリ全体像" /></p>
<h2 id="準備-3"><a class="header" href="#準備-3">準備</a></h2>
<p>以下 4 点ができているか確認しよう！</p>
<ul>
<li>XAMPP の起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="db-接続関数の作成"><a class="header" href="#db-接続関数の作成">DB 接続関数の作成</a></h1>
<h2 id="db-接続は常に同じコード"><a class="header" href="#db-接続は常に同じコード">DB 接続は常に同じコード</a></h2>
<p>実は．．．</p>
<ul>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で記述した DB 接続のコードは全く同じ！</li>
<li>今回作成する<code>todo_edit.php</code>, <code>todo_update.php</code>, <code>todo_delete.php</code>も同じ記述！</li>
</ul>
<p>であれば．．！</p>
<p>一つの関数にまとめられる！</p>
<p>=&gt; 関数用のファイルを作成しよう！（<code>functions.php</code>）</p>
<h2 id="関数の定義"><a class="header" href="#関数の定義">関数の定義</a></h2>
<p>DB 接続の処理は様々なファイルで実行されるため，関数専用のファイル（<code>functions.php</code>）に記述して他のファイルから読み込むと効率が良い．</p>
<p>関数を実行すると，DB 接続情報を出力するように実装すると良い（<code>return new PDO...</code>部分）．</p>
<pre><code class="language-php">// functions.php

function connect_to_db()
{
  $dbn='mysql:dbname=YOUR_DB_NAME;charset=utf8;port=3306;host=localhost';
  $user = 'root';
  $pwd = '';
  try {
    return new PDO($dbn, $user, $pwd);
  } catch (PDOException $e) {
    exit('dbError:'.$e-&gt;getMessage());
  }
}

</code></pre>
<h2 id="関数の実行"><a class="header" href="#関数の実行">関数の実行</a></h2>
<p>上で定義した関数は DB 接続が必要なファイルで<code>functions.php</code>を読み込むことで実行可能．</p>
<p>別ファイルの読み込みは<code>include()</code>関数を用いる．</p>
<pre><code class="language-php">// DB接続したいファイル（todo_create.php, todo_read.php, など）

include('functions.php');
$pdo = connect_to_db();

// 他のDB接続が必要なファイルでも上記の2行でOK！

</code></pre>
<h2 id="練習-25"><a class="header" href="#練習-25">練習</a></h2>
<ol>
<li><code>functions.php</code>に DB 接続の関数を定義しよう！</li>
<li><code>todo_create.php</code>と<code>todo_read.php</code>で<code>functions.php</code>を<code>include()</code>し，関数を実行しよう！</li>
</ol>
<p>今まで通りの動きが確認できれば OK！</p>
<p>（これまでやっていた処理を関数にしただけなので，実行される内容はこれまでと変化なし）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-と-db-の連携-3編集画面の作成"><a class="header" href="#php-と-db-の連携-3編集画面の作成">PHP と DB の連携 3（編集画面の作成）</a></h1>
<h2 id="処理の流れ-8"><a class="header" href="#処理の流れ-8">処理の流れ</a></h2>
<p>データ更新の処理はデータ作成処理の流れと似ている！</p>
<p>まずは本項で 1 と 2 を実装する．</p>
<ol>
<li>一覧画面に更新ページへのリンクを作成（url に id を追加： todo_edit.php?id=**）</li>
<li>更新ページの作成（todo_edit.php）</li>
<li>更新処理の作成（todo_update.php）</li>
<li>一覧画面に戻る</li>
</ol>
<h2 id="一覧画面にリンク追加"><a class="header" href="#一覧画面にリンク追加">一覧画面にリンク追加</a></h2>
<p><code>&lt;a&gt;</code>を用いて編集画面（と削除処理）へのリンクを作成する．</p>
<p>GET メソッドが「データを URL に格納する」仕様を利用し，<code>&lt;a&gt;</code>の URL に各データの<code>id</code>を埋め込む．</p>
<pre><code class="language-php">// todo_read.php

foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;
      &lt;/td&gt;
      &lt;td&gt;
        &lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<p>下図のようにリンクが表示されれば OK．</p>
<p>リンクにマウスカーソルを当てると，ブラウザ左下にリンク先の URL が表示される．<code>id=**</code>の形で数値が表示されれば正しく指定されている．</p>
<p><img src="php/php03/./img/php_crud02_todo_read.png" alt="一覧画面リンク表示" /></p>
<h2 id="編集画面の作成"><a class="header" href="#編集画面の作成">編集画面の作成</a></h2>
<p>続いて，編集画面を実装する．</p>
<p>本画面の役割は</p>
<ul>
<li>現在テーブルに保存されている<code>todo</code>と<code>deadline</code>を表示する．</li>
<li>ユーザが画面上でデータを編集する．</li>
<li>ユーザが編集したデータをテーブル更新用ファイル（<code>todo_update.php</code>）に送信する．</li>
</ul>
<p>コードのポイントは以下．</p>
<ul>
<li>SELECT 文を用いて<code>id</code>指定し，<code>fetch()</code>関数でデータを取得する．</li>
<li>取得したデータを<code>&lt;input&gt;</code>の初期値として設定する．</li>
<li>次の更新処理で<code>id</code>が必要になるため，<code>&lt;input type=&quot;hidden&quot;&gt;</code>を用いて<code>id</code>を送信する．</li>
</ul>
<pre><code class="language-php">include(&quot;functions.php&quot;);

$id = $_GET['id'];

$pdo = connect_to_db();

$sql = 'SELECT * FROM todo_table WHERE id=:id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_INT);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $record = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
}
?&gt;

// 以下HTML部分
&lt;form action=&quot;todo_update.php&quot; method=&quot;POST&quot;&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;DB連携型todoリスト（編集画面）&lt;/legend&gt;
    &lt;a href=&quot;todo_read.php&quot;&gt;一覧画面&lt;/a&gt;
    &lt;div&gt;
      todo: &lt;input type=&quot;text&quot; name=&quot;todo&quot; value=&quot;&lt;?= $record['todo'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      deadline: &lt;input type=&quot;date&quot; name=&quot;deadline&quot; value=&quot;&lt;?= $record['deadline'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?= $record['id'] ?&gt;&quot;&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button&gt;submit&lt;/button&gt;
    &lt;/div&gt;
  &lt;/fieldset&gt;
&lt;/form&gt;

</code></pre>
<p>下図のように現在のデータが画面に表示されれば OK．</p>
<p><img src="php/php03/./img/php_crud02_todo_edit.png" alt="編集画面データ表示" /></p>
<h2 id="練習-26"><a class="header" href="#練習-26">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>一覧画面に<code>todo_edit.php</code>へのリンクを追加！（<code>todo_delete.php</code>へのリンクも一緒に！）</li>
<li><code>todo_edit.php</code>ではデータを ID で検索し，該当するデータを画面に表示！</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-と-db-の連携-4データ更新処理の作成"><a class="header" href="#php-と-db-の連携-4データ更新処理の作成">PHP と DB の連携 4（データ更新処理の作成）</a></h1>
<h2 id="データ更新の-sql"><a class="header" href="#データ更新の-sql">データ更新の SQl</a></h2>
<pre><code class="language-sql">-- UPDATE文の基本構造
UPDATE テーブル名 SET 変更データ WHERE 選択データ;

-- 例
UPDATE todo_table SET todo='PHP課題' WHERE id = 1;
-- 【重要】必ずWHEREを使用！！（忘れると全てのデータが更新されます．．！）

</code></pre>
<h2 id="更新の処理"><a class="header" href="#更新の処理">更新の処理</a></h2>
<p>前項の編集画面からデータを受け取り，DB のデータを更新する．</p>
<p>処理の流れは<code>todo_create.php</code>とよく似ている．</p>
<h3 id="データチェックと受け取り"><a class="header" href="#データチェックと受け取り">データチェックと受け取り</a></h3>
<p>まずは<code>todo</code>，<code>deadline</code>，<code>id</code>のデータが揃っていることを確認し，データを受け取る．</p>
<pre><code class="language-php">// todo_update.php

if (
  !isset($_POST['todo']) || $_POST['todo'] == '' ||
  !isset($_POST['deadline']) || $_POST['deadline'] == '' ||
  !isset($_POST['id']) || $_POST['id'] == ''
) {
  exit('paramError');
}

$todo = $_POST['todo'];
$deadline = $_POST['deadline'];
$id = $_POST['id'];

</code></pre>
<h3 id="db-接続と-sql-実行"><a class="header" href="#db-接続と-sql-実行">DB 接続と SQL 実行</a></h3>
<p>続いて DB 接続し，UPDATE の SQL を実行する．SQL が正常に実行された場合は一覧画面に移動する．</p>
<h3 id="-key-point-22"><a class="header" href="#-key-point-22">💡 Key Point</a></h3>
<blockquote>
<p>必ず WHERE で id を指定すること！！！</p>
</blockquote>
<pre><code class="language-php">// todo_update.php

include('functions.php');
$pdo = connect_to_db();

$sql = 'UPDATE todo_table SET todo=:todo, deadline=:deadline, updated_at=now() WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header('Location:todo_read.php');
  exit();
}

</code></pre>
<h2 id="練習-27"><a class="header" href="#練習-27">練習</a></h2>
<p><code>todo_update.php</code>で UPDATE の処理を実装しよう！</p>
<p>更新処理実行後，一覧ページでデータが更新されていれば OK！</p>
<p>（phpmyadmin でも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php-と-db-の連携-5データ削除処理"><a class="header" href="#php-と-db-の連携-5データ削除処理">PHP と DB の連携 5（データ削除処理）</a></h1>
<h2 id="データ削除の-sql"><a class="header" href="#データ削除の-sql">データ削除の SQL</a></h2>
<pre><code class="language-sql">-- DELETE文の基本構造
DELETE FROM テーブル名;

-- 例

-- 全消去
DELETE FROM todo_table;
-- 指定データのみ
DELETE FROM todo_table WHERE id = 2;

-- WHEREで指定しないとテーブルのデータが全滅する！！
-- DELETEすると復旧できないので注意！！

</code></pre>
<h2 id="処理の流れ-9"><a class="header" href="#処理の流れ-9">処理の流れ</a></h2>
<ol>
<li>✅ 一覧画面に削除ページへのリンクを作成（url に id を追加<code>todo_delete.php?id=**</code>）</li>
<li>削除処理の作成（<code>todo_delete.php</code>）</li>
<li>テーブルのデータを削除したら一覧画面に戻る</li>
</ol>
<h2 id="削除の実装"><a class="header" href="#削除の実装">削除の実装</a></h2>
<p>削除に必要なのは<code>id</code>のみである．編集画面に移動する場合と同様に GET で<code>id</code>を受け取る．</p>
<p>データを受け取ったら，下記の順で処理を記述する．</p>
<ul>
<li>DB 接続</li>
<li>SQL 実行（DELETE 文）</li>
<li>一覧画面へ移動</li>
</ul>
<h3 id="-key-point-23"><a class="header" href="#-key-point-23">💡 Key Point</a></h3>
<blockquote>
<p>⚠️ DELETE 文を実行する場合には必ず WHERE で<code>id</code>を指定すること．</p>
</blockquote>
<pre><code class="language-php">$id = $_GET['id'];

include('functions.php');
$pdo = connect_to_db();

$sql = 'DELETE FROM todo_table WHERE id=:id';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-28"><a class="header" href="#練習-28">練習</a></h2>
<p>以下の処理を実装しよう！</p>
<ol>
<li>✅ 一覧画面に<code>todo_delete.php</code>へのリンクを追加！</li>
<li><code>todo_delete.php</code>ではデータを ID で検索し，該当するデータを削除！</li>
<li>完了したら<code>todo_read.php</code>へ戻る．</li>
</ol>
<p>削除処理実行後，一覧ページでデータが削除されていれば OK！</p>
<p>（phpmyadmin でも確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-5"><a class="header" href="#課題-5">課題</a></h1>
<h2 id="課題-1"><a class="header" href="#課題-1">課題 1</a></h2>
<p><strong>前回の課題に機能追加しよう！</strong></p>
<ul>
<li>表示処理 &lt;- 更新画面へのリンクなど追加</li>
<li>更新画面</li>
<li>更新処理</li>
<li>削除処理</li>
</ul>
<p>もちろん新しいアイデアで作り直しても OK！</p>
<p>そろそろ web アプリケーションの全体（卒制含め）が実装できるぞッ！</p>
<p>※そろそろ作り始めないとキツイ．．！</p>
<h3 id="考えるときのポイント"><a class="header" href="#考えるときのポイント">考えるときのポイント</a></h3>
<ul>
<li>世の中の Web アプリケーションはどのような CRUD 処理を実行しているのかを考えてみる．</li>
<li>自分のアイデアではどこでどのような CRUD 処理が実行すればよいのかを当てはめてみる．</li>
<li>テーブルの項目が異なるけどやっている処理自体は同じ．</li>
</ul>
<h2 id="課題-2"><a class="header" href="#課題-2">課題 2</a></h2>
<h3 id="ユーザ管理テーブルの作成"><a class="header" href="#ユーザ管理テーブルの作成">ユーザ管理テーブルの作成</a></h3>
<p>次回の講義ではユーザ情報を連携させた機能を実装する．その際に使用する<code>users_table</code>を作成しておこう．</p>
<h3 id="テーブル名"><a class="header" href="#テーブル名">テーブル名</a></h3>
<p><code>users_table</code></p>
<h3 id="カラム構造"><a class="header" href="#カラム構造">カラム構造</a></h3>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>username</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>password</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>is_admin</code></td><td>INT</td><td>1</td><td>管理者ユーザと一般ユーザの識別に使用</td></tr>
<tr><td><code>is_deleted</code></td><td>INT</td><td>1</td><td>論理削除に使用</td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<h3 id="ユーザ管理機能の実装"><a class="header" href="#ユーザ管理機能の実装">ユーザ管理機能の実装</a></h3>
<p>前項でつくったユーザのデータを管理する処理を実装しよう！</p>
<p>講義で作成した todo リストと同じ手順で実装できるので，内容が理解不足の人は自分の課題に取り組む前に復習を兼ねて実装してみよう．</p>
<ul>
<li>ユーザ作成処理</li>
<li>ユーザ一覧参照&amp;表示処理</li>
<li>ユーザデータ更新処理</li>
<li>ユーザデータ削除処理</li>
</ul>
<p>サービス管理者がユーザのデータを操作するイメージなので画面のデザイン等は不要．</p>
<p>こちらは提出不要．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_セッション"><a class="header" href="#php_セッション">PHP_セッション</a></h1>
<h2 id="サンプルコード-9"><a class="header" href="#サンプルコード-9">サンプルコード</a></h2>
<p><a href="php/php04/../../samples/09_php04_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-9"><a class="header" href="#本講義の内容とゴール-9">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-9"><a class="header" href="#本講義の内容-9">本講義の内容</a></h3>
<ul>
<li>セッション機能の確認．</li>
<li>ログイン処理，ログアウト処理の実装．</li>
<li>todo リストをログインしていないと使えないようにする．</li>
</ul>
<h3 id="本講義のゴール-9"><a class="header" href="#本講義のゴール-9">本講義のゴール</a></h3>
<ul>
<li>ページ間でデータ共有する方法を知る！</li>
<li>プロダクトの中で最適なデータの管理方法を選べるようになる！</li>
<li>「ログインしているとはなにか」をマスター！</li>
</ul>
<h2 id="準備-4"><a class="header" href="#準備-4">準備</a></h2>
<p>以下 4 点ができているか確認しよう！</p>
<ul>
<li>XAMPP の起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッションとは"><a class="header" href="#セッションとは">セッションとは</a></h1>
<h2 id="セッションとはなにか"><a class="header" href="#セッションとはなにか">セッションとはなにか</a></h2>
<ul>
<li>サーバに変数などを保存できる仕組み．</li>
<li>サーバ自体に変数を定義する．</li>
<li>サーバ上にあるどのファイルからでも値を取り出せる！</li>
</ul>
<h3 id="普通の変数を使用した例"><a class="header" href="#普通の変数を使用した例">普通の変数を使用した例</a></h3>
<p>各ファイルで用意した変数はそのファイル内でしか使用できない．</p>
<table><thead><tr><th>file</th><th>data</th></tr></thead><tbody>
<tr><td>hoge.php</td><td>$number = 100;</td></tr>
<tr><td>fuga.php</td><td>$keyword = 'ジーズ';</td></tr>
<tr><td>piyo.php</td><td>$array = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td></tr>
</tbody></table>
<h3 id="セッション変数を活用"><a class="header" href="#セッション変数を活用">セッション変数を活用</a></h3>
<p>セッション領域自体にデータを保存することができ，サーバ上のどのファイルからでもアクセスすることができる．</p>
<p>セッション変数は<code>$_SESSION</code>で記述する（後述）．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];
      </td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッションの使用とsession_id"><a class="header" href="#セッションの使用とsession_id">セッションの使用と「session_id」</a></h2>
<p>セッションは下記の流れで使用する．</p>
<ol>
<li>セッションの開始．
<ul>
<li>セッションがスタートすると「セッション領域」が作られる．</li>
<li>セッション領域識別用の id（<code>session_id</code>）が発行される．</li>
<li>セッションの機能が使えるようになり，情報を保存できる．</li>
<li>session_id の再生成ができる．</li>
</ul>
</li>
<li>必要に応じてセッション変数（<code>$_SESSION</code>）にデータを保存．</li>
<li><code>session_id</code>の再生成
<ul>
<li>悪意あるサイトに<code>session_id</code>を読まれてしまうとハッキングのリスク．</li>
<li>ページ移動などのタイミングで id を再生成し，最新版だけを有効にする．</li>
</ul>
</li>
<li>セッションの終了．
<ul>
<li>保存されている情報などを破棄する．</li>
</ul>
</li>
</ol>
<h3 id="session_id-の確認"><a class="header" href="#session_id-の確認">session_id の確認</a></h3>
<p>まずはセッションの開始を宣言する．
セッションに関連する機能を使用する場合には必ず記述する必要がある．</p>
<pre><code class="language-php">session_start();
</code></pre>
<p>セッションを開始すると自動的に id が発行されてブラウザに id が保存される．</p>
<p>id はサーバとブラウザの双方に保存され，下記の方法で確認することができる．</p>
<ol>
<li>PHP ファイル上で<code>session_id();</code>で取得可能．</li>
<li>ブラウザで「検証 → Application → Cookies → localhost」
<ul>
<li>現在有効な session_id が保存されている．</li>
</ul>
</li>
</ol>
<h3 id="session_id-の再生成"><a class="header" href="#session_id-の再生成">session_id の再生成</a></h3>
<p>session_id がバレると他の人に session の中身をいじられてしまう可能性がある．．！</p>
<p><code>session_regenerate_id();</code>を使用すると id を再生成して更新できる．</p>
<p>（保存されているデータ自体は変更なし）</p>
<p>使い所</p>
<ul>
<li>ログインしたら id 発行してログイン情報を管理．</li>
<li>ページ移動など特定の操作をしたタイミングで再生成して古い id を無効化する．</li>
</ul>
<pre><code class="language-php">// session_regenerate_id.php

&lt;?php
// セッションの開始
session_start();
$old_session_id = session_id();

// 再生成
session_regenerate_id(true);
$new_session_id = session_id();

// 新旧のidを画面に表示して更新されていることを確認
echo &quot;&lt;p&gt;旧id: {$old_session_id}&lt;/p&gt;&quot;;
echo &quot;&lt;p&gt;新id: {$new_session_id}&lt;/p&gt;&quot;;
exit();

?&gt;

</code></pre>
<h3 id="-key-point-24"><a class="header" href="#-key-point-24">💡 Key Point</a></h3>
<blockquote>
<p><code>session_regenerate_id(true);</code>の<code>true</code>が大切！！</p>
<p><code>true</code>を設定することで古い id を無効にすることができる．</p>
</blockquote>
<h3 id="セッションの終了"><a class="header" href="#セッションの終了">セッションの終了</a></h3>
<p>セッションの終了に際しては保存したデータの削除が必要になる．</p>
<p>以下の 3 つの手順でデータを削除する．</p>
<ol>
<li>セッション変数の削除．</li>
<li>ブラウザに保存されたセッション id の有効期間操作．</li>
<li>セッション領域の削除．</li>
</ol>
<p>これらの処理は後のステップで実装する．</p>
<pre><code class="language-php">// 指定したsession変数の削除
unset($_SESSION[key]);

// session情報の全削除
$_SESSION = array();

// ブラウザに保存した情報の有効期限を操作
setcookie(session_name(), '', time() - 42000, '/');

// session領域自体をを破壊
session_destroy();

</code></pre>
<p><a href="https://www.php.net/manual/ja/function.session-destroy.php">参考</a></p>
<h2 id="練習-29"><a class="header" href="#練習-29">練習</a></h2>
<p>下記の処理を実装してセッションと session_id の挙動を確認しよう．</p>
<ul>
<li>id を発行して確認しよう！</li>
<li>再生成して旧 id と新 id を表示しよう！</li>
</ul>
<p>検証画面で確認し，リロードの度に新 ID と一致すれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="セッション変数"><a class="header" href="#セッション変数">セッション変数</a></h1>
<p>セッション領域に保存される変数を使用することで，複数のファイルで横断的にデータを扱うことができる．</p>
<h2 id="セッション変数の形式"><a class="header" href="#セッション変数の形式">セッション変数の形式</a></h2>
<p>セッション変数は<code>$_SESSION</code>で記述する．</p>
<p>連想配列形式（JavaScript のオブジェクトに相当）で扱われる．</p>
<table>
  <thead>
    <th>file</th>
    <th>session</th>
  </thead>
  <tbody>
    <tr>
      <td>hoge.php</td>
      <td rowspan="3">
        $_SESSION['number'] = 100;<br>
        $_SESSION['keyword'] = 'ジーズ';<br>
        $_SESSION['array'] = ['JavaScript', 'PHP', 'Swift', 'Rust'];</td>
    </tr>
    <tr>
      <td>fuga.php</td>
    </tr>
    <tr>
      <td>piyo.php</td>
    </tr>
  </tbody>
</table>
<h2 id="セッション変数の定義"><a class="header" href="#セッション変数の定義">セッション変数の定義</a></h2>
<p>セッション変数を扱う際にも<code>session_start();</code>は必須！</p>
<p>セッション変数は<code>$_SESSION['キー名']</code>の形式で宣言するが，使い方は通常の変数と同様である．</p>
<pre><code class="language-php">// session01.php

&lt;?php
session_start();

// セッション変数に値を代入
$_SESSION['keyword'] = 'PHP';

echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="セッション変数の使用"><a class="header" href="#セッション変数の使用">セッション変数の使用</a></h2>
<p>セッション変数はセッション領域に保存されているので，ファイル内で定義していなくても呼び出すことができる．</p>
<p>使い方は通常の変数と同様．</p>
<pre><code class="language-php">&lt;?php
// session02.php

session_start();

// `$_SESSION['keyword']`はセッション変数なので定義していなくても呼び出せる
$string = $_SESSION['keyword'] . '&amp;MySQL';
echo $_SESSION['keyword'];
exit();

?&gt;

</code></pre>
<h2 id="練習-30"><a class="header" href="#練習-30">練習</a></h2>
<p>下記の処理を記述して，セッション変数の動き方を確認しよう．</p>
<ul>
<li><code>session01.php</code>で session 変数を定義しよう！</li>
<li><code>session02.php</code>で定義した変数を呼び出して出力しよう！</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装-1ログインとログアウト"><a class="header" href="#認証処理の実装-1ログインとログアウト">認証処理の実装 1（ログインとログアウト）</a></h1>
<h2 id="ユーザテーブルの準備"><a class="header" href="#ユーザテーブルの準備">ユーザテーブルの準備</a></h2>
<p>ユーザのデータを格納するテーブルが必要になる．テーブルの構成は以下のとおりである．</p>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>username</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>password</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>is_admin</code></td><td>INT</td><td>1</td><td>管理者ユーザと一般ユーザの識別に使用</td></tr>
<tr><td><code>is_deleted</code></td><td>INT</td><td>1</td><td>論理削除に使用</td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<p>テーブルを数件のテストデータを作成するため，下記の SQL 文を実行する．</p>
<p><code>phpmyadmin</code>画面で<code>dec_todo</code>のデータベースを選択し，<code>SQL</code>タブから実行する．</p>
<pre><code class="language-sql">CREATE TABLE users_table(
  id int(12) not null primary key auto_increment,
  username varchar(128) not null,
  password varchar(128) not null,
  is_admin int(1) not null,
  is_deleted int(1) not null,
  created_at datetime not null,
  updated_at datetime not null
)
;
INSERT INTO users_table(
  id,
  username,
  password,
  is_admin,
  is_deleted,
  created_at,
  updated_at
)
VALUES(
  NULL,
  'testuser01',
  '111111',
  1,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser02',
  '222222',
  0,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser03',
  '333333',
  0,
  0,
  now(),
  now()
),
(
  NULL,
  'testuser04',
  '444444',
  0,
  0,
  now(),
  now()
)
;

</code></pre>
<h2 id="処理に必要なファイル"><a class="header" href="#処理に必要なファイル">処理に必要なファイル</a></h2>
<p>ログイン処理に<code>todo_login.php</code>と<code>todo_login.php</code>，ログアウト処理に<code>todo_logout.php</code>を使用する．</p>
<table><thead><tr><th>file</th><th>役割</th></tr></thead><tbody>
<tr><td><code>todo_login.php</code></td><td>ログイン情報（username, password）を入力して送信する．</td></tr>
<tr><td><code>todo_login_act.php</code></td><td>送信されたデータを受け取り，DB 関連の処理を実行する．</td></tr>
<tr><td><code>todo_logout.php</code></td><td>セッション，ログイン情報を破棄する．</td></tr>
</tbody></table>
<h2 id="ログイン処理"><a class="header" href="#ログイン処理">ログイン処理</a></h2>
<h3 id="ログイン処理の流れ"><a class="header" href="#ログイン処理の流れ">ログイン処理の流れ</a></h3>
<ol>
<li>ログインフォーム情報を入力して送信（<code>todo_login.php</code>）</li>
<li>送信されたデータを受け取る（<code>todo_login_act.php</code>）</li>
<li>受け取ったデータが DB にあるかどうかチェック（<code>todo_login_act.php</code>）
<ul>
<li>成功時（DB にユーザのデータが存在した場合）
<ul>
<li>DB にログイン情報があればセッション変数に格納（<code>todo_login_act.php</code>）</li>
<li>セッション変数にログイン情報を保持して<code>todo_read.php</code>に移動</li>
</ul>
</li>
<li>失敗時（DB にユーザのデータが存在しなかった場合）
<ul>
<li><code>todo_login.php</code>に戻るリンクを表示する（ログイン失敗）</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="ログイン画面の実装"><a class="header" href="#ログイン画面の実装">ログイン画面の実装</a></h2>
<p>ログインフォームに<code>action</code>，<code>method</code>，<code>name</code>を設定する．</p>
<p>データを<code>todo_login_act.php</code>に送信する．</p>
<pre><code class="language-php">// todo_login.php

&lt;form action=&quot;todo_login_act.php&quot; method=&quot;POST&quot;&gt;
  // ...
  &lt;div&gt;
    username: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    password: &lt;input type=&quot;text&quot; name=&quot;password&quot;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;button&gt;Login&lt;/button&gt;
  &lt;/div&gt;
  // ...
&lt;/form&gt;

</code></pre>
<h2 id="データ受け取り--ログイン処理"><a class="header" href="#データ受け取り--ログイン処理">データ受け取り → ログイン処理</a></h2>
<p>データを受け取ったら，ユーザのテーブルに該当するデータが存在するかどうかを確認する．</p>
<pre><code class="language-php">// todo_login_act.php

&lt;?php
session_start();
include('functions.php');

$username = $_POST['username'];
$password = $_POST['password'];

$pdo = connect_to_db();

// username，password，is_deletedの3項目全てを満たすデータを抽出する．
$sql = 'SELECT * FROM users_table WHERE username=:username AND password=:password AND is_deleted=0';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':username', $username, PDO::PARAM_STR);
$stmt-&gt;bindValue(':password', $password, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

</code></pre>
<p>データの有無で条件分岐する．</p>
<ul>
<li>データが存在しない場合はログイン画面へ移動するリンクを表示する．</li>
<li>データが存在した場合はセッション変数に session_id とユーザのデータを入れ，一覧画面に移動する．</li>
</ul>
<pre><code class="language-php">if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $val = $stmt-&gt;fetch(PDO::FETCH_ASSOC);
  if (!$val) {
    echo &quot;&lt;p&gt;ログイン情報に誤りがあります&lt;/p&gt;&quot;;
    echo &quot;&lt;a href=todo_login.php&gt;ログイン&lt;/a&gt;&quot;;
    exit();
  } else {
    $_SESSION = array();
    $_SESSION['session_id'] = session_id();
    $_SESSION['is_admin'] = $val['is_admin'];
    $_SESSION['username'] = $val['username'];
    header(&quot;Location:todo_read.php&quot;);
    exit();
  }
}

</code></pre>
<h3 id="-key-point-25"><a class="header" href="#-key-point-25">💡 Key Point</a></h3>
<blockquote>
<p><code>session_id</code>はこの後使用するので必ず保存しよう．</p>
<p>ユーザデータはアプリケーションに必要なものを適宜選別してセッションに保存する．</p>
</blockquote>
<h2 id="ログアウト"><a class="header" href="#ログアウト">ログアウト</a></h2>
<p>ログアウトの処理は前項のセッション終了のコードそのもの．</p>
<p>ユーザの痕跡をなくすことが肝要．</p>
<pre><code class="language-php">// todo_logout.php

&lt;?php
session_start();
$_SESSION = array();
if (isset($_COOKIE[session_name()])) {
  setcookie(session_name(), '', time() - 42000, '/');
}
session_destroy();
header('Location:todo_login.php');
exit();

</code></pre>
<h2 id="練習-31"><a class="header" href="#練習-31">練習</a></h2>
<p>ログインとログアウトの処理を実装しよう！</p>
<ol>
<li>ログインフォームを実装！（<code>todo_login.php</code>）</li>
<li>ログイン処理を実装！（<code>todo_login_act.php</code>）</li>
<li>ログアウト処理を実装！（<code>todo_logout.php</code>）</li>
</ol>
<p>以下の動作が確認できれば OK．</p>
<ul>
<li>存在するユーザの username と password を入力して一覧ページが表示される．</li>
<li>存在しないユーザの username と password を入力してログインページへのリンクが表示される．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="認証処理の実装-2認証状態の確認"><a class="header" href="#認証処理の実装-2認証状態の確認">認証処理の実装 2（認証状態の確認）</a></h1>
<p>todo リストの機能はログインしているときのみアクセスできるようにしたい！</p>
<p>現状では，ログアウトした状態でも URL を手打ちするとアクセスできてしまう．．．</p>
<ul>
<li>登録画面，一覧画面などはログイン済ユーザのみ見られるようにする</li>
<li>ログインをチェックし，ログインしていない状態ならログイン画面に移動</li>
</ul>
<h2 id="ログインしているとはなにか"><a class="header" href="#ログインしているとはなにか">「ログインしている」とはなにか</a></h2>
<p>以下の 2 つの状態を「ログインしていない」とみなす！！</p>
<ul>
<li>「セッション変数に<code>session_id</code>を持っていない」</li>
<li>「id が最新ではない」はログインしていない状態</li>
</ul>
<h2 id="関数の定義-1"><a class="header" href="#関数の定義-1">関数の定義</a></h2>
<p>上記 2 条件を用いてログインの有無を判断する関数を作成する．</p>
<p>関数の役割は</p>
<ol>
<li>ログインしていない場合はログインページへ強制送還．</li>
<li>ログインしている場合は<code>session_id</code>を更新してセッション変数に保存する．
<ul>
<li>セッション変数には常に最新の<code>session_id</code>が入っている状態にする．</li>
</ul>
</li>
</ol>
<p>複数のファイルでチェックを行うため，関数ファイルに記述しよう！</p>
<pre><code class="language-php">// functions.php

function check_session_id()
{
  if (!isset($_SESSION[&quot;session_id&quot;]) ||$_SESSION[&quot;session_id&quot;] != session_id()) {
    header('Location:todo_login.php');
    exit();
  } else {
    session_regenerate_id(true);
    $_SESSION[&quot;session_id&quot;] = session_id();
  }
}

</code></pre>
<h2 id="関数の実行-1"><a class="header" href="#関数の実行-1">関数の実行</a></h2>
<p>あとは定義した関数を「ログインしていないときに動いてほしくない PHP ファイル」で実行しよう．</p>
<p>セッションの機能を使用するため，<code>session_start();</code>を忘れないように注意！</p>
<p>下記ファイルで実行すると良き．</p>
<ul>
<li><code>todo_input.php</code></li>
<li><code>todo_read.php</code></li>
<li><code>todo_edit.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_create.php</code></li>
<li><code>todo_update.php</code></li>
<li><code>todo_delete.php</code></li>
</ul>
<pre><code class="language-php">// ログインしていないときに動いてほしくないPHPファイル

&lt;?php
session_start();
include('functions.php');
check_session_id();

</code></pre>
<h3 id="-key-point-26"><a class="header" href="#-key-point-26">💡 Key Point</a></h3>
<blockquote>
<p>「ログインしているユーザだけがアクセスできる画面」と「誰でもアクセスできる画面」がそれぞれどの画面なのかを明確にすることが大切．</p>
<p>同様に管理者ユーザのみがアクセス可能な画面を切り分けることも同様の方法で可能．</p>
</blockquote>
<h2 id="練習-32"><a class="header" href="#練習-32">練習</a></h2>
<p>メインのコンテンツは未ログインだとアクセスできないようにしよう！</p>
<ul>
<li>ログイン状態を確認する関数をつくろう！（functions.php）</li>
<li>コンテンツのページで上記関数を実行しよう！</li>
</ul>
<p>ログアウトした状態で各ページにアクセスできない状態（ログインページに移動）になれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-6"><a class="header" href="#課題-6">課題</a></h1>
<p><strong>セッション機能を用いて管理機能を実装しよう</strong></p>
<p>DB を扱うことで Web アプリケーションの基本的な機能を実装できる．日頃使っている Web アプリケーションの中で，DB や SQL がどのように使われているのかイメージしてみると，活用方法のイメージが湧くだろう．</p>
<h2 id="まずは下記の機能を実装しよう既存-web-サービスのコピー実装もオススメ"><a class="header" href="#まずは下記の機能を実装しよう既存-web-サービスのコピー実装もオススメ">まずは下記の機能を実装しよう（既存 web サービスのコピー実装もオススメ！）</a></h2>
<ul>
<li>ログイン画面</li>
<li>ログイン処理</li>
<li>ログアウト処理</li>
</ul>
<h2 id="ユーザの種類によって権限を分けてみよう"><a class="header" href="#ユーザの種類によって権限を分けてみよう">ユーザの種類によって権限を分けてみよう</a></h2>
<p>todo リストの例</p>
<table><thead><tr><th>ユーザ種別</th><th>できること</th><th>アクセスできるページ</th></tr></thead><tbody>
<tr><td>ログインしていないユーザ</td><td>情報を見るだけ（登録，更新&amp;削除不可）</td><td>ログイン画面<br>編集不可の todo 一覧画面</td></tr>
<tr><td>一般ユーザ</td><td>情報の登録，表示，更新，削除が可能</td><td>ログイン画面<br>編集不可の todo 一覧画面<br>todo 一覧画面<br>todo 登録画面<br>todo 編集画面</td></tr>
<tr><td>管理者ユーザ</td><td>ユーザの登録，表示，更新，削除も可能</td><td>ログイン画面<br>編集不可の todo 一覧画面<br>todo 一覧画面<br>todo 登録画面<br>todo 編集画面<br>ユーザ一覧画面<br>ユーザ編集画面<br>ユーザ編集画面</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_db-応用_rdb"><a class="header" href="#php_db-応用_rdb">PHP_DB 応用_RDB</a></h1>
<h2 id="サンプルコード-10"><a class="header" href="#サンプルコード-10">サンプルコード</a></h2>
<p><a href="php/php05/../../samples/10_php05_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-10"><a class="header" href="#本講義の内容とゴール-10">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-10"><a class="header" href="#本講義の内容-10">本講義の内容</a></h3>
<ul>
<li>RDB のデータ構造紹介．</li>
<li>SQL を用いたデータ集計（Like 機能）．</li>
<li>todo リスト一覧での集計結果表示．</li>
</ul>
<h3 id="本講義のゴール-10"><a class="header" href="#本講義のゴール-10">本講義のゴール</a></h3>
<ul>
<li>データ構造を知り，よくないテーブルのパターンを把握する！</li>
<li>データの件数をカウントし，集計する！</li>
<li>複数のテーブルを結合し，必要なデータをまとめる！</li>
</ul>
<h2 id="準備-5"><a class="header" href="#準備-5">準備</a></h2>
<p>以下 4 点ができているか確認しよう！</p>
<ul>
<li>XAMPP の起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="rdb-の構造"><a class="header" href="#rdb-の構造">RDB の構造</a></h1>
<h2 id="rdbrelational-databaseとは"><a class="header" href="#rdbrelational-databaseとは">RDB（Relational Database）とは</a></h2>
<h3 id="複雑なデータが必要なとき"><a class="header" href="#複雑なデータが必要なとき">複雑なデータが必要なとき</a></h3>
<ul>
<li>一つのテーブルから取得できる情報は限られている．</li>
<li>EC で購入したユーザの情報と商品の情報を両方取得したい場合は．．？？</li>
</ul>
<h3 id="複数のテーブル同士を連携relationさせるッ"><a class="header" href="#複数のテーブル同士を連携relationさせるッ">複数のテーブル同士を連携（relation）させるッ！！</a></h3>
<ul>
<li>テーブルの設計段階で連携させたい id のカラムをつくっておく！</li>
<li>両方のテーブルを関連付けるテーブルを「SQL で」作成する！</li>
<li>大事なのはデータの構造を見極めること！！</li>
</ul>
<p>まずは下記 2 種類のデータ構造をマスターしよう！</p>
<h2 id="one-to-many学部テーブルと学生テーブル"><a class="header" href="#one-to-many学部テーブルと学生テーブル">One to Many（学部テーブルと学生テーブル）</a></h2>
<p>一つの学部には複数の学生が在籍するが，学生の所属は一つ．</p>
<h3 id="学部テーブルdepartment_table"><a class="header" href="#学部テーブルdepartment_table">学部テーブル（department_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>工学部</td></tr>
<tr><td align="right">2</td><td>理学部</td></tr>
<tr><td align="right">3</td><td>医学部</td></tr>
<tr><td align="right">4</td><td>歯学部</td></tr>
<tr><td align="right">5</td><td>農学部</td></tr>
<tr><td align="right">6</td><td>文学部</td></tr>
<tr><td align="right">7</td><td>経済学部</td></tr>
</tbody></table>
<h3 id="学生テーブルstudent_table"><a class="header" href="#学生テーブルstudent_table">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<p>「多」の側に対応する id を入れる構造にすれば OK．</p>
<p>誰がどこに所属しているかがわかるようになる！</p>
<table><thead><tr><th align="right">id</th><th>name</th><th align="right">department_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td><td align="right">1</td></tr>
<tr><td align="right">3</td><td>リサリサ</td><td align="right">2</td></tr>
<tr><td align="right">4</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">6</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td><td align="right">4</td></tr>
<tr><td align="right">8</td><td>川尻早人</td><td align="right">4</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td><td align="right">5</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td><td align="right">5</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td><td align="right">6</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td><td align="right">6</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td><td align="right">7</td></tr>
</tbody></table>
<h2 id="many-to-many学生テーブルと講義テーブル"><a class="header" href="#many-to-many学生テーブルと講義テーブル">Many to Many（学生テーブルと講義テーブル）</a></h2>
<p>学生は複数の講義を選択し，講義も複数の学生に提供される．</p>
<h3 id="学生テーブルstudent_table-1"><a class="header" href="#学生テーブルstudent_table-1">学生テーブル（student_table）</a></h3>
<table><thead><tr><th align="right">student_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td></tr>
<tr><td align="right">2</td><td>ツェペリ</td></tr>
<tr><td align="right">3</td><td>リサリサ</td></tr>
<tr><td align="right">4</td><td>カーズ</td></tr>
<tr><td align="right">5</td><td>花京院典明</td></tr>
<tr><td align="right">6</td><td>DIO</td></tr>
<tr><td align="right">7</td><td>吉良吉影</td></tr>
<tr><td align="right">8</td><td>川尻早人</td></tr>
<tr><td align="right">9</td><td>パンナコッタ・フーゴ</td></tr>
<tr><td align="right">10</td><td>ディアボロ</td></tr>
<tr><td align="right">11</td><td>エルメェス・コステロ</td></tr>
<tr><td align="right">12</td><td>エンリコ・プッチ</td></tr>
<tr><td align="right">13</td><td>ジャイロ・ツェペリ</td></tr>
<tr><td align="right">14</td><td>ファニー・ヴァレンタイン</td></tr>
</tbody></table>
<h3 id="講義テーブルclass_table"><a class="header" href="#講義テーブルclass_table">講義テーブル（class_table）</a></h3>
<table><thead><tr><th align="right">class_id</th><th>name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>線形代数学</td></tr>
<tr><td align="right">2</td><td>微分積分学</td></tr>
<tr><td align="right">3</td><td>電子回路</td></tr>
<tr><td align="right">4</td><td>電気回路</td></tr>
<tr><td align="right">5</td><td>情報学</td></tr>
<tr><td align="right">6</td><td>情報数学</td></tr>
<tr><td align="right">7</td><td>統計学</td></tr>
<tr><td align="right">8</td><td>信号処理</td></tr>
<tr><td align="right">9</td><td>電磁気学</td></tr>
</tbody></table>
<h3 id="中間テーブル"><a class="header" href="#中間テーブル">中間テーブル</a></h3>
<p>この場合，「どの講義を」「どの学生が選択するか」を表す別のテーブルを作成する．</p>
<p>このテーブルのことを「中間テーブル」と呼ぶ．</p>
<table><thead><tr><th align="right">class_id</th><th align="right">student_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">1</td><td align="right">2</td></tr>
<tr><td align="right">1</td><td align="right">7</td></tr>
<tr><td align="right">7</td><td align="right">7</td></tr>
<tr><td align="right">3</td><td align="right">9</td></tr>
<tr><td align="right">1</td><td align="right">6</td></tr>
<tr><td align="right">3</td><td align="right">1</td></tr>
<tr><td align="right">5</td><td align="right">5</td></tr>
<tr><td align="right">7</td><td align="right">5</td></tr>
</tbody></table>
<h2 id="テーブルの設計"><a class="header" href="#テーブルの設計">テーブルの設計</a></h2>
<p>データ構造を考える際には，「どうすればうまくいくか」よりも「このパターンはマズイ」を押さえるとうまくいきやすい．</p>
<p>マズイパターンのことを「アンチパターン」と呼ぶが，まずは下記のパターンがないかどうか確認しよう．</p>
<h3 id="-key-point-27"><a class="header" href="#-key-point-27">💡 Key Point</a></h3>
<blockquote>
<p>出やすいアンチパターン</p>
<ul>
<li>ユーザの操作でテーブルが増える（減る）．</li>
<li>ユーザの操作でカラムが増える（減る）．</li>
<li>一つのセル（でいいのかな？）に複数のデータ（数値など）が入る．</li>
<li>なにかのデータを更新したときに，別のテーブルのデータを更新する必要がある．</li>
</ul>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like-機能の実装-1データの追加-1"><a class="header" href="#like-機能の実装-1データの追加-1">Like 機能の実装 1（データの追加 1）</a></h1>
<p>前回までに作成した todo リストに Like 機能（Many to Many の関係）を追加する！</p>
<h2 id="アプリケーションの動作"><a class="header" href="#アプリケーションの動作">アプリケーションの動作</a></h2>
<ul>
<li>各ユーザは複数の todo に Like し，各 todo は複数のユーザから Like される．</li>
<li>一覧画面の Like ボタンをクリックしたら Like することができ，Like 数が一覧画面に表示される．</li>
<li>Like は 1 ユーザ 1Like に制限する（自演禁止）．</li>
</ul>
<h2 id="必要な作業処理"><a class="header" href="#必要な作業処理">必要な作業・処理</a></h2>
<ul>
<li>ユーザテーブルといいねテーブルを作成．</li>
<li>Like ボタン追加．</li>
<li>Like ボタンクリック時に Like データを作成．</li>
<li>Like 数を一覧画面に表示する．</li>
</ul>
<h2 id="like-テーブルを作成"><a class="header" href="#like-テーブルを作成">Like テーブルを作成</a></h2>
<p>新しくテーブルを作成する．テーブル名は「<code>like_table</code>」とする．</p>
<p>このテーブルでは「どのユーザが」「どの todo に」Like したのかを記録する役割を持つ．</p>
<p>前項の「中間テーブル」にあたる．</p>
<h3 id="カラム構造-1"><a class="header" href="#カラム構造-1">カラム構造</a></h3>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>user_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>todo_id</code></td><td>INT</td><td>12</td><td></td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<h2 id="todo-リストの-like-機能実装"><a class="header" href="#todo-リストの-like-機能実装">todo リストの Like 機能実装</a></h2>
<h3 id="やりたいこと-2"><a class="header" href="#やりたいこと-2">やりたいこと</a></h3>
<p>いいねボタンをクリックしたら．．．</p>
<ul>
<li>like_table に「誰が」「何に」いいねをしたのかを追加</li>
</ul>
<p>実装の方針</p>
<ul>
<li>todo_read.php にいいねボタンを設置</li>
<li>GET で todo の id とユーザの id を送信する</li>
<li>受け取り側のファイル（like_create.php）で受け取ったデータを db に登録</li>
</ul>
<h2 id="todo-一覧画面に-like-ボタンの設置"><a class="header" href="#todo-一覧画面に-like-ボタンの設置">todo 一覧画面に Like ボタンの設置</a></h2>
<p>一覧画面のタグ生成部分に Like ボタンを追記する．</p>
<p>user_id はログイン時にセッション変数に保存している値を使用する（<code>todo_login_act.php</code>に追記）．</p>
<pre><code class="language-php">// todo_login_act.php

if (!$val) {
  echo &quot;&lt;p&gt;ログイン情報に誤りがあります&lt;/p&gt;&quot;;
  echo &quot;&lt;a href=todo_login.php&gt;ログイン&lt;/a&gt;&quot;;
  exit();
} else {
  $_SESSION = array();
  // 🔽 ここを追記
  $_SESSION['user_id'] = $val['id'];
  $_SESSION['session_id'] = session_id();
  $_SESSION['is_admin'] = $val['is_admin'];
  $_SESSION['username'] = $val['username'];
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<p><code>user_id</code>と<code>todo_id</code>を<code>like_create.php</code>に GET で送信する．</p>
<pre><code class="language-php">// todo_read.php

$user_id = $_SESSION['user_id'];

// 🔽 タグ生成部分
foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      // 🔽 ここ1行追記
      &lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<h2 id="like-データの追加"><a class="header" href="#like-データの追加">Like データの追加</a></h2>
<p>Like テーブルに GET で送信されてきた内容を追加する．</p>
<p>処理の流れ自体はシンプルな INSERT 処理．</p>
<pre><code class="language-php">// like_create.php

include('functions.php');

$user_id = $_GET['user_id'];
$todo_id = $_GET['todo_id'];

$pdo = connect_to_db();

$sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, now())';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<h2 id="練習-33"><a class="header" href="#練習-33">練習</a></h2>
<p>todo リストに Like 機能を追加しよう．</p>
<ul>
<li><code>todo_read.php</code>に Like ボタンを追加．</li>
<li><code>like_create.php</code>でテーブルにデータ作成．</li>
</ul>
<p>Like ボタンをクリックして，Like テーブルにデータが作成されていれば OK．</p>
<p>（phpmyadmin でデータを確認しよう）</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like-機能の実装-2データの追加-2"><a class="header" href="#like-機能の実装-2データの追加-2">Like 機能の実装 2（データの追加 2）</a></h1>
<h2 id="ここまでの-like-機能の問題点"><a class="header" href="#ここまでの-like-機能の問題点">ここまでの Like 機能の問題点</a></h2>
<h3 id="現状"><a class="header" href="#現状">現状</a></h3>
<ul>
<li>連打すれば無限に Like できてしまう．．．</li>
<li>Like している状況であれば，Like を取り消す処理にしたい！</li>
</ul>
<h3 id="実装の方針"><a class="header" href="#実装の方針">実装の方針</a></h3>
<ul>
<li>Like ボタンをクリックしたら，まず todo と user でテーブルを検索する．</li>
<li>データが 1 件以上存在すれば DELETE の SQL を実行する．</li>
<li>データが存在しなければ INSERT の SQL（前項で実装したもの）を実行する．</li>
</ul>
<h2 id="like-状態の調査"><a class="header" href="#like-状態の調査">Like 状態の調査</a></h2>
<p>前項で作成した<code>like_create.php</code>の INSERT 処理の前にデータの件数を確認したい．</p>
<p>件数の確認には<code>COUNT()</code>関数を使用する．</p>
<pre><code class="language-php">// like_create.php

// 省略

$sql = 'SELECT COUNT(*) FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  $like_count = $stmt-&gt;fetchColumn();
  // まずはデータ確認
  var_dump($like_count);
  exit();
}

</code></pre>
<h2 id="like-数で条件分岐削除-or-作成"><a class="header" href="#like-数で条件分岐削除-or-作成">Like 数で条件分岐（削除 or 作成）</a></h2>
<p><code>$like_count</code>で条件に該当するデータの件数が取得できるのでまずは確認する．</p>
<p>データの件数が確認できたら，件数が 0 かそれ以外で条件分岐する．0 件でなければ DELETE 文が作成され，0 件の場合は INSERT 文が作成される．</p>
<pre><code class="language-php">// like_create.php

if ($like_count != 0) {
  // いいねされている状態
  $sql = 'DELETE FROM like_table WHERE user_id=:user_id AND todo_id=:todo_id';
} else {
  // いいねされていない状態
  $sql = 'INSERT INTO like_table (id, user_id, todo_id, created_at) VALUES (NULL, :user_id, :todo_id, sysdate())';
}

// 以下は前項と変更なし
$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':user_id', $user_id, PDO::PARAM_STR);
$stmt-&gt;bindValue(':todo_id', $todo_id, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_read.php&quot;);
  exit();
}

</code></pre>
<p>このように記述することで，1 ユーザ 1Like の状態を実現することができる．</p>
<h2 id="練習-34"><a class="header" href="#練習-34">練習</a></h2>
<p>todo リストの Like 機能を編集しよう．</p>
<ul>
<li><code>like_create.php</code>で Like 数カウント -&gt; 条件分岐して DELETE or INSERT．</li>
</ul>
<p>以下 2 条件で動作確認！</p>
<ul>
<li>「Like されていない状態」で Like ボタンをクリックして，Like テーブルにデータが作成されていれば OK．</li>
<li>「Like されている状態」で Like ボタンをクリックして，Like テーブルのデータが削除されていれば OK．</li>
</ul>
<p>phpmyadmin でデータを確認し，10 件程度データが入っている状態にしておこう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like-機能の実装-3集計と-like-数表示"><a class="header" href="#like-機能の実装-3集計と-like-数表示">Like 機能の実装 3（集計と Like 数表示）</a></h1>
<h2 id="やりたいこと-3"><a class="header" href="#やりたいこと-3">やりたいこと</a></h2>
<ul>
<li>ここまでで Like 数を 1 ユーザあたり 1 件に制限する処理を実装した．</li>
<li>しかし，現状では Like 状況を確認するには phpmyadmin にアクセスして確認するしかなくアプリケーション側に情報が表示されない．</li>
<li>そこで，本項では Like された件数を todo 一覧画面に表示するための処理を実装する．</li>
</ul>
<h2 id="手順"><a class="header" href="#手順">手順</a></h2>
<ul>
<li>Like 情報が保存されている「Like テーブル」を用いて，各 todo が何件 Like されているのかを集計する．</li>
<li>「todo テーブル」と「集計結果のテーブル」を結合し，両方のデータを一度に取得できるようにする．</li>
<li>取得したデータを画面に表示する．</li>
</ul>
<h2 id="集計"><a class="header" href="#集計">集計</a></h2>
<p>GROUP BY を使うと集計ができる！</p>
<h3 id="例phpmyadmin-で実行しよう"><a class="header" href="#例phpmyadmin-で実行しよう">例（phpmyadmin で実行しよう！）</a></h3>
<pre><code class="language-sql">SELECT
  todo_id,
  COUNT(id) AS like_count
FROM
  like_table
GROUP BY
  todo_id
</code></pre>
<p>「<code>like_table</code>」の「<code>todo_id</code>」ごとに「id の数」を「<code>like_count</code>」というカラム名で表示する．</p>
<p>集計したカラムのカラム名は自由に設定できる（しなくても良い）が，後ほど再利用する場合は何らかの名前を指定しておくのがオススメ．</p>
<p>実行すると下記のような集計結果のテーブルが表示される．下記は一例なので，<code>like_table</code>のデータによって件数は変化する．</p>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="-key-point-28"><a class="header" href="#-key-point-28">💡 Key Point</a></h3>
<blockquote>
<p>この SQL 文は「集計結果のテーブル」を出力する！！</p>
</blockquote>
<h3 id="注意点-1"><a class="header" href="#注意点-1">注意点</a></h3>
<ul>
<li>COUNT()で件数を取得しているが，集計関数以外だとエラーになる</li>
<li>その他の集計関数
<ul>
<li><code>MIN()</code>, <code>MAX()</code>, <code>SUM()</code>, etc...</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="like-機能の実装-4データの結合"><a class="header" href="#like-機能の実装-4データの結合">Like 機能の実装 4（データの結合）</a></h1>
<h2 id="画面表示のためにデータをまとめる"><a class="header" href="#画面表示のためにデータをまとめる">画面表示のためにデータをまとめる．</a></h2>
<ul>
<li>現状，画面の表示は<code>todo_table</code>からデータなので，集計結果を組み込めない．．．</li>
<li>テーブルを結合させることで，集計結果もまとめて表示できる！</li>
</ul>
<h2 id="sql-の考え方"><a class="header" href="#sql-の考え方">SQL の考え方</a></h2>
<ul>
<li>「<code>todo_table</code>」と「集計結果のテーブル」をつなげる．</li>
<li>「<code>todo_table</code>の<code>id</code>」と「集計結果のテーブルの<code>todo_id</code>」を対応させる．</li>
<li>「集計結果のテーブル」は前項で取得したアレ</li>
</ul>
<h2 id="テーブルの結合join"><a class="header" href="#テーブルの結合join">テーブルの結合（JOIN）</a></h2>
<p>JOIN を使うとテーブルの結合ができる！</p>
<h3 id="例-8"><a class="header" href="#例-8">例</a></h3>
<p>JOIN を使う場合の書式は以下のとおり．この場合は以下の条件で結合する．</p>
<ul>
<li>別々のテーブルで管理している「ユーザ」と「ユーザが所属するカテゴリ」を 1 つの画面に表示したい．</li>
<li>「<code>user_table</code>」「<code>category_table</code>」を結合する．</li>
<li>結合する際には，「<code>user_table</code>の<code>category_id</code>カラム」と「<code>category_table</code>の<code>category_id</code>カラム」を対応させる．</li>
</ul>
<h3 id="user_table"><a class="header" href="#user_table">user_table</a></h3>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td></tr>
</tbody></table>
<h3 id="category_table"><a class="header" href="#category_table">category_table</a></h3>
<table><thead><tr><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>ダイヤモンドは砕けない</td></tr>
<tr><td align="right">5</td><td>黄金の風</td></tr>
<tr><td align="right">6</td><td>ストーンオーシャン</td></tr>
<tr><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h3 id="sql-文"><a class="header" href="#sql-文">SQL 文</a></h3>
<pre><code class="language-sql">SELECT
  *
FROM
  user_table
  LEFT OUTER JOIN
    category_table
  ON  user_table.category_id = category_table.category_id
</code></pre>
<h3 id="join-したテーブル"><a class="header" href="#join-したテーブル">JOIN したテーブル</a></h3>
<p>このテーブルがあれば，画面に必要な情報を全て表示することができる．SQL 文の「ON」の後にどのカラムとどのカラムを対応させるのかと記述する．</p>
<table><thead><tr><th align="right">user_id</th><th>user_name</th><th align="right">category_id</th><th>category_name</th></tr></thead><tbody>
<tr><td align="right">1</td><td>ディオ・ブランドー</td><td align="right">1</td><td>ファントムブラッド</td></tr>
<tr><td align="right">2</td><td>カーズ</td><td align="right">2</td><td>戦闘潮流</td></tr>
<tr><td align="right">3</td><td>DIO</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">4</td><td>花京院典明</td><td align="right">3</td><td>スターダストクルセイダース</td></tr>
<tr><td align="right">5</td><td>ジャイロ・ツェペリ</td><td align="right">7</td><td>スティール・ボール・ラン</td></tr>
</tbody></table>
<h2 id="今回の-todo-リストで結合したいテーブルの状況"><a class="header" href="#今回の-todo-リストで結合したいテーブルの状況">今回の todo リストで結合したいテーブルの状況</a></h2>
<p>「<code>todo_table</code>」と「集計結果のテーブル」を結合する．</p>
<h3 id="todo_table"><a class="header" href="#todo_table"><code>todo_table</code></a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL 練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td></tr>
<tr><td align="right">2</td><td>PHP 課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td></tr>
</tbody></table>
<h3 id="集計結果のテーブル"><a class="header" href="#集計結果のテーブル">集計結果のテーブル</a></h3>
<table><thead><tr><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="sql-文-1"><a class="header" href="#sql-文-1">SQL 文</a></h3>
<ul>
<li>今回は「<code>todo_table</code>の<code>id</code>」と「集計結果の<code>todo_id</code>」が対応させる．</li>
<li>「集計結果のテーブル」は前項で<code>GROUP BY</code>して出力したテーブル．このテーブルには<code>result-table</code>という名前をつける．</li>
</ul>
<pre><code class="language-sql">SELECT
  *
FROM
  todo_table
  LEFT OUTER JOIN
    (
      SELECT
        todo_id,
        COUNT(id) AS like_count
      FROM
        like_table
      GROUP BY
        todo_id
    ) AS result_table
  ON  todo_table.id = result_table.todo_id
</code></pre>
<h3 id="出力結果"><a class="header" href="#出力結果">出力結果</a></h3>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL 練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP 課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
<tr><td align="right">6</td><td>ワインを買う</td><td>2021-06-04</td><td>2021-06-01 12:06:14</td><td>2021-06-04 17:18:34</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">7</td><td>良い食材を買う</td><td>2021-06-03</td><td>2021-06-01 12:06:39</td><td>2021-06-04 17:18:25</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">8</td><td>肉を焼く</td><td>2021-06-09</td><td>2021-06-01 12:06:59</td><td>2021-06-01 12:06:59</td><td align="right">NULL</td><td align="right">NULL</td></tr>
<tr><td align="right">10</td><td>質問投稿する</td><td>2021-06-01</td><td>2021-06-01 12:07:45</td><td>2021-06-01 12:07:45</td><td align="right">NULL</td><td align="right">NULL</td></tr>
</tbody></table>
<h3 id="参考inner-join"><a class="header" href="#参考inner-join">【参考】INNER JOIN</a></h3>
<p><code>LEFT OUTER JOIN</code>の代わりに<code>INNER JOIN</code>を使用すると下記のテーブルが得られる．</p>
<p>（結合元のどちらかのテーブルでデータが欠損している場合は結合結果に表示されない）</p>
<table><thead><tr><th align="right">id</th><th>todo</th><th>deadline</th><th>created_at</th><th>updated_at</th><th align="right">todo_id</th><th align="right">like_count</th></tr></thead><tbody>
<tr><td align="right">1</td><td>SQL 練習</td><td>2021-06-01</td><td>2021-06-01 11:58:44</td><td>2021-06-01 11:58:44</td><td align="right">1</td><td align="right">1</td></tr>
<tr><td align="right">2</td><td>PHP 課題</td><td>2021-06-04</td><td>2021-06-01 11:59:25</td><td>2021-06-01 11:59:25</td><td align="right">2</td><td align="right">1</td></tr>
<tr><td align="right">4</td><td>ビールを買う</td><td>2021-06-01</td><td>2021-06-01 12:00:59</td><td>2021-06-04 17:18:19</td><td align="right">4</td><td align="right">2</td></tr>
<tr><td align="right">5</td><td>ウイスキーを買う</td><td>2021-06-10</td><td>2021-06-01 12:01:11</td><td>2021-06-04 17:17:56</td><td align="right">5</td><td align="right">2</td></tr>
</tbody></table>
<h3 id="画面に結合したデータを表示"><a class="header" href="#画面に結合したデータを表示">画面に結合したデータを表示</a></h3>
<p>一覧画面で上記のデータを参照し，画面に集計結果を表示する．</p>
<pre><code class="language-php">// todo_read.php

// 省略

$sql = 'SELECT * FROM todo_table LEFT OUTER JOIN (SELECT todo_id, COUNT(id) AS like_count FROM like_table GROUP BY todo_id) AS result_table ON todo_table.id = result_table.todo_id';

// タグ生成部分

foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      // 🔽 ここに`$record[&quot;like_count&quot;]`を追加！
      &lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like{$record[&quot;like_count&quot;]}&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

</code></pre>
<h2 id="練習-35"><a class="header" href="#練習-35">練習</a></h2>
<p>下記の処理を実装しよう！</p>
<ol>
<li><code>GROUP BY</code>を使って like_table のデータを集計しよう（phpmyadmin で確認）．</li>
<li><code>JOIN</code>を使用して<code>todo_table</code>と集計結果のテーブルを結合しよう（phpmyadmin で確認）．</li>
<li>2 で結合したテーブルを用いて，todo 一覧画面に集計結果を表示しよう．</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-7"><a class="header" href="#課題-7">課題</a></h1>
<p><strong>集計や結合を利用したアプリケーションを実装しよう</strong></p>
<p>集計や結合を使うことで既存の Web サービスの細かい処理も実装できるようになる．</p>
<p>Twitter の機能をコピーしてみる，EC サイトの仕組み（カートやお気に入り機能）を実装してみる，などもテーブル設計のヒントが得られるだろう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="php_ファイル操作と-ajax"><a class="header" href="#php_ファイル操作と-ajax">PHP_ファイル操作と Ajax</a></h1>
<h2 id="サンプルコード-11"><a class="header" href="#サンプルコード-11">サンプルコード</a></h2>
<p><a href="php/php06/../../samples/11_php06_sample.zip">download</a></p>
<h2 id="本講義の内容とゴール-11"><a class="header" href="#本講義の内容とゴール-11">本講義の内容とゴール</a></h2>
<h3 id="本講義の内容-11"><a class="header" href="#本講義の内容-11">本講義の内容</a></h3>
<ul>
<li>ファイルをサーバに保存する処理を実装．</li>
<li>todo リストに画像アップロード機能を追加．</li>
<li>todo リストにリアルタイムキーワード検索を実装．</li>
</ul>
<h3 id="本講義のゴール-11"><a class="header" href="#本講義のゴール-11">本講義のゴール</a></h3>
<ul>
<li>ファイルの扱いを知る．</li>
<li>ファイルと DB の組み合わせ方を知る．</li>
<li>JavaScript と PHP でシームレスなデータ通信を行う！</li>
</ul>
<h2 id="準備-6"><a class="header" href="#準備-6">準備</a></h2>
<p>以下 4 点ができているか確認しよう！</p>
<ul>
<li>XAMPP の起動確認</li>
<li><a href="http://localhost/">http://localhost/</a>のアクセス確認</li>
<li><a href="http://localhost/phpmyadmin">http://localhost/phpmyadmin</a>のアクセス確認</li>
<li>サンプルフォルダを「htdocs」フォルダに入れる</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイルアップロードの流れ"><a class="header" href="#ファイルアップロードの流れ">ファイルアップロードの流れ</a></h1>
<h2 id="ファイルアップロード"><a class="header" href="#ファイルアップロード">ファイルアップロード</a></h2>
<p>Web アプリケーションでは，ユーザが撮影した画像や動画などを送信して共有する場面が多々存在する．</p>
<p>しかし，これまで扱ってきたデータベースにはテキストデータしか保存することができないため，上記のような場合には別の方法が必要となる．</p>
<p>（画像をテキスト形式に変換してデータベースに保存する方法もあるが，容量の大きなデータには向かない．）</p>
<p>このような場合には，ファイル自体をサーバへ送信して指定したディレクトリに保存する，という方法をとる必要がある．</p>
<h2 id="ファイルアップロードの流れ-1"><a class="header" href="#ファイルアップロードの流れ-1">ファイルアップロードの流れ</a></h2>
<p>ファイルをサーバへ送信する際の流れは決まっている．</p>
<ol>
<li>フォーム（<code>&lt;form&gt;</code>）からアップロードする．</li>
<li>tmp 領域（一時保存場所）に自動的に保存される．</li>
<li>サーバの保存領域に移動（今回は「<code>upload</code>」ディレクトリとする）</li>
</ol>
<p>この流れは毎回同じであり，サーバ側（PHP）では「一時保存場所から指定した保存場所にファイルを移動する」処理がメインとなる．</p>
<h2 id="保存場所の準備"><a class="header" href="#保存場所の準備">保存場所の準備</a></h2>
<p>今回は<code>upload</code>ディレクトリを画像保存場所とする．</p>
<p>サンプルファイルを格納しているフォルダ内に<code>upload</code>フォルダを作成しておく．</p>
<pre><code class="language-bash"># サンプルフォルダ内の構成
.
├── ajax_get.php
├── ajax_search.html
├── create_file.php
├── # その他大勢
├── todo_update.php
└── upload  # &lt;- これを作成する！

</code></pre>
<h2 id="-macos-の場合は権限の設定が必要-1"><a class="header" href="#-macos-の場合は権限の設定が必要-1">⚠️ MacOS の場合は権限の設定が必要</a></h2>
<p>（WindowsOS の場合は設定不要）</p>
<ul>
<li>初期状態では PHP からファイルを操作する権限が付与されていない．</li>
<li>以下の手順で権限を設定する．</li>
</ul>
<ol>
<li>「htdocs に入れた講義フォルダ」で</li>
<li>メニュー表示 =&gt; 情報を見る =&gt; 共有とアクセス権</li>
<li>全て「読み/書き」に変更 =&gt; 歯車ボタン =&gt; 内包している項目に適用</li>
</ol>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイルアップロード実装"><a class="header" href="#ファイルアップロード実装">ファイルアップロード実装</a></h1>
<h2 id="フォームからファイルを送信"><a class="header" href="#フォームからファイルを送信">フォームからファイルを送信</a></h2>
<p>ファイルをサーバに送信する場合もこれまで同様フォームから操作するが，一部追記が必要となる．</p>
<ul>
<li><code>&lt;input type=&quot;file&quot;&gt;</code>を使用．</li>
<li>使用時には<code>&lt;form&gt;</code>内に「<code>enctype=&quot;multipart/form-data&quot;</code>」が必須！！</li>
<li>method は<code>POST</code>を使用！</li>
</ul>
<blockquote>
<p>【解説 / <code>enctype=&quot;multipart/form-data&quot;</code>について】</p>
<ul>
<li>これまで<code>&lt;form&gt;</code>から送信していたのはテキストデータのみであったが，画像や音声のファイルはバイナリ形式である．</li>
<li>この 2 つのデータを混在させてデータを送信する場合にはこの記述が必要となる．</li>
</ul>
</blockquote>
<pre><code class="language-html">&lt;!-- file_upform.php --&gt;
&lt;form action=&quot;file_upload.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;
  &lt;!-- 省略 --&gt;
  &lt;input type=&quot;file&quot; name=&quot;upfile&quot; accept=&quot;image/*&quot; capture=&quot;camera&quot; /&gt;
  &lt;!-- 省略 --&gt;
&lt;/form&gt;
</code></pre>
<h2 id="サーバ側でのファイル保存の流れ"><a class="header" href="#サーバ側でのファイル保存の流れ">サーバ側でのファイル保存の流れ</a></h2>
<p>今回は画像ファイルをサーバに送信して保存する処理を実装する．以下の流れで順番に進める．</p>
<ol start="0">
<li>準備：送信時にエラー等ないかどうか確認する．</li>
<li>送られてきたファイルの情報を取得する（ファイルは自動的に tmp 領域に保管されている状態）．</li>
<li>ファイル名を準備する（他のファイルと被らないようにするため）．</li>
<li>サーバの保存領域に移動（今回は「<code>upload</code>」ディレクトリ）．</li>
<li>サンプルファイルでは保存した画像ファイルを img タグで画面に表示する．</li>
</ol>
<h3 id="-key-point-29"><a class="header" href="#-key-point-29">💡 Key Point</a></h3>
<blockquote>
<p>if 文が多いのでコードをどこに書くか確認しましょう！</p>
</blockquote>
<h3 id="送信時のエラー確認"><a class="header" href="#送信時のエラー確認">送信時のエラー確認</a></h3>
<p>まず，「送信されたデータを正しく受け取ることができているかどうか」を確認する．</p>
<ul>
<li>「ファイルが送信されていない」 or 「送信時にエラーが発生した」状態はエラーを出して終了させる．</li>
<li>送信されたファイルは<code>$_FILES</code>で受け取ることができる！</li>
<li>まずは<code>var_dump()</code>でデータを確認すること！</li>
</ul>
<blockquote>
<p>【参考 / <code>$_FILES</code>の中身】</p>
<ul>
<li><code>$_FILES</code>には名前，種類，サイズなどファイルに関する情報が含まれている．</li>
<li>また，送信時のエラー状況も含まれており，<code>[&quot;error&quot;]</code>が 0 の場合は正常に送信されていることを示している．</li>
</ul>
<pre><code class="language-bash">array(1) {
 [&quot;upfile&quot;] =&gt;
 array(5) {
   [&quot;name&quot;] =&gt; string(19) &quot;EH91HetUUAgJkWW.jpg&quot;
   [&quot;type&quot;] =&gt; string(10) &quot;image/jpeg&quot;
   [&quot;tmp_name&quot;] =&gt; string(25) &quot;/opt/lampp/temp/phpFq7XJl&quot;
   [&quot;error&quot;] =&gt; int(0)
   [&quot;size&quot;] =&gt; int(85162)
 }
}

</code></pre>
</blockquote>
<pre><code class="language-php">// file_upload.php

if (isset($_FILES['upfile']) &amp;&amp; $_FILES['upfile']['error'] == 0) {
  // 送信が正常に行われたときの処理
  // ...
} else {
  exit('Error:画像が送信されていません');
}

</code></pre>
<h3 id="送信されたデータから必要な情報を取得"><a class="header" href="#送信されたデータから必要な情報を取得">送信されたデータから必要な情報を取得</a></h3>
<p>正しくデータが送信されていれば，ファイル自体は tmp 領域に保存された状態になっている．</p>
<p>ここでは，ファイルを指定の場所に保存するために必要な情報を取得する．</p>
<p>必要な情報は以下のとおり．</p>
<ul>
<li>ファイル名</li>
<li>一時保存されている場所</li>
<li>指定の保存場所（前項で作成した<code>upload</code>フォルダ）</li>
</ul>
<pre><code class="language-php">// file_upload.php

$uploaded_file_name = $_FILES['upfile']['name'];
$temp_path  = $_FILES['upfile']['tmp_name'];
$directory_path = 'upload/';

</code></pre>
<h3 id="ファイル名の準備"><a class="header" href="#ファイル名の準備">ファイル名の準備</a></h3>
<p>サーバにファイルを保存する場合は名前の付け方が重要となる．</p>
<p>Web アプリケーションでは様々なユーザが使用することが想定され，ファイル名が重複すると予期せぬ結果が発生するリスクがある．</p>
<p>そのため，ファイルを指定の場所に保存するタイミングで重複しない名前をつけておくことが重要となる．ここでは次の手順で重複しない名前を準備する．</p>
<ul>
<li>ファイルの拡張子の種類を取得する．</li>
<li>ファイルごとにユニークな名前を作成し，末尾に拡張子を追加する．</li>
<li>指定の保存場所を追加し，保存用のパスを作成（<code>upload/hogehoge.png</code>のような形になる）．</li>
</ul>
<pre><code class="language-php">// file_upload.php

$extension = pathinfo($uploaded_file_name, PATHINFO_EXTENSION);
$unique_name = date('YmdHis').md5(session_id()) . '.' . $extension;
$save_path = $directory_path . $unique_name;

</code></pre>
<h3 id="指定の場所に指定の名前でファイルを保存する"><a class="header" href="#指定の場所に指定の名前でファイルを保存する">指定の場所に指定の名前でファイルを保存する</a></h3>
<p>ファイル名の準備ができたら，tmp 領域から指定の保存場所へファイルを移動する．</p>
<p>移動する際には下記の条件分岐を行う．</p>
<ul>
<li>tmp 領域にファイルが存在しているかどうか．</li>
<li>指定のパスでファイルの保存が成功したかどうか．</li>
</ul>
<p>双方の条件をクリアした場合は，PHP がファイルを操作するために権限を変更し，画像を HTML に埋め込む．</p>
<p>HTML 内の適当な場所への<code>$img</code>の出力を忘れずに！</p>
<p><a href="https://www.atmarkit.co.jp/ait/articles/1605/23/news020.html">権限の参考：https://www.atmarkit.co.jp/ait/articles/1605/23/news020.html</a></p>
<p><a href="https://www.php.net/manual/ja/function.chmod.php">chmod について：https://www.php.net/manual/ja/function.chmod.php</a></p>
<pre><code class="language-php">// file_upload.php

if (is_uploaded_file($temp_path)) {
  if (move_uploaded_file($temp_path, $save_path)) {
    chmod($save_path, 0644);
    $img = '&lt;img src=&quot;'. $save_path . '&quot; &gt;';
  } else {
    exit('Error:アップロードできませんでした');
  }
} else {
  exit('Error:画像がありません');
}

</code></pre>
<h2 id="練習-36"><a class="header" href="#練習-36">練習</a></h2>
<p>ファイルをアップロードする処理を実装しよう．</p>
<ul>
<li><code>file_upform.php</code>にアップロード用のフォームを準備しよう！</li>
<li><code>file_upload.php</code>にアップロード処理を記述して画像をアップロードしよう！</li>
</ul>
<p>送信側ファイルからファイルをアップロードし，下記の状態になっていれば OK！</p>
<ul>
<li>送信したファイルが<code>upload</code>フォルダに保存されている．</li>
<li>画面に送信したファイルが表示されている．</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ファイルアップロードと-db-連携"><a class="header" href="#ファイルアップロードと-db-連携">ファイルアップロードと DB 連携</a></h1>
<p>ファイルをサーバの指定した場所に保存することはできたが，このままでは使い勝手が良くない．</p>
<p>ファイルの保存場所を記録しておくことで，他のデータを連携させてアプリケーション上で扱えるようになる．</p>
<p>今回は DB と連携させて，前回までに実装した todo リストに組み込む．流れは先程までとほぼ同様だ．</p>
<h2 id="やることの流れ"><a class="header" href="#やることの流れ">やることの流れ</a></h2>
<h3 id="送信側"><a class="header" href="#送信側">送信側</a></h3>
<ul>
<li>todo などのデータを一緒に画像ファイルを送信する．</li>
</ul>
<h3 id="受信側"><a class="header" href="#受信側">受信側</a></h3>
<ol start="0">
<li>準備：送信時にエラー等ないかどうか確認する．</li>
<li>送られてきたファイルの情報を取得する（ファイルは自動的に tmp 領域に保管されている状態）．</li>
<li>ファイル名を準備する（他のファイルと被らないようにするため）．</li>
<li>サーバの保存領域に移動（今回は「<code>upload</code>」ディレクトリ）．</li>
<li>todo などのデータを一緒に，「保存場所のパス」をテーブルに保存する．</li>
</ol>
<h2 id="準備-7"><a class="header" href="#準備-7">準備</a></h2>
<p>「ファイルの保存場所のパス」をテーブルに記録したいので，カラムを追加する．</p>
<p>phpmyadmin から，これまで使用していた<code>todo_table</code>に<code>image</code>カラムを追加しよう．</p>
<table><thead><tr><th>カラム名</th><th>データ型</th><th>長さ</th><th>その他設定項目</th></tr></thead><tbody>
<tr><td><code>id</code></td><td>INT</td><td>12</td><td>インデックスを「PRIMARY」に設定．</br>「A_I」にチェック．</td></tr>
<tr><td><code>todo</code></td><td>VARCHAR</td><td>128</td><td></td></tr>
<tr><td><code>deadline</code></td><td>DATE</td><td>-</td><td></td></tr>
<tr><td><code>image</code></td><td>VARCHAR</td><td>128</td><td>「<code>Null</code>にチェックを入れる．」</td></tr>
<tr><td><code>created_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
<tr><td><code>updated_at</code></td><td>DATETIME</td><td>-</td><td></td></tr>
</tbody></table>
<h2 id="送信側の処理-3"><a class="header" href="#送信側の処理-3">送信側の処理</a></h2>
<p>送信側のフォームでは以下の点を追記しよう．</p>
<ul>
<li>ファイル送信用に<code>&lt;input type=&quot;file&quot;&gt;</code>を追加．</li>
<li><code>action</code>をファイル保存用の<code>create_file.php</code>に変更．</li>
<li><code>enctype</code>属性の追加．</li>
</ul>
<pre><code class="language-html">&lt;!-- todo_input.php --&gt;

&lt;form action=&quot;create_file.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
  &lt;!-- 省略 --&gt;
  &lt;div&gt;
    &lt;input type=&quot;file&quot; name=&quot;upfile&quot; accept=&quot;image/*&quot; capture=&quot;camera&quot; /&gt;
  &lt;/div&gt;
  &lt;!-- 省略 --&gt;
&lt;/form&gt;
</code></pre>
<h2 id="受信側の処理-3"><a class="header" href="#受信側の処理-3">受信側の処理</a></h2>
<p>こちらも前項の内容とほぼ同じであるが，ファイルの保存後が異なる．</p>
<ol start="0">
<li>準備：送信時にエラー等ないかどうか確認する．</li>
<li>送られてきたファイルの情報を取得する．</li>
<li>ファイル名を準備する．</li>
<li>サーバの保存領域に移動（前項と同じ「<code>upload</code>」ディレクトリ）．</li>
</ol>
<p>-- ここまで前項の処理と全く同じ --</p>
<ol start="4">
<li>「POST で受け取った todo のデータ」と「ファイルを保存したパス」をテーブルに保存する．</li>
<li>一覧画面に画像が表示されるよう追記．</li>
</ol>
<h3 id="ファイル保存の処理"><a class="header" href="#ファイル保存の処理">ファイル保存の処理</a></h3>
<p>前項までと全く同様のコード．ただし，今回は画像を表示する必要がないため，権限の変更までの処理で十分である．</p>
<pre><code class="language-php">// create_file.php

// 他ファイル読み込み，POSTデータの受け取りなど

// データの確認
if (isset($_FILES['upfile']) &amp;&amp; $_FILES['upfile']['error'] == 0) {
  // 情報の取得
  $uploaded_file_name = $_FILES['upfile']['name'];
  $temp_path  = $_FILES['upfile']['tmp_name'];
  $directory_path = 'upload/';
  // ファイル名の準備
  $extension = pathinfo($uploaded_file_name, PATHINFO_EXTENSION);
  $unique_name = date('YmdHis').md5(session_id()) . '.' . $extension;
  $save_path = $directory_path . $unique_name;
  // 今回は画面に表示しないので権限の変更までで終了
  if (is_uploaded_file($temp_path)) {
    if (move_uploaded_file($temp_path, $save_path)) {
      chmod($save_path, 0644);
    } else {
      exit('Error:アップロードできませんでした');
    }
  } else {
    exit('Error:画像がありません');
  }
} else {
  exit('Error:画像が送信されていません');
}

</code></pre>
<h3 id="db-への情報追加"><a class="header" href="#db-への情報追加">DB への情報追加</a></h3>
<p>ここまでで指定の場所にファイルを保存できたので，次は保存したパスをテーブルに追加する．</p>
<p>流れはいつもどおり「DB 接続」 -&gt; 「SQL 文作成&amp;実行」．</p>
<p><code>image</code>カラムを追加しているため，「カラム名」「バインド変数」を追加する．ファイル保存の際に使用した<code>$save_path</code>を<code>image</code>カラムに入れるよう設定している．</p>
<pre><code class="language-php">// create_file.php

// ファイル保存処理など

$pdo = connect_to_db();

$sql = 'INSERT INTO todo_table(id, todo, deadline, image, created_at, updated_at) VALUES(NULL, :todo, :deadline, :image, sysdate(), sysdate())';

$stmt = $pdo-&gt;prepare($sql);
$stmt-&gt;bindValue(':todo', $todo, PDO::PARAM_STR);
$stmt-&gt;bindValue(':deadline', $deadline, PDO::PARAM_STR);
$stmt-&gt;bindValue(':image', $save_path, PDO::PARAM_STR);
$status = $stmt-&gt;execute();

if ($status == false) {
  $error = $stmt-&gt;errorInfo();
  echo json_encode([&quot;error_msg&quot; =&gt; &quot;{$error[2]}&quot;]);
  exit();
} else {
  header(&quot;Location:todo_input.php&quot;);
  exit();
}

</code></pre>
<h3 id="一覧画面での画像表示"><a class="header" href="#一覧画面での画像表示">一覧画面での画像表示</a></h3>
<p>テーブルに画像パスを保存できたら，後は呼び出して<code>&lt;img&gt;</code>の中に<code>image</code>カラムの値を設定すれば該当する画像が表示される．</p>
<p>delete ボタンの後あたりに表示させてみると良いだろう．</p>
<pre><code class="language-php">// todo_read.php

// 省略

// タグ生成部分
foreach ($result as $record) {
  $output .= &quot;
    &lt;tr&gt;
      &lt;td&gt;{$record[&quot;deadline&quot;]}&lt;/td&gt;
      &lt;td&gt;{$record[&quot;todo&quot;]}&lt;/td&gt;
      &lt;td&gt;&lt;a href='like_create.php?user_id={$user_id}&amp;todo_id={$record[&quot;id&quot;]}'&gt;like{$record[&quot;like_count&quot;]}&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_edit.php?id={$record[&quot;id&quot;]}'&gt;edit&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;a href='todo_delete.php?id={$record[&quot;id&quot;]}'&gt;delete&lt;/a&gt;&lt;/td&gt;
      &lt;td&gt;&lt;img src='{$record[&quot;image&quot;]}' height='150px'&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &quot;;
}

// 省略

</code></pre>
<h2 id="練習-37"><a class="header" href="#練習-37">練習</a></h2>
<p>ファイルをアップロードする処理を実装しよう．</p>
<ul>
<li><code>todo_input.php</code>にアップロード用のフォームを準備しよう！</li>
<li><code>create_file.php</code>にアップロード処理を記述して画像をアップロードし，DB と連携させよう！</li>
<li><code>todo_read.php</code>に画像を表示させよう！</li>
</ul>
<p>送信側ファイル（<code>todo_input.php</code>）からファイルをアップロードし，下記の状態になっていれば OK！</p>
<ul>
<li>送信したファイルが<code>upload</code>フォルダに保存されている．</li>
<li>画像の保存パスが<code>todo_table</code>の<code>image</code>カラムに保存されている．</li>
<li>一覧画面（<code>todo_read.php</code>）に画像が表示されている．</li>
</ul>
<p>アップロード用のフォームを準備しよう！（todo_input.php）
アップロード処理を記述して画像をアップロードしよう！（create_file.php）
アップロードしたファイルの URL を DB に保存しよう！（create_file.php）
一覧画面に画像を表示しよう！（todo_read.php）
-&gt; 「画像が<code>upload</code>フォルダに保存」されて「パスが DB に保存」されていれば OK！
-&gt; 一覧画面で画像が表示されれば OK！</p>
<blockquote>
<p>【参考 / ファイル送信を任意にする】</p>
<ul>
<li>現在の状況では，ファイル送信が必須になっている．</li>
<li>ファイルを「送信してもしなくても良い」ようにするには条件分岐を工夫してやれば良い．</li>
<li>未送信時には<code>$_FILES</code>内の<code>['error']</code>が<code>4</code>であることを利用して条件を分ける．</li>
</ul>
<pre><code class="language-php">// create_file.php

if ($_FILES['upfile']['error'] == 4) {
 $save_path = null;
} else if ($_FILES['upfile']['error'] == 0) {
 // ファイルを保存する処理
} else {
 exit('アップロードに失敗しました');
}

</code></pre>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ajax-実装"><a class="header" href="#ajax-実装">Ajax 実装</a></h1>
<h2 id="ajaxasynchronous-javascript-and-xmlとは"><a class="header" href="#ajaxasynchronous-javascript-and-xmlとは">Ajax（Asynchronous JavaScript And XML）とは</a></h2>
<p>DB への登録，表示などの処理を実行する PHP ファイルとの http 通信を「JavaScript で」扱う手法ッ！！</p>
<p>JavaScript で http 通信を行うコードを記述し，サーバからデータを取得して動的にページの一部を書き換える動作が中心となる．</p>
<p>もともとは<code>XML</code>形式のデータをやり取りしていたが，現在は<code>JSON</code>形式が主流である．</p>
<h3 id="動き方のイメージ-1"><a class="header" href="#動き方のイメージ-1">動き方のイメージ</a></h3>
<p>これまでに扱った Firebase や API 連携と似た動き．この場合は Google などがつくってくれたサーバと通信を行ってデータを取得していた．</p>
<p><img src="php/php06/./img/php_upload_ajax_01.svg" alt="ajax動き1" /></p>
<p>今回は自分でサーバ側の PHP を実装する．自分で API をつくっている状態！</p>
<p><img src="php/php06/./img/php_upload_ajax_02.svg" alt="ajax動き2" /></p>
<h3 id="メリット"><a class="header" href="#メリット">メリット</a></h3>
<ul>
<li>データだけをやり取りするので速い&amp;通信量が少ない（HTML 全部は重い）！</li>
<li>ファイル数が少なくできる &amp; フロントとサーバの分業がしやすい！</li>
<li>通信時にリロードがない！ &lt;- Google マップや無限スクロールなどで活用されている！</li>
</ul>
<h3 id="デメリット"><a class="header" href="#デメリット">デメリット</a></h3>
<ul>
<li>SEO に弱い（最近は大丈夫になってきている）．</li>
<li>動的にページの内容を更新するので構造が複雑になりがち．</li>
<li>ページを更新すると表示内容が初期状態に戻ってしまう．</li>
</ul>
<h2 id="javascript-で-http-通信を行う方法"><a class="header" href="#javascript-で-http-通信を行う方法">JavaScript で http 通信を行う方法</a></h2>
<p>主に下記 4 種類が存在する．下に行くほど新しい&amp;オススメ．</p>
<p>今回は<code>axios</code>ライブラリを使用する．</p>
<table><thead><tr><th>方法</th><th>特徴</th></tr></thead><tbody>
<tr><td>XMLHttpRequest</td><td>生 JS / 一番昔から存在する</td></tr>
<tr><td>$.ajax()</td><td>jQuery / これが出てきて流行った</td></tr>
<tr><td>fetch</td><td>生 JS / 慣れないと分かりづらい</td></tr>
<tr><td>axios</td><td>React とか Vue でも使われていて使い勝手が良い</td></tr>
</tbody></table>
<h2 id="今回実装する内容"><a class="header" href="#今回実装する内容">今回実装する内容</a></h2>
<p>Ajax を使ってリアルタイム検索を実装しよう！！</p>
<ul>
<li>検索ボックスになにか入力したら，該当するデータだけを DB から取り出して画面に表示する．</li>
<li>「検索ボタン」ではなく，入力した時点でリアルタイムに検索する．</li>
</ul>
<h3 id="-key-point-30"><a class="header" href="#-key-point-30">💡 Key Point</a></h3>
<blockquote>
<p>※JavaScript と PHP が入り乱れるので都度どちらを書いているか確認！！！</p>
</blockquote>
<h2 id="必要なもの"><a class="header" href="#必要なもの">必要なもの</a></h2>
<h3 id="javascipt-のコードajax_searchhtml"><a class="header" href="#javascipt-のコードajax_searchhtml">JavaScipt のコード（<code>ajax_search.html</code>）</a></h3>
<ul>
<li>検索ボックスからリアルタイムに入力値を取得する．</li>
<li>PHP ファイルに対してリクエストを送る処理．</li>
<li>API へのリクエストと同じく<code>axios.get()</code>を使用．</li>
</ul>
<h3 id="php-のコードajax_getphp"><a class="header" href="#php-のコードajax_getphp">PHP のコード（<code>ajax_get.php</code>）</a></h3>
<ul>
<li>DB からデータを取得する処理．
<ul>
<li>前回までの todo_read.php とほぼ同様．</li>
</ul>
</li>
<li>取得したデータを JSON 形式で返す．</li>
<li>「API」を PHP でつくる！！！</li>
</ul>
<h2 id="処理の流れ-10"><a class="header" href="#処理の流れ-10">処理の流れ</a></h2>
<ol>
<li>JavaScript から PHP ファイルにリクエスト（検索ワード）を送る．（JS）</li>
<li>DB からデータを取得する．（PHP）</li>
<li>取得したデータを JSON 形式にして出力する．（PHP）</li>
<li>JavaScript でデータを受け取る．（JS）&lt;- 今回はまずここまでつくろう！</li>
<li>（受け取ったデータをブラウザに表示）</li>
</ol>
<h2 id="javascript-側のコード"><a class="header" href="#javascript-側のコード">JavaScript 側のコード</a></h2>
<p>まず，検索ボックス（<code>#search</code>）に対して<code>keyup</code>イベントを作成し，キーボード操作時に入力された値を取得できるようにする．</p>
<p>また，送信先のファイル（<code>ajax_get.php</code>）も準備しておく．</p>
<pre><code class="language-js">// ajax_search.html

$(&quot;#search&quot;).on(&quot;keyup&quot;, function (e) {
  console.log(e.target.value);
  const searchWord = e.target.value;
  const requestUrl = &quot;ajax_get.php&quot;;
  // ここからhttp通信を行うコード
});
</code></pre>
<p>続いて，API 回と同じく<code>axios.get()</code>でデータを取得する．取得したデータは URL 末尾にセットされ，サーバから得られたデータは<code>response</code>に格納される．</p>
<pre><code class="language-js">// ajax_search.html

axios
  .get(`${requestUrl}?searchword=${searchWord}`)
  .then(function (response) {
    console.log(response);
  })
  .catch(function (error) {
    // 省略
  })
  .finally(function () {
    // 省略
  });
</code></pre>
<h2 id="php-側のコード"><a class="header" href="#php-側のコード">PHP 側のコード</a></h2>
<p>JavaScript では<code>GET</code>メソッドでデータを送信しているため，PHP では<code>$_GET</code>でデータを受け取ることができる．</p>
<ul>
<li>SQL 文作成 &amp; 実行．</li>
<li>LIKE を使用してキーワードで検索する．</li>
<li>ユーザが入力した値を使用するのでバインド変数が必須．検索ワードをバインド変数にセットする際に<code>%</code>を前後につけることで曖昧検索ができるようにする．</li>
</ul>
<p>また，今回は JavaScript 側に JSON 形式のデータを送るので，<code>json_encode()</code>を用いている．出力するには単に<code>echo</code>するだけで OK！</p>
<pre><code class="language-php">// ajax_get.php

// 省略（ファイル読み込み，DB接続処理など）

$search_word = $_GET[&quot;searchword&quot;];

$sql = &quot;SELECT * FROM todo_table  WHERE todo LIKE :search_word&quot;;
// 省略
$stmt-&gt;bindValue(':search_word', &quot;%{$search_word}%&quot;, PDO::PARAM_STR);
// 省略
if ($status == false) {
  // 省略（エラー処理）
} else {
  $result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);
  echo json_encode($result);
  exit();
}

</code></pre>
<h3 id="動作確認-5"><a class="header" href="#動作確認-5">動作確認</a></h3>
<p>一連の動作が正常に動いていれば，テーブルに保存されているデータが検証画面に表示されるはずだ．</p>
<p>一方でサーバ側の動作を（<code>var_dump()</code>などで）確認したい場合は検証ツールを用いる．</p>
<ul>
<li>検証ツールの「NetWork」タブでは通信を行っているファイルを確認することができる．</li>
<li>この中の<code>ajax_get.php</code>をクリックすることで，PHP が動作した画面を確認することができる．</li>
</ul>
<p><img src="php/php06/./img/php_upload_ajax_03.svg" alt="NetWorkタブ" /></p>
<h2 id="練習-38"><a class="header" href="#練習-38">練習</a></h2>
<p>リアルタイム検索を実装しよう！</p>
<ul>
<li>axios.get()でリクエストを送ろう！（<code>ajax_read.html</code>）</li>
<li>DB からデータを取得しよう！（<code>ajax_get.php</code>）</li>
<li>JSON 形式にして出力しよう！（<code>ajax_get.php</code>）</li>
<li>受け取って console でデータを確認しよう！（<code>ajax_read.html</code>）</li>
</ul>
<p>できた人はブラウザ画面にデータを表示しよう！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="課題-8"><a class="header" href="#課題-8">課題</a></h1>
<p><strong>PHP と DB を使用したアプリケーションを実装</strong></p>
<ul>
<li>卒制プロトタイプ（オススメ！！！）</li>
<li>twitter みたいなもの（リロードなしに新しいツイートを取得できる，とか）</li>
<li>投票管理アプリ（リアルタイムに投票結果のグラフが動く）</li>
<li>掲示板アプリ（テーブル設計の練習にオススメ）</li>
</ul>
<p>以下の実装をメンター期間までに行っておくことを推奨！！</p>
<ul>
<li>オリジナルのアイデアでの画面遷移設計</li>
<li>画面に対応するための SQL を中心とした DB 設計</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-事前準備"><a class="header" href="#laravel-事前準備">Laravel 事前準備</a></h1>
<p>Laravel で開発をするためには，開発環境を用意する必要がある．一人で開発するときだけでなく，複数人で開発する際には「同じ開発環境」を揃えることが大切である．</p>
<p>更に，フレームワークやライブラリを多用する場合，個々の PC 環境によって細かいバージョンの差異や動作具合に影響が生じることがある．</p>
<p>主な Laravel の開発環境には以下のようなものがある．</p>
<ul>
<li>ローカル環境（XAMPP など）</li>
<li>ローカル上の仮想マシン（vagrant など）</li>
<li>仮想コンテナ（Docker など）</li>
<li>クラウド上の仮想マシン（AWS Cloud9 など）</li>
</ul>
<p>今回は Laravel 公式が準備する機能を用い，仮想マシン上で開発を行う．</p>
<h2 id="多用するコマンドまとめ"><a class="header" href="#多用するコマンドまとめ">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる"><a class="header" href="#仮想コンテナを立ち上げる">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる"><a class="header" href="#仮想コンテナを終了させる">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする"><a class="header" href="#laravel-コンテナへログインする">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする"><a class="header" href="#mysql-コンテナへログインする">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする"><a class="header" href="#コンテナからログアウトする">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="mac-編環境構築"><a class="header" href="#mac-編環境構築">【Mac 編】環境構築</a></h1>
<p>Docker を使用するための準備を進めていく．</p>
<p>必要なもの</p>
<ul>
<li>Docker Desktop</li>
<li>ターミナル（Mac に入っているもので OK）</li>
</ul>
<h2 id="docker-desktop-のダウンロードとインストール"><a class="header" href="#docker-desktop-のダウンロードとインストール">Docker Desktop のダウンロードとインストール</a></h2>
<p>下記の URL にアクセスし，必要なファイルをダウンロードする．</p>
<p>Intel CPU と M1 CPU で異なるので，ダウンロード時は注意すること．</p>
<p><a href="https://hub.docker.com/editions/community/docker-ce-desktop-mac/">https://hub.docker.com/editions/community/docker-ce-desktop-mac/</a></p>
<ol>
<li>
<p>ダウンロードした <code>Docker.dmg</code> をダブルクリックしてインストーラを起動したら，アプリケーション・フォルダに Docker アイコンをドラッグする．</p>
</li>
<li>
<p>アプリケーション・フォルダ内にある <code>Docker.app</code> をダブルクリックし， <code>Docker</code> を起動する．</p>
</li>
<li>
<p>トップステータスバーにある <code>Docker</code> メニュー（クジラのマーク）で， <code>Docker Desktop</code> が実行中で，ターミナルからアクセスできる状態になる．</p>
</li>
</ol>
<h2 id="docker-の動作確認"><a class="header" href="#docker-の動作確認">Docker の動作確認</a></h2>
<p>ターミナルを開いて下記のコマンドを実行し， <code>docker</code> のバージョンが表示されれば準備完了（バージョンなどの数値は資料より新しくて問題ない）．</p>
<pre><code class="language-bash">$ docker -v
Docker version 20.10.8, build 3967b7d

</code></pre>
<p>バージョンが表示されたら，「Laravel プロジェクト作成」項に進もう！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="windows-編環境構築"><a class="header" href="#windows-編環境構築">【Windows 編】環境構築</a></h1>
<p>Docker を使用するための準備を進めていく．</p>
<p>必要なもの</p>
<ul>
<li>Docker Desktop</li>
<li>Windows ターミナル</li>
<li>Ubuntu 20.04</li>
<li>WSL2</li>
<li>PowerShell（Windows にもともと入っている）</li>
</ul>
<h2 id="docker-desktop-のダウンロードとインストール-1"><a class="header" href="#docker-desktop-のダウンロードとインストール-1">Docker Desktop のダウンロードとインストール</a></h2>
<p>下記の URL にアクセスし，必要なファイルをダウンロードする．</p>
<p><a href="https://hub.docker.com/editions/community/docker-ce-desktop-windows/">https://hub.docker.com/editions/community/docker-ce-desktop-windows/</a></p>
<ol>
<li>
<p><code>Docker Desktop Installer.exe</code> をダブルクリックし，インストーラを起動する．</p>
</li>
<li>
<p>確認画面が出たら， <code>Enable Hyper-V Windows Features</code> （Hyper V の Windows 機能を有効にする）のオプションが，設定ページで選択されているかどうかを確認する．OS の状況によっては出てこない場合もあるので，その場合もそのまま進める．</p>
</li>
<li>
<p>インストール・ウィザードの指示に従い，利用規約（ライセンス）を承諾し，インストーラに権限を与えてインストールを進める．</p>
</li>
<li>
<p>インストールに成功したら， <code>Close</code> （閉じる）をクリックしてインストールを終了する．</p>
</li>
</ol>
<h2 id="windows-ターミナルと-ubuntu-2004-のインストール"><a class="header" href="#windows-ターミナルと-ubuntu-2004-のインストール">Windows ターミナルと Ubuntu 20.04 のインストール</a></h2>
<p>以下の URL からそれぞれをインストールする．</p>
<ul>
<li><a href="https://www.microsoft.com/ja-jp/p/windows-terminal/9n0dx20hk701">Windows ターミナル（https://www.microsoft.com/ja-jp/p/windows-terminal/9n0dx20hk701）</a></li>
<li><a href="https://www.microsoft.com/ja-jp/p/ubuntu-2004-lts/9n6svws3rx71">Ubuntu 20.04（https://www.microsoft.com/ja-jp/p/ubuntu-2004-lts/9n6svws3rx71）</a></li>
</ul>
<h2 id="wsl2-のダウンロードインストールと設定"><a class="header" href="#wsl2-のダウンロードインストールと設定">WSL2 のダウンロード，インストールと設定</a></h2>
<ol>
<li>下記の URL から必要なファイルをダウンロードする．</li>
</ol>
<p><a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi</a></p>
<blockquote>
<p>注意</p>
<p>ARM64 マシンを使用している場合は，代わりに<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_arm64.msi">https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_arm64.msi</a>をダウンロードする．</p>
</blockquote>
<ol start="2">
<li>
<p>ダウンロードしたファイルをダブルクリックして実行する．管理者特権のアクセス許可を求めるメッセージが表示される．<code>はい</code> を選択して，インストールを進める．</p>
</li>
<li>
<p>PowerShell を開いて次のコマンドを実行し，新しい Linux ディストリビューションをインストールする際の既定のバージョンとして WSL 2 を設定する．</p>
</li>
</ol>
<pre><code class="language-bash">wsl --set-default-version 2
</code></pre>
<!-- 1. 下記の URL の「Step 4」と「Step 5」を実行する．
    - [https://docs.microsoft.com/en-us/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package](https://docs.microsoft.com/en-us/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package) -->
<ol start="4">
<li>PC を再起動する．</li>
</ol>
<h2 id="docker-の動作確認-1"><a class="header" href="#docker-の動作確認-1">Docker の動作確認</a></h2>
<ol>
<li>
<p>Docker Desktop を起動する．</p>
</li>
<li>
<p>「<code>Setting</code>（画面上部の ⚙ アイコン）」 -&gt; 「<code>General</code>」 -&gt; 「<code>Use the WSL2 based engine</code>」にチェックを入れる．すでにチェックが入っていてユーザが操作できない状態となっている場合があるが，その場合はそのままで OK．</p>
</li>
</ol>
<p><img src="laravel/laravel_setup/./img/docker_setting01.PNG" alt="docker 設定画面01" /></p>
<ol start="3">
<li>「<code>Setting</code>（画面上部の ⚙ アイコン）」 -&gt; 「<code>Resources</code>」 -&gt; 「<code>WSL INTEGRATION</code>」の <code>Enable Integration ...</code> にチェックを入れ，「<code>Ubuntu 20.04</code>」のトグルをオンにする．</li>
</ol>
<ul>
<li>トグルが出てこない場合は PC を再起動する．</li>
<li>再起動してもダメなら以下の手順を試す．
<ul>
<li>Windows のスタートメニューをクリックして「Ubuntu」と入力し，Ubuntu を起動する．</li>
<li>ターミナルのような画面でユーザ名を設定するよう表示されるので，任意のユーザ名を入力する．</li>
<li>続けて，パスワードを設定する．</li>
<li>設定が終了したら <code>exit</code> を入力 →Enter して Ubuntu を終了する．</li>
<li>PowerShell を管理者モードで起動し，<code>wsl --set-default-version 2</code> のコマンドを実行する．</li>
<li>PC を再起動し，Docker Desktop の設定項目を確認する．</li>
</ul>
</li>
</ul>
<p><img src="laravel/laravel_setup/./img/docker_setting02.PNG" alt="docker 設定画面02" /></p>
<ol start="4">
<li>Windows ターミナルを Ubuntu 20.04 で動かす．</li>
</ol>
<p>↓ Windows ターミナルを開いて上部の「∨」をクリックするとメニューが出るので，ここで <code>Ubuntu 20.04</code> を選ぶ．出てこない場合は PC を再起動する．</p>
<p><img src="laravel/laravel_setup/./img/terminal_image01.png" alt="Ubuntu 設定箇所" /></p>
<p>↓ このようになっていればコマンドが実行できる．<strong>次項以降もこの状態でコマンドを実行していく．</strong></p>
<p><img src="laravel/laravel_setup/./img/terminal_image02.png" alt="Windows ターミナル動作画面" /></p>
<ol start="5">
<li>下記のコマンドを実行し， <code>docker</code> のバージョンが表示されれば準備完了（バージョンなどの数値は資料より新しくて問題ない）．</li>
</ol>
<pre><code class="language-bash">$ docker -v
Docker version 20.10.8, build 3967b7d

</code></pre>
<p>バージョンが表示されたら，「Laravel プロジェクト作成」項に進もう！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-プロジェクト作成"><a class="header" href="#laravel-プロジェクト作成">Laravel プロジェクト作成</a></h1>
<p>Mac の人は「ターミナル」，Windows の人は「Windows ターミナル」を起動する．</p>
<p>（Windows の人は Ubuntu 20.04 で動かしている状態でコマンドを実行する必要があるので，適宜前項の「Docker の動作確認」を確認しておく．）</p>
<p>下記コマンドでプロジェクトのフォルダができる．<code>laratter</code>部分がプロジェクト名となる．</p>
<p><strong>コマンドはデスクトップなどわかりやすい場所で実行する．作成された<code>laratter</code>フォルダに必要なファイルが全て含まれている．</strong></p>
<pre><code class="language-bash">$ curl -s https://laravel.build/laratter | bash
</code></pre>
<p>実行結果</p>
<pre><code>
 _                               _
| |                             | |
| |     __ _ _ __ __ ___   _____| |
| |    / _` | '__/ _` \ \ / / _ \ |
| |___| (_| | | | (_| |\ V /  __/ |
|______\__,_|_|  \__,_| \_/ \___|_|

Warning: TTY mode requires /dev/tty to be read/writable.
    Creating a &quot;laravel/laravel&quot; project at &quot;./laratter&quot;
    Installing laravel/laravel (v8.6.2)
      - Downloading laravel/laravel (v8.6.2)
      - Installing laravel/laravel (v8.6.2): Extracting archive
    Created project in /opt/laratter
    &gt; @php -r &quot;file_exists('.env') || copy('.env.example', '.env');&quot;
    Loading composer repositories with package information
    Updating dependencies
...

</code></pre>
<p>途中，Laravel 側でいろいろ実行するため PC のログインパスワードを求められるので入力する．</p>
<pre><code class="language-bash">Please provide your password so we can make some final adjustments to your application's permissions.

[sudo] password for taroosg:

Thank you! We hope you build something incredible. Dive in with: cd laratter &amp;&amp; ./vendor/bin/sail up

</code></pre>
<h2 id="権限の変更-1"><a class="header" href="#権限の変更-1">権限の変更</a></h2>
<p>この方法でプロジェクトを作成するとエディタで操作する場合に権限で引っかかる場合があるので権限を変更する．</p>
<pre><code class="language-bash">$ sudo chmod -R 777 laratter
</code></pre>
<p>権限が変更できない場合は下記 URL の設定を行い再度コマンドを実行する．</p>
<p><a href="https://gori.me/mac/mac-tips/112082">参考 URL</a></p>
<h2 id="起動"><a class="header" href="#起動">起動</a></h2>
<p>早速仮想コンテナを立ち上げる．</p>
<pre><code class="language-bash">$ cd laratter
$ ./vendor/bin/sail up -d
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Creating network &quot;laratter_sail&quot; with driver &quot;bridge&quot;
Creating volume &quot;laratter_sailmysql&quot; with local driver
Creating volume &quot;laratter_sailredis&quot; with local driver
Creating volume &quot;laratter_sailmeilisearch&quot; with local driver
Creating laratter_mailhog_1     ... done
Creating laratter_redis_1       ... done
Creating laratter_mysql_1       ... done
Creating laratter_selenium_1    ... done
Creating laratter_meilisearch_1 ... done
Creating laratter_laravel.test_1 ... done
</code></pre>
<h2 id="動作確認-6"><a class="header" href="#動作確認-6">動作確認</a></h2>
<p>ブラウザで<code>localhost</code>にアクセスし，下記画面が表示されれば OK．</p>
<p><img src="laravel/laravel_setup/./img/laravel-firstview.png" alt="トップ画面" /></p>
<p><strong>！！！この画面が表示されたら OK！次項の「終了するとき」を実行して事前準備は完了！！！</strong></p>
<p>コマンド実行時にエラーが出る場合や，画面が表示されない場合は以下の「エラーが出る場合」を確認しよう．</p>
<h2 id="終了するとき"><a class="header" href="#終了するとき">終了するとき</a></h2>
<p>仮想マシン（コンテナ）を終了させる場合は以下のコマンドを実行する．</p>
<p>コンテナが立ち上がっていると XAMPP が立ち上がらなくなるため，開発が終わったら下記コマンドで終了させること．</p>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h2 id="エラーが出る場合"><a class="header" href="#エラーが出る場合">エラーが出る場合</a></h2>
<h3 id="xampp-が動いている"><a class="header" href="#xampp-が動いている">XAMPP が動いている</a></h3>
<p>XAMPP が動いていると立ち上がらない場合があるため，一度 XAMPP を終了させてから再度コマンドを実行する．</p>
<p>また，Laravel の仮想コンテナが立ち上がっていると XAMPP が動かない場合があるので，XAMPP で開発を行う場合には仮想コンテナを終了させておく．</p>
<h3 id="pc-再起動"><a class="header" href="#pc-再起動">PC 再起動</a></h3>
<p>PC を再起動すると解決する場合が多い．</p>
<h3 id="docker-desktop-のバージョンアップ"><a class="header" href="#docker-desktop-のバージョンアップ">Docker Desktop のバージョンアップ</a></h3>
<p>Docker Desktop を以前からインストールしていた場合，バージョンが古いと起動しない場合はあるので最新バージョンにアップデートを行う．</p>
<h3 id="ファイヤーウォールを無効化する"><a class="header" href="#ファイヤーウォールを無効化する">ファイヤーウォールを無効化する</a></h3>
<p>途中でエラーが出る場合はファイヤーウォールで必要なファイルのダウンロードができていない場合がある．その場合は一旦ファイヤーウォールを無効化して，再度プロジェクト作成コマンドを実行する．</p>
<h3 id="m1-の-mac-でerror-no-matching-manifest-for-linuxarm64v8-in-the-manifest-list-entriesが出る"><a class="header" href="#m1-の-mac-でerror-no-matching-manifest-for-linuxarm64v8-in-the-manifest-list-entriesが出る">M1 の Mac で<code>ERROR: no matching manifest for linux/arm64/v8 in the manifest list entries</code>が出る</a></h3>
<p>エディタなどで<code>docker-compoes.yml</code>を開き，下記を追加する，</p>
<pre><code class="language-yml">platform: &quot;linux/x86_64&quot;
</code></pre>
<p>追記場所はこのへん．</p>
<pre><code class="language-yml">mysql:
  image: &quot;mysql:8.0&quot;
  platform: &quot;linux/x86_64&quot;
</code></pre>
<p><a href="https://neoighodaro.com/posts/3-running-laravel-and-docker-on-the-apple-mac-m1">参考：https://neoighodaro.com/posts/3-running-laravel-and-docker-on-the-apple-mac-m1</a></p>
<h3 id="m1-の-mac-でlaraveltest-failed的なエラーが出る"><a class="header" href="#m1-の-mac-でlaraveltest-failed的なエラーが出る">M1 の Mac で<code>laravel.test failed</code>的なエラーが出る</a></h3>
<p>エディタで<code>laratter/vendor/laravel/sail/runtimes/8.0/Dockerfile</code>を開き．34 行目と 35 行目をコメントアウトする．</p>
<p>↓ この 2 行をコメントアウトする（バージョンによって異なるので，該当ファイルの記述内容をよく確認すること）</p>
<pre><code>&amp;&amp; curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \
&amp;&amp; echo &quot;deb https://dl.yarnpkg.com/debian/ stable main&quot; &gt; /etc/apt/sources.list.d/yarn.list \
</code></pre>
<h2 id="いけてそうだけどブラウザで表示できない"><a class="header" href="#いけてそうだけどブラウザで表示できない">いけてそうだけどブラウザで表示できない</a></h2>
<p>アクセスするときの URL を<code>https://localhost</code>から<code>http://localhost</code>に変更</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="補足docker-と-docker-compose-の解説"><a class="header" href="#補足docker-と-docker-compose-の解説">【補足】Docker と Docker Compose の解説</a></h1>
<h2 id="docker-とは"><a class="header" href="#docker-とは">Docker とは</a></h2>
<p>コンテナ型の仮想化技術を提供するプロダクト．</p>
<h2 id="仮想化とは"><a class="header" href="#仮想化とは">「仮想化」とは</a></h2>
<p>物理的な PC やサーバ上に仮想的なマシンを動かすこと．</p>
<p>仮想化を用いる利点としては下記が挙げられる．</p>
<ul>
<li>異なるコンピュータ間でも同じ環境を用意できる．</li>
<li>コンピュータ内の状況に依らず，開発や運用をおこなうことができる（仮想マシン同士は独立に動作する）．</li>
<li>不具合があった場合にもすぐに環境を作り直すことができる．</li>
</ul>
<p>反面，デメリットとしては下記が挙げられる．</p>
<ul>
<li>コンピュータ上でマシンを複数台動作させている状況なので，リソースを圧迫する．</li>
<li>それなりのマシンスペックが求められる．</li>
<li>仮想マシンを共有する場合にファイルが重い．</li>
</ul>
<p>↓ 仮想マシンの大雑把な仕組み</p>
<p><img src="laravel/laravel_setup/./img/docker_vm.svg" alt="仮想マシンの大雑把な仕組み" /></p>
<h2 id="コンテナ型とは"><a class="header" href="#コンテナ型とは">「コンテナ型」とは</a></h2>
<p>通常の仮想化が「仮想マシン」を OS レベルから構成していたのに対し，コンテナ型の場合は Docker が OS などの環境を準備してくれる．</p>
<p>そのため，通常の仮想化よりも</p>
<ul>
<li>軽量であるため，複数のコンテナを同時に動作させることもできる．各コンテナは独立に動作し，お互いに影響しない．</li>
<li>Docker さえ準備しておけば，「Dockerfile」という設定ファイルを共有することで簡単に環境を再現可能．</li>
</ul>
<p>などの利点がある．</p>
<p>これにより，Docker では複雑なアーキテクチャを持つプロダクトであっても簡単に複数のマシンで実行環境を共有できる．</p>
<p>↓ コンテナの大雑把な仕組み</p>
<p><img src="laravel/laravel_setup/./img/docker_container.svg" alt="コンテナの大雑把な仕組み" /></p>
<h2 id="コンテナの仕組み"><a class="header" href="#コンテナの仕組み">コンテナの仕組み</a></h2>
<p>コンテナは以下の要素から作られている．</p>
<ul>
<li>Application</li>
<li>Image</li>
</ul>
<h3 id="application-とは"><a class="header" href="#application-とは">Application とは</a></h3>
<p>実際にコンテナ内で開発，動作させるアプリケーション．今回は Laravel がこれに当たり，開発しているときは個々の部分のコードを書くこととなる．</p>
<h3 id="image-とは"><a class="header" href="#image-とは">Image とは</a></h3>
<p>イメージは「仮想マシンの構成を定義するもの」で，アプリケーションを動作させるために必要なもの（OS，言語，など）を用意する．「Docker Image」と呼ばれ，オンライン上の「DockerHub」からダウンロードして用いることができる．</p>
<p>また，用意する OS 上で任意のコマンドなど実行してライブラリ等インストールしたい場合は「Dockerfile」と呼ばれる設定ファイルにその旨を記述する．</p>
<p>イメージは「環境」であるため一度作成されたら編集は不可能．</p>
<h2 id="コンテナの問題点"><a class="header" href="#コンテナの問題点">コンテナの問題点</a></h2>
<p>コンテナを用意するときは，「1 コンテナ 1 役割」で用意する．</p>
<p>そのため，アプリケーションを開発する際には複数のコンテナが必要になることが多い．</p>
<p>例：</p>
<ul>
<li>Web サーバ用コンテナ</li>
<li>アプリケーションサーバ用コンテナ</li>
<li>DB サーバ用コンテナ</li>
</ul>
<p>しかし，コンテナ数が多くなると管理が面倒な上，「各コンテナは独立に動作し，お互いに影響しない」ため，実行順などによってはうまく連携しない場合も発生する．</p>
<h2 id="docker-compose-とは"><a class="header" href="#docker-compose-とは">Docker Compose とは</a></h2>
<p>Docker Compose は上記のような場合に「複数のコンテナを連携させて管理・運用するプロダクト」である．</p>
<p>連携させるコンテナの情報は「<code>Docker-compose.yaml</code>」ファイルに記述する．</p>
<p><code>Docker-compose.yaml</code> はインデントによってデータ構成を表すため，不用意にインデントを崩さないよう注意する．</p>
<p>まずは「ファイル内の <code>services</code> 直下部分がコンテナを表す」を押さえておけば OK．</p>
<p>↓ Docker compose のイメージ</p>
<p><img src="laravel/laravel_setup/./img/docker_docker-conpose.svg" alt="Docker Composeのイメージ" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day06"><a class="header" href="#day06">Day06</a></h1>
<h2 id="コンテナの起動と-vs-code-の準備"><a class="header" href="#コンテナの起動と-vs-code-の準備">コンテナの起動と vs code の準備</a></h2>
<p>laratter ディレクトリに移動して下記コマンドでコンテナを起動！</p>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<p>↓ 起動したときのターミナル</p>
<p><img src="laravel/laravel01/./img/laratter_start_terminal.png" alt="コンテナ起動時のターミナル" /></p>
<p>↓ ブラウザは <code>localhost</code> にアクセス！</p>
<p><img src="laravel/laravel01/./img/laratter_start_browser.png" alt="localhost画面" /></p>
<p>↓ vs code で laratter フォルダを開く（エディタ画面左のディレクトリ構成を確認）！</p>
<p><img src="laravel/laravel01/./img/laratter_start_vscode.png" alt="vs code 画面" /></p>
<h2 id="本日の内容"><a class="header" href="#本日の内容">本日の内容</a></h2>
<ul>
<li>MVC フレームワークについての解説．</li>
<li>開発環境についての解説．</li>
<li>SNS アプリケーションの実装（データ作成，一覧表示まで）．</li>
</ul>
<h2 id="本日の目標"><a class="header" href="#本日の目標">本日の目標</a></h2>
<ul>
<li>MVC フレームワークである Laravel の動き方や考え方を学ぶ．</li>
<li>SNS アプリケーションの実装を通して，開発の手順や流れに慣れる．</li>
<li>PHP での実装と Laravel での実装について，共通点や相違点を把握する．</li>
</ul>
<h2 id="ルーティング表"><a class="header" href="#ルーティング表">ルーティング表</a></h2>
<p>後ほど解説します！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドまとめ-1"><a class="header" href="#多用するコマンドまとめ-1">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる-1"><a class="header" href="#仮想コンテナを立ち上げる-1">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる-1"><a class="header" href="#仮想コンテナを終了させる-1">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする-1"><a class="header" href="#laravel-コンテナへログインする-1">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする-1"><a class="header" href="#mysql-コンテナへログインする-1">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする-1"><a class="header" href="#コンテナからログアウトする-1">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-と-mvc-フレームワーク"><a class="header" href="#laravel-と-mvc-フレームワーク">Laravel と MVC フレームワーク</a></h1>
<p>Laravel とは PHP の MVC フレームワークである．</p>
<h2 id="フレームワークとは"><a class="header" href="#フレームワークとは">フレームワークとは</a></h2>
<p>フレームワークとは．．．</p>
<ul>
<li>ある言語で作るシステムの枠組み．考え方．</li>
<li>よく使う関数やクラスが用意されている．</li>
<li>規則が決まっているので，誰が書いても似たコードになる．</li>
</ul>
<h3 id="メリットとデメリット"><a class="header" href="#メリットとデメリット">メリットとデメリット</a></h3>
<ul>
<li>✅ 組み込まれている機能があるので実装の負荷が少ない．</li>
<li>✅ コードの品質担保による保守管理の負荷低減．</li>
<li>✅ セキュリティ面での担保．</li>
<li>🔼 学習コスト．</li>
<li>🔼 環境構築．</li>
</ul>
<h3 id="各言語のフレームワークの例"><a class="header" href="#各言語のフレームワークの例">各言語のフレームワークの例</a></h3>
<table><thead><tr><th>言語</th><th>フレームワーク</th></tr></thead><tbody>
<tr><td>PHP</td><td>Laravel, CakePHP, Symphony</td></tr>
<tr><td>Ruby</td><td>Ruby on Rails</td></tr>
<tr><td>Python</td><td>Django, Flask</td></tr>
<tr><td>Node.js</td><td>Express, NestJS</td></tr>
<tr><td>JavaScript</td><td>Next.js, Gatsby.js, Nuxt.js</td></tr>
</tbody></table>
<p>※あくまで一例，他にもたくさんあります．．！</p>
<h3 id="laravel-の特徴"><a class="header" href="#laravel-の特徴">Laravel の特徴</a></h3>
<ul>
<li>今最もアツい PHP フレームワーク！</li>
<li>Web サービスで使用する機能が豊富に用意されている．
<ul>
<li>DB 操作関連の機能（論理削除など）</li>
<li>メール通知機能</li>
</ul>
</li>
<li>画面を柔軟に作成できる blade テンプレート．</li>
<li><code>artisan</code>コマンドによる手軽なライブラリ操作．</li>
<li>とにかく自由（ディレクトリ構成，処理の記述場所など）</li>
</ul>
<h2 id="mvc-とは"><a class="header" href="#mvc-とは">MVC とは</a></h2>
<p><strong>MVC とは，役割分担の概念であるッ！</strong></p>
<p>これまでは適当な PHP ファイルに処理を全部書いていた！</p>
<ul>
<li>ファイル数が増える．．．</li>
<li>あの処理，どのファイルに書いたっけ．．？？</li>
<li>バグあったけど次の処理が他の人の書いたファイルに．．．（チーム開発）</li>
</ul>
<p>=&gt; いずれ詰む未来が見える．．．</p>
<p>=&gt; せや，処理毎に別々のところに書いて管理や分類をしやすくしたろ！MVC の 3 つくらいでええやろ！</p>
<h3 id="役割分担"><a class="header" href="#役割分担">役割分担</a></h3>
<table><thead><tr><th>name</th><th>役割</th></tr></thead><tbody>
<tr><td>Model</td><td>データの操作を行う役割．<br>データの「作成」「参照」「更新」「削除」し，その結果を出力．</td></tr>
<tr><td>View</td><td>ブラウザの表示領域を作成する役割．<br>受け取ったデータ処理の結果を html に埋め込み，出力する．</td></tr>
<tr><td>Controller</td><td>リクエストとレスポンスを行う．その間のことをいい感じにやる．<br>Model と View に司令を出す，処理の流れを決める役割．</td></tr>
<tr><td>Route</td><td>アクセスされた URL に応じて処理を振り分ける．URL と Controller の関数の対応を決める．<br>実際の処理は Controller を通じて Model や View が実行する．</td></tr>
</tbody></table>
<h3 id="処理のイメージ"><a class="header" href="#処理のイメージ">処理のイメージ</a></h3>
<p>MVC では処理によって役割分担されているため，「処理の順番」と「データ流れ」を把握することが理解への近道である．</p>
<p>例として，DB から取り出したデータを一覧画面に表示する流れを考えてみる．</p>
<h3 id="リクエストからの処理の流れ"><a class="header" href="#リクエストからの処理の流れ">リクエストからの処理の流れ</a></h3>
<p>リクエスト -&gt; Route -&gt; Controller の順で処理が実行される．</p>
<p><img src="laravel/laravel01/./img/laravel_mvc_01.svg" alt="MVCの流れ1" /></p>
<h3 id="db-から取り出したデータの流れ"><a class="header" href="#db-から取り出したデータの流れ">DB から取り出したデータの流れ</a></h3>
<p>Model -&gt; Controller -&gt; View の順で処理が実行される．</p>
<p><img src="laravel/laravel01/./img/laravel_mvc_02.svg" alt="MVCの流れ2" /></p>
<h2 id="コツ"><a class="header" href="#コツ">コツ</a></h2>
<h3 id="習うより慣れろッ"><a class="header" href="#習うより慣れろッ">習うより慣れろッ！</a></h3>
<ul>
<li>初見で理解することは不可能！
<ul>
<li>まずはアプリケーションを作って動かそう！</li>
<li>処理を見ながら，どこでどの処理を行っているのかを考えよう！</li>
</ul>
</li>
<li>MVC 間でのデータの流れを追えるようになると Good！！</li>
<li>慣れゲー &amp; 周回ゲー！
<ul>
<li>何度も作ることで処理のイメージが湧き，余裕が生まれる．</li>
<li>「そういえば前回もこの処理書いたな」で OK．</li>
<li>10 周くらいするとだいぶわかる！</li>
</ul>
</li>
</ul>
<h3 id="余計なことをせずにフレームワークに従う"><a class="header" href="#余計なことをせずにフレームワークに従う">余計なことをせずにフレームワークに従う</a></h3>
<p><strong>フレームワーク &gt; 越えられない壁 &gt;&gt;&gt; 人間</strong></p>
<ul>
<li>フレームワークは人類の叡智！</li>
<li>素人が安易に改造すると台無し．</li>
<li>細かい設定などは弄らない！</li>
<li>自分で実装せずにフレームワークに用意された機能を使え！</li>
<li>ゴリ押しで書くな！（よくある処理はドキュメントに載ってる）</li>
</ul>
<!-- ## Get Started!!!

**【超重要】下記の手順でAWS Educateアカウントにログイン**

1. [https://aws.amazon.com/jp/education/awseducate/](https://aws.amazon.com/jp/education/awseducate/)にアクセス
2. 「AWS Educate にサインイン」をクリック
3. ページ上段 「My Classroom」をクリック
4. 今回のクラスに入る -> AWS console
5. 今後作業途中で再度ログインが必要になっても上記手順でログイン！ -->
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ライブラリ準備"><a class="header" href="#ライブラリ準備">ライブラリ準備</a></h1>
<h2 id="ライブラリ準備-1"><a class="header" href="#ライブラリ準備-1">ライブラリ準備</a></h2>
<p>作成するアプリケーションでライブラリを使用する場合はコマンドでインストールを行う．今回は認証を実装するための<code>Laravel Breeze</code>をインストールする．</p>
<p>Laravel のプロジェクト内でコマンドを実行する場合には，下記コマンドで仮想コンテナにログインする必要がある．</p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@81f8517c4e7f:/var/www/html#
</code></pre>
<p>仮想コンテナから出る場合には下記のコマンドを実行する．</p>
<pre><code class="language-bash">root@81f8517c4e7f:/var/www/html# exit
exit
$
</code></pre>
<p><strong>以降のコマンドは仮想コンテナにログインした状態（ターミナルが<code>/var/www/html# </code>になっている状態）で行うこと</strong></p>
<p>下記コマンドを実行し，必要なファイルをダウンロードする．</p>
<pre><code class="language-bash">$ composer require laravel/breeze --dev
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">...
Discovered Package: nesbot/carbon
Discovered Package: nunomaduro/collision
Package manifest generated successfully.
73 packages you are using are looking for funding.
Use the `composer fund` command to find out more!
</code></pre>
<p>下記コマンドでインストールする．</p>
<pre><code class="language-bash">$ php artisan breeze:install
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Breeze scaffolding installed successfully.
Please execute the &quot;npm install &amp;&amp; npm run dev&quot; command to build your assets.
</code></pre>
<p>下記コマンドを実行し，その他必要なパッケージをインストールしてビルドする（ここで Node.js が動く）．</p>
<pre><code class="language-bash">$ npm install &amp;&amp; npm run dev
</code></pre>
<p>実行結果（やや時間がかかる）</p>
<pre><code class="language-bash">✔ Compiled Successfully in 4720ms
┌───────────────────────────────────────────────────────────────────┬──────────┐
│                                                              File │ Size     │
├───────────────────────────────────────────────────────────────────┼──────────┤
│                                                        /js/app.js │ 673 KiB  │
│                                                       css/app.css │ 3.82 MiB │
└───────────────────────────────────────────────────────────────────┴──────────┘
webpack compiled successfully
</code></pre>
<p>ブラウザで localhost にアクセスし，動作を確認する．</p>
<p>以下の画面が表示されれば OK（右上に<code>Login</code>と<code>register</code>が表示される）．</p>
<p><img src="laravel/laravel_setup/./img/breeze-installed.png" alt="breezeインストール確認" /></p>
<p>右上の<code>register</code>をクリックするとユーザ登録画面に移動するが，まだこの段階ではユーザ登録機能は動作しない．ユーザ登録画面が表示されれば OK．</p>
<p><img src="laravel/laravel_setup/./img/register.png" alt="register画面" /></p>
<p>ここまででライブラリの準備は完了．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="今回は不要データベース準備"><a class="header" href="#今回は不要データベース準備">【今回は不要】データベース準備</a></h1>
<h2 id="mysql-の状態を確認"><a class="header" href="#mysql-の状態を確認">MySQL の状態を確認</a></h2>
<p>今回の SNS アプリケーションでは，DB として MySQL を使用する．</p>
<p>すでに MySQL 自体は動作する状態になっているが，自分で確認したい場合もある．下記手順を実行し，MySQL にログインする．</p>
<p><strong>コンテナへログインしている場合は一旦<code>exit</code>で通常のターミナルに戻って実行すること</strong></p>
<h3 id="db-用のコンテナへログイン"><a class="header" href="#db-用のコンテナへログイン">DB 用のコンテナへログイン</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
root@d984f6614597:/#
</code></pre>
<h3 id="mysql-へログイン"><a class="header" href="#mysql-へログイン">MySQL へログイン</a></h3>
<p>ユーザ名<code>sail</code>，パスワード<code>password</code>でログインできる．</p>
<p>パスワードを求められるので「<code>password</code>」を入力して Enter（パスワードは画面上に表示されないので注意）．</p>
<pre><code class="language-bash">root@d984f6614597:/# mysql -u sail -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 29
Server version: 8.0.25 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
</code></pre>
<h3 id="db-状況の確認"><a class="header" href="#db-状況の確認">DB 状況の確認</a></h3>
<p>すでに今回のアプリケーションで使用するデータベースを作成されている．データベース名は <code>laratter</code>（プロジェクト名を同じ）．</p>
<p>下記コマンドを実行してデータベースの一覧を表示する．</p>
<pre><code class="language-bash">mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| laratter           |
+--------------------+
2 rows in set (0.03 sec)
</code></pre>
<p>確認できたらログアウトする．</p>
<pre><code class="language-bash">mysql&gt; exit;
Bye
</code></pre>
<h2 id="laravel-から-db-に接続するための設定"><a class="header" href="#laravel-から-db-に接続するための設定">Laravel から DB に接続するための設定</a></h2>
<p>続いて，Laravel から MySQL にアクセスするための設定を行う．今回はプロジェクト作成の時点で設定されているため項目の確認のみ行う．</p>
<p>エディタから<code>.env</code>ファイルを開く．<code>.env</code>ファイルは<code>laratter</code>ディレクトリの直下に配置されている．</p>
<pre><code class="language-env">DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=laratter
DB_USERNAME=sail
DB_PASSWORD=password
</code></pre>
<p>それぞれ下記の意味となっている．デプロイする場合などはサービス提供者側からそれぞれ情報が提供されるため，必要に応じて編集する．</p>
<table><thead><tr><th>項目</th><th>意味</th></tr></thead><tbody>
<tr><td>DB_CONNECTION</td><td>DB の種類</td></tr>
<tr><td>DB_HOST</td><td>DB のホスト名</td></tr>
<tr><td>DB_PORT</td><td>DB のポート</td></tr>
<tr><td>DB_DATABASE</td><td>DB 名</td></tr>
<tr><td>DB_USERNAME</td><td>DB にログインするときのユーザ名</td></tr>
<tr><td>DB_PASSWORD</td><td>DB にログインするときのパスワード</td></tr>
</tbody></table>
<p>もし<code>.env</code>ファイルを更新する場合はキャッシュをクリアする．</p>
<blockquote>
<p>設定ファイルはサーバ起動時にキャッシュに保存されるため，変更した場合は「キャッシュをクリアする」「コンテナを立ち上げ直す」のどちらかが必要になる．</p>
<p>キャッシュクリアのコマンドを実行する場合は Laravel の仮想コンテナにログインした状態で行うこと．</p>
</blockquote>
<pre><code class="language-bash">$ php artisan config:cache
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Configuration cache cleared!
Configuration cached successfully!
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="phpmyadmin-の追加"><a class="header" href="#phpmyadmin-の追加">phpmyadmin の追加</a></h1>
<h2 id="コンテナの停止"><a class="header" href="#コンテナの停止">コンテナの停止</a></h2>
<p>コンテナが動いている場合は下記コマンドで停止させる．</p>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h2 id="phpmyadmin-のコンテナを追加"><a class="header" href="#phpmyadmin-のコンテナを追加">phpmyadmin のコンテナを追加</a></h2>
<p><code>docker-compose.yml</code>に下記を追記する．</p>
<pre><code class="language-yml">phpmyadmin:
  image: phpmyadmin/phpmyadmin
  links:
    - mysql:mysql
  ports:
    - 8080:80
  environment:
    MYSQL_USERNAME: &quot;${DB_USERNAME}&quot;
    MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
    PMA_HOST: mysql
  networks:
    - sail
</code></pre>
<p>追記場所は<code>selenium</code>付近．</p>
<pre><code class="language-yml">selenium:
  image: &quot;selenium/standalone-chrome&quot;
  volumes:
    - &quot;/dev/shm:/dev/shm&quot;
  networks:
    - sail
# この下に追記
</code></pre>
<p><strong>yaml ファイルはインデントが重要となるため全コピペ推奨．</strong></p>
<p>↓【M1 Mac 以外の人】</p>
<pre><code class="language-yaml"># For more information: https://laravel.com/docs/sail
version: &quot;3&quot;
services:
  laravel.test:
    build:
      context: ./vendor/laravel/sail/runtimes/8.0
      dockerfile: Dockerfile
      args:
        WWWGROUP: &quot;${WWWGROUP}&quot;
    image: sail-8.0/app
    extra_hosts:
      - &quot;host.docker.internal:host-gateway&quot;
    ports:
      - &quot;${APP_PORT:-80}:80&quot;
    environment:
      WWWUSER: &quot;${WWWUSER}&quot;
      LARAVEL_SAIL: 1
      XDEBUG_MODE: &quot;${SAIL_XDEBUG_MODE:-off}&quot;
      XDEBUG_CONFIG: &quot;${SAIL_XDEBUG_CONFIG:-client_host=host.docker.internal}&quot;
    volumes:
      - &quot;.:/var/www/html&quot;
    networks:
      - sail
    depends_on:
      - mysql
      - redis
      - meilisearch
      - selenium
  mysql:
    image: &quot;mysql:8.0&quot;
    ports:
      - &quot;${FORWARD_DB_PORT:-3306}:3306&quot;
    environment:
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_DATABASE: &quot;${DB_DATABASE}&quot;
      MYSQL_USER: &quot;${DB_USERNAME}&quot;
      MYSQL_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_ALLOW_EMPTY_PASSWORD: &quot;yes&quot;
    volumes:
      - &quot;sailmysql:/var/lib/mysql&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-p${DB_PASSWORD}&quot;]
      retries: 3
      timeout: 5s
  redis:
    image: &quot;redis:alpine&quot;
    ports:
      - &quot;${FORWARD_REDIS_PORT:-6379}:6379&quot;
    volumes:
      - &quot;sailredis:/data&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]
      retries: 3
      timeout: 5s
  meilisearch:
    image: &quot;getmeili/meilisearch:latest&quot;
    ports:
      - &quot;${FORWARD_MEILISEARCH_PORT:-7700}:7700&quot;
    volumes:
      - &quot;sailmeilisearch:/data.ms&quot;
    networks:
      - sail
    healthcheck:
      test:
        [
          &quot;CMD&quot;,
          &quot;wget&quot;,
          &quot;--no-verbose&quot;,
          &quot;--spider&quot;,
          &quot;http://localhost:7700/health&quot;,
        ]
      retries: 3
      timeout: 5s
  mailhog:
    image: &quot;mailhog/mailhog:latest&quot;
    ports:
      - &quot;${FORWARD_MAILHOG_PORT:-1025}:1025&quot;
      - &quot;${FORWARD_MAILHOG_DASHBOARD_PORT:-8025}:8025&quot;
    networks:
      - sail
  selenium:
    image: &quot;selenium/standalone-chrome&quot;
    volumes:
      - &quot;/dev/shm:/dev/shm&quot;
    networks:
      - sail
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    links:
      - mysql:mysql
    ports:
      - 8080:80
    environment:
      MYSQL_USERNAME: &quot;${DB_USERNAME}&quot;
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      PMA_HOST: mysql
    networks:
      - sail
networks:
  sail:
    driver: bridge
volumes:
  sailmysql:
    driver: local
  sailredis:
    driver: local
  sailmeilisearch:
    driver: local
</code></pre>
<p>↓【M1 Mac の人】</p>
<pre><code class="language-yaml"># For more information: https://laravel.com/docs/sail
version: &quot;3&quot;
services:
  laravel.test:
    build:
      context: ./vendor/laravel/sail/runtimes/8.0
      dockerfile: Dockerfile
      args:
        WWWGROUP: &quot;${WWWGROUP}&quot;
    image: sail-8.0/app
    extra_hosts:
      - &quot;host.docker.internal:host-gateway&quot;
    ports:
      - &quot;${APP_PORT:-80}:80&quot;
    environment:
      WWWUSER: &quot;${WWWUSER}&quot;
      LARAVEL_SAIL: 1
      XDEBUG_MODE: &quot;${SAIL_XDEBUG_MODE:-off}&quot;
      XDEBUG_CONFIG: &quot;${SAIL_XDEBUG_CONFIG:-client_host=host.docker.internal}&quot;
    volumes:
      - &quot;.:/var/www/html&quot;
    networks:
      - sail
    depends_on:
      - mysql
      - redis
      - meilisearch
      - selenium
  mysql:
    image: &quot;mysql:8.0&quot;
    platform: &quot;linux/x86_64&quot;
    ports:
      - &quot;${FORWARD_DB_PORT:-3306}:3306&quot;
    environment:
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_DATABASE: &quot;${DB_DATABASE}&quot;
      MYSQL_USER: &quot;${DB_USERNAME}&quot;
      MYSQL_PASSWORD: &quot;${DB_PASSWORD}&quot;
      MYSQL_ALLOW_EMPTY_PASSWORD: &quot;yes&quot;
    volumes:
      - &quot;sailmysql:/var/lib/mysql&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-p${DB_PASSWORD}&quot;]
      retries: 3
      timeout: 5s
  redis:
    image: &quot;redis:alpine&quot;
    ports:
      - &quot;${FORWARD_REDIS_PORT:-6379}:6379&quot;
    volumes:
      - &quot;sailredis:/data&quot;
    networks:
      - sail
    healthcheck:
      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]
      retries: 3
      timeout: 5s
  meilisearch:
    image: &quot;getmeili/meilisearch:latest&quot;
    ports:
      - &quot;${FORWARD_MEILISEARCH_PORT:-7700}:7700&quot;
    volumes:
      - &quot;sailmeilisearch:/data.ms&quot;
    networks:
      - sail
    healthcheck:
      test:
        [
          &quot;CMD&quot;,
          &quot;wget&quot;,
          &quot;--no-verbose&quot;,
          &quot;--spider&quot;,
          &quot;http://localhost:7700/health&quot;,
        ]
      retries: 3
      timeout: 5s
  mailhog:
    image: &quot;mailhog/mailhog:latest&quot;
    ports:
      - &quot;${FORWARD_MAILHOG_PORT:-1025}:1025&quot;
      - &quot;${FORWARD_MAILHOG_DASHBOARD_PORT:-8025}:8025&quot;
    networks:
      - sail
  selenium:
    image: &quot;selenium/standalone-chrome&quot;
    volumes:
      - &quot;/dev/shm:/dev/shm&quot;
    networks:
      - sail
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    links:
      - mysql:mysql
    ports:
      - 8080:80
    environment:
      MYSQL_USERNAME: &quot;${DB_USERNAME}&quot;
      MYSQL_ROOT_PASSWORD: &quot;${DB_PASSWORD}&quot;
      PMA_HOST: mysql
    networks:
      - sail
networks:
  sail:
    driver: bridge
volumes:
  sailmysql:
    driver: local
  sailredis:
    driver: local
  sailmeilisearch:
    driver: local
</code></pre>
<h2 id="動作確認-7"><a class="header" href="#動作確認-7">動作確認</a></h2>
<p>下記コマンドでコンテナを起動する．</p>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<p>立ち上がったら，ブラウザで<code>localhost:8080</code>にアクセスすると phpmyadmin にアクセスできる．</p>
<p>ユーザ名とパスワードは以下の通り．</p>
<table><thead><tr><th>ユーザ名</th><th>パスワード</th></tr></thead><tbody>
<tr><td><code>sail</code></td><td><code>password</code></td></tr>
</tbody></table>
<h2 id="注意点-2"><a class="header" href="#注意点-2">注意点</a></h2>
<p>Laravel ではテーブルの設定などはマイグレーションによって行うため，phpmyadmin で不用意に操作すると予期しないエラーが発生する場合がある．</p>
<p>そのため，カラム名の調整などは phpmyadmin から行わないことをオススメする．</p>
<p>レコードの追加などは問題ないので適宜活用していきましょう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="マイグレーションによるテーブル作成"><a class="header" href="#マイグレーションによるテーブル作成">マイグレーションによるテーブル作成</a></h1>
<p>プロダクトの実装を進める上で，Laravel コンテナ内や DB コンテナ内など「実行場所」を確認すること．</p>
<h2 id="テーブル設計マイグレーションファイル"><a class="header" href="#テーブル設計マイグレーションファイル">テーブル設計（マイグレーションファイル）</a></h2>
<blockquote>
<p><strong>📦 Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>今回のアプリケーションは twitter ライクな SNS なので「tweets」テーブルを作成する．</p>
<p>Laravel では「マイグレーション」という仕組みを使用してテーブルの管理を行う．また，テーブル内のデータは「Model」を使用して操作する．Laravel では<code>Eroquent Model</code>と呼ばれる ORM を使用する．</p>
<blockquote>
<p>【解説 / マイグレーション】</p>
<ul>
<li>マイグレーションとは「マイグレーションファイル」を用いてテーブルを管理する仕組み．</li>
<li>「マイグレーションファイル」にテーブル名やカラム名を記述し，指定されたコマンドを実行することで設定したテーブルが生成される．</li>
</ul>
</blockquote>
<blockquote>
<p>【解説 / Eloquent Model】</p>
<ul>
<li>Eloquent Model は Laravel 標準の ORM（object-relational mapper）である．</li>
<li>ORM とは，DB のレコードをオブジェクトとして直感的に扱えるようにしたもので，SQL を意識せずにプログラムで処理を記述することができる．</li>
<li>Eloquent Model は定義された「Model」を用いることで簡単に DB へのデータ保存・取得などを行える．</li>
<li>1 つのモデルが 1 つのテーブルに対応する．例えば，<code>tweets</code>テーブルに対して<code>Tweet</code>のようにモデルを定義すると自動的に対応する．モデル内に明示的に対応を記述することもできる．</li>
<li>テーブルに対してデータ操作を行う場合，対応するモデルに対して処理を実行することで DB 操作を行うことができる．</li>
</ul>
</blockquote>
<p>Model とマイグレーションファイルは一度に両方とも作成することができる．</p>
<p>下記コマンドは Model を作成するコマンドだが（<code>Tweet</code>がモデル名），<code>-m</code>をつけることでマイグレーションファイルも同時に作成できる．この手法を用いることで，Model 名とマイグレーションファイル内のテーブル名が自動的に対応する．</p>
<p>早速実行．</p>
<pre><code class="language-bash">$ php artisan make:model Tweet -m

# 実行結果（日付時刻は毎回変わる）
Model created successfully.
Created Migration: 2021_09_23_130915_create_tweets_table

</code></pre>
<p><code>database/migration/2021_09_23_130915_create_tweets_table.php</code>を開く．これがマイグレーションファイルである．</p>
<p>カラムを追加するため，下記にように編集する．今回は<code>tweet</code>，<code>description</code>の 2 カラムを追加する．</p>
<p>カラムを追加するときはデータ型も設定する．<code>tweet</code>は文字列（<code>string</code>），<code>description</code>はテキスト（<code>text</code>）を設定している．</p>
<p><code>id</code>ははじめから用意されているので設定不要．</p>
<blockquote>
<p>【tips】</p>
<ul>
<li><code>nullable()</code>を記述することで，入力必須でなくすることができる．他に<code>unique()</code>で重複を禁止することもできる．</li>
<li><code>timestamps()</code>は<code>created_at</code>カラムと<code>updated_at</code>カラムを自動的に設定してくれる．</li>
</ul>
</blockquote>
<pre><code class="language-php">// database/migrations/2021_09_23_130915_create_tweets_table.php

&lt;?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateTweetsTable extends Migration
{
  /**
   * Run the migrations.
   *
   * @return void
   */
  public function up()
  {
    Schema::create('tweets', function (Blueprint $table) {
      $table-&gt;id();
      // 🔽 ここから追加
      $table-&gt;string('tweet');
      $table-&gt;text('description')-&gt;nullable();
      // 🔼 ここまで追加
      $table-&gt;timestamps();
    });
  }

  /**
   * Reverse the migrations.
   *
   * @return void
   */
  public function down()
  {
    Schema::dropIfExists('tweets');
  }
}

</code></pre>
<!-- ## 【今回は不要】文字列最大長の変更

これでテーブルの設計は完了だが，MySQL のバージョンによってはエラーが発生するため，次の設定を行う．

`app/Providers/AppServiceProvider.php`の内容を以下のように編集する．`string`型の最大長を 191 に変更する．

> 【解説】
>
> - この設定が必要かどうかは MySQL のバージョンによる．MySQL のバージョンが`5.7.7`以下の場合は必要となる．
> - Laravel のマイグレーションでは文字列の最大長が`255`として実行するが，MySQL5.7.7 以下では最大長が`191`となっているためである．

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
// 🔽  1行追加
use Illuminate\Support\Facades\Schema;

class AppServiceProvider extends ServiceProvider
{
  /**
   * Register any application services.
   *
   * @return void
   */
  public function register()
  {
    //
  }

  /**
   * Bootstrap any application services.
   *
   * @return void
   */
  public function boot()
  {
    // 1行追加
    Schema::defaultStringLength(191);
  }
}
``` -->
<h2 id="マイグレーション実行"><a class="header" href="#マイグレーション実行">マイグレーション実行</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>マイグレーションを実行するとテーブルが作成される．以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migration table created successfully.
Migrating: 2014_10_12_000000_create_users_table
Migrated:  2014_10_12_000000_create_users_table (88.55ms)
Migrating: 2014_10_12_100000_create_password_resets_table
Migrated:  2014_10_12_100000_create_password_resets_table (90.49ms)
Migrating: 2019_08_19_000000_create_failed_jobs_table
Migrated:  2019_08_19_000000_create_failed_jobs_table (89.10ms)
Migrating: 2019_12_14_000001_create_personal_access_tokens_table
Migrated:  2019_12_14_000001_create_personal_access_tokens_table (155.49ms)
Migrating: 2021_09_23_130915_create_tweets_table
Migrated:  2021_09_23_130915_create_tweets_table (57.06ms)

</code></pre>
<p>エラーになる場合はマイグレーションファイルの内容が間違っていることが多い．修正して以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate:fresh
</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>:fresh</code>をつけることで，存在しているテーブルを一旦削除し，再度マイグレーションを実行することができる．</li>
<li>マイグレーションに失敗した場合はエラーが発生するまでに実行された部分はテーブルが作成される．しかし，マイグレーション実行時に，すでに同名のテーブルが存在している場合はエラーになるため，既存テーブルを削除する必要がある．</li>
</ul>
</blockquote>
<h2 id="テーブル確認"><a class="header" href="#テーブル確認">テーブル確認</a></h2>
<p>phpmyadmin でテーブルの状況を確認する．<code>tweets</code>が以下の内容で作成されていれば OK．</p>
<pre><code class="language-txt">+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】コマンドで確認する場合は以下の手順で行う．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

うまくいったら，mysql にログインしてテーブルを確認する．パスワードは`password`．

```bash
$ mysql -u sail -p

mysql> use laratter;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweets                 |
| users                  |
+------------------------+
6 rows in set (0.00 sec)

mysql> desc tweets;
+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

mysql> exit
Bye

``` -->
<h2 id="テストユーザーデータの作成"><a class="header" href="#テストユーザーデータの作成">テストユーザーデータの作成</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>この段階で，ユーザテーブルなどの認証に使用するテーブルも用意された状態となる．</p>
<p>Laravel には「seeder」という機能があり，テスト用のデータを簡単に作成することができる．</p>
<p>今回はダミーデータを 10 件作成する．<code>database/seeders/DatabaseSeeder.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// database/seeders/DatabaseSeeder.php

&lt;?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
  /**
   * Seed the application's database.
   *
   * @return void
   */
  public function run()
  {
    // 🔽 この行のコメントから外す
    \App\Models\User::factory(10)-&gt;create();
  }
}

</code></pre>
<p>下記コマンドを実行してテストユーザを作成する．</p>
<pre><code class="language-bash">$ php artisan db:seed

# 実行結果
Database seeding completed successfully.

</code></pre>
<p>コマンドを実行したら phpmyadmin でユーザーデータを確認する．パスワードはハッシュ化されているが全員<code>password</code>となっている．</p>
<p>ブラウザの画面からメールアドレスとパスワードでログインできることを確認しよう．</p>
<p>ログインすると，下記の画面が表示される．</p>
<p><img src="laravel/laravel01/./img/register-success.png" alt="ユーザ登録完了" /></p>
<blockquote>
<p>【tips】</p>
<p><code>Email</code>は<code>example.com</code>を使用する．これはテスト用に用意されているドメインであり，誰かのメールアドレスを使用してしまうリスクを回避できる．</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ルーティングとコントローラ"><a class="header" href="#ルーティングとコントローラ">ルーティングとコントローラ</a></h1>
<p>Laravel では，クライアントからリクエストされた URL に対して，どの関数を実行するかを決める．この対応を決定するのが「ルーティング」であり，実際に実行される関数を記述するのが「コントローラ」である．</p>
<h2 id="ルーティングとコントローラの作成"><a class="header" href="#ルーティングとコントローラの作成">ルーティングとコントローラの作成</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<p>コントローラとルーティングを作成する．今回のコントローラ名は<code>TweetController</code>とする．</p>
<p><code>--resource</code>をつけることで，よく使用する処理（代表的な CRUD 処理）を一括して作成することができる．</p>
<p>下記コマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:controller TweetController --resource

# 実行結果
Controller created successfully.

</code></pre>
<p>これでコントローラファイルが作成された．続いてルーティングを作成する．</p>
<p><strong>ルーティングファイルは<code>routes</code>以下に配置される．</strong></p>
<p><code>routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
// 🔽 追加
use App\Http\Controllers\TweetController;

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider within a group which
| contains the &quot;web&quot; middleware group. Now create something great!
|
*/

// 🔽 追加
Route::resource('tweet', TweetController::class);

Route::get('/', function () {
    return view('welcome');
});

Route::get('/dashboard', function () {
    return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__.'/auth.php';

</code></pre>
<p>ルーティングの一覧は下記で確認できる．</p>
<pre><code class="language-bash">$ php artisan route:list

# 実行結果（ユーザ操作などのルーティングは省略）
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+

</code></pre>
<blockquote>
<p>【解説】</p>
<p><strong>この表は非常に重要．</strong></p>
<ul>
<li>例えば，<code>/tweet/</code>に<code>GET</code>でリクエストが来た場合，<code>TweetController</code>の<code>index</code>関数が動作することを示している．</li>
<li>このように，URL と動作する関数の対応を決めているのがルーティングである．</li>
</ul>
</blockquote>
<p>これで，ルーティング部分は完了である．</p>
<h2 id="コントローラの実装一部"><a class="header" href="#コントローラの実装一部">コントローラの実装（一部）</a></h2>
<p>URL にリクエストが来た場合に実行される関数はコントローラに記述される．まずはリクエストが来た場合に特定の画面を表示するよう処理を記述する．</p>
<p><strong>コントローラは<code>app/Http/Controllers</code>以下に配置される．</strong></p>
<p><code>app/Http/Controllers/TweetController.php</code>の内容を以下のように編集する．</p>
<p><code>view()</code>関数は指定したビューファイル（画面）を表示する．<code>tweet.index</code>は<code>tweet</code>フォルダの<code>index.blade.php</code>の意味．ビューファイルは次項で作成する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
// 🔽 2行追加
use Validator;
use App\Models\Tweet;

class TweetController extends Controller
{
  /**
   * Display a listing of the resource.
   *
   * @return \Illuminate\Http\Response
   */
  public function index()
  {
    // 🔽 追加
    return view('tweet.index');
  }

  /**
   * Show the form for creating a new resource.
   *
   * @return \Illuminate\Http\Response
   */
  public function create()
  {
    // 🔽 追加
    return view('tweet.create');
  }

  // 以降は変更なし

}

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="必要な画面の作成と動作確認"><a class="header" href="#必要な画面の作成と動作確認">必要な画面の作成と動作確認</a></h1>
<h2 id="共通画面の作成"><a class="header" href="#共通画面の作成">共通画面の作成</a></h2>
<p>実際にブラウザ画面に表示される内容を記述する．ビューファイルは<code>*.blade.php</code>の形式で作成する．これは「blade テンプレート」と呼ばれる形式であり，コントローラとのデータのやり取りなどに最適化されている．</p>
<p><strong>ビューファイルは<code>latavel_tweet/resources/views</code>ディレクトリ以下に配置する．</strong></p>
<p>blade テンプレートでは共通パーツと個別パーツを組み合わせて画面を構成する．例えば，アプリケーション全体を通して表示されるナビゲーションバーやエラー画面などは共通パーツである．</p>
<p>それぞれのパーツは「コンポーネント」と呼ばれる．</p>
<h2 id="共通パーツエラー表示の作成"><a class="header" href="#共通パーツエラー表示の作成">共通パーツ（エラー表示）の作成</a></h2>
<p>入力値が不正な場合などはエラー画面を表示して対応する．</p>
<p>tweet の入力や編集など複数の画面で必要となるため，共通のコンポーネントとして作成する．</p>
<p><code>latavel_tweet/resources/views</code>の中に<code>common</code>フォルダを作成する．
<code>common</code>フォルダの中に<code>errors.blade.php</code>ファイルを作成する．</p>
<p><code>errors.blade.php</code>に以下の内容を記述する．</p>
<pre><code class="language-php">@if (count($errors) &gt; 0)
&lt;div&gt;
  &lt;div class=&quot;font-medium text-red-600&quot;&gt;
    {{ __('Whoops! Something went wrong.') }}
  &lt;/div&gt;

  &lt;ul class=&quot;mt-3 list-disc list-inside text-sm text-red-600&quot;&gt;
    @foreach ($errors-&gt;all() as $error)
    &lt;li&gt;{{ $error }}&lt;/li&gt;
    @endforeach
  &lt;/ul&gt;
&lt;/div&gt;
@endif

</code></pre>
<h2 id="共通パーツナビゲーションバーの調整"><a class="header" href="#共通パーツナビゲーションバーの調整">共通パーツ（ナビゲーションバー）の調整</a></h2>
<p>ナビゲーションバーもアプリケーションを通じて使用するため，共通パーツとして作成する．</p>
<p>「tweet 一覧」と「tweet 作成」の 2 種類のリンクを作成しておく．</p>
<p><code>resources/views/layouts/navigation.blade.php</code>の内容を以下のように編集する．</p>
<p>全部で 4 箇所追記があるので注意．長いので全コピペ推奨．</p>
<pre><code class="language-php">&lt;nav x-data=&quot;{ open: false }&quot; class=&quot;bg-white border-b border-gray-100&quot;&gt;
  &lt;!-- Primary Navigation Menu --&gt;
  &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;
    &lt;div class=&quot;flex justify-between h-16&quot;&gt;
      &lt;div class=&quot;flex&quot;&gt;
        &lt;!-- Logo --&gt;
        &lt;div class=&quot;flex-shrink-0 flex items-center&quot;&gt;
          &lt;a href=&quot;{{ route('dashboard') }}&quot;&gt;
            &lt;x-application-logo class=&quot;block h-10 w-auto fill-current text-gray-600&quot; /&gt;
          &lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- Navigation Links --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
            {{ __('Dashboard') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
            {{ __('Index') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
            {{ __('Create') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- Settings Dropdown --&gt;
      &lt;div class=&quot;hidden sm:flex sm:items-center sm:ml-6&quot;&gt;
        &lt;x-dropdown align=&quot;right&quot; width=&quot;48&quot;&gt;
          &lt;x-slot name=&quot;trigger&quot;&gt;
            &lt;button class=&quot;flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out&quot;&gt;
              &lt;div&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;

              &lt;div class=&quot;ml-1&quot;&gt;
                &lt;svg class=&quot;fill-current h-4 w-4&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                  &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                &lt;/svg&gt;
              &lt;/div&gt;
            &lt;/button&gt;
          &lt;/x-slot&gt;

          &lt;x-slot name=&quot;content&quot;&gt;
            &lt;!-- Authentication --&gt;
            &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
              @csrf

              &lt;x-dropdown-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                                this.closest('form').submit();&quot;&gt;
                {{ __('Logout') }}
              &lt;/x-dropdown-link&gt;
            &lt;/form&gt;
          &lt;/x-slot&gt;
        &lt;/x-dropdown&gt;
      &lt;/div&gt;

      &lt;!-- Hamburger --&gt;
      &lt;div class=&quot;-mr-2 flex items-center sm:hidden&quot;&gt;
        &lt;button @click=&quot;open = ! open&quot; class=&quot;inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out&quot;&gt;
          &lt;svg class=&quot;h-6 w-6&quot; stroke=&quot;currentColor&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot;&gt;
            &lt;path :class=&quot;{'hidden': open, 'inline-flex': ! open }&quot; class=&quot;inline-flex&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M4 6h16M4 12h16M4 18h16&quot; /&gt;
            &lt;path :class=&quot;{'hidden': ! open, 'inline-flex': open }&quot; class=&quot;hidden&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M6 18L18 6M6 6l12 12&quot; /&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Responsive Navigation Menu --&gt;
  &lt;div :class=&quot;{'block': open, 'hidden': ! open}&quot; class=&quot;hidden sm:hidden&quot;&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
        {{ __('Dashboard') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
        {{ __('Index') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
        {{ __('Create') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;

    &lt;!-- Responsive Settings Options --&gt;
    &lt;div class=&quot;pt-4 pb-1 border-t border-gray-200&quot;&gt;
      &lt;div class=&quot;flex items-center px-4&quot;&gt;
        &lt;div class=&quot;flex-shrink-0&quot;&gt;
          &lt;svg class=&quot;h-10 w-10 fill-current text-gray-400&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;
            &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z&quot; /&gt;
          &lt;/svg&gt;
        &lt;/div&gt;

        &lt;div class=&quot;ml-3&quot;&gt;
          &lt;div class=&quot;font-medium text-base text-gray-800&quot;&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;
          &lt;div class=&quot;font-medium text-sm text-gray-500&quot;&gt;{{ Auth::user()-&gt;email }}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class=&quot;mt-3 space-y-1&quot;&gt;
        &lt;!-- Authentication --&gt;
        &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
          @csrf

          &lt;x-responsive-nav-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                        this.closest('form').submit();&quot;&gt;
            {{ __('Logout') }}
          &lt;/x-responsive-nav-link&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li>Laravel8 のビューは CSS フレームワークの<code>tailwind.css</code>を使用している．</li>
<li>予め用意されたクラス名を記述するだけでスタイルを適用できるので，ドキュメントを読みながらスタイルを変更してみよう．</li>
</ul>
</blockquote>
<p>画面をリロードすると下記のようにナビゲーションが設置された状態となる（一覧ページと作成ページはまだ作成していないので動作しない点に注意）．</p>
<p><img src="laravel/laravel01/./img/laratter_logged_in.png" alt="ナビゲーション設置" /></p>
<h2 id="tweet-作成画面の作成"><a class="header" href="#tweet-作成画面の作成">tweet 作成画面の作成</a></h2>
<p>まず，<code>resources/views</code>の中に<code>tweet</code>フォルダを作成する．</p>
<p>続いて，<code>tweet</code>フォルダの中に以下のファイルを作成する．今後必要になる画面のファイルも合わせて作成している．</p>
<ul>
<li><code>index.blade.php</code>（tweet 一覧画面）</li>
<li><code>create.blade.php</code>（tweet 作成画面）</li>
<li><code>show.blade.php</code>（tweet 詳細画面）</li>
<li><code>edit.blade.php</code>（tweet 編集画面）</li>
</ul>
<p>ファイルを作成したら<code>create.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/create.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Create New Tweet') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          @include('common.errors')
          &lt;form class=&quot;mb-6&quot; action=&quot;{{ route('tweet.store') }}&quot; method=&quot;POST&quot;&gt;
            @csrf
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;tweet&quot;&gt;Tweet&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;tweet&quot; id=&quot;tweet&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;description&quot;&gt;Description&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;description&quot; id=&quot;description&quot;&gt;
            &lt;/div&gt;
            &lt;button type=&quot;submit&quot; class=&quot;w-full py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
              Create
            &lt;/button&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>route('tweet.store')</code>は<code>TweetController</code>の<code>store()</code>関数にデータを送ることを示している．</li>
<li><code>@csrf</code>はセキュリティ対策．フォームからデータを送信するときには必ず記述すること．</li>
</ul>
</blockquote>
<h2 id="動作確認作成画面"><a class="header" href="#動作確認作成画面">動作確認（作成画面）</a></h2>
<p>編集したらブラウザから<code>localhost/tweet/create</code>にアクセスして動作確認．
下記画面になっていれば OK．</p>
<p><img src="laravel/laravel01/./img/laratter_create.png" alt="tweet作成画面" /></p>
<h2 id="tweet-一覧画面の作成"><a class="header" href="#tweet-一覧画面の作成">tweet 一覧画面の作成</a></h2>
<p>続いて，<code>index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 削除ボタン --&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<p>こちらはエラーが発生する．</p>
<p><img src="laravel/laravel01/./img/laratter_index_error.png" alt="一覧画面のエラー" /></p>
<p>コントローラから<code>$tweets</code>という名前でデータを受け取るよう記述しているが，コントローラからデータが送られていないためである．</p>
<p>とりあえず空のデータを送るように<code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>view()</code>関数の第 2 引数に渡したいデータを配列で記述する．</li>
<li>ここでは「<code>tweets</code>」という名前で「空の配列」を送っている．</li>
<li>ビューファイル側では<code>$tweets</code>とすることで渡されたデータを使うことができる．</li>
<li>また，変数などのデータは<code>var_dump()</code>または<code>dd()</code>または<code>ddd()</code>で確認することができる．これらを使ってデータの構造を確認しながら進めると良いだろう．</li>
</ul>
</blockquote>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function index()
{
  // 🔽 編集
  return view('tweet.index', [
    'tweets' =&gt; []
  ]);
}

</code></pre>
<h2 id="動作確認-8"><a class="header" href="#動作確認-8">動作確認</a></h2>
<p>編集したらブラウザから<code>localhost/tweet</code>にアクセスして動作確認．
下記画面になっていれば OK．</p>
<p><img src="laravel/laravel01/./img/laratter_index_empty.png" alt="一覧画面" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-作成処理の実装"><a class="header" href="#tweet-作成処理の実装">tweet 作成処理の実装</a></h1>
<p>必要な画面を揃えたので，作成ページから実際に DB にデータを保存できるようにする．</p>
<h2 id="model-の編集"><a class="header" href="#model-の編集">Model の編集</a></h2>
<p>Model の役割は「DB とのデータをやり取り」である．Model には DB からどのようにデータを取得するか，などの処理を記述する．</p>
<p>ただし，Model には予め使用頻度の高い処理（基本的な CRUD）が用意されているため，今回記述するコードはそれほど多くない．</p>
<p>まず，テーブル対して，Laravel 側からデータの作成や編集が行えないカラムを設定する．</p>
<p>これはクライアントから送信されてくるデータが ID やユーザ権限などの情報を書き換えてしまうリスクを低減させるためである．</p>
<p><code>app/Models/Tweet.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  // アプリケーション側でcreateなどできない値を記述する
  // 🔽 以下の処理を記述

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];
}


</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>$guarded</code>はアプリケーション側から変更できないカラムを指定する（ブラックリスト）．</li>
<li>対して，<code>$fillable</code>はアプリケーション側から変更できるカラムを指定する（ホワイトリスト）．</li>
<li>どちらを使用しても良いが，どちらかを使用する必要がある．</li>
</ul>
</blockquote>
<h2 id="controller-の編集"><a class="header" href="#controller-の編集">Controller の編集</a></h2>
<p>続いて，コントローラに「Model に対しての命令」を記述する．DB とやり取りする関数はすでに定義されているのでモデル側に新たな記述は必要ない．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>store()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function store(Request $request)
{
  // バリデーション
  $validator = Validator::make($request-&gt;all(), [
    'tweet' =&gt; 'required | max:191',
    'description' =&gt; 'required',
  ]);
  // バリデーション:エラー
  if ($validator-&gt;fails()) {
    return redirect()
      -&gt;route('tweet.create')
      -&gt;withInput()
      -&gt;withErrors($validator);
  }
  // create()は最初から用意されている関数
  // 戻り値は挿入されたレコードの情報
  $result = Tweet::create($request-&gt;all());
  // ルーティング「todo.index」にリクエスト送信（一覧ページに移動）
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>create.blade.php</code>から送信されていたデータは<code>$request</code>に入っている．<code>$request-&gt;all()</code>とすることで全部取得することができる．</li>
<li><code>redirect()-&gt;route('tweet.index')</code>は指定したコントローラの関数を動かす．今回は<code>TweetController</code>の<code>index()</code>関数．</li>
</ul>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-一覧画面の実装"><a class="header" href="#tweet-一覧画面の実装">tweet 一覧画面の実装</a></h1>
<p>一覧画面では締切が早い順にソートしてデータを表示する．</p>
<h3 id="model-の処理"><a class="header" href="#model-の処理">Model の処理</a></h3>
<p>まず，上記の条件でデータを取得する関数を Model に作成する．</p>
<p><code>app/Models/Tweet.php</code>に以下の関数を作成する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

class Tweet extends Model
{
  use HasFactory;

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];

  // 🔽 追加
  public static function getAllOrderByUpdated_at()
  {
    return self::orderBy('updated_at', 'desc')-&gt;get();
  }
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>self</code>は Tweet モデルのこと．</li>
<li><code>orderBy()</code>は SQL のものと同じ理解で OK．</li>
<li>最後の<code>get()</code>がないと実行されないので注意．</li>
</ul>
</blockquote>
<h2 id="controller-を編集"><a class="header" href="#controller-を編集">Controller を編集</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function index()
{
  // 🔽 編集
  $tweets = Tweet::getAllOrderByUpdated_at();
  return view('tweet.index', [
    'tweets' =&gt; $tweets
  ]);
}

</code></pre>
<h2 id="動作確認-9"><a class="header" href="#動作確認-9">動作確認</a></h2>
<p>tweet 作成画面でデータを入力して送信すると．．．</p>
<p><img src="laravel/laravel01/./img/laratter_create_adding.png" alt="データ作成" /></p>
<p>自動的に一覧画面に切り替わる．</p>
<p><img src="laravel/laravel01/./img/laratter_index_added_one.png" alt="データ1件追加" /></p>
<p>自分が入力したデータが表示されていれば OK．何件かデータを入れておこう．</p>
<p><img src="laravel/laravel01/./img/laratter_index_added_some.png" alt="データ複数件追加" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day07"><a class="header" href="#day07">Day07</a></h1>
<h2 id="本日の内容-1"><a class="header" href="#本日の内容-1">本日の内容</a></h2>
<ul>
<li>SNS アプリケーションの実装（詳細表示，更新処理，削除処理）</li>
<li>ユーザ情報の利用</li>
</ul>
<h2 id="本日の目標-1"><a class="header" href="#本日の目標-1">本日の目標</a></h2>
<ul>
<li>CRUD 処理の流れをマスターする．</li>
<li>ユーザ情報の取得や取得したデータの使い方を学ぶ．</li>
<li>データを連携させる処理を実装する．</li>
</ul>
<h2 id="ルーティング表-1"><a class="header" href="#ルーティング表-1">ルーティング表</a></h2>
<p>都度確認しよう！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドまとめ-2"><a class="header" href="#多用するコマンドまとめ-2">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる-2"><a class="header" href="#仮想コンテナを立ち上げる-2">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる-2"><a class="header" href="#仮想コンテナを終了させる-2">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする-2"><a class="header" href="#laravel-コンテナへログインする-2">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする-2"><a class="header" href="#mysql-コンテナへログインする-2">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする-2"><a class="header" href="#コンテナからログアウトする-2">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-詳細画面の実装"><a class="header" href="#tweet-詳細画面の実装">tweet 詳細画面の実装</a></h1>
<p>詳細画面は tweet の 1 件を個別に表示する．</p>
<h2 id="一覧画面に詳細画面へのリンクを作成"><a class="header" href="#一覧画面に詳細画面へのリンクを作成">一覧画面に詳細画面へのリンクを作成</a></h2>
<p>各 tweet の詳細を取得する処理と表示する画面を作成する．</p>
<p>一覧画面の tweet 名をクリックすると詳細画面に移動するようにする．</p>
<p>クリックするとコントローラの<code>show()</code>関数にリクエストを送るように記述している．</p>
<p><code>resources/views/tweet/index.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;!-- 🔽 詳細画面へのリンク --&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 削除ボタン --&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="指定した-1-件のデータを取得する処理を追加"><a class="header" href="#指定した-1-件のデータを取得する処理を追加">指定した 1 件のデータを取得する処理を追加</a></h2>
<p><code>show()</code>関数では，ID を指定して 1 件のデータを取得したい．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>show()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function show($id)
{
  $tweet = Tweet::find($id);
  return view('tweet.show', ['tweet' =&gt; $tweet]);
}

</code></pre>
<p>ここでは，受け取った ID の値でテーブルからデータを取り出し，<code>tweet</code>という名前で<code>show.blade.php</code>に渡している．</p>
<h2 id="詳細表示画面の作成"><a class="header" href="#詳細表示画面の作成">詳細表示画面の作成</a></h2>
<p>詳細画面の<code>resources/views/tweet/show.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Show Tweet Detail') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;div class=&quot;mb-6&quot;&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;p class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot;&gt;Tweet&lt;/p&gt;
              &lt;p class=&quot;py-2 px-3 text-grey-darkest&quot; id=&quot;tweet&quot;&gt;
                {{$tweet-&gt;tweet}}
              &lt;/p&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;p class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot;&gt;Description&lt;/p&gt;
              &lt;p class=&quot;py-2 px-3 text-grey-darkest&quot; id=&quot;description&quot;&gt;
                {{$tweet-&gt;description}}
              &lt;/p&gt;
            &lt;/div&gt;
            &lt;a href=&quot;{{ route('tweet.index') }}&quot; class=&quot;block text-center w-full py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
              Back
            &lt;/a&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-10"><a class="header" href="#動作確認-10">動作確認</a></h2>
<p>一覧画面で各 tweet をクリックし，下記のように詳細画面が表示されれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_show.png" alt="詳細画面" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-削除処理の実装"><a class="header" href="#tweet-削除処理の実装">tweet 削除処理の実装</a></h1>
<p>一覧画面に削除ボタンを設置し，クリックしたら該当するデータを削除できるようにする．</p>
<h2 id="一覧画面に削除ボタンを追加"><a class="header" href="#一覧画面に削除ボタンを追加">一覧画面に削除ボタンを追加</a></h2>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 🔽 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li>削除ボタンクリック時には，コントローラの<code>destroy()</code>関数にリクエストが送られる．</li>
<li>削除の処理を行うには<code>DELETE</code>メソッドでリクエストを送る必要があるが，form からは GET または POST でしか送れない．</li>
<li><code>@method('delete')</code>を記述することで，<code>DELETE</code>メソッドで送信できる．</li>
</ul>
</blockquote>
<h2 id="動作確認削除ボタンの設置"><a class="header" href="#動作確認削除ボタンの設置">動作確認（削除ボタンの設置）</a></h2>
<p>一覧画面を確認し，削除ボタンが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_added_delete_button.png" alt="削除ボタン追加" /></p>
<h2 id="指定したデータを削除する処理の作成"><a class="header" href="#指定したデータを削除する処理の作成">指定したデータを削除する処理の作成</a></h2>
<p>まず ID で指定したデータを 1 件抽出し，そのデータを削除する，という流れ．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>destroy()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controller/TweetController.php

public function destroy($id)
{
  $result = Tweet::find($id)-&gt;delete();
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<h2 id="動作確認削除処理"><a class="header" href="#動作確認削除処理">動作確認（削除処理）</a></h2>
<p>動作させて確認する．削除ボタンをクリックし，該当するデータが削除されれば OK．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-更新処理の実装"><a class="header" href="#tweet-更新処理の実装">tweet 更新処理の実装</a></h1>
<p>更新処理は</p>
<ol>
<li>一覧画面に編集ボタンを設置．</li>
<li>編集ボタンをクリックしたら編集画面に移動.</li>
<li>編集画面でデータを書き換え，送信ボタンクリックで DB のデータを更新する．</li>
</ol>
<h2 id="一覧画面に編集ボタンを追加"><a class="header" href="#一覧画面に編集ボタンを追加">一覧画面に編集ボタンを追加</a></h2>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 🔽 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集ボタンの設置"><a class="header" href="#動作確認編集ボタンの設置">動作確認（編集ボタンの設置）</a></h2>
<p>一覧画面に編集ボタンが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_added_edit_button.png" alt="編集ボタン追加" /></p>
<h2 id="編集画面に移動する処理の作成"><a class="header" href="#編集画面に移動する処理の作成">編集画面に移動する処理の作成</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>edit()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controller/TweetController.php

public function edit($id)
{
  $tweet = Tweet::find($id);
  return view('tweet.edit', ['tweet' =&gt; $tweet]);
}

</code></pre>
<p>やっていることは<code>create()</code>関数と同様．</p>
<h2 id="編集画面の作成-1"><a class="header" href="#編集画面の作成-1">編集画面の作成</a></h2>
<p><code>resources/views/tweet/edit.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/edit.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Edit Tweet') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          @include('common.errors')
          &lt;form class=&quot;mb-6&quot; action=&quot;{{ route('tweet.update',$tweet-&gt;id) }}&quot; method=&quot;POST&quot;&gt;
            @method('put')
            @csrf
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;tweet&quot;&gt;tweet&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;tweet&quot; id=&quot;tweet&quot; value=&quot;{{$tweet-&gt;tweet}}&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;description&quot;&gt;Description&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;description&quot; id=&quot;description&quot; value=&quot;{{$tweet-&gt;description}}&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex justify-evenly&quot;&gt;
              &lt;a href=&quot;{{ route('tweet.index') }}&quot; class=&quot;block text-center w-5/12 py-3 mt-6 font-medium tracking-widest text-black uppercase bg-gray-100 shadow-sm focus:outline-none hover:bg-gray-200 hover:shadow-none&quot;&gt;
                Back
              &lt;/a&gt;
              &lt;button type=&quot;submit&quot; class=&quot;w-5/12 py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
                Update
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集画面"><a class="header" href="#動作確認編集画面">動作確認（編集画面）</a></h2>
<p>一覧画面の編集ボタンをクリックし，現在のデータが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_edit.png" alt="編集画面" /></p>
<h2 id="指定したデータを更新する処理の作成"><a class="header" href="#指定したデータを更新する処理の作成">指定したデータを更新する処理の作成</a></h2>
<p>編集画面でデータを書き換え，コントローラの<code>update()</code>関数にデータを送信し，DB のデータを更新する．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>update()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function update(Request $request, $id)
{
  //バリデーション
  $validator = Validator::make($request-&gt;all(), [
    'tweet' =&gt; 'required | max:191',
    'description' =&gt; 'required',
  ]);
  //バリデーション:エラー
  if ($validator-&gt;fails()) {
    return redirect()
      -&gt;route('tweet.edit', $id)
      -&gt;withInput()
      -&gt;withErrors($validator);
  }
  //データ更新処理
  // updateは更新する情報がなくても更新が走る（updated_atが更新される）
  $result = Tweet::find($id)-&gt;update($request-&gt;all());
  // fill()save()は更新する情報がない場合は更新が走らない（updated_atが更新されない）
  // $redult = Tweet::find($id)-&gt;fill($request-&gt;all())-&gt;save();
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<h2 id="動作確認更新処理"><a class="header" href="#動作確認更新処理">動作確認（更新処理）</a></h2>
<p>一覧画面のデータが，編集画面で書き換えたデータに更新されれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_updated.png" alt="データ更新結果" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-とユーザ認証の連携"><a class="header" href="#tweet-とユーザ認証の連携">tweet とユーザ認証の連携</a></h1>
<p>はじめのほうで，ユーザ認証を行う breeze ライブラリをインストールしたため，これを利用してユーザ管理を行う．</p>
<p>まず，認証ユーザのみがアプリケーションの機能を利用できるように処理を変更する．現状ではログインしていない状態でも一覧画面などにアクセスできてしまう（実際はユーザ情報が不足しているためエラー画面となる）．</p>
<h2 id="ログインしていないユーザはアプリケーションにアクセスできないようにする"><a class="header" href="#ログインしていないユーザはアプリケーションにアクセスできないようにする">ログインしていないユーザはアプリケーションにアクセスできないようにする．</a></h2>
<p><code>app/routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// app/routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

// コメントは省略

// 🔽 ここを編集
Route::group(['middleware' =&gt; 'auth'], function () {
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="動作確認ログイン必須"><a class="header" href="#動作確認ログイン必須">動作確認（ログイン必須）</a></h2>
<p>一旦ログアウトした状態で，URL 直打ち（<code>localhost/tweet</code>）して tweet 画面にアクセスできずにログイン画面に戻されれば OK！</p>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>['middleware' =&gt; 'auth']</code> を記述することで認証状態をチェックしてくれる．</li>
<li><code>{}</code> 内に記述したルーティングは認証必須となり，未認証（未ログイン）の場合はログイン画面に戻される．</li>
</ul>
</blockquote>
<h2 id="tweet-テーブルにユーザ-id-カラムを追加する"><a class="header" href="#tweet-テーブルにユーザ-id-カラムを追加する">tweet テーブルにユーザ ID カラムを追加する</a></h2>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<h3 id="マイグレーションファイルの作成"><a class="header" href="#マイグレーションファイルの作成">マイグレーションファイルの作成</a></h3>
<p>カラムの変更はマイグレーションで行う．</p>
<blockquote>
<ul>
<li>本来はカラムはテーブル作成時点で決定しておくことが望ましい．</li>
<li>マイグレーションは実行した内容を取り消せる（ロールバック）ため，不具合が生じても対応できる場合が多い．</li>
</ul>
</blockquote>
<p>下記コマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:migration add_user_id_to_tweets_table --table=tweets

# 実行結果
Created Migration: 2021_09_24_061716_add_user_id_to_tweets_table

</code></pre>
<h3 id="マイグレーションファイルの編集"><a class="header" href="#マイグレーションファイルの編集">マイグレーションファイルの編集</a></h3>
<p><code>database/migration/2021_09_24_061716_add_user_id_to_tweets_table.php</code>を開く．
下記にように編集する．</p>
<blockquote>
<p>他のテーブルと relation させるためには，カラム名を「<code>モデル名小文字_id</code>」とする必要がある．</p>
</blockquote>
<pre><code class="language-php">// database/migrations/2021_09_24_061716_add_user_id_to_tweets_table.php

public function up()
{
  Schema::table('tweets', function (Blueprint $table) {
    // 🔽 1行追加
    $table-&gt;integer('user_id')-&gt;after('id');
  });
}

</code></pre>
<h3 id="マイグレーション実行-1"><a class="header" href="#マイグレーション実行-1">マイグレーション実行</a></h3>
<p>以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migrating: 2021_09_24_061716_add_user_id_to_tweets_table
Migrated:  2021_09_24_061716_add_user_id_to_tweets_table (102.98ms)

</code></pre>
<h2 id="テーブルの確認"><a class="header" href="#テーブルの確認">テーブルの確認</a></h2>
<p>phpmyadmin でテーブルの構造を確認する．<code>user_id</code> カラムが追加されていれば OK．</p>
<pre><code class="language-txt">+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id     | int             | NO   |     | NULL    |                |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】コマンドで確認する場合は以下の手順で行う．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

mysql にログインしてテーブルを確認する．パスワードは`password`．

```bash
$ mysql -u sail -p

mysql> use laratter
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweets                 |
| users                  |
+------------------------+
6 rows in set (0.01 sec)

mysql> desc tweets;
+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id     | int             | NO   |     | NULL    |                |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)

mysql>

``` -->
<h2 id="データ追加時に-user_id-を追加"><a class="header" href="#データ追加時に-user_id-を追加">データ追加時に user_id を追加</a></h2>
<p>tweet のデータを作成する際に，「誰が作成したのか」がわかるように，データにログインユーザの ID を追加する．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>store()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

use Validator;
use App\Models\Tweet;

// 🔽 追加
use Auth;

class TweetController extends Controller
{

  // 省略

  public function store(Request $request)
  {
    // バリデーション
    $validator = Validator::make($request-&gt;all(), [
      'tweet' =&gt; 'required | max:191',
      'description' =&gt; 'required',
    ]);
    // バリデーション:エラー
    if ($validator-&gt;fails()) {
      return redirect()
        -&gt;route('tweet.create')
        -&gt;withInput()
        -&gt;withErrors($validator);
    }

    // 🔽 編集 フォームから送信されてきたデータとユーザIDをマージし，DBにinsertする
    $data = $request-&gt;merge(['user_id' =&gt; Auth::user()-&gt;id])-&gt;all();
    $result = Tweet::create($data);

    // tweet.index」にリクエスト送信（一覧ページに移動）
    return redirect()-&gt;route('tweet.index');
  }

  // 省略
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>$request-&gt;merge()</code>でユーザ ID を追加している．</li>
<li><code>Auth::user()-&gt;id</code>で現在ログインしているユーザの ID を取得することができる（<code>Auth::id()</code>でも可）．</li>
<li><code>Auth::user()</code>には他にもデータが入っているので，<code>dd()</code>などで確認してみると良いだろう．</li>
</ul>
</blockquote>
<h2 id="動作確認-11"><a class="header" href="#動作確認-11">動作確認</a></h2>
<p>適当なデータを追加し，phpmyadmin で確認する．</p>
<p>tweets テーブルのデータにユーザ ID が一緒に入っていれば OK．既存データの user_id カラムに 0 が入っているので，ログインユーザの ID に変更しておこう．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="day08"><a class="header" href="#day08">Day08</a></h1>
<h2 id="本日の内容-2"><a class="header" href="#本日の内容-2">本日の内容</a></h2>
<ul>
<li>マイページの実装（1 対多のデータ）．</li>
<li>ユーザ名の表示（多対 1 のデータ）．</li>
<li>favorite 機能の実装（多対多）．</li>
</ul>
<h2 id="本日の目標-2"><a class="header" href="#本日の目標-2">本日の目標</a></h2>
<ul>
<li>SNS アプリケーションを完成させる．</li>
<li>様々な形のデータを扱う方法を学ぶ．</li>
<li>Laravel でアプリケーションを開発するイメージを持つ．</li>
</ul>
<h2 id="ルーティング表-2"><a class="header" href="#ルーティング表-2">ルーティング表</a></h2>
<p>都度確認しよう！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドまとめ-3"><a class="header" href="#多用するコマンドまとめ-3">多用するコマンドまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="仮想コンテナを立ち上げる-3"><a class="header" href="#仮想コンテナを立ち上げる-3">仮想コンテナを立ち上げる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail up -d
</code></pre>
<h3 id="仮想コンテナを終了させる-3"><a class="header" href="#仮想コンテナを終了させる-3">仮想コンテナを終了させる</a></h3>
<pre><code class="language-bash">$ ./vendor/bin/sail down
</code></pre>
<h3 id="laravel-コンテナへログインする-3"><a class="header" href="#laravel-コンテナへログインする-3">Laravel コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
</code></pre>
<h3 id="mysql-コンテナへログインする-3"><a class="header" href="#mysql-コンテナへログインする-3">MySQL コンテナへログインする</a></h3>
<pre><code class="language-bash">$ docker-compose exec mysql bash
</code></pre>
<h3 id="コンテナからログアウトする-3"><a class="header" href="#コンテナからログアウトする-3">コンテナからログアウトする</a></h3>
<pre><code class="language-bash">$ exit
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="マイページ機能の実装1-対多のデータ"><a class="header" href="#マイページ機能の実装1-対多のデータ">マイページ機能の実装（1 対多のデータ）</a></h1>
<p>現在，一覧ページにはユーザ関係なく全てのデータが表示された状態となっている．ユーザが自分の投稿を確認して編集できるように，マイページ機能を実装する．</p>
<h2 id="1-対多のデータ連携"><a class="header" href="#1-対多のデータ連携">1 対多のデータ連携</a></h2>
<p>今回の場合，ユーザと tweet が「1 対多」の関係となっている．</p>
<p>Laravel では，このような場合に親となるデータから子のデータを取得する方法が準備されている．</p>
<p><code>app/Models/User.php</code>に以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Models/User.php

class User extends Authenticatable
{
  use HasApiTokens, HasFactory, Notifiable;

  // 省略

  // 🔽 追加
  public function mytweets()
  {
    return $this-&gt;hasMany(Tweet::class)-&gt;orderBy('updated_at', 'desc');
  }
}

</code></pre>
<p>ここで，User と Tweet を連携させるためには，子（Tweet）のカラムに「<code>親_id</code>」（&lt;- 今回は<code>user_id</code>）を用意しておく必要がある（前項で実施）．</p>
<p>これで<code>User</code>モデルを用いて，特定のユーザが投稿した tweet を取得できるようになる．</p>
<h2 id="マイページのルーティング"><a class="header" href="#マイページのルーティング">マイページのルーティング</a></h2>
<p>マイページを表示するためのルーティングを追加する．</p>
<p><code>routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

Route::group(['middleware' =&gt; 'auth'], function () {
  // 🔽 追加
  Route::get('/tweet/mypage', [TweetController::class, 'mydata'])-&gt;name('tweet.mypage');
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="特定ユーザのデータのみ取得する処理"><a class="header" href="#特定ユーザのデータのみ取得する処理">特定ユーザのデータのみ取得する処理</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<p><code>class TweetController extends Controller{ ... }</code>内の最後に<code>mydata()</code>関数を追加すれば OK．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Validator;
use App\Models\Tweet;
use Auth;

// 🔽 追加
use App\Models\User;

class TweetController extends Controller
{

  // 省略

  public function mydata()
  {
    // Userモデルに定義した関数を実行する．
    $tweets = User::find(Auth::user()-&gt;id)-&gt;mytweets;
    return view('tweet.index', [
      'tweets' =&gt; $tweets
    ]);
  }
}

</code></pre>
<h2 id="マイページ画面の確認"><a class="header" href="#マイページ画面の確認">マイページ画面の確認</a></h2>
<p>マイページ自体は<code>index.blade.php</code>画面をそのまま利用するため，新たに実装する必要はない（ビューファイルにログインユーザのデータのみ渡される）．</p>
<p>スムーズにマイページにアクセスできるようにするため，ナビゲーション部分にリンクを追加する．</p>
<p><code>resources/views/layouts/navigation.blade.php</code>の内容を以下のように編集する．</p>
<p>長いので全コピペ推奨．</p>
<pre><code class="language-php">&lt;!-- resources/views/layouts/navigation.blade.php --&gt;

&lt;nav x-data=&quot;{ open: false }&quot; class=&quot;bg-white border-b border-gray-100&quot;&gt;
  &lt;!-- Primary Navigation Menu --&gt;
  &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;
    &lt;div class=&quot;flex justify-between h-16&quot;&gt;
      &lt;div class=&quot;flex&quot;&gt;
        &lt;!-- Logo --&gt;
        &lt;div class=&quot;flex-shrink-0 flex items-center&quot;&gt;
          &lt;a href=&quot;{{ route('dashboard') }}&quot;&gt;
            &lt;x-application-logo class=&quot;block h-10 w-auto fill-current text-gray-600&quot; /&gt;
          &lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- Navigation Links --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
            {{ __('Dashboard') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
            {{ __('Index') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
            {{ __('Create') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 マイページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.mypage')&quot; :active=&quot;request()-&gt;routeIs('tweet.mypage')&quot;&gt;
            {{ __('Mypage') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- Settings Dropdown --&gt;
      &lt;div class=&quot;hidden sm:flex sm:items-center sm:ml-6&quot;&gt;
        &lt;x-dropdown align=&quot;right&quot; width=&quot;48&quot;&gt;
          &lt;x-slot name=&quot;trigger&quot;&gt;
            &lt;button class=&quot;flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out&quot;&gt;
              &lt;div&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;

              &lt;div class=&quot;ml-1&quot;&gt;
                &lt;svg class=&quot;fill-current h-4 w-4&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                  &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                &lt;/svg&gt;
              &lt;/div&gt;
            &lt;/button&gt;
          &lt;/x-slot&gt;

          &lt;x-slot name=&quot;content&quot;&gt;
            &lt;!-- Authentication --&gt;
            &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
              @csrf

              &lt;x-dropdown-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                                this.closest('form').submit();&quot;&gt;
                {{ __('Logout') }}
              &lt;/x-dropdown-link&gt;
            &lt;/form&gt;
          &lt;/x-slot&gt;
        &lt;/x-dropdown&gt;
      &lt;/div&gt;

      &lt;!-- Hamburger --&gt;
      &lt;div class=&quot;-mr-2 flex items-center sm:hidden&quot;&gt;
        &lt;button @click=&quot;open = ! open&quot; class=&quot;inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out&quot;&gt;
          &lt;svg class=&quot;h-6 w-6&quot; stroke=&quot;currentColor&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot;&gt;
            &lt;path :class=&quot;{'hidden': open, 'inline-flex': ! open }&quot; class=&quot;inline-flex&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M4 6h16M4 12h16M4 18h16&quot; /&gt;
            &lt;path :class=&quot;{'hidden': ! open, 'inline-flex': open }&quot; class=&quot;hidden&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M6 18L18 6M6 6l12 12&quot; /&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Responsive Navigation Menu --&gt;
  &lt;div :class=&quot;{'block': open, 'hidden': ! open}&quot; class=&quot;hidden sm:hidden&quot;&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
        {{ __('Dashboard') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
        {{ __('Index') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
        {{ __('Create') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 マイページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.mypage')&quot; :active=&quot;request()-&gt;routeIs('tweet.mypage')&quot;&gt;
        {{ __('Mypage') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;

    &lt;!-- Responsive Settings Options --&gt;
    &lt;div class=&quot;pt-4 pb-1 border-t border-gray-200&quot;&gt;
      &lt;div class=&quot;flex items-center px-4&quot;&gt;
        &lt;div class=&quot;flex-shrink-0&quot;&gt;
          &lt;svg class=&quot;h-10 w-10 fill-current text-gray-400&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;
            &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z&quot; /&gt;
          &lt;/svg&gt;
        &lt;/div&gt;

        &lt;div class=&quot;ml-3&quot;&gt;
          &lt;div class=&quot;font-medium text-base text-gray-800&quot;&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;
          &lt;div class=&quot;font-medium text-sm text-gray-500&quot;&gt;{{ Auth::user()-&gt;email }}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class=&quot;mt-3 space-y-1&quot;&gt;
        &lt;!-- Authentication --&gt;
        &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
          @csrf

          &lt;x-responsive-nav-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                        this.closest('form').submit();&quot;&gt;
            {{ __('Logout') }}
          &lt;/x-responsive-nav-link&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;

</code></pre>
<h2 id="tweet-データの編集"><a class="header" href="#tweet-データの編集">tweet データの編集</a></h2>
<p>phpmyadmin で tweets テーブルのデータを確認し，レコード毎に<code>user_id</code>が異なるよう調整しておく．</p>
<h2 id="動作確認マイページ"><a class="header" href="#動作確認マイページ">動作確認（マイページ）</a></h2>
<p>下図のようにマイページへのリンクが表示される．</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_mypage_nav.png" alt="マイページへのリンク" /></p>
<p>マイページを表示させ，ログインしているユーザのデータのみ表示されることを確認する．異なるユーザでログインし，個別にデータが表示されることを確認しても良いだろう．</p>
<p><img src="laravel/laravel03/./img/laratter_mypage.png" alt="マイページへのリンク" /></p>
<h2 id="一覧ページでログインユーザの投稿のみ編集削除できるようにする"><a class="header" href="#一覧ページでログインユーザの投稿のみ編集削除できるようにする">一覧ページでログインユーザの投稿のみ編集削除できるようにする</a></h2>
<p>現状，一覧ページでは全ての投稿に対して編集や削除が行える状態である．これを下記のようにしたい．</p>
<ul>
<li>ログインしているユーザは自分の投稿を編集削除できる．</li>
<li>自分以外のユーザの投稿は閲覧のみ可能．</li>
</ul>
<p>一覧画面のビューファイル内で条件分岐を行い，編集ボタンと削除ボタンの表示非表示を制御することで実現できる．</p>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 🔽 条件分岐でログインしているユーザが投稿したtweetのみ編集ボタンと削除ボタンが表示される --&gt;
                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集削除ボタンの表示非表示"><a class="header" href="#動作確認編集削除ボタンの表示非表示">動作確認（編集削除ボタンの表示非表示）</a></h2>
<p>自分の投稿のみ編集ボタンと削除ボタンが表示されれば OK！</p>
<p>phpmyadmin で <code>user_id</code> カラムを適当に編集しながら確認すると良いだろう．</p>
<p><img src="laravel/laravel03/./img/laratter_index_switch_edit_remove.png" alt="編集削除ボタンの表示非表示適用" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="投稿者名の表示多対-1-のデータ"><a class="header" href="#投稿者名の表示多対-1-のデータ">投稿者名の表示（多対 1 のデータ）</a></h1>
<p>一覧ページでログインユーザのみが編集と削除を行えるようにしたが，このままでは tweet がどのユーザによって行われたのかを画面から判別できない．</p>
<p>そこで，各 tweet にユーザ名を表示して tweet の識別ができるようにする．</p>
<h2 id="多対-1-のデータ構造"><a class="header" href="#多対-1-のデータ構造">多対 1 のデータ構造</a></h2>
<p>tweet とユーザの関係は「多対 1」である（1 対多の逆）．</p>
<p>Laravel では，この場合も連携ができる機能が準備されている．</p>
<p>設定はモデル部分に記述する．<code>app/Http/Models/Tweet.php</code>を以下のように編集する．</p>
<p>子のモデルに<code>belongsTo()</code>を設定することで親のモデルを指定することができる．これで「Tweet モデルは User モデルに属している」状態となる．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];

  public static function getAllOrderByDeadline()
  {
    return self::orderBy('updated_at', 'desc')-&gt;get();
  }

  // 🔽 追加
  public function user()
  {
    return $this-&gt;belongsTo(User::class);
  }

}

</code></pre>
<h2 id="連携したデータの呼び出し"><a class="header" href="#連携したデータの呼び出し">連携したデータの呼び出し</a></h2>
<p>モデルに多対 1 の関係を指定できたので，<code>user</code>関数を用いて子のデータから親のデータを呼び出せるようになった．</p>
<p>ビューファイルでは tweet の内容を表示しているので，<code>$tweet-&gt;user-&gt;name</code>のように指定することで親データ（この場合は<code>name</code>）を取得できる．</p>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;!-- 🔽 追加 --&gt;
                    &lt;p class=&quot;text-left text-grey-dark&quot;&gt;{{$tweet-&gt;user-&gt;name}}&lt;/p&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-12"><a class="header" href="#動作確認-12">動作確認</a></h2>
<p>一覧画面で各 tweet に投稿者名が表示されれば OK！</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_auther.png" alt="投稿者名の表示" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="favorite-機能-1多対多のデータ中間テーブル"><a class="header" href="#favorite-機能-1多対多のデータ中間テーブル">Favorite 機能 1（多対多のデータ・中間テーブル）</a></h1>
<p>ここからは SNS においてメジャーな機能である「Favorite 機能」を実装していく．</p>
<p>Favorite は多対多のデータ構造となるため，新たに中間テーブルを作成する必要がある．</p>
<h2 id="多対多のデータ構造"><a class="header" href="#多対多のデータ構造">多対多のデータ構造</a></h2>
<p>Laravel では中間テーブルの命名を「関連するテーブル A の単数形_関連するテーブル B の単数形（テーブル名はアルファベット順）」とする規則がある．</p>
<p>したがって，今回の中間テーブル名は <code>tweet_user</code> となる．</p>
<p>↓ テーブルの構造（主要なもののみ記載）</p>
<pre><code class="language-txt">users
    id - integer
    name - string

tweets
    id - integer
    tweet - string
    description - string

tweet_user
    user_id - integer
    tweet_id - integer

</code></pre>
<blockquote>
<p>📦 <strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.test bash
root@8544d96d2334:/var/www/html#
</code></pre>
</blockquote>
<h2 id="マイグレーションファイルの作成-1"><a class="header" href="#マイグレーションファイルの作成-1">マイグレーションファイルの作成</a></h2>
<p>テーブルの作成はマイグレーションで行う．まずはマイグレーションファイルを作成する．</p>
<pre><code class="language-bash">$ php artisan make:migration create_tweet_user_table
</code></pre>
<p>マイグレーションファイル（<code>database/migrations/2021_09_24_072924_create_tweet_user_table.php</code>）を開き，<code>up()</code> 関数を以下のように編集する．</p>
<pre><code class="language-php">// database/migrations/2021_09_24_072924_create_tweet_user_table.php

public function up()
{
  Schema::create('tweet_user', function (Blueprint $table) {
    $table-&gt;id();
    // 🔽 ここから追加
    $table-&gt;unsignedBigInteger('user_id');
    $table-&gt;unsignedBigInteger('tweet_id');
    $table-&gt;foreign('user_id')-&gt;references('id')-&gt;on('users')-&gt;onDelete('cascade');
    $table-&gt;foreign('tweet_id')-&gt;references('id')-&gt;on('tweets')-&gt;onDelete('cascade');
    $table-&gt;unique(['user_id', 'tweet_id']);
    // 🔼 ここまで追加
    $table-&gt;timestamps();
  });
}

</code></pre>
<h2 id="補足マイグレーションファイルの設定項目について"><a class="header" href="#補足マイグレーションファイルの設定項目について">【補足】マイグレーションファイルの設定項目について</a></h2>
<table><thead><tr><th>関数</th><th>意味</th></tr></thead><tbody>
<tr><td><code>foreign()</code></td><td>引数のカラムが外部キー制約であることを示す．</td></tr>
<tr><td><code>references()</code></td><td>↑ で参照する外部キーを設定する．</td></tr>
<tr><td><code>on()</code></td><td>↑ で参照するテーブルを設定する．</td></tr>
<tr><td><code>onDelete()</code></td><td>↑ で参照しているデータが削除された場合に中間テーブルのデータも削除する設定．</td></tr>
</tbody></table>
<p>上記をまとめると「中間テーブルの <code>user_id</code> は <code>users</code> テーブルの <code>id</code> を参照していて，<code>users</code> テーブルのデータが削除されると中間テーブルのデータも削除される」となる．</p>
<h2 id="マイグレーションの実行"><a class="header" href="#マイグレーションの実行">マイグレーションの実行</a></h2>
<p>マイグレーションファイルを作成したらマイグレーションを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migrating: 2021_09_24_072924_create_tweet_user_table
Migrated:  2021_09_24_072924_create_tweet_user_table (451.37ms)

</code></pre>
<h2 id="テーブルの確認-1"><a class="header" href="#テーブルの確認-1">テーブルの確認</a></h2>
<p>phpmyadmin で，<code>tweet_user</code> テーブルが作成されていることを確認する．</p>
<pre><code class="language-txt">+------------+-----------------+------+-----+---------+----------------+
| Field      | Type            | Null | Key | Default | Extra          |
+------------+-----------------+------+-----+---------+----------------+
| id         | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id    | bigint unsigned | NO   | MUL | NULL    |                |
| tweet_id   | bigint unsigned | NO   | MUL | NULL    |                |
| created_at | timestamp       | YES  |     | NULL    |                |
| updated_at | timestamp       | YES  |     | NULL    |                |
+------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】以下にコマンドで確認する場合も示す．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

```bash
$  mysql -u sail -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 347
Server version: 8.0.25 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use laratter;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweet_user             |
| tweets                 |
| users                  |
+------------------------+
7 rows in set (0.00 sec)

mysql> desc tweet_user;
+------------+-----------------+------+-----+---------+----------------+
| Field      | Type            | Null | Key | Default | Extra          |
+------------+-----------------+------+-----+---------+----------------+
| id         | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id    | bigint unsigned | NO   | MUL | NULL    |                |
| tweet_id   | bigint unsigned | NO   | MUL | NULL    |                |
| created_at | timestamp       | YES  |     | NULL    |                |
| updated_at | timestamp       | YES  |     | NULL    |                |
+------------+-----------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)

mysql>
``` -->
<h2 id="モデルに多対多の連携を設定"><a class="header" href="#モデルに多対多の連携を設定">モデルに多対多の連携を設定</a></h2>
<p>User モデルに <code>belongsToMany</code> を設定して，User モデルは Tweet モデルと多対多の連携をすることを示す．</p>
<pre><code class="language-php">// app/Http/Models/User.php

&lt;?php

namespace App\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
  use HasApiTokens, HasFactory, Notifiable;

  // 省略

  // 🔽 追加
  public function tweets()
  {
    return $this-&gt;belongsToMany(Tweet::class)-&gt;withTimestamps();
  }
}

</code></pre>
<p>同様に Tweet モデルにも <code>belongsToMany</code> を設定する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  // 省略

  // 🔽 追加
  public function users()
  {
    return $this-&gt;belongsToMany(User::class)-&gt;withTimestamps();
  }
}

</code></pre>
<p>ここまでで，データを連携させる設定は完了となる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="favorite-機能-2各処理の実装"><a class="header" href="#favorite-機能-2各処理の実装">Favorite 機能 2（各処理の実装）</a></h1>
<p>データ連携の準備ができたので，各処理を実装していく．</p>
<h2 id="コントローラ生成"><a class="header" href="#コントローラ生成">コントローラ生成</a></h2>
<p>まずは，favorite 処理用のコントローラを作成する．</p>
<blockquote>
<p>📦<strong>Laravel コンテナ内の操作</strong></p>
<pre><code class="language-bash">$ docker-compose exec laravel.testbash
root@8544d96d2334: /var/www/html #
</code></pre>
</blockquote>
<p>下記のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:controller FavoriteController --resource

# 実行結果
Controller created successfully.

</code></pre>
<h2 id="ルーティングの設定"><a class="header" href="#ルーティングの設定">ルーティングの設定</a></h2>
<p>続いてルーティングを設定する．</p>
<p>今回は<code>favorite</code>と<code>unfavorite</code>の URI を設定し，FavoriteController の<code>store()</code>関数と<code>destroy()</code>関数をそれぞれ利用する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

// 🔽 追加
use App\Http\Controllers\FavoriteController;

// 省略

Route::group(['middleware' =&gt; 'auth'], function () {
  // 🔽 追加
  Route::post('tweet/{tweet}/favorites', [FavoriteController::class, 'store'])-&gt;name('favorites');

  // 🔽 追加
  Route::post('tweet/{tweet}/unfavorites', [FavoriteController::class, 'destroy'])-&gt;name('unfavorites');

  Route::get('/tweet/mypage', [TweetController::class, 'mydata'])-&gt;name('tweet.mypage');
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="コントローラの処理を実装"><a class="header" href="#コントローラの処理を実装">コントローラの処理を実装</a></h2>
<p>ルーティングで設定した<code>store()</code>関数と<code>destroy()</code>関数の中身を実装する．</p>
<p><code>app/Http/Controllers/FavoriteController.php</code>を以下のように編集する．</p>
<p><code>attach()</code>で中間テーブルへのデータの追加，<code>detach()</code>で中間テーブルからのデータ削除が実行される．</p>
<pre><code class="language-php">// app/Http/Controllers/FavoriteController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

// 🔽 2行追加
use App\Models\Tweet;
use Auth;

class FavoriteController extends Controller
{

  // 省略

  // 🔽 編集（`store()` の `()` 内も異なるので注意）
  public function store(Tweet $tweet)
  {
    $tweet-&gt;users()-&gt;attach(Auth::id());
    return redirect()-&gt;route('tweet.index');
  }

  // 🔽 編集（`destroy()` の `()` 内も異なるので注意）
  public function destroy(Tweet $tweet)
  {
    $tweet-&gt;users()-&gt;detach(Auth::id());
    return redirect()-&gt;route('tweet.index');
  }
}

</code></pre>
<h2 id="一覧画面への反映"><a class="header" href="#一覧画面への反映">一覧画面への反映</a></h2>
<p>中間テーブルへのデータ追加及び削除の処理を実装したので，最後に favorite 数を一覧画面に反映させて完成となる．</p>
<p>まず，<code>$tweet-&gt;users()-&gt;where('user_id', Auth::id())-&gt;exists()</code>でログインしているユーザが favorite しているかどうかを判定する．</p>
<p>既 favorite の場合は unfavorite するボタンを，未 favorite の場合は favorite するボタンを条件分岐で表示する．</p>
<p>それぞれのボタン部分では favorite 件数を表示する．<code>$tweet-&gt;users()-&gt;count()</code> で中間テーブルのデータ件数を取得することができる．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;p class=&quot;text-left text-grey-dark&quot;&gt;{{$tweet-&gt;user-&gt;name}}&lt;/p&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 🔽 追加 --&gt;
                    &lt;!-- favorite 状態で条件分岐 --&gt;
                    @if($tweet-&gt;users()-&gt;where('user_id', Auth::id())-&gt;exists())
                    &lt;!-- unfavorite ボタン --&gt;
                    &lt;form action=&quot;{{ route('unfavorites',$tweet) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;flex mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-red py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-red-500&quot; fill=&quot;red&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;red&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot; /&gt;
                        &lt;/svg&gt;
                        {{ $tweet-&gt;users()-&gt;count() }}
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @else
                    &lt;!-- favorite ボタン --&gt;
                    &lt;form action=&quot;{{ route('favorites',$tweet) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;flex mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-black py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-red-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot; /&gt;
                        &lt;/svg&gt;
                        {{ $tweet-&gt;users()-&gt;count() }}
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif

                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-13"><a class="header" href="#動作確認-13">動作確認</a></h2>
<p>下図のように favorite ボタンが表示され，favorite 件数が表示されていれば OK．</p>
<p>ここまでで Twitter ライクな SNS アプリケーションの実装は完了である．</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_favorite.png" alt="favorite機能追加" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="デプロイ"><a class="header" href="#デプロイ">デプロイ</a></h1>
<p>Laravel で作成したプロジェクトを Lolipop マネージドクラウドにデプロイする．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="docker-編実装したコードを-github-へ-push"><a class="header" href="#docker-編実装したコードを-github-へ-push">【Docker 編】実装したコードを GitHub へ push</a></h1>
<p>いつもどおり GitHub にコードを push する．</p>
<h2 id="リポジトリの作成"><a class="header" href="#リポジトリの作成">リポジトリの作成</a></h2>
<p>適当につくっておく．</p>
<h2 id="ソースコードの-push"><a class="header" href="#ソースコードの-push">ソースコードの push</a></h2>
<blockquote>
<p>ローカルでの操作．「コンテナにログインしていない状態」で実行すること．</p>
</blockquote>
<p>以下のコマンドを実行する．</p>
<p>必ずプロジェクトのフォルダに<code>cd</code>してから実行すること！！</p>
<pre><code class="language-bash">$ git init
$ git remote add origin YOUR_REPOSITORY_URL
$ git add .
$ git commit -m&quot;first commit&quot;
$ git push origin main
</code></pre>
<p>GitHub にプロダクトのソースコードが push されていれば OK！</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ローカルからロリポップマネージドクラウドへのログイン"><a class="header" href="#ローカルからロリポップマネージドクラウドへのログイン">ローカルからロリポップマネージドクラウドへのログイン</a></h1>
<p>GitHub 上のソースコードをサーバ上にデプロイするため，ローカル PC のターミナルでマネージドクラウドの仮想マシンを操作する．</p>
<h2 id="ssh-通信の準備"><a class="header" href="#ssh-通信の準備">SSH 通信の準備</a></h2>
<p>まずはローカル PC とマネージドクラウドの間で通信ができるようにするための ssh-key を準備する．</p>
<p>（本手順は初めてマネージドクラウドと通信する場合のみ必要であり，プロジェクトが 2 つ目以降の場合は操作不要．）</p>
<blockquote>
<p>💻 ターミナルでの操作</p>
</blockquote>
<p>まず<code>id_rsa</code>と<code>id_rsa.pub</code>が存在するかどうか調べる．</p>
<p>下記コマンドで<code>.ssh</code>フォルダの中身を表示する．</p>
<pre><code class="language-bash">$ cd ~/.ssh
$ ls
</code></pre>
<p><code>id_rsa</code>と<code>id_rsa.pub</code>が存在するかどうかで下記のどちらかを行う．</p>
<h3 id="id_rsaとid_rsapubが存在する場合"><a class="header" href="#id_rsaとid_rsapubが存在する場合"><code>id_rsa</code>と<code>id_rsa.pub</code>が存在する場合</a></h3>
<p><code>id_rsa.pub</code>を使用する．</p>
<pre><code class="language-bash">$ cat id_rsa.pub
</code></pre>
<h3 id="id_rsaとid_rsapubが存在しない場合"><a class="header" href="#id_rsaとid_rsapubが存在しない場合"><code>id_rsa</code>と<code>id_rsa.pub</code>が存在しない場合</a></h3>
<p><code>ssh-keygen</code>を実行して新しく<code>id_rsa</code>と<code>id_rsa.pub</code>を作成して使用する．</p>
<pre><code class="language-bash">$ cd ~/.ssh
$ ssh-keygen
$ cat id_rsa.pub
</code></pre>
<h2 id="マネージドクラウドへの-ssh-キーの登録"><a class="header" href="#マネージドクラウドへの-ssh-キーの登録">マネージドクラウドへの SSH キーの登録</a></h2>
<blockquote>
<p>🌏 ブラウザでの操作</p>
</blockquote>
<p>Lolipop のページの右上から「SSH 公開鍵の追加」をクリックする．</p>
<p>上で表示した<code>id_rsa.pub</code>の中身を登録する．</p>
<h2 id="ターミナルからマネージドクラウドのマシンへログイン"><a class="header" href="#ターミナルからマネージドクラウドのマシンへログイン">ターミナルからマネージドクラウドのマシンへログイン</a></h2>
<blockquote>
<p>💻 ターミナルでの操作</p>
</blockquote>
<p>マネクラのプロジェクトページに表示されている「SSH コマンド」を入力してサーバにアクセスする．</p>
<p><strong>下記は一例なので必ず「自分のプロジェクト管理画面に表示されている SSH コマンド」を実行すること．</strong></p>
<pre><code class="language-bash">$ ssh -p 38216 reliable-amami-8204@ssh-1.mc.lolipop.jp
</code></pre>
<p>実行結果．（何か訊かれたら<code>yes</code>で進む）</p>
<pre><code class="language-bash">The authenticity of host '[ssh-1.mc.lolipop.jp]:38216 ([157.7.190.236]:38216)' can't be established.
ECDSA key fingerprint is SHA256:fqQ1YxW9OFrAwKVtnt92YIB2Bv6MQfJVGRo73gktLmk.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '[ssh-1.mc.lolipop.jp]:38216,[157.7.190.236]:38216' (ECDSA) to the list of known hosts.
Last login: Thu Jun 20 02:06:09 2019 from 10.1.36.1
  __  __  ____   _          _ _
 |  \/  |/ ___| | |    ___ | (_)_ __   ___  _ __
 | |\/| | |     | |   / _ \| | | '_ \ / _ \| '_ \
 | |  | | |___ _| |__| (_) | | | |_) | (_) | |_) |
 |_|  |_|\____(_)_____\___/|_|_| .__/ \___/| .__/
export PATH=$PATH:/var/www/bin
                               |_|         |_|

******* Welcome to Lolipop! Managed Cloud *******

reliable-amami-8204@ssh-aws-laravel01:~$
</code></pre>
<p>この状態で<code>reliable-hoge-6666@ssh-aws-laravel01:~$ </code>（← 状況によって文字列は異なる）となっていればうまくログインできている状態．</p>
<p>ある程度時間が経過すると自動的にログアウトされるので，その場合は再度 SSH コマンドを実行するとログインできる．</p>
<h3 id="-key-point-31"><a class="header" href="#-key-point-31">💡 Key Point</a></h3>
<blockquote>
<p><strong>※以下の「Lolipop での操作」は上記の状態（ターミナルが<code>reliable-hoge-6666@ssh-aws-laravel01:~$ </code>）になっていることを確認すること．</strong></p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ロリポップマネージドクラウドと-github-の-ssh-通信設定"><a class="header" href="#ロリポップマネージドクラウドと-github-の-ssh-通信設定">ロリポップマネージドクラウドと GitHub の SSH 通信設定</a></h1>
<p>ここまででローカル PC からマネージドクラウド上の仮想マシンを操作できるようになった．</p>
<p>続いて，マネージドクラウド上に GitHub のソースコードをデプロイするため，両者の間で通信できるように設定を行う．</p>
<h2 id="ssh-key-の発行-1"><a class="header" href="#ssh-key-の発行-1">ssh-key の発行</a></h2>
<blockquote>
<p>Lolipop での操作</p>
</blockquote>
<p>ssh-key を作成し，マネクラと GitHub の間で通信できるようにする．</p>
<pre><code class="language-bash">$ cd .ssh
$ ssh-keygen
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Generating public/private rsa key pair.
Enter file in which to save the key (/var/www//.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /var/www//.ssh/id_rsa.
Your public key has been saved in /var/www//.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:NPkD2j3bgqXWJ2G2nO2hMjGh3pZwruePjPnFosuUuPc reliable-amami-8204@ssh-aws-laravel01.lolipop.io-2adc16106d
The key's randomart image is:
+---[RSA 2048]----+
|                 |
|         .       |
|        =        |
|       +.=       |
|      ..w.w      |
|     .w.+w w     |
|    ..w==+@ =    |
|     +w*w+ * .   |
|    ..www+w .    |
+----[SHA256]-----+
</code></pre>
<h2 id="ssh-key-の表示と登録"><a class="header" href="#ssh-key-の表示と登録">ssh-key の表示と登録</a></h2>
<p>作成した ssh-key を表示する．</p>
<pre><code class="language-bash">$ cat id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJPmXzhA733dAupv+pVUG6I04agsUSKI7BeekJgBn//1P7Ca96JJkqd1M8yBHARSJxYdSUC31Dn9UpmO87XVLVlVCjmwwwwwwwwwwwwwwwwzIqvRtJmOfvQEfJ/cvBA/bPkrD3V80epwlWiVfWNPSKIZYKVf3LRJI2RoU8WtNSI/Zc8VOH+NOxRVQRQrYaHUSjKDqwFqKK/ttuG4xoRHXPI4Xj4rNn+zfNcd52z0Njq/TtpOAZ6TH6Xtg366sc60HJpIBcQfiz8Kq1mpmw5aLqTzz2l6V0rbsQB0zZCIaqdpFdRUf47aMRBpqK10LPB9N8jC3Gq5Gb1WuJY5Asbzxp reliable-amami-8204@ssh-aws-laravel01.lolipop.io-2adc16106d
</code></pre>
<blockquote>
<p>ブラウザでの操作</p>
</blockquote>
<p>上記で表示された GitHub サイトに ssh-key を登録する．流れはこれまでと同様．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-上のコードをマネージドクラウドにデプロイ"><a class="header" href="#github-上のコードをマネージドクラウドにデプロイ">GitHub 上のコードをマネージドクラウドにデプロイ</a></h1>
<p>ここまでで下記のように必要な通信ができるようになった．</p>
<ul>
<li>ローカル PC と GitHub</li>
<li>ローカル PC とマネージドクラウドの仮想マシン</li>
<li>マネージドクラウドの仮想マシンと GitHub</li>
</ul>
<p>通信の環境が整ったので，マネージドクラウドの仮想マシン上に GitHub のコードをデプロイする．</p>
<h2 id="仮想マシンの準備"><a class="header" href="#仮想マシンの準備">仮想マシンの準備</a></h2>
<blockquote>
<p>🔗 Lolipop での作業</p>
</blockquote>
<p>まず，デプロイに関する準備（以下）をする．</p>
<ul>
<li>デプロイ用ディレクトリの作成</li>
<li><code>composer</code>のダウンロード</li>
<li>必要なパスを通す</li>
<li>Laravel の準備</li>
</ul>
<h3 id="デプロイ用ディレクトリの作成"><a class="header" href="#デプロイ用ディレクトリの作成">デプロイ用ディレクトリの作成</a></h3>
<p>以下を順に実行する．</p>
<pre><code class="language-bash">$ cd /var/www
$ mkdir bin
$ cd bin
</code></pre>
<h3 id="composer-のダウンロード"><a class="header" href="#composer-のダウンロード">composer のダウンロード</a></h3>
<pre><code class="language-bash">$ php -r &quot;copy('https://getcomposer.org/installer', 'composer-setup.php');&quot;
$ php composer-setup.php
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">All settings correct for using Composer
Downloading...

Composer (version 1.10.8) successfully installed to: /var/www/bin/composer.phar
Use it: php composer.phar
</code></pre>
<p>composer のファイルを移動する．</p>
<pre><code class="language-bash">$ mv composer.phar composer
</code></pre>
<h3 id="パスを通す"><a class="header" href="#パスを通す">パスを通す</a></h3>
<p>下記のコマンドを実行する．</p>
<pre><code class="language-bash">$ export PATH=$PATH:/var/www/bin
</code></pre>
<p><code>.bash_profile</code>を開き，設定ファイルを編集する．</p>
<pre><code class="language-bash">$ vi ~/.bash_profile
</code></pre>
<p><code>.bash_profile</code>に以下を追記する．</p>
<pre><code class="language-bash">export PATH=$PATH:/var/www/bin
</code></pre>
<h3 id="laravel-の準備"><a class="header" href="#laravel-の準備">Laravel の準備</a></h3>
<p>ディレクトリを移動し，Laravel のインストーラを準備する．</p>
<pre><code class="language-bash">$ cd /var/www
$ composer global require 'laravel/installer'
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">...
symfony/console suggests installing psr/log (For using the console logger)
guzzlehttp/guzzle suggests installing psr/log (Required for using the Log middleware)
Writing lock file
Generating autoload files
11 packages you are using are looking for funding.
Use the `composer fund` command to find out more!
</code></pre>
<h2 id="github-上のコードをデプロイ"><a class="header" href="#github-上のコードをデプロイ">GitHub 上のコードをデプロイ</a></h2>
<p>GitHub から自分が作成したプロジェクトのファイルをダウンロードして<code>project</code>ディレクトリにコピーし，アプリケーションが動作するように設定を行う．</p>
<pre><code class="language-bash">$ git clone YOUR_REPOSITORY_URL project
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Cloning into 'project'...
Warning: Permanently added the RSA host key for IP address '11.11.111.11' to the list of known hosts.
remote: Enumerating objects: 140, done.
remote: Counting objects: 100% (140/140), done.
remote: Compressing objects: 100% (104/104), done.
remote: Total 140 (delta 17), reused 140 (delta 17), pack-reused 0
Receiving objects: 100% (140/140), 195.58 KiB | 0 bytes/s, done.
Resolving deltas: 100% (17/17), done.
Checking connectivity... done.
</code></pre>
<h3 id="-key-point-32"><a class="header" href="#-key-point-32">💡 Key Point</a></h3>
<blockquote>
<p>初回は<code>git clone</code>コマンドでソースコードをダウンロードするが，2 回め以降（機能追加した場合など）は<code>git pull</code>コマンドで差分管理する．</p>
</blockquote>
<p>デプロイしたディレクトリに移動し，必要なライブラリをインストールする．</p>
<pre><code class="language-bash">$ cd /var/www/project/
$ composer install
</code></pre>
<p>実行結果（長い）</p>
<pre><code class="language-bash">...
Discovered Package: beyondcode/laravel-dump-server
Discovered Package: fideloper/proxy
Discovered Package: laravel/tinker
Discovered Package: nesbot/carbon
Discovered Package: nunomaduro/collision
Package manifest generated successfully.
43 packages you are using are looking for funding.
Use the `composer fund` command to find out more!
</code></pre>
<h2 id="db-関連の準備"><a class="header" href="#db-関連の準備">DB 関連の準備</a></h2>
<p>設定ファイルを準備し，DB 関連の設定を記述する．</p>
<pre><code class="language-bash">$ cp .env.example .env
$ vi .env
</code></pre>
<p>以下のように編集する．</p>
<pre><code class="language-bash">DB_CONNECTION=mysql
DB_HOST=マネクラ管理画面にあるDBのホスト名
DB_PORT=3306
DB_DATABASE=マネクラ管理画面にあるDB名
DB_USERNAME=マネクラ管理画面にあるユーザー名
DB_PASSWORD=プロジェクト作成時に決めたパスワード
</code></pre>
<p>マイグレーションを実行してテーブルを準備する．</p>
<pre><code class="language-bash">$ php artisan migrate
Migration table created successfully.
Migrating: 2014_10_12_000000_create_users_table
Migrated:  2014_10_12_000000_create_users_table (0.01 seconds)
Migrating: 2014_10_12_100000_create_password_resets_table
Migrated:  2014_10_12_100000_create_password_resets_table (0.01 seconds)
Migrating: 2019_08_19_000000_create_failed_jobs_table
Migrated:  2019_08_19_000000_create_failed_jobs_table (0 seconds)
Migrating: 2020_06_23_024905_create_tasks_table
Migrated:  2020_06_23_024905_create_tasks_table (0 seconds)
</code></pre>
<p>アプリケーションキーを作成する．</p>
<pre><code class="language-bash">$ php artisan key:generate
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Application key set successfully.
</code></pre>
<h2 id="シンボリックリンクの作成"><a class="header" href="#シンボリックリンクの作成">シンボリックリンクの作成</a></h2>
<p>ルートディレクトリを設定できないので，<code>/var/www/html</code>をシンボリックリンクにして<code>/var/www/project/public/</code>を参照する．</p>
<pre><code class="language-bash">$ rm -rf /var/www/html/
$ ln -s /var/www/project/public/ /var/www/html
</code></pre>
<p>ブラウザでプロジェクトの URL にアクセスして表示されれば OK！</p>
<p>以上である( `･ω･)b</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
